<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Module      : Control.Auto.Serialize</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Description : Serializing and deserializing 'Auto's to and from disk,</span><span>
</span><a name="line-6"></a><span class="hs-comment">--               and also 'Auto' transformers focused around serialization.</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Copyright   : (c) Justin Le 2015</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- License     : MIT</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Maintainer  : justin@jle.im</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Stability   : unstable</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Portability : portable</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- This module provides tools for working with the automatically derived</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- serializability and resumability of 'Auto's.  The first half contains</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- boring wrappers around encoding and decoding to and from binary,</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- filepaths on disk, etc.</span><span>
</span><a name="line-17"></a><span class="hs-comment">--</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- The second half contains 'Auto' transformers that &quot;imbue&quot; an 'Auto' with</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- IO serialization abilities.  Note that these all require an underlying</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- 'Monad' that is an instance of 'MonadIO'.</span><span>
</span><a name="line-21"></a><span class="hs-comment">--</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- You have &quot;identity-like&quot; transformers that take an 'Auto' and spit it</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- back out operationally unchanged...but every step, it might do some</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- behind-the-scenes saving or re-load itself from disk when it is first</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- stepped.  Or you have some &quot;trigger enhancers&quot; that take normal 'Auto's</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- and give you the ability to &quot;trigger&quot; saving and loading events on the</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- 'Auto' using the 'Blip' mechanisms and blip stream semantics from</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- &quot;Control.Auto.Blip&quot;.</span><span>
</span><a name="line-29"></a><span class="hs-comment">--</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- Note that the entire 'Auto' construct is a little bit awkward when it</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- comes to performing IO effects --- it isn't exactly what they were</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- designed for originally.  Hooking on effects to stepping can be</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- powerful, but as of now, not much has been looked into meaningful error</span><span>
</span><a name="line-34"></a><span class="hs-comment">-- handling when working with IO.  If you have any experience with this and</span><span>
</span><a name="line-35"></a><span class="hs-comment">-- are willing to help, please feel free to send me an e-mail or open an</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- issue on the &lt;https://github.com/mstksg/auto/issues issue tracker&gt;!</span><span>
</span><a name="line-37"></a><span class="hs-comment">--</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-comment">-- * Serializing and deserializing 'Auto's</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-comment">-- ** To and from &quot;Data.Serialize&quot; types</span><span>
</span><a name="line-42"></a><span>    </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-comment">-- ** To and from binary</span><span>
</span><a name="line-45"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#encodeAuto"><span class="hs-identifier hs-var">encodeAuto</span></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#decodeAuto"><span class="hs-identifier hs-var">decodeAuto</span></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-comment">-- ** To and from disk</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#writeAuto"><span class="hs-identifier hs-var">writeAuto</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#readAuto"><span class="hs-identifier hs-var">readAuto</span></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#readAutoDef"><span class="hs-identifier hs-var">readAutoDef</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-comment">-- * Imbuing 'Auto's with serialization</span><span>
</span><a name="line-52"></a><span>  </span><span class="hs-comment">-- ** Implicit automatic serialization</span><span>
</span><a name="line-53"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#saving"><span class="hs-identifier hs-var">saving</span></a><span>
</span><a name="line-54"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loading%27"><span class="hs-identifier hs-var">loading'</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loading"><span class="hs-identifier hs-var">loading</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#serializing%27"><span class="hs-identifier hs-var">serializing'</span></a><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#serializing"><span class="hs-identifier hs-var">serializing</span></a><span>
</span><a name="line-58"></a><span>  </span><span class="hs-comment">-- ** Triggered (blip stream-based) automatic serialization</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-comment">-- $onfrom</span><span>
</span><a name="line-60"></a><span>  </span><span class="hs-comment">-- *** External triggering</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#saveOnB"><span class="hs-identifier hs-var">saveOnB</span></a><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadOnB%27"><span class="hs-identifier hs-var">loadOnB'</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadOnB"><span class="hs-identifier hs-var">loadOnB</span></a><span>
</span><a name="line-64"></a><span>  </span><span class="hs-comment">-- *** Intrinsic triggering</span><span>
</span><a name="line-65"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#saveFromB"><span class="hs-identifier hs-var">saveFromB</span></a><span>
</span><a name="line-66"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadFromB%27"><span class="hs-identifier hs-var">loadFromB'</span></a><span>
</span><a name="line-67"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadFromB"><span class="hs-identifier hs-var">loadFromB</span></a><span>
</span><a name="line-68"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Blip.Internal.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Blip</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Core.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System</span><span class="hs-operator">.</span><span class="hs-identifier">IO</span><span class="hs-operator">.</span><span class="hs-identifier">Error</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">-- | Give a 'FilePath' and an 'Auto', and 'readAuto' will attempt to resume</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- the saved state of the 'Auto' from disk, reading from the given</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- 'FilePath'.  Will return 'Left' upon a decoding error, with the error,</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- and 'Right' if the decoding is succesful.</span><span>
</span><a name="line-84"></a><span class="hs-identifier">readAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>        </span><span class="hs-comment">-- ^ filepath to read from</span><span>
</span><a name="line-85"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470173"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470174"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470175"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto' to resume</span><span>
</span><a name="line-86"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470173"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470174"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470175"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><a name="readAuto"><a href="Control.Auto.Serialize.html#readAuto"><span class="hs-identifier">readAuto</span></a></a><span> </span><a name="local-1627470176"><a href="#local-1627470176"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470177"><a href="#local-1627470177"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#decodeAuto"><span class="hs-identifier hs-var">decodeAuto</span></a><span> </span><a href="#local-1627470177"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">readFile</span><span> </span><a href="#local-1627470176"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- | Like 'readAuto', but will return the /original/ 'Auto' (instead of</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- a resumed one) if the file does not exist.</span><span>
</span><a name="line-91"></a><span class="hs-comment">--</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- Useful if you want to &quot;resume an 'Auto'&quot; &quot;if there is&quot; a save state, or</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- just use it as-is if there isn't.</span><span>
</span><a name="line-94"></a><span class="hs-identifier">readAutoDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>             </span><span class="hs-comment">-- ^ filepath to read from</span><span>
</span><a name="line-95"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470170"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470171"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470172"><span class="hs-identifier hs-type">b</span></a><span>           </span><span class="hs-comment">-- ^ 'Auto' to resume</span><span>
</span><a name="line-96"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470170"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470171"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470172"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><a name="readAutoDef"><a href="Control.Auto.Serialize.html#readAutoDef"><span class="hs-identifier">readAutoDef</span></a></a><span> </span><a name="local-1627470178"><a href="#local-1627470178"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470179"><a href="#local-1627470179"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-98"></a><span>    </span><a name="local-1627470504"><a href="#local-1627470504"><span class="hs-identifier">esa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#readAuto"><span class="hs-identifier hs-var">readAuto</span></a><span> </span><a href="#local-1627470178"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-1627470179"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470504"><span class="hs-identifier hs-var">esa</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-100"></a><span>      </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627470505"><a href="#local-1627470505"><span class="hs-identifier">a'</span></a></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470505"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-101"></a><span>      </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627470506"><a href="#local-1627470506"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isDoesNotExistError</span><span> </span><a href="#local-1627470506"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627470179"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throw</span><span> </span><a href="#local-1627470506"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | Like 'readAuto', but will throw a runtime exception on a failure to</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- decode or an IO error.</span><span>
</span><a name="line-106"></a><span class="hs-identifier">readAutoErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>             </span><span class="hs-comment">-- ^ filepath to read from</span><span>
</span><a name="line-107"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470167"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470168"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470169"><span class="hs-identifier hs-type">b</span></a><span>           </span><span class="hs-comment">-- ^ 'Auto' to resume</span><span>
</span><a name="line-108"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470167"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470168"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470169"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><a name="readAutoErr"><a href="Control.Auto.Serialize.html#readAutoErr"><span class="hs-identifier">readAutoErr</span></a></a><span> </span><a name="local-1627470764"><a href="#local-1627470764"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470765"><a href="#local-1627470765"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-110"></a><span>    </span><a name="local-1627470766"><a href="#local-1627470766"><span class="hs-identifier">esa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Serialize.html#readAuto"><span class="hs-identifier hs-var">readAuto</span></a><span> </span><a href="#local-1627470764"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-1627470765"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-111"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470766"><span class="hs-identifier hs-var">esa</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-112"></a><span>      </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627470767"><a href="#local-1627470767"><span class="hs-identifier">e</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;readAutoErr: Corrupted Auto binary -- &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-1627470767"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-113"></a><span>      </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627470797"><a href="#local-1627470797"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627470797"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- | Given a 'FilePath' and an 'Auto', serialize and freeze the state of</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- the 'Auto' as binary to that 'FilePath'.</span><span>
</span><a name="line-117"></a><span class="hs-identifier">writeAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>       </span><span class="hs-comment">-- ^ filepath to write to</span><span>
</span><a name="line-118"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470164"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470165"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470166"><span class="hs-identifier hs-type">b</span></a><span>     </span><span class="hs-comment">-- ^ 'Auto' to serialize</span><span>
</span><a name="line-119"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><a name="writeAuto"><a href="Control.Auto.Serialize.html#writeAuto"><span class="hs-identifier">writeAuto</span></a></a><span> </span><a name="local-1627470798"><a href="#local-1627470798"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470799"><a href="#local-1627470799"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">writeFile</span><span> </span><a href="#local-1627470798"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#encodeAuto"><span class="hs-identifier hs-var">encodeAuto</span></a><span> </span><a href="#local-1627470799"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- | &quot;Transforms&quot; the given 'Auto' into an 'Auto' that constantly saves its</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- state to the given 'FilePath' at every &quot;step&quot;.  Requires an underlying</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- 'MonadIO'.</span><span>
</span><a name="line-125"></a><span class="hs-comment">--</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- Note that (unless the 'Auto' depends on IO), the resulting 'Auto' is</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- meant to be operationally /identical/ in its inputs/outputs to the</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- original one.</span><span>
</span><a name="line-129"></a><span class="hs-comment">--</span><span>
</span><a name="line-130"></a><span class="hs-identifier">saving</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470161"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-131"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>          </span><span class="hs-comment">-- ^ filepath to write to</span><span>
</span><a name="line-132"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470161"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470162"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470163"><span class="hs-identifier hs-type">b</span></a><span>        </span><span class="hs-comment">-- ^ 'Auto' to transform</span><span>
</span><a name="line-133"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470161"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470162"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470163"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-134"></a><a name="saving"><a href="Control.Auto.Serialize.html#saving"><span class="hs-identifier">saving</span></a></a><span> </span><a name="local-1627470800"><a href="#local-1627470800"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#interceptO"><span class="hs-identifier hs-var">interceptO</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627470801"><a href="#local-1627470801"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470802"><a href="#local-1627470802"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-135"></a><span>                             </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#writeAuto"><span class="hs-identifier hs-var">writeAuto</span></a><span> </span><a href="#local-1627470800"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-1627470802"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-136"></a><span>                             </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470801"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | &quot;Transforms&quot; the given 'Auto' into an 'Auto' that, when you /first/</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- try to run or step it, &quot;loads&quot; itself from disk at the given 'FilePath'.</span><span>
</span><a name="line-140"></a><span class="hs-comment">--</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- Will throw a runtime exception on either an I/O error or a decoding</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- error.</span><span>
</span><a name="line-143"></a><span class="hs-comment">--</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- Note that (unless the 'Auto' depends on IO), the resulting 'Auto' is</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- meant to be operationally /identical/ in its inputs/outputs to the</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- /fast-forwarded/ original 'Auto'.</span><span>
</span><a name="line-147"></a><span class="hs-comment">--</span><span>
</span><a name="line-148"></a><span class="hs-identifier">loading</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470158"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-149"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>         </span><span class="hs-comment">-- ^ filepath to read from</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470158"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470159"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470160"><span class="hs-identifier hs-type">b</span></a><span>       </span><span class="hs-comment">-- ^ 'Auto' to transform</span><span>
</span><a name="line-151"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470158"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470159"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470160"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-152"></a><a name="loading"><a href="Control.Auto.Serialize.html#loading"><span class="hs-identifier">loading</span></a></a><span> </span><a name="local-1627470803"><a href="#local-1627470803"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470804"><a href="#local-1627470804"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loading"><span class="hs-identifier hs-var">loading</span></a><span> </span><a href="#local-1627470803"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470804"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>                         </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470804"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>                         </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627470810"><a href="#local-1627470810"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-155"></a><span>                             </span><a name="local-1627470811"><a href="#local-1627470811"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="#local-1627470805"><span class="hs-identifier hs-var">loaded</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#readAutoErr"><span class="hs-identifier hs-var">readAutoErr</span></a><span> </span><a href="#local-1627470803"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-1627470804"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-156"></a><span>                             </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470811"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627470810"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-158"></a><span>    </span><a name="local-1627470805"><a href="#local-1627470805"><span class="hs-identifier">loaded</span></a></a><span> </span><a name="local-1627470806"><a href="#local-1627470806"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loading%27"><span class="hs-identifier hs-var">loading'</span></a><span> </span><a href="#local-1627470803"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470806"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>                       </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470806"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627470807"><a href="#local-1627470807"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-161"></a><span>                           </span><span class="hs-special">(</span><a name="local-1627470808"><a href="#local-1627470808"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470809"><a href="#local-1627470809"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470806"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627470807"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-162"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470808"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627470805"><span class="hs-identifier hs-var">loaded</span></a><span> </span><a href="#local-1627470809"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">-- | Like 'loading', except silently suppresses all I/O and decoding</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- errors; if there are errors, it returns back the given 'Auto' as-is.</span><span>
</span><a name="line-168"></a><span class="hs-comment">--</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- Useful for when you aren't sure the save state is on disk or not yet,</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- and want to resume it only in the case that it is.</span><span>
</span><a name="line-171"></a><span class="hs-identifier">loading'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470155"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-172"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>        </span><span class="hs-comment">-- ^ filepath to read from</span><span>
</span><a name="line-173"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470155"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470156"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470157"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto' to transform (or return unchanged)</span><span>
</span><a name="line-174"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470155"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470156"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470157"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-175"></a><a name="loading%27"><a href="Control.Auto.Serialize.html#loading%27"><span class="hs-identifier">loading'</span></a></a><span> </span><a name="local-1627470812"><a href="#local-1627470812"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470813"><a href="#local-1627470813"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loading%27"><span class="hs-identifier hs-var">loading'</span></a><span> </span><a href="#local-1627470812"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470813"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>                         </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470813"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-177"></a><span>                         </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627470819"><a href="#local-1627470819"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-178"></a><span>                             </span><a name="local-1627470822"><a href="#local-1627470822"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-179"></a><span>                               </span><a name="local-1627470820"><a href="#local-1627470820"><span class="hs-identifier">ea'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#readAutoDef"><span class="hs-identifier hs-var">readAutoDef</span></a><span> </span><a href="#local-1627470812"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-1627470813"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-180"></a><span>                               </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470820"><span class="hs-identifier hs-var">ea'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-181"></a><span>                                 </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627470821"><a href="#local-1627470821"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470814"><span class="hs-identifier hs-var">loaded</span></a><span> </span><a href="#local-1627470821"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>                                 </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470813"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-183"></a><span>                             </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470822"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627470819"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-184"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-185"></a><span>    </span><a name="local-1627470814"><a href="#local-1627470814"><span class="hs-identifier">loaded</span></a></a><span> </span><a name="local-1627470815"><a href="#local-1627470815"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loading%27"><span class="hs-identifier hs-var">loading'</span></a><span> </span><a href="#local-1627470812"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470815"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>                       </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470815"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627470816"><a href="#local-1627470816"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-188"></a><span>                           </span><span class="hs-special">(</span><a name="local-1627470817"><a href="#local-1627470817"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470818"><a href="#local-1627470818"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470815"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627470816"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-189"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470817"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627470814"><span class="hs-identifier hs-var">loaded</span></a><span> </span><a href="#local-1627470818"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- | A combination of 'saving' and 'loading'.  When the 'Auto' is first</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- run, it loads the save state from the given 'FilePath' and fast forwards</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- it.  Then, subsequently, it updates the save state on disk on every</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- step.</span><span>
</span><a name="line-195"></a><span class="hs-identifier">serializing</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470152"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-196"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>     </span><span class="hs-comment">-- ^ filepath to read from and write to</span><span>
</span><a name="line-197"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470152"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470153"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470154"><span class="hs-identifier hs-type">b</span></a><span>   </span><span class="hs-comment">-- ^ 'Auto' to transform</span><span>
</span><a name="line-198"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470152"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470153"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470154"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-199"></a><a name="serializing"><a href="Control.Auto.Serialize.html#serializing"><span class="hs-identifier">serializing</span></a></a><span> </span><a name="local-1627470823"><a href="#local-1627470823"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470824"><a href="#local-1627470824"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Serialize.html#loading"><span class="hs-identifier hs-var">loading</span></a><span> </span><a href="#local-1627470823"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#saving"><span class="hs-identifier hs-var">saving</span></a><span> </span><a href="#local-1627470823"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-1627470824"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- | Like 'serializing', except suppresses all I/O and decoding errors.</span><span>
</span><a name="line-202"></a><span class="hs-comment">--</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- Useful in the case that when the 'Auto' is first run and there is no</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- save state yet on disk (or the save state is corrupted), it'll &quot;start</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- a new one&quot;; if there is one, it'll load it automatically.  Then, on</span><span>
</span><a name="line-206"></a><span class="hs-comment">-- every further step in both cases, it'll update the save state.</span><span>
</span><a name="line-207"></a><span class="hs-identifier">serializing'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470149"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-208"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>        </span><span class="hs-comment">-- ^ filepath to read from and write to</span><span>
</span><a name="line-209"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470149"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470150"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470151"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto' to transform</span><span>
</span><a name="line-210"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470149"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470150"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470151"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-211"></a><a name="serializing%27"><a href="Control.Auto.Serialize.html#serializing%27"><span class="hs-identifier">serializing'</span></a></a><span> </span><a name="local-1627470825"><a href="#local-1627470825"><span class="hs-identifier">fp</span></a></a><span> </span><a name="local-1627470826"><a href="#local-1627470826"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Serialize.html#loading%27"><span class="hs-identifier hs-var">loading'</span></a><span> </span><a href="#local-1627470825"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#saving"><span class="hs-identifier hs-var">saving</span></a><span> </span><a href="#local-1627470825"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-1627470826"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-comment">-- $onfrom</span><span>
</span><a name="line-214"></a><span class="hs-comment">--</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- Note that these follow the naming conventions from</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- &quot;Control.Auto.Switch&quot;: Something &quot;from&quot; a blip stream is a thing</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- triggered by the 'Auto' itself, and something &quot;on&quot; a blip stream is</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- a thing triggered externally, from another 'Auto'.</span><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-comment">-- | Takes an 'Auto' that produces a blip stream with a 'FilePath' and</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- a value, and turns it into an 'Auto' that, outwardly, produces just the</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- value.</span><span>
</span><a name="line-223"></a><span class="hs-comment">--</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- Whenever the output blip stream emits, it automatically serializes and</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- saves the state of the 'Auto' to the emitted 'FilePath'.</span><span>
</span><a name="line-226"></a><span class="hs-comment">--</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- In practice, this allows any 'Auto' to basically control when it wants</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- to &quot;save&quot;, by providing a blip stream.</span><span>
</span><a name="line-229"></a><span class="hs-comment">--</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- The following is an alternative implementation of 'saving', except</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- saving every two steps instead of every step:</span><span>
</span><a name="line-232"></a><span class="hs-comment">--</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- saving2 fp a = 'saveFromB' (a '&amp;&amp;&amp;' ('every' 2 . 'pure' fp))</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-236"></a><span class="hs-comment">--</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- Or, in proc notation:</span><span>
</span><a name="line-238"></a><span class="hs-comment">--</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- &gt; saving2 fp a = saveFromB $ proc x -&gt; do</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- &gt;     y &lt;- a       -&lt; x</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- &gt;     b &lt;- every 2 -&lt; fp</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- &gt;     id -&lt; (y, b)</span><span>
</span><a name="line-243"></a><span class="hs-comment">--</span><span>
</span><a name="line-244"></a><span class="hs-comment">-- (Recall that @'every' n@ is the &quot;Auto&quot; that emits the received value</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- every @n@ steps)</span><span>
</span><a name="line-246"></a><span class="hs-comment">--</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- In useful real-world cases, you can have the 'Auto' decide whether or</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- not to save itself based on its input.  Like, for example, when it</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- detects a certain user command, or when the user has reached a given</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- location.</span><span>
</span><a name="line-251"></a><span class="hs-comment">--</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- The following takes a 'FilePath' and an 'Auto' (@a@), and turns it into</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- an 'Auto' that &quot;saves&quot; whenever @a@ crosses over from positive to</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- negative.</span><span>
</span><a name="line-255"></a><span class="hs-comment">--</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- saveOnNegative fp a = saveFromB $ proc x -&gt; do</span><span>
</span><a name="line-258"></a><span class="hs-comment">--     y       &lt;- a            -&lt; x</span><span>
</span><a name="line-259"></a><span class="hs-comment">--     saveNow &lt;- 'became' (&lt; 0) -&lt; y</span><span>
</span><a name="line-260"></a><span class="hs-comment">--     id       -&lt; (y, fp '&lt;$' saveNow)</span><span>
</span><a name="line-261"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-262"></a><span class="hs-comment">--</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- Contrast to 'saveOnB', where the saves are triggered by outside input.</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- In this case, the saves are triggered by the 'Auto' to be saved itself.</span><span>
</span><a name="line-265"></a><span class="hs-comment">--</span><span>
</span><a name="line-266"></a><span class="hs-identifier">saveFromB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470146"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-267"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470146"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470147"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627470148"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ 'Auto' producing a value</span><span>
</span><a name="line-268"></a><span>                                            </span><span class="hs-comment">--   @b@ and a blip stream</span><span>
</span><a name="line-269"></a><span>                                            </span><span class="hs-comment">--   with a 'FilePath' to save</span><span>
</span><a name="line-270"></a><span>                                            </span><span class="hs-comment">--   to</span><span>
</span><a name="line-271"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470146"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470147"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470148"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-272"></a><a name="saveFromB"><a href="Control.Auto.Serialize.html#saveFromB"><span class="hs-identifier">saveFromB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#interceptO"><span class="hs-identifier hs-var">interceptO</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1627470827"><a href="#local-1627470827"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470828"><a href="#local-1627470828"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627470829"><a href="#local-1627470829"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-273"></a><span>                             </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470828"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-274"></a><span>                               </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627470830"><a href="#local-1627470830"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#writeAuto"><span class="hs-identifier hs-var">writeAuto</span></a><span> </span><a href="#local-1627470830"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627470829"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-275"></a><span>                               </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>                             </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470827"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- | Takes an 'Auto' that outputs a @b@ and a blip stream of 'FilePath's</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- and returns an 'Auto' that ouputs only that @b@ stream...but every time</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- the blip stream emits, it &quot;resets/loads&quot; itself from that 'FilePath'.</span><span>
</span><a name="line-281"></a><span class="hs-comment">--</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- The following is a re-implementation of 'loading'...except delayed by</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- one (the second step that is run is the first &quot;resumed&quot; step).</span><span>
</span><a name="line-284"></a><span class="hs-comment">--</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- loading2 fp a = 'loadFromB' $ proc x -&gt; do</span><span>
</span><a name="line-287"></a><span class="hs-comment">--     y       &lt;- a           -&lt; x</span><span>
</span><a name="line-288"></a><span class="hs-comment">--     loadNow &lt;- 'immediately' -&lt; fp</span><span>
</span><a name="line-289"></a><span class="hs-comment">--     'id'       -&lt; (y, loadNow)</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-291"></a><span class="hs-comment">--</span><span>
</span><a name="line-292"></a><span class="hs-comment">-- (the blip stream emits only once, immediately, to re-load).</span><span>
</span><a name="line-293"></a><span class="hs-comment">--</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- In the real world, you could have the 'Auto' decide to reset or resume</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- itself based on a user command:</span><span>
</span><a name="line-296"></a><span class="hs-comment">--</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- loadFrom = loadFromB $ proc x -&gt; do</span><span>
</span><a name="line-299"></a><span class="hs-comment">--     steps  &lt;- count -&lt; ()</span><span>
</span><a name="line-300"></a><span class="hs-comment">--     toLoad &lt;- case words x of</span><span>
</span><a name="line-301"></a><span class="hs-comment">--                   (&quot;load&quot;:fp:_) -&gt; do</span><span>
</span><a name="line-302"></a><span class="hs-comment">--                       immediately -&lt; fp</span><span>
</span><a name="line-303"></a><span class="hs-comment">--                   _             -&gt; do</span><span>
</span><a name="line-304"></a><span class="hs-comment">--                       never       -&lt; ()</span><span>
</span><a name="line-305"></a><span class="hs-comment">--     id      -&lt; (steps, toLoad)</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-307"></a><span class="hs-comment">--</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- This will throw a runtime error on an IO exception or parsing error.</span><span>
</span><a name="line-309"></a><span class="hs-comment">--</span><span>
</span><a name="line-310"></a><span class="hs-identifier">loadFromB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470143"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-311"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470143"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470144"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627470145"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ 'Auto' with an output</span><span>
</span><a name="line-312"></a><span>                                            </span><span class="hs-comment">--     and a blip stream to</span><span>
</span><a name="line-313"></a><span>                                            </span><span class="hs-comment">--     trigger re-loading</span><span>
</span><a name="line-314"></a><span>                                            </span><span class="hs-comment">--     itself from the given</span><span>
</span><a name="line-315"></a><span>                                            </span><span class="hs-comment">--     filepath</span><span>
</span><a name="line-316"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470143"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470144"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470145"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-317"></a><a name="loadFromB"><a href="Control.Auto.Serialize.html#loadFromB"><span class="hs-identifier">loadFromB</span></a></a><span> </span><a name="local-1627470831"><a href="#local-1627470831"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loadFromB%27"><span class="hs-identifier hs-var">loadFromB'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470831"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>                      </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470831"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>                      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627470832"><a href="#local-1627470832"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-320"></a><span>                          </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1627470833"><a href="#local-1627470833"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470834"><a href="#local-1627470834"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627470835"><a href="#local-1627470835"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470831"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627470832"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-321"></a><span>                          </span><a name="local-1627470837"><a href="#local-1627470837"><span class="hs-identifier">a''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470834"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-322"></a><span>                                   </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627470836"><a href="#local-1627470836"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#readAutoErr"><span class="hs-identifier hs-var">readAutoErr</span></a><span> </span><a href="#local-1627470836"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627470835"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-323"></a><span>                                   </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470835"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-324"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470833"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadFromB%27"><span class="hs-identifier hs-var">loadFromB'</span></a><span> </span><a href="#local-1627470837"><span class="hs-identifier hs-var">a''</span></a><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">-- | Like 'loadFromB', except silently ignores errors.  When a load is</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- requested, but there is an IO or parse error, the loading is skipped.</span><span>
</span><a name="line-328"></a><span class="hs-identifier">loadFromB'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470140"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-329"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470140"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470141"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627470142"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ 'Auto' with an output</span><span>
</span><a name="line-330"></a><span>                                            </span><span class="hs-comment">--     and a blip stream to</span><span>
</span><a name="line-331"></a><span>                                            </span><span class="hs-comment">--     trigger re-loading</span><span>
</span><a name="line-332"></a><span>                                            </span><span class="hs-comment">--     itself from the given</span><span>
</span><a name="line-333"></a><span>                                            </span><span class="hs-comment">--     filepath</span><span>
</span><a name="line-334"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470140"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470141"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470142"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-335"></a><a name="loadFromB%27"><a href="Control.Auto.Serialize.html#loadFromB%27"><span class="hs-identifier">loadFromB'</span></a></a><span> </span><a name="local-1627470838"><a href="#local-1627470838"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loadFromB%27"><span class="hs-identifier hs-var">loadFromB'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470838"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>                        </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470838"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>                        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627470839"><a href="#local-1627470839"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-338"></a><span>                            </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1627470840"><a href="#local-1627470840"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470841"><a href="#local-1627470841"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627470842"><a href="#local-1627470842"><span class="hs-identifier">a1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470838"><span class="hs-identifier hs-var">a0</span></a><span> </span><a href="#local-1627470839"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-339"></a><span>                            </span><a name="local-1627470846"><a href="#local-1627470846"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470841"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-340"></a><span>                                    </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627470843"><a href="#local-1627470843"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-341"></a><span>                                      </span><a name="local-1627470844"><a href="#local-1627470844"><span class="hs-identifier">ea3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#readAutoDef"><span class="hs-identifier hs-var">readAutoDef</span></a><span> </span><a href="#local-1627470843"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627470842"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-342"></a><span>                                      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470844"><span class="hs-identifier hs-var">ea3</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-343"></a><span>                                        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627470845"><a href="#local-1627470845"><span class="hs-identifier">a3</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470845"><span class="hs-identifier hs-var">a3</span></a><span>
</span><a name="line-344"></a><span>                                        </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470842"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-345"></a><span>                                    </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470842"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-346"></a><span>                            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470840"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadFromB%27"><span class="hs-identifier hs-var">loadFromB'</span></a><span> </span><a href="#local-1627470846"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- | Takes an 'Auto' and basically &quot;wraps&quot; it so that you can trigger saves</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- with a blip stream.</span><span>
</span><a name="line-350"></a><span class="hs-comment">--</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- For example, we can take @'sumFrom' 0@:</span><span>
</span><a name="line-352"></a><span class="hs-comment">--</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- 'saveOnB' ('sumFrom' 0) :: 'Auto' 'IO' ('Int', 'Blip' 'FilePath') 'Int'</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-356"></a><span class="hs-comment">--</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- It'll behave just like @'sumFrom' 0@ (with the input you pass in the</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- first field of the tuple)...and whenever the blip stream (the second</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- field of the input tuple) emits, it'll save the state of @'sumFrom' 0@</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- to disk at the given 'FilePath'.</span><span>
</span><a name="line-361"></a><span class="hs-comment">--</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- Contrast to 'saveFromB', where the 'Auto' itself can trigger saves; in</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- this one, saves are triggered &quot;externally&quot;.</span><span>
</span><a name="line-364"></a><span class="hs-comment">--</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- Might be useful in similar situations as 'saveFromB', except if you want</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- to trigger the save externally.</span><span>
</span><a name="line-367"></a><span class="hs-comment">--</span><span>
</span><a name="line-368"></a><span class="hs-identifier">saveOnB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470137"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-369"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470137"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470138"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470139"><span class="hs-identifier hs-type">b</span></a><span>       </span><span class="hs-comment">-- ^ 'Auto' to make saveable-by-trigger</span><span>
</span><a name="line-370"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470137"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627470138"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span> </span><a href="#local-1627470139"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-371"></a><a name="saveOnB"><a href="Control.Auto.Serialize.html#saveOnB"><span class="hs-identifier">saveOnB</span></a></a><span> </span><a name="local-1627470847"><a href="#local-1627470847"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#saveOnB"><span class="hs-identifier hs-var">saveOnB</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470847"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>                    </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470847"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>                    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627470848"><a href="#local-1627470848"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470849"><a href="#local-1627470849"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-374"></a><span>                      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470849"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-375"></a><span>                        </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627470850"><a href="#local-1627470850"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#writeAuto"><span class="hs-identifier hs-var">writeAuto</span></a><span> </span><a href="#local-1627470850"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627470847"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-376"></a><span>                        </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-377"></a><span>                      </span><span class="hs-special">(</span><a name="local-1627470851"><a href="#local-1627470851"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470852"><a href="#local-1627470852"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470847"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627470848"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-378"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470851"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#saveOnB"><span class="hs-identifier hs-var">saveOnB</span></a><span> </span><a href="#local-1627470852"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span class="hs-comment">-- | Takes an 'Auto' and basically &quot;wraps&quot; it so that you can trigger</span><span>
</span><a name="line-381"></a><span class="hs-comment">-- loads/resumes from a file with a blip stream.</span><span>
</span><a name="line-382"></a><span class="hs-comment">--</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- For example, we can take @'sumFrom' 0@:</span><span>
</span><a name="line-384"></a><span class="hs-comment">--</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- 'loadOnB' ('sumFrom' 0) :: 'Auto' 'IO' ('Int', 'Blip' 'FilePath') 'Int'</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-388"></a><span class="hs-comment">--</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- It'll behave just like @'sumFrom' 0@ (with the input you pass in the</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- first field of the tiple)...and whenever the blip stream (the second</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- field of the input tuple) emits, it'll &quot;reset&quot; and &quot;reload&quot; the</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- @'sumFrom' 0@ from the 'FilePath' on disk.</span><span>
</span><a name="line-393"></a><span class="hs-comment">--</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- Will throw a runtime exception if there is an IO error or a parse error.</span><span>
</span><a name="line-395"></a><span class="hs-comment">--</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- Contrast to 'loadFromB', where the 'Auto' itself can trigger</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- reloads/resets; in this one, the loads are triggered &quot;externally&quot;.</span><span>
</span><a name="line-398"></a><span class="hs-comment">--</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- Might be useful in similar situations as 'loadFromB', except if you want</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- to trigger the loading externally.</span><span>
</span><a name="line-401"></a><span class="hs-comment">--</span><span>
</span><a name="line-402"></a><span class="hs-identifier">loadOnB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470134"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-403"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470134"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470135"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470136"><span class="hs-identifier hs-type">b</span></a><span>       </span><span class="hs-comment">-- ^ 'Auto' to make reloadable-by-trigger</span><span>
</span><a name="line-404"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470134"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627470135"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span> </span><a href="#local-1627470136"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-405"></a><a name="loadOnB"><a href="Control.Auto.Serialize.html#loadOnB"><span class="hs-identifier">loadOnB</span></a></a><span> </span><a name="local-1627470853"><a href="#local-1627470853"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loadOnB%27"><span class="hs-identifier hs-var">loadOnB'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470853"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>                    </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470853"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>                    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627470854"><a href="#local-1627470854"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470855"><a href="#local-1627470855"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-408"></a><span>                        </span><a name="local-1627470857"><a href="#local-1627470857"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470855"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-409"></a><span>                                </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627470856"><a href="#local-1627470856"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#readAutoErr"><span class="hs-identifier hs-var">readAutoErr</span></a><span> </span><a href="#local-1627470856"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627470853"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-410"></a><span>                                </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470853"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-411"></a><span>                        </span><span class="hs-special">(</span><a name="local-1627470858"><a href="#local-1627470858"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470859"><a href="#local-1627470859"><span class="hs-identifier">a''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470857"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627470854"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-412"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470858"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadOnB%27"><span class="hs-identifier hs-var">loadOnB'</span></a><span> </span><a href="#local-1627470859"><span class="hs-identifier hs-var">a''</span></a><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-comment">-- | Like 'loadOnB', except silently ignores errors.  When a load is</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- requested, but there is an IO or parse error, the loading is skipped.</span><span>
</span><a name="line-416"></a><span class="hs-identifier">loadOnB'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-1627470021"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-417"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470021"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627470022"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627470023"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto' to make reloadable-by-trigger</span><span>
</span><a name="line-418"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627470021"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627470022"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span> </span><a href="#local-1627470023"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-419"></a><a name="loadOnB%27"><a href="Control.Auto.Serialize.html#loadOnB%27"><span class="hs-identifier">loadOnB'</span></a></a><span> </span><a name="local-1627470860"><a href="#local-1627470860"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Serialize.html#loadOnB%27"><span class="hs-identifier hs-var">loadOnB'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627470860"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>                      </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627470860"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>                      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627470861"><a href="#local-1627470861"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470862"><a href="#local-1627470862"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-422"></a><span>                          </span><a name="local-1627470866"><a href="#local-1627470866"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470862"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-423"></a><span>                                  </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627470863"><a href="#local-1627470863"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-424"></a><span>                                    </span><a name="local-1627470864"><a href="#local-1627470864"><span class="hs-identifier">ea2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Control.Auto.Serialize.html#readAutoDef"><span class="hs-identifier hs-var">readAutoDef</span></a><span> </span><a href="#local-1627470863"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627470860"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-425"></a><span>                                    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627470864"><span class="hs-identifier hs-var">ea2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-426"></a><span>                                      </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627470865"><a href="#local-1627470865"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470865"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-427"></a><span>                                      </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470860"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-428"></a><span>                                  </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627470860"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-429"></a><span>                          </span><span class="hs-special">(</span><a name="local-1627470867"><a href="#local-1627470867"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627470868"><a href="#local-1627470868"><span class="hs-identifier">a2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627470866"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-1627470861"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-430"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627470867"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Serialize.html#loadOnB%27"><span class="hs-identifier hs-var">loadOnB'</span></a><span> </span><a href="#local-1627470868"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a></pre></body></html>