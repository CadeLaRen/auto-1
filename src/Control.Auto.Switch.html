<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- Module      : Control.Auto.Switch</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Description : Combinators for dynamically switching between and</span><span>
</span><a name="line-4"></a><span class="hs-comment">--               sequencing 'Auto's.</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Copyright   : (c) Justin Le 2015</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- License     : MIT</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Maintainer  : justin@jle.im</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Stability   : unstable</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Portability : portable</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- A collection of versatile switching mechanisms.  Switching is really</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- a core mechanic at the heart of how to structure a lot of program</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- logics.  Switching from one &quot;mode&quot; to another, from dead to alive, from</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- room to room, menu to menu...switching between 'Auto's is a core part</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- about how many programs are built.</span><span>
</span><a name="line-17"></a><span class="hs-comment">--</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- All of the switches here take advantage of either blip semantics (from</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- &quot;Control.Auto.Blip&quot;) or /Interval/ semantics (from</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- &quot;Control.Auto.Interval&quot;)...so this is where maintaining semantically</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- meaningful blip streams and intervals pays off!</span><span>
</span><a name="line-22"></a><span class="hs-comment">--</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- Each switch here has various examples, and you'll find many of these in</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- use in the &lt;https://github.com/mstksg/auto-examples example projects&gt;.</span><span>
</span><a name="line-25"></a><span class="hs-comment">--</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- Note the naming convention going on here (also used in</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- &quot;Control.Auto.Serialize&quot;):  A switch &quot;from&quot; a blip stream is triggered</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- &quot;internally&quot; by the 'Auto' being switched itself; a switch &quot;on&quot; a blip</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- stream is triggered &quot;externally&quot; by an 'Auto' that is /not/ swiched.</span><span>
</span><a name="line-30"></a><span class="hs-comment">--</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Switch</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-comment">-- * Sequential switching</span><span>
</span><a name="line-34"></a><span>    </span><span class="hs-special">(</span><span class="hs-comment">--&gt;)</span><span>
</span><a name="line-35"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Switch.html#-%3F%3E"><span class="hs-operator hs-var">-?&gt;</span></a><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchIn"><span class="hs-identifier hs-var">switchIn</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-comment">-- * Arbitrary switching</span><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchFrom_"><span class="hs-identifier hs-var">switchFrom_</span></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchOn_"><span class="hs-identifier hs-var">switchOn_</span></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-comment">-- * Function-based switches</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchOnF"><span class="hs-identifier hs-var">switchOnF</span></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchOnF_"><span class="hs-identifier hs-var">switchOnF_</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchFromF"><span class="hs-identifier hs-var">switchFromF</span></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchFromF_"><span class="hs-identifier hs-var">switchFromF_</span></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-comment">-- * Resetting</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#resetOn"><span class="hs-identifier hs-var">resetOn</span></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#resetFrom"><span class="hs-identifier hs-var">resetFrom</span></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Blip.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Blip</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Blip.Internal.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Blip</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Core.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Interval.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Interval</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Category</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span>             </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">id</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-comment">--&gt;</span><span>
</span><a name="line-62"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator">-?&gt;</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- | &quot;This, then that&quot;.  Behave like the first 'Interval' (and run its</span><span>
</span><a name="line-65"></a><span class="hs-comment">-- effects) as long as it is &quot;on&quot; (outputting 'Just').  As soon as it turns</span><span>
</span><a name="line-66"></a><span class="hs-comment">-- off (is 'Nothing'), it'll &quot;switch over&quot; and begin behaving like the</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- second 'Auto' forever, running the effects of the second 'Auto', too.</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- Works well if the 'Auto's follow interval semantics from</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- &quot;Control.Auto.Interval&quot;.</span><span>
</span><a name="line-70"></a><span class="hs-comment">--</span><span>
</span><a name="line-71"></a><span class="hs-comment">-- &gt;&gt;&gt; let a1 = whenI (&lt;= 4) --&gt; pure 0</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' a1 [1..10]</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- [1, 2, 3, 4, 0, 0, 0, 0, 0, 0]</span><span>
</span><a name="line-74"></a><span class="hs-comment">--</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- ('whenI' only lets items satisfying the predicate pass through as &quot;on&quot;,</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- and is &quot;off&quot; otherwise; 'pure' is the 'Auto' that always produces the</span><span>
</span><a name="line-77"></a><span class="hs-comment">-- same output)</span><span>
</span><a name="line-78"></a><span class="hs-comment">--</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- Association works in a way that you can &quot;chain&quot; '--&gt;'s, as long as you</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- have an appropriate 'Auto' (and not 'Interval') at the end:</span><span>
</span><a name="line-81"></a><span class="hs-comment">--</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- &gt;&gt;&gt; let a2 = onFor 3 . sumFrom 0</span><span>
</span><a name="line-83"></a><span class="hs-comment">--          --&gt; onFor 3 . sumFrom 100</span><span>
</span><a name="line-84"></a><span class="hs-comment">--          --&gt; pure 0</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' a2 [1..10]</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- [1,3,6,104,109,115,0,0,0,0]</span><span>
</span><a name="line-87"></a><span class="hs-comment">--</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- @a --&gt; b --&gt; c@ associates as @a --&gt; (b --&gt; c)@</span><span>
</span><a name="line-89"></a><span class="hs-comment">--</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- This is pretty invaluable for having 'Auto's &quot;step&quot; through a series of</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- different 'Auto's, progressing their state from one stage to the next.</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- 'Auto's can control when they want to be &quot;moved on&quot; from by turning</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- &quot;off&quot; (outputting 'Nothing').</span><span>
</span><a name="line-94"></a><span class="hs-comment">--</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- Note that recursive bindings work just fine, so:</span><span>
</span><a name="line-96"></a><span class="hs-comment">--</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- &gt;&gt;&gt; let a3 = onFor 2 . pure &quot;hello&quot;</span><span>
</span><a name="line-98"></a><span class="hs-comment">--          --&gt; onFor 2 . pure &quot;world&quot;</span><span>
</span><a name="line-99"></a><span class="hs-comment">--          --&gt; a3</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, _) = stepAutoN' 8 a3 ()</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- [&quot;hello&quot;, &quot;hello&quot;, &quot;world&quot;, &quot;world&quot;, &quot;hello&quot;, &quot;hello&quot;, &quot;world&quot;, &quot;world&quot;]</span><span>
</span><a name="line-103"></a><span class="hs-comment">--</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- the above represents an infinite loop between outputting &quot;hello&quot; and</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- outputting &quot;world&quot;.</span><span>
</span><a name="line-106"></a><span class="hs-comment">--</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- For serialization, an extra byte cost is incurred per invocation of</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- '--&gt;'.  For cyclic switches like @a3@, every time the cycle &quot;completes&quot;,</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- it adds another layer of '--&gt;' byte costs.  For example, initially,</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- saving @a3@ incurs a cost for the two '--&gt;'s.  After @a3@ loops once,</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- it incurs a cost for another two '--&gt;'s, so it costs four '--&gt;'s.  After</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- @a3@ loops another time, it is like a cost of six '--&gt;'s.  So be aware</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- that for cyclic bindings like @a3@, space for serialization grows at</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- O(n).</span><span>
</span><a name="line-115"></a><span class="hs-comment">--</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- By the way, it might be worth contrasting this with '&lt;|!&gt;' and '&lt;|?&gt;'</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- from &quot;Control.Auto.Interval&quot;, which have the same type signatures.</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- Those alternative-y operators always /feed the input to both sides/,</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- /run both sides/, and output the first 'Just'.  With '&lt;|!&gt;', you can</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- &quot;switch back and forth&quot; to the first 'Auto' as soon as the first 'Auto'</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- is &quot;on&quot; ('Just') again.</span><span>
</span><a name="line-122"></a><span class="hs-comment">--</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- '--&gt;', in contrast, runs /only/ the first 'Auto' until it is</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- off ('Nothing')...then runs /only/ the second 'Auto'.  This transition is</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- one-way, as well.</span><span>
</span><a name="line-126"></a><span class="hs-special">(</span><span class="hs-comment">--&gt;) :: Monad m</span><span>
</span><a name="line-127"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627486472"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486473"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486474"><span class="hs-identifier hs-type">b</span></a><span>     </span><span class="hs-comment">-- ^ initial behavior</span><span>
</span><a name="line-128"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486472"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486473"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486474"><span class="hs-identifier hs-type">b</span></a><span>         </span><span class="hs-comment">-- ^ final behavior, when the initial</span><span>
</span><a name="line-129"></a><span>                            </span><span class="hs-comment">--   behavior turns off.</span><span>
</span><a name="line-130"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486472"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486473"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486474"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-131"></a><a name="local-1627486475"><a href="#local-1627486475"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-comment">--&gt; a2 = fmap fromJust (a1 -?&gt; fmap Just a2)</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- | A variation of '--&gt;', where the right hand side can also be an</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- 'Interval' / 'Maybe'.  The entire result is, then, a 'Maybe'.  Probably less</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- useful than '--&gt;' in most situations.</span><span>
</span><a name="line-136"></a><span class="hs-special">(</span><span class="hs-operator">-?&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486469"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-137"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627486469"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486470"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486471"><span class="hs-identifier hs-type">b</span></a><span>   </span><span class="hs-comment">-- ^ initial behavior</span><span>
</span><a name="line-138"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627486469"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486470"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486471"><span class="hs-identifier hs-type">b</span></a><span>   </span><span class="hs-comment">-- ^ final behavior, when the initial</span><span>
</span><a name="line-139"></a><span>                          </span><span class="hs-comment">--   behavior turns off.</span><span>
</span><a name="line-140"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627486469"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486470"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486471"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-141"></a><a name="local-1627486477"><a href="#local-1627486477"><span class="hs-identifier">a1</span></a></a><span> </span><a name="-%3F%3E"><a href="Control.Auto.Switch.html#-%3F%3E"><span class="hs-operator">-?&gt;</span></a></a><span> </span><a name="local-1627486478"><a href="#local-1627486478"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627486479"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627486480"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627486481"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-142"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-143"></a><span>    </span><a name="local-1627486479"><a href="#local-1627486479"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-144"></a><span>      </span><a name="local-1627486483"><a href="#local-1627486483"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-145"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627486483"><span class="hs-identifier hs-var">flag</span></a><span>
</span><a name="line-146"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486482"><span class="hs-identifier hs-var">switched</span></a><span> </span><a href="#local-1627486478"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Switch.html#-%3F%3E"><span class="hs-operator hs-var">-?&gt;</span></a><span> </span><a href="#local-1627486478"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627486477"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-148"></a><span>    </span><a name="local-1627486480"><a href="#local-1627486480"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627486477"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-149"></a><span>    </span><a name="local-1627486481"><a href="#local-1627486481"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-1627486484"><a href="#local-1627486484"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-150"></a><span>      </span><span class="hs-special">(</span><a name="local-1627486485"><a href="#local-1627486485"><span class="hs-identifier">y1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486486"><a href="#local-1627486486"><span class="hs-identifier">a1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486477"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-1627486484"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-151"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486485"><span class="hs-identifier hs-var">y1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-152"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-153"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486485"><span class="hs-identifier hs-var">y1</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486486"><span class="hs-identifier hs-var">a1'</span></a><span> </span><a href="Control.Auto.Switch.html#-%3F%3E"><span class="hs-operator hs-var">-?&gt;</span></a><span> </span><a href="#local-1627486478"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-155"></a><span>          </span><span class="hs-special">(</span><a name="local-1627486487"><a href="#local-1627486487"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486488"><a href="#local-1627486488"><span class="hs-identifier">a2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486478"><span class="hs-identifier hs-var">a2</span></a><span> </span><a href="#local-1627486484"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-156"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486487"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486482"><span class="hs-identifier hs-var">switched</span></a><span> </span><a href="#local-1627486488"><span class="hs-identifier hs-var">a2'</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>    </span><a name="local-1627486482"><a href="#local-1627486482"><span class="hs-identifier">switched</span></a></a><span> </span><a name="local-1627486489"><a href="#local-1627486489"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627486479"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-158"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627486489"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627486490"><a href="#local-1627486490"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-160"></a><span>                           </span><span class="hs-special">(</span><a name="local-1627486491"><a href="#local-1627486491"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486492"><a href="#local-1627486492"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486489"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627486490"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-161"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486491"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486482"><span class="hs-identifier hs-var">switched</span></a><span> </span><a href="#local-1627486492"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- TODO: Add tests for the serialization here.</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-- | @'switchIn' n a1 a2@ will behave like @a1@ for @n@ steps of output,</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- and then behave like @a2@ forever after.</span><span>
</span><a name="line-166"></a><span class="hs-comment">--</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- More or less a more efficient/direct implementation of the common idiom:</span><span>
</span><a name="line-168"></a><span class="hs-comment">--</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- onFor n a1 --&gt; a2</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-172"></a><span class="hs-comment">--</span><span>
</span><a name="line-173"></a><span class="hs-comment">--</span><span>
</span><a name="line-174"></a><span class="hs-identifier">switchIn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486466"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-175"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>           </span><span class="hs-comment">-- ^ number of outputs before switching</span><span>
</span><a name="line-176"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486466"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486467"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486468"><span class="hs-identifier hs-type">b</span></a><span>    </span><span class="hs-comment">-- ^ initial behavior</span><span>
</span><a name="line-177"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486466"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486467"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486468"><span class="hs-identifier hs-type">b</span></a><span>    </span><span class="hs-comment">-- ^ switched behavior</span><span>
</span><a name="line-178"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486466"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486467"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486468"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-179"></a><a name="switchIn"><a href="Control.Auto.Switch.html#switchIn"><span class="hs-identifier">switchIn</span></a></a><span> </span><a name="local-1627486493"><a href="#local-1627486493"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-1627486494"><a href="#local-1627486494"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-1627486495"><a href="#local-1627486495"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1627486493"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627486496"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627486497"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627486498"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-180"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627486499"><span class="hs-identifier hs-var">switched</span></a><span> </span><a href="#local-1627486495"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-181"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>    </span><a name="local-1627486496"><a href="#local-1627486496"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-183"></a><span>      </span><a name="local-1627486500"><a href="#local-1627486500"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-184"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-1627486500"><span class="hs-identifier hs-var">flag</span></a><span>
</span><a name="line-185"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486499"><span class="hs-identifier hs-var">switched</span></a><span> </span><a href="#local-1627486495"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Control.Auto.Switch.html#switchIn"><span class="hs-identifier hs-var">switchIn</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627486494"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-1627486495"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-187"></a><span>    </span><a name="local-1627486497"><a href="#local-1627486497"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><a href="#local-1627486493"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627486494"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-188"></a><span>    </span><a name="local-1627486498"><a href="#local-1627486498"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-1627486501"><a href="#local-1627486501"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-189"></a><span>      </span><span class="hs-special">(</span><a name="local-1627486502"><a href="#local-1627486502"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486503"><a href="#local-1627486503"><span class="hs-identifier">a1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486494"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-1627486501"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-190"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486502"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchIn"><span class="hs-identifier hs-var">switchIn</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486493"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-1627486503"><span class="hs-identifier hs-var">a1'</span></a><span> </span><a href="#local-1627486495"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>    </span><a name="local-1627486499"><a href="#local-1627486499"><span class="hs-identifier">switched</span></a></a><span> </span><a name="local-1627486504"><a href="#local-1627486504"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627486496"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-192"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627486504"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627486505"><a href="#local-1627486505"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-194"></a><span>                           </span><span class="hs-special">(</span><a name="local-1627486506"><a href="#local-1627486506"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486507"><a href="#local-1627486507"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486504"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627486505"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-195"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486506"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486499"><span class="hs-identifier hs-var">switched</span></a><span> </span><a href="#local-1627486507"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- | Takes an 'Auto' who has both a normal output stream and a blip stream</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- output stream, where the blip stream emits new 'Auto's.</span><span>
</span><a name="line-200"></a><span class="hs-comment">--</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- You can imagine 'switchFrom_' as a box containing a single 'Auto' like</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- the one just described.  It feeds its input into the contained 'Auto',</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- and its output stream is the &quot;normal value&quot; output stream of the</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- contained 'Auto'.</span><span>
</span><a name="line-205"></a><span class="hs-comment">--</span><span>
</span><a name="line-206"></a><span class="hs-comment">-- However, as soon as the blip stream of the contained 'Auto' emits a new</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- 'Auto', it /replaces/ the contained 'Auto' with the /new/ one (just after</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- emitting the &quot;normal value&quot;), and the whole thing starts all over again.</span><span>
</span><a name="line-209"></a><span class="hs-comment">--</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- @'switchFrom_' a0@ will &quot;start&quot; with @a0@ already in the box.</span><span>
</span><a name="line-211"></a><span class="hs-comment">--</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- This is mostly useful to allow 'Auto's to &quot;replace themselves&quot; or</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- control their own destiny, or the behavior of their successors.</span><span>
</span><a name="line-214"></a><span class="hs-comment">--</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- In the following example, @a1@ is an 'Auto' that behaves like</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- a cumulative sum but also outputs a blip stream that will emit an 'Auto'</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- containing @'pure' 100@ (the 'Auto' that always emits 100) after three</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- steps.</span><span>
</span><a name="line-219"></a><span class="hs-comment">--</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- a1 :: Auto' Int (Int, Blip (Auto' Int Int))</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- a1 = proc x -&gt; do</span><span>
</span><a name="line-223"></a><span class="hs-comment">--     sums       &lt;- sumFrom 0 -&lt; x</span><span>
</span><a name="line-224"></a><span class="hs-comment">--     switchBlip &lt;- inB 4     -&lt; pure 100</span><span>
</span><a name="line-225"></a><span class="hs-comment">--     id -&lt; (sums, switchBlip)</span><span>
</span><a name="line-226"></a><span class="hs-comment">--</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- -- alternatively</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- a1' = sumFrom 0 &amp;&amp;&amp; (tagBlips (pure 100) . inB 4)</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-230"></a><span class="hs-comment">--</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- So, @'switchFrom_' a1@ will be the output of 'count' for three steps,</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- and then switch to @'pure' 100@ afterwards (when the blip stream</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- emits):</span><span>
</span><a name="line-234"></a><span class="hs-comment">--</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (switchFrom_ a1) [1..10]</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- [1,3,6,10,100,100,100,100,100,100]</span><span>
</span><a name="line-237"></a><span class="hs-comment">--</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- This is fun to use with recursion, so you can get looping switches:</span><span>
</span><a name="line-239"></a><span class="hs-comment">--</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- a2 :: Auto' Int (Int, Blip (Auto' Int Int))</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- a2 = proc x -&gt; do</span><span>
</span><a name="line-243"></a><span class="hs-comment">--     sums       &lt;- sumFrom 0 -&lt; x</span><span>
</span><a name="line-244"></a><span class="hs-comment">--     switchBlip &lt;- inB 3     -&lt; switchFrom_ a2</span><span>
</span><a name="line-245"></a><span class="hs-comment">--     id -&lt; (c, switchBlip)</span><span>
</span><a name="line-246"></a><span class="hs-comment">--</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- -- alternatively</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- a2' = sumFrom 0 &amp;&amp;&amp; (tagBlips (switchFrom_ a2') . inB 3)</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-250"></a><span class="hs-comment">--</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (switchFrom_ a2) [101..112]</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- [ 101, 203, 306 -- first 'sumFrom', on first three items [101, 102, 103]</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- , 104, 209, 315 -- second 'sumFrom', on second three items [104, 105, 106]</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- , 107, 215, 324 -- third 'sumFrom', on third three items [107, 108, 109]</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- , 110, 221, 333 -- final 'sumFrom', on fourth three items [110, 111, 112]</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- ]</span><span>
</span><a name="line-257"></a><span class="hs-comment">--</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- Note that this combinator is inherently unserializable, so you are going</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- to lose all serialization capabilities if you use this.  So sad, I know!</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- :(  This fact is reflected in the underscore suffix, as per convention.</span><span>
</span><a name="line-261"></a><span class="hs-comment">--</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- If you want to use switching /and/ have serialization, you can use the</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- perfectly serialization-safe alternative, 'switchFromF', which slightly</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- less powerful in ways that are unlikely to be missed in practical usage.</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- That is, almost all non-contrived real life usages of 'switchFrom_' can</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- be recovered using 'switchFromF'.</span><span>
</span><a name="line-267"></a><span class="hs-comment">--</span><span>
</span><a name="line-268"></a><span class="hs-identifier">switchFrom_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486463"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-269"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486463"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486464"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486465"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486463"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486464"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486465"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ 'Auto' outputting a</span><span>
</span><a name="line-270"></a><span>                                                </span><span class="hs-comment">--   normal output (@b@)</span><span>
</span><a name="line-271"></a><span>                                                </span><span class="hs-comment">--   and a blip stream</span><span>
</span><a name="line-272"></a><span>                                                </span><span class="hs-comment">--   containing the 'Auto'</span><span>
</span><a name="line-273"></a><span>                                                </span><span class="hs-comment">--   to replace itself</span><span>
</span><a name="line-274"></a><span>                                                </span><span class="hs-comment">--   with.</span><span>
</span><a name="line-275"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486463"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486464"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486465"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-276"></a><a name="switchFrom_"><a href="Control.Auto.Switch.html#switchFrom_"><span class="hs-identifier">switchFrom_</span></a></a><span> </span><a name="local-1627486508"><a href="#local-1627486508"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627486509"><a href="#local-1627486509"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-277"></a><span>                              </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1627486510"><a href="#local-1627486510"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486511"><a href="#local-1627486511"><span class="hs-identifier">ea1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627486512"><a href="#local-1627486512"><span class="hs-identifier">a0'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486508"><span class="hs-identifier hs-var">a0</span></a><span> </span><a href="#local-1627486509"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-278"></a><span>                              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486511"><span class="hs-identifier hs-var">ea1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-279"></a><span>                                </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627486513"><a href="#local-1627486513"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486510"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486513"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>                                </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486510"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchFrom_"><span class="hs-identifier hs-var">switchFrom_</span></a><span> </span><a href="#local-1627486512"><span class="hs-identifier hs-var">a0'</span></a><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- | You can think of this as a little box containing a single 'Auto'</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- inside.  Takes two input streams: an input stream of normal values, and</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- a blip stream containing 'Auto's.  It feeds the input stream into the</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- contained 'Auto'...but every time the input blip stream emits with a new</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- 'Auto', /replaces/ the contained 'Auto' with the emitted one.  Then</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- starts the cycle all over, immediately giving the new 'Auto' the</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- received input.</span><span>
</span><a name="line-289"></a><span class="hs-comment">--</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- Useful for being able to externally &quot;swap out&quot; 'Auto's for a given</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- situation by just emitting a new 'Auto' in the blip stream.</span><span>
</span><a name="line-292"></a><span class="hs-comment">--</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- For example, here we push several 'Auto's one after the other into the</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- box: @'sumFrom' 0@, @'productFrom' 1@, and 'count'. @'eachAt_' 4@ emits</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- each 'Auto' in the given list every four steps, starting on the fourth.</span><span>
</span><a name="line-296"></a><span class="hs-comment">--</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- newAutos :: Auto' Int (Blip (Auto' Int Int))</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- newAutos = eachAt_ 4 [sumFrom 0, productFrom 1, count]</span><span>
</span><a name="line-300"></a><span class="hs-comment">--</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- a :: Auto' Int Int</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- a = proc i -&gt; do</span><span>
</span><a name="line-303"></a><span class="hs-comment">--     blipAutos &lt;- newAutos -&lt; ()</span><span>
</span><a name="line-304"></a><span class="hs-comment">--     switchOn_ (pure 0)    -&lt; (i, blipAutos)</span><span>
</span><a name="line-305"></a><span class="hs-comment">--</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- -- alternatively</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- a' = switchOn_ (pure 0) . (id &amp;&amp;&amp; newAutos)</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-309"></a><span class="hs-comment">--</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' a [1..12]</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- [ 1,  3,   6           -- output from sumFrom 0</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- , 4, 20, 120           -- output from productFrom 1</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- , 0,  1,   2, 3, 4, 5] -- output from count</span><span>
</span><a name="line-314"></a><span class="hs-comment">--</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- Like 'switchFrom_', this combinator is inherently unserializable.  So if</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- you use it, you give up serialization for your 'Auto's.  This is</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- reflected in the underscore suffix.</span><span>
</span><a name="line-318"></a><span class="hs-comment">--</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- If you wish to have the same switching devices but keep serialization,</span><span>
</span><a name="line-320"></a><span class="hs-comment">-- you can use 'switchOnF', which is slightly less powerful, but should be</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- sufficient for all practical use cases.</span><span>
</span><a name="line-322"></a><span class="hs-comment">--</span><span>
</span><a name="line-323"></a><span class="hs-identifier">switchOn_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486460"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-324"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486462"><span class="hs-identifier hs-type">b</span></a><span>     </span><span class="hs-comment">-- ^ initial 'Auto'</span><span>
</span><a name="line-325"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486460"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486461"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627486462"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-326"></a><a name="switchOn_"><a href="Control.Auto.Switch.html#switchOn_"><span class="hs-identifier">switchOn_</span></a></a><span> </span><a name="local-1627486514"><a href="#local-1627486514"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627486515"><a href="#local-1627486515"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486516"><a href="#local-1627486516"><span class="hs-identifier">ea1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-327"></a><span>                            </span><span class="hs-keyword">let</span><span> </span><a name="local-1627486517"><a href="#local-1627486517"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486516"><span class="hs-identifier hs-var">ea1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-328"></a><span>                                      </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627486514"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-329"></a><span>                                      </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627486518"><a href="#local-1627486518"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627486518"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-330"></a><span>                            </span><span class="hs-special">(</span><a name="local-1627486519"><a href="#local-1627486519"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486520"><a href="#local-1627486520"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486517"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627486515"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-331"></a><span>                            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486519"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchOn_"><span class="hs-identifier hs-var">switchOn_</span></a><span> </span><a href="#local-1627486520"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">-- | Essentially identical to 'switchFrom_', except insead of the 'Auto'</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- outputting a blip stream of new 'Auto's to replace itself with, it emits</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- a blip stream of @c@ --- and 'switchFromF' uses the @c@ to create the</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- new 'Auto'.</span><span>
</span><a name="line-337"></a><span class="hs-comment">--</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- Here is the equivalent of the two examples from 'switchFrom_',</span><span>
</span><a name="line-339"></a><span class="hs-comment">-- implemented with 'switchFromF'; see the documentation for 'switchFrom_'</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- for a description of what they are to do.</span><span>
</span><a name="line-341"></a><span class="hs-comment">--</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- a1 :: Auto' Int (Int, Blip Int)</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- a1 = proc x -&gt; do</span><span>
</span><a name="line-345"></a><span class="hs-comment">--     sums       &lt;- sumFrom 0 -&lt; x</span><span>
</span><a name="line-346"></a><span class="hs-comment">--     switchBlip &lt;- inB 4     -&lt; 100</span><span>
</span><a name="line-347"></a><span class="hs-comment">--     id -&lt; (sums, switchBlip)</span><span>
</span><a name="line-348"></a><span class="hs-comment">--</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- -- alternatively</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- a1' = sumFrom 0 &amp;&amp;&amp; (tagBlips 100 . inB 4)</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-352"></a><span class="hs-comment">--</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (switchFromF (\x -&gt; (x,) &lt;$&gt; never) a1) [1..10]</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- [1,3,6,10,100,100,100,100,100,100]</span><span>
</span><a name="line-355"></a><span class="hs-comment">--</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- a2 :: Auto' Int (Int, Blip ())</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- a2 = proc x -&gt; do</span><span>
</span><a name="line-359"></a><span class="hs-comment">--     sums       &lt;- sumFrom 0 -&lt; x</span><span>
</span><a name="line-360"></a><span class="hs-comment">--     switchBlip &lt;- inB 3     -&lt; ()</span><span>
</span><a name="line-361"></a><span class="hs-comment">--     id -&lt; (sums, switchBlip)</span><span>
</span><a name="line-362"></a><span class="hs-comment">--</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- -- alternatively</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- a2' = sumFrom 0 &amp;&amp;&amp; (tagBlips () . inB 3)</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-366"></a><span class="hs-comment">--</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (switchFromF (const a2) a2) [101..112]</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- [ 101, 203, 306  -- first 'sumFrom', on first three items [101, 102, 103]</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- , 104, 209, 315  -- second 'sumFrom', on second three items [104, 105, 106]</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- , 107, 215, 324  -- third 'sumFrom', on third three items [107, 108, 109]</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- , 110, 221, 333] -- final 'sumFrom', on fourth three items [110, 111, 112]</span><span>
</span><a name="line-372"></a><span class="hs-comment">--</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- Or, if you're only ever going to use @a2@ in switching form:</span><span>
</span><a name="line-374"></a><span class="hs-comment">--</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- a2s :: Auto' Int Int</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- a2s = switchFromF (const a2s) $ proc x -&gt; do</span><span>
</span><a name="line-378"></a><span class="hs-comment">--           sums       &lt;- sumFrom 0 -&lt; x</span><span>
</span><a name="line-379"></a><span class="hs-comment">--           switchBlip &lt;- inB 3     -&lt; ()</span><span>
</span><a name="line-380"></a><span class="hs-comment">--           id -&lt; (c, swichBlip)</span><span>
</span><a name="line-381"></a><span class="hs-comment">--</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- -- or</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- a2s' = switchFromF (const a2s')</span><span>
</span><a name="line-384"></a><span class="hs-comment">--      $ sumFrom 0 &amp;&amp;&amp; (tagBlips () . inB 3)</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-386"></a><span class="hs-comment">--</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' a2s [101..112]</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- [101, 203, 306, 104, 209, 315, 107, 215, 324, 110, 221, 333]</span><span>
</span><a name="line-389"></a><span class="hs-comment">--</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- As you can see, all of the simple examples from 'switchFrom_' can be</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- implemented in 'switchFromF'...and so can most real-life examples.  The</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- advantage is that 'switchFromF' is serializable, and 'switchFrom_' is</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- not.</span><span>
</span><a name="line-394"></a><span class="hs-comment">--</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- Note that for the examples above, instead of using 'const', we could</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- have actually used the input parameter to create a new 'Auto' based on</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- what we outputted.</span><span>
</span><a name="line-398"></a><span class="hs-comment">--</span><span>
</span><a name="line-399"></a><span class="hs-identifier">switchFromF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486456"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627486457"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486457"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486456"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486458"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486459"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486457"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ function to generate the</span><span>
</span><a name="line-401"></a><span>                                            </span><span class="hs-comment">--   next 'Auto' to behave like</span><span>
</span><a name="line-402"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486456"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486458"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486459"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486457"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- ^ initial 'Auto'.  the @b@</span><span>
</span><a name="line-403"></a><span>                                            </span><span class="hs-comment">--   is the output, and the</span><span>
</span><a name="line-404"></a><span>                                            </span><span class="hs-comment">--   blip stream triggers new</span><span>
</span><a name="line-405"></a><span>                                            </span><span class="hs-comment">--   'Auto's to replace this</span><span>
</span><a name="line-406"></a><span>                                            </span><span class="hs-comment">--   one.</span><span>
</span><a name="line-407"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486456"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486458"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486459"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-408"></a><a name="switchFromF"><a href="Control.Auto.Switch.html#switchFromF"><span class="hs-identifier">switchFromF</span></a></a><span> </span><a name="local-1627486521"><a href="#local-1627486521"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627486522"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-409"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-410"></a><span>    </span><a name="local-1627486522"><a href="#local-1627486522"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627486524"><a href="#local-1627486524"><span class="hs-identifier">mz</span></a></a><span> </span><a name="local-1627486525"><a href="#local-1627486525"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486523"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627486525"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486526"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627486527"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-411"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-412"></a><span>        </span><a name="local-1627486526"><a href="#local-1627486526"><span class="hs-identifier">s</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><a href="#local-1627486524"><span class="hs-identifier hs-var">mz</span></a><span>
</span><a name="line-413"></a><span>           </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627486525"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-414"></a><span>        </span><a name="local-1627486527"><a href="#local-1627486527"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-1627486528"><a href="#local-1627486528"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-415"></a><span>          </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1627486529"><a href="#local-1627486529"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486530"><a href="#local-1627486530"><span class="hs-identifier">ez</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627486531"><a href="#local-1627486531"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486525"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627486528"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-416"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486530"><span class="hs-identifier hs-var">ez</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-417"></a><span>            </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627486532"><a href="#local-1627486532"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486529"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486522"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627486532"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627486521"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486532"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>            </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486529"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486522"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627486524"><span class="hs-identifier hs-var">mz</span></a><span>       </span><a href="#local-1627486531"><span class="hs-identifier hs-var">a'</span></a><span>   </span><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>    </span><a name="local-1627486523"><a href="#local-1627486523"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627486533"><a href="#local-1627486533"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-420"></a><span>      </span><a name="local-1627486534"><a href="#local-1627486534"><span class="hs-identifier">mz</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-421"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486534"><span class="hs-identifier hs-var">mz</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-422"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627486535"><a href="#local-1627486535"><span class="hs-identifier">z</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627486522"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627486534"><span class="hs-identifier hs-var">mz</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486521"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486535"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627486522"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627486534"><span class="hs-identifier hs-var">mz</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627486533"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'switchFromF'.  You sort</span><span>
</span><a name="line-426"></a><span class="hs-comment">-- of might as well use 'switchFrom_'; this version might give rise to more</span><span>
</span><a name="line-427"></a><span class="hs-comment">-- &quot;disciplined&quot; code, however, by being more restricted in power.</span><span>
</span><a name="line-428"></a><span class="hs-identifier">switchFromF_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486452"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-429"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486453"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486452"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486454"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486455"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486453"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ function to generate the</span><span>
</span><a name="line-430"></a><span>                                            </span><span class="hs-comment">--   next 'Auto' to behave like</span><span>
</span><a name="line-431"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486452"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486454"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486455"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486453"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ initial 'Auto'.  the @b@</span><span>
</span><a name="line-432"></a><span>                                            </span><span class="hs-comment">--   is the output, and the</span><span>
</span><a name="line-433"></a><span>                                            </span><span class="hs-comment">--   blip stream triggers new</span><span>
</span><a name="line-434"></a><span>                                            </span><span class="hs-comment">--   'Auto's to replace this</span><span>
</span><a name="line-435"></a><span>                                            </span><span class="hs-comment">--   one.</span><span>
</span><a name="line-436"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486452"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486454"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486455"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-437"></a><a name="switchFromF_"><a href="Control.Auto.Switch.html#switchFromF_"><span class="hs-identifier">switchFromF_</span></a></a><span> </span><a name="local-1627486536"><a href="#local-1627486536"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627486537"><a href="#local-1627486537"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627486538"><a href="#local-1627486538"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-438"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-1627486539"><a href="#local-1627486539"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486540"><a href="#local-1627486540"><span class="hs-identifier">ez</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-1627486541"><a href="#local-1627486541"><span class="hs-identifier">a0'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486537"><span class="hs-identifier hs-var">a0</span></a><span> </span><a href="#local-1627486538"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-439"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486540"><span class="hs-identifier hs-var">ez</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-440"></a><span>                                   </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627486542"><a href="#local-1627486542"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486539"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchFromF_"><span class="hs-identifier hs-var">switchFromF_</span></a><span> </span><a href="#local-1627486536"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486536"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486542"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>                                   </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486539"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchFromF_"><span class="hs-identifier hs-var">switchFromF_</span></a><span> </span><a href="#local-1627486536"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486541"><span class="hs-identifier hs-var">a0'</span></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>
</span><a name="line-443"></a><span class="hs-comment">-- | Gives an 'Auto' the ability to &quot;reset&quot; itself on command</span><span>
</span><a name="line-444"></a><span class="hs-comment">--</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- Basically acts like @'fmap' 'fst'@</span><span>
</span><a name="line-446"></a><span class="hs-comment">--</span><span>
</span><a name="line-447"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- fmap fst :: Monad m =&gt; Auto m a (b, Blip c) -&gt; Auto m a b</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-450"></a><span class="hs-comment">--</span><span>
</span><a name="line-451"></a><span class="hs-comment">-- But...whenever the blip stream emits...&quot;resets&quot; the 'Auto' back to the</span><span>
</span><a name="line-452"></a><span class="hs-comment">-- original state, as if nothing ever happened.</span><span>
</span><a name="line-453"></a><span class="hs-comment">--</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- Note that this resetting happens on the step /after/ the blip stream</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- emits.</span><span>
</span><a name="line-456"></a><span class="hs-comment">--</span><span>
</span><a name="line-457"></a><span class="hs-comment">-- Here is a summer that sends out a signal to reset itself whenever the</span><span>
</span><a name="line-458"></a><span class="hs-comment">-- cumulative sum reaches 10 or higher:</span><span>
</span><a name="line-459"></a><span class="hs-comment">--</span><span>
</span><a name="line-460"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- limitSummer :: Auto' Int (Int, Blip ())</span><span>
</span><a name="line-462"></a><span class="hs-comment">-- limitSummer = (id &amp;&amp;&amp; became (&gt;= 10)) . sumFrom 0</span><span>
</span><a name="line-463"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-464"></a><span class="hs-comment">--</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- And now we throw it into 'resetFrom':</span><span>
</span><a name="line-466"></a><span class="hs-comment">--</span><span>
</span><a name="line-467"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- resettingSummer :: Auto' Int Int</span><span>
</span><a name="line-469"></a><span class="hs-comment">-- resettingSummer = resetFrom limitSummer</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-471"></a><span class="hs-comment">--</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' resettingSummer [1..10]</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- [ 1, 3, 6, 10    -- and...reset!</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- , 5, 11          -- and...reset!</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- , 7, 15          -- and...reset!</span><span>
</span><a name="line-476"></a><span class="hs-comment">-- , 9, 19 ]</span><span>
</span><a name="line-477"></a><span class="hs-comment">--</span><span>
</span><a name="line-478"></a><span class="hs-identifier">resetFrom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486448"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-479"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486448"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486449"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486450"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486451"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ The self-resetting 'Auto'</span><span>
</span><a name="line-480"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486448"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486449"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486450"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-481"></a><a name="resetFrom"><a href="Control.Auto.Switch.html#resetFrom"><span class="hs-identifier">resetFrom</span></a></a><span> </span><a name="local-1627486543"><a href="#local-1627486543"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Switch.html#switchFromF"><span class="hs-identifier hs-var">switchFromF</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-1627486544"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486544"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-482"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-483"></a><span>    </span><a name="local-1627486544"><a href="#local-1627486544"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Blip.html#tagBlips"><span class="hs-identifier hs-var">tagBlips</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627486543"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- | Essentially identical to 'switchOn_', except instead of taking in</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- a blip stream of new 'Auto's to put into the box, takes a blip stream</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- of @c@ --- and 'switchOnF' uses the @c@ to create the new 'Auto' to put</span><span>
</span><a name="line-488"></a><span class="hs-comment">-- in the box.</span><span>
</span><a name="line-489"></a><span class="hs-comment">--</span><span>
</span><a name="line-490"></a><span class="hs-comment">-- Here is the equivalent of the two examples from 'switchOn_',</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- implemented with 'switchOnF'; see the documentatino for 'switchOn_'</span><span>
</span><a name="line-492"></a><span class="hs-comment">-- for a description of what they are to do.</span><span>
</span><a name="line-493"></a><span class="hs-comment">--</span><span>
</span><a name="line-494"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- newAuto :: Int -&gt; Auto' Int Int</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- newAuto 1 = sumFrom 0</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- newAuto 2 = productFrom 1</span><span>
</span><a name="line-498"></a><span class="hs-comment">-- newAuto 3 = count</span><span>
</span><a name="line-499"></a><span class="hs-comment">-- newAuto _ = error &quot;Do you expect rigorous error handling from a toy example?&quot;</span><span>
</span><a name="line-500"></a><span class="hs-comment">--</span><span>
</span><a name="line-501"></a><span class="hs-comment">-- a :: Auto' Int Int</span><span>
</span><a name="line-502"></a><span class="hs-comment">-- a = proc i -&gt; do</span><span>
</span><a name="line-503"></a><span class="hs-comment">--     blipAutos &lt;- eachAt 4 [1,2,3] -&lt; ()</span><span>
</span><a name="line-504"></a><span class="hs-comment">--     switchOnF_ newAuto (pure 0) -&lt; (i, blipAutos)</span><span>
</span><a name="line-505"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-506"></a><span class="hs-comment">--</span><span>
</span><a name="line-507"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' a [1..12]</span><span>
</span><a name="line-508"></a><span class="hs-comment">-- [ 1,  3,   6           -- output from sumFrom 0</span><span>
</span><a name="line-509"></a><span class="hs-comment">-- , 4, 20, 120           -- output from productFrom 1</span><span>
</span><a name="line-510"></a><span class="hs-comment">-- , 0,  1,   2, 3, 4, 5] -- output from count</span><span>
</span><a name="line-511"></a><span class="hs-comment">--</span><span>
</span><a name="line-512"></a><span class="hs-comment">-- Instead of sending in the &quot;replacement 'Auto'&quot;, sends in a number, which</span><span>
</span><a name="line-513"></a><span class="hs-comment">-- corresponds to a specific replacement 'Auto'.</span><span>
</span><a name="line-514"></a><span class="hs-comment">--</span><span>
</span><a name="line-515"></a><span class="hs-comment">-- As you can see, all of the simple examples from 'switchOn_' can be</span><span>
</span><a name="line-516"></a><span class="hs-comment">-- implemented in 'switchOnF'...and so can most real-life examples.  The</span><span>
</span><a name="line-517"></a><span class="hs-comment">-- advantage is that 'switchOnF' is serializable, and 'switchOn_' is</span><span>
</span><a name="line-518"></a><span class="hs-comment">-- not.</span><span>
</span><a name="line-519"></a><span class="hs-comment">--</span><span>
</span><a name="line-520"></a><span class="hs-identifier">switchOnF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486444"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627486445"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486445"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486444"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486446"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486447"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ function to generate the next 'Auto'</span><span>
</span><a name="line-522"></a><span>                                  </span><span class="hs-comment">--   to behave like</span><span>
</span><a name="line-523"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486444"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486446"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486447"><span class="hs-identifier hs-type">b</span></a><span>           </span><span class="hs-comment">-- ^ initial starting 'Auto' to behave</span><span>
</span><a name="line-524"></a><span>                                  </span><span class="hs-comment">--   like</span><span>
</span><a name="line-525"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486444"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486446"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486445"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486447"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-526"></a><a name="switchOnF"><a href="Control.Auto.Switch.html#switchOnF"><span class="hs-identifier">switchOnF</span></a></a><span> </span><a name="local-1627486545"><a href="#local-1627486545"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627486546"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-527"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-528"></a><span>    </span><a name="local-1627486546"><a href="#local-1627486546"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627486550"><a href="#local-1627486550"><span class="hs-identifier">mz</span></a></a><span> </span><a name="local-1627486551"><a href="#local-1627486551"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486547"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627486551"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627486548"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627486550"><span class="hs-identifier hs-var">mz</span></a><span> </span><a href="#local-1627486551"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627486549"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-1627486550"><span class="hs-identifier hs-var">mz</span></a><span> </span><a href="#local-1627486551"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>    </span><a name="local-1627486547"><a href="#local-1627486547"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627486552"><a href="#local-1627486552"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-530"></a><span>      </span><a name="local-1627486553"><a href="#local-1627486553"><span class="hs-identifier">mz</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-531"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486553"><span class="hs-identifier hs-var">mz</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-532"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627486554"><a href="#local-1627486554"><span class="hs-identifier">z</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627486546"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627486553"><span class="hs-identifier hs-var">mz</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486545"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486554"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627486546"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627486553"><span class="hs-identifier hs-var">mz</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627486552"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-534"></a><span>    </span><a name="local-1627486548"><a href="#local-1627486548"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627486555"><a href="#local-1627486555"><span class="hs-identifier">mz</span></a></a><span> </span><a name="local-1627486556"><a href="#local-1627486556"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><a href="#local-1627486555"><span class="hs-identifier hs-var">mz</span></a><span>
</span><a name="line-535"></a><span>           </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627486556"><span class="hs-identifier hs-var">a0</span></a><span>
</span><a name="line-536"></a><span>    </span><a name="local-1627486549"><a href="#local-1627486549"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-1627486557"><a href="#local-1627486557"><span class="hs-identifier">mz</span></a></a><span> </span><a name="local-1627486558"><a href="#local-1627486558"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627486559"><a href="#local-1627486559"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486560"><a href="#local-1627486560"><span class="hs-identifier">ez</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-537"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486560"><span class="hs-identifier hs-var">ez</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-538"></a><span>        </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-539"></a><span>          </span><span class="hs-special">(</span><a name="local-1627486561"><a href="#local-1627486561"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486562"><a href="#local-1627486562"><span class="hs-identifier">a0'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486558"><span class="hs-identifier hs-var">a0</span></a><span> </span><a href="#local-1627486559"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-540"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486561"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486546"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627486557"><span class="hs-identifier hs-var">mz</span></a><span> </span><a href="#local-1627486562"><span class="hs-identifier hs-var">a0'</span></a><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>        </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627486563"><a href="#local-1627486563"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-542"></a><span>          </span><span class="hs-special">(</span><a name="local-1627486564"><a href="#local-1627486564"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486565"><a href="#local-1627486565"><span class="hs-identifier">a1</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486545"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486563"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486559"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-543"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486564"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627486546"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627486563"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486565"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span>
</span><a name="line-544"></a><span>
</span><a name="line-545"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'switchOnF'. You sort of</span><span>
</span><a name="line-546"></a><span class="hs-comment">-- might as well use 'switchOn_'; this version might give rise to more</span><span>
</span><a name="line-547"></a><span class="hs-comment">-- &quot;disciplined&quot; code, however, by being more restricted in power.</span><span>
</span><a name="line-548"></a><span class="hs-identifier">switchOnF_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486440"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-549"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627486441"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486440"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486442"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486443"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ function to generate the next 'Auto'</span><span>
</span><a name="line-550"></a><span>                                  </span><span class="hs-comment">--   to behave like</span><span>
</span><a name="line-551"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486440"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486442"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486443"><span class="hs-identifier hs-type">b</span></a><span>          </span><span class="hs-comment">-- ^ initial starting 'Auto' to behave</span><span>
</span><a name="line-552"></a><span>                                  </span><span class="hs-comment">--   like</span><span>
</span><a name="line-553"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486440"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486442"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486441"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486443"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-554"></a><a name="switchOnF_"><a href="Control.Auto.Switch.html#switchOnF_"><span class="hs-identifier">switchOnF_</span></a></a><span> </span><a name="local-1627486566"><a href="#local-1627486566"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627486567"><a href="#local-1627486567"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627486568"><a href="#local-1627486568"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486569"><a href="#local-1627486569"><span class="hs-identifier">ez</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-555"></a><span>                              </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627486569"><span class="hs-identifier hs-var">ez</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-556"></a><span>                                </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-557"></a><span>                                  </span><span class="hs-special">(</span><a name="local-1627486570"><a href="#local-1627486570"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486571"><a href="#local-1627486571"><span class="hs-identifier">a0'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627486567"><span class="hs-identifier hs-var">a0</span></a><span> </span><a href="#local-1627486568"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-558"></a><span>                                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486570"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchOnF_"><span class="hs-identifier hs-var">switchOnF_</span></a><span> </span><a href="#local-1627486566"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486571"><span class="hs-identifier hs-var">a0'</span></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>                                </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-var">Blip</span></a><span> </span><a name="local-1627486572"><a href="#local-1627486572"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-560"></a><span>                                  </span><span class="hs-special">(</span><a name="local-1627486573"><a href="#local-1627486573"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627486574"><a href="#local-1627486574"><span class="hs-identifier">a1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486566"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486572"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486568"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-561"></a><span>                                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627486573"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Switch.html#switchOnF_"><span class="hs-identifier hs-var">switchOnF_</span></a><span> </span><a href="#local-1627486566"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627486574"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-comment">-- | Takes an innocent 'Auto' and wraps a &quot;reset button&quot; around it.  It</span><span>
</span><a name="line-564"></a><span class="hs-comment">-- behaves just like the original 'Auto' at first, but when the input blip</span><span>
</span><a name="line-565"></a><span class="hs-comment">-- stream emits, the internal 'Auto' is reset back to the beginning.</span><span>
</span><a name="line-566"></a><span class="hs-comment">--</span><span>
</span><a name="line-567"></a><span class="hs-comment">-- Here we have 'sumFrom' wrapped around a reset button, and we send</span><span>
</span><a name="line-568"></a><span class="hs-comment">-- in a blip stream that emits every 4 steps; so every 4th step, the whole</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- summer resets.</span><span>
</span><a name="line-570"></a><span class="hs-comment">--</span><span>
</span><a name="line-571"></a><span class="hs-comment">-- &gt;&gt;&gt; let a = resetOn (sumFrom 0) . (id &amp;&amp;&amp; every 4)</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' a [101..112]</span><span>
</span><a name="line-573"></a><span class="hs-comment">-- [ 101, 203, 306</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- , 104, 209, 315  -- resetted!</span><span>
</span><a name="line-575"></a><span class="hs-comment">-- , 107, 215, 324  -- resetted!</span><span>
</span><a name="line-576"></a><span class="hs-comment">-- , 110, 221, 333] -- resetted!</span><span>
</span><a name="line-577"></a><span class="hs-identifier">resetOn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627486436"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-578"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486436"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627486437"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627486438"><span class="hs-identifier hs-type">b</span></a><span>   </span><span class="hs-comment">-- ^ 'Auto' to repeatedly reset</span><span>
</span><a name="line-579"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627486436"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627486437"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627486439"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486438"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-580"></a><a name="resetOn"><a href="Control.Auto.Switch.html#resetOn"><span class="hs-identifier">resetOn</span></a></a><span> </span><a name="local-1627486575"><a href="#local-1627486575"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Switch.html#switchOnF"><span class="hs-identifier hs-var">switchOnF</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-1627486575"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627486575"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Blip.html#tagBlips"><span class="hs-identifier hs-var">tagBlips</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-581"></a></pre></body></html>