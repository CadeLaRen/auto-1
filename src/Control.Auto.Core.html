<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# OPTIONS_HADDOCK not-home #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Module      : Control.Auto.Core</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Description : Core types, constructors, and utilities.</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Copyright   : (c) Justin Le 2015</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- License     : MIT</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Maintainer  : justin@jle.im</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Stability   : unstable</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Portability : portable</span><span>
</span><a name="line-16"></a><span class="hs-comment">--</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- This module defines and provides the core types, (smart) constructors,</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- and general high and low-level utilities used by the /auto/ library.</span><span>
</span><a name="line-19"></a><span class="hs-comment">--</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- Note that importing and using functions from this module in part voids</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- some of the &quot;semantic contracts&quot; of the 'Auto' types you get, so use</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- with caution!</span><span>
</span><a name="line-23"></a><span class="hs-comment">--</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- A lot of low-level functionality is provided here which is most likely</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- unnecessary for most applications; many are mostly for internal usage or</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- advanced/fine-grained usage.  It also isn't really enough to do too many</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- useful things, either.  It's recommended that you import &quot;Control.Auto&quot;</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- instead, which re-organizes the more useful parts of this module in</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- addition with useful parts of others to provide a nice packaged entry</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- point.  If something in here becomes useful for more than just</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- fine-tuning or low-level tweaking, it is probably supposed to be in</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- &quot;Control.Auto&quot; anyway.</span><span>
</span><a name="line-33"></a><span class="hs-comment">--</span><span>
</span><a name="line-34"></a><span class="hs-comment">-- Information on how to use these types is available in the</span><span>
</span><a name="line-35"></a><span class="hs-comment">-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;!</span><span>
</span><a name="line-36"></a><span class="hs-comment">--</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-comment">-- * Auto</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-comment">-- ** Type</span><span>
</span><a name="line-41"></a><span>    </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#autoConstr"><span class="hs-identifier hs-var">autoConstr</span></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier hs-var">toArb</span></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#purifyAuto"><span class="hs-identifier hs-var">purifyAuto</span></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-comment">-- ** Running</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#stepAuto%27"><span class="hs-identifier hs-var">stepAuto'</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#evalAuto"><span class="hs-identifier hs-var">evalAuto</span></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#evalAuto%27"><span class="hs-identifier hs-var">evalAuto'</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#execAuto"><span class="hs-identifier hs-var">execAuto</span></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#execAuto%27"><span class="hs-identifier hs-var">execAuto'</span></a><span>
</span><a name="line-53"></a><span>  </span><span class="hs-comment">-- ** Serializing</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-comment">-- $serializing</span><span>
</span><a name="line-55"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#encodeAuto"><span class="hs-identifier hs-var">encodeAuto</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#decodeAuto"><span class="hs-identifier hs-var">decodeAuto</span></a><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span>
</span><a name="line-58"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span>
</span><a name="line-59"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#unserialize"><span class="hs-identifier hs-var">unserialize</span></a><span>
</span><a name="line-60"></a><span>  </span><span class="hs-comment">-- ** Underlying monad</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#hoistA"><span class="hs-identifier hs-var">hoistA</span></a><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#generalizeA"><span class="hs-identifier hs-var">generalizeA</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-comment">-- ** Special modifiers</span><span>
</span><a name="line-64"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#interceptO"><span class="hs-identifier hs-var">interceptO</span></a><span>
</span><a name="line-65"></a><span>  </span><span class="hs-comment">-- * Auto constructors</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-comment">-- ** Lifting values and functions</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkConst"><span class="hs-identifier hs-var">mkConst</span></a><span>
</span><a name="line-68"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkConstM"><span class="hs-identifier hs-var">mkConstM</span></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkFunc"><span class="hs-identifier hs-var">mkFunc</span></a><span>
</span><a name="line-70"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkFuncM"><span class="hs-identifier hs-var">mkFuncM</span></a><span>
</span><a name="line-71"></a><span>  </span><span class="hs-comment">-- ** from State transformers</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkState"><span class="hs-identifier hs-var">mkState</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkState_"><span class="hs-identifier hs-var">mkState_</span></a><span>
</span><a name="line-74"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkStateM"><span class="hs-identifier hs-var">mkStateM</span></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkStateM_"><span class="hs-identifier hs-var">mkStateM_</span></a><span>
</span><a name="line-76"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkState%27"><span class="hs-identifier hs-var">mkState'</span></a><span>
</span><a name="line-77"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkStateM%27"><span class="hs-identifier hs-var">mkStateM'</span></a><span>
</span><a name="line-78"></a><span>  </span><span class="hs-comment">-- ** from Accumulators</span><span>
</span><a name="line-79"></a><span>  </span><span class="hs-comment">-- *** Result-first</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accum"><span class="hs-identifier hs-var">accum</span></a><span>
</span><a name="line-81"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accum_"><span class="hs-identifier hs-var">accum_</span></a><span>
</span><a name="line-82"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accumM"><span class="hs-identifier hs-var">accumM</span></a><span>
</span><a name="line-83"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accumM_"><span class="hs-identifier hs-var">accumM_</span></a><span>
</span><a name="line-84"></a><span>  </span><span class="hs-comment">-- *** Initial accumulator-first</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accumD"><span class="hs-identifier hs-var">accumD</span></a><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accumD_"><span class="hs-identifier hs-var">accumD_</span></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accumMD"><span class="hs-identifier hs-var">accumMD</span></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#accumMD_"><span class="hs-identifier hs-var">accumMD_</span></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-comment">-- ** Arbitrary Autos</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkAuto"><span class="hs-identifier hs-var">mkAuto</span></a><span>
</span><a name="line-91"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkAuto_"><span class="hs-identifier hs-var">mkAuto_</span></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span>
</span><a name="line-93"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span>
</span><a name="line-94"></a><span>  </span><span class="hs-comment">-- * Strictness</span><span>
</span><a name="line-95"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#forceSerial"><span class="hs-identifier hs-var">forceSerial</span></a><span>
</span><a name="line-96"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#forcer"><span class="hs-identifier hs-var">forcer</span></a><span>
</span><a name="line-97"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#seqer"><span class="hs-identifier hs-var">seqer</span></a><span>
</span><a name="line-98"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Category</span><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-keyword">hiding</span><span>   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sequence</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Fix</span><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Functor</span><span class="hs-operator">.</span><span class="hs-identifier">Identity</span><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Orphans</span><span>           </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Profunctor</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Semigroup</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">String</span><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Traversable</span><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span>         </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sequence</span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-cpp">#if MIN_VERSION_base(4,7,0)</span><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-118"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- | The 'Auto' type.  For this library, an 'Auto' semantically</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- represents/denotes a /a relationship/ between an input and an</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- output that is preserved over multiple steps, where that relationship is</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- (optionally) maintained within the context of a monad.</span><span>
</span><a name="line-125"></a><span class="hs-comment">--</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- A lot of fancy words, I know...but you can think of an 'Auto' as nothing</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- more than a &quot;stream transformer&quot; of value streams.  A stream of</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- sequential input values come in one at a time, and a stream of outputs</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- pop out one at a time, as well.</span><span>
</span><a name="line-130"></a><span class="hs-comment">--</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- Using the 'streamAuto' function, you can &quot;unwrap&quot; the inner value stream</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- transformer from any 'Auto': if @a :: 'Auto' m a b@, 'streamAuto' lets</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- you turn it into an @[a] -&gt; m [b]@.  &quot;Give me a stream of @a@s, one at</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- a time, and I'll give you a list of @b@s, matching a relationship to</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- your stream of @a@s.&quot;</span><span>
</span><a name="line-136"></a><span class="hs-comment">--</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- -- unwrap your inner [a] -&gt; m [b]!</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- 'streamAuto' :: Monad m =&gt; 'Auto' m a b -&gt; ([a] -&gt; m [b])</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-141"></a><span class="hs-comment">--</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- You can also turn an @'Auto' m a b@ into an /effects stream/ that</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- executes effects sequentially with 'toEffectStream' and</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- 'streamAutoEffects', so you can run it with a ListT-compatible library</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- like /pipes/.</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- There's a handy type synonym 'Auto'' for relationships that don't really</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- need a monadic context; the @m@ is just 'Identity':</span><span>
</span><a name="line-149"></a><span class="hs-comment">--</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- type Auto' = Auto Identity</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-153"></a><span class="hs-comment">--</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- So if you had an @a :: 'Auto'' a b@, you can use 'streamAuto'' to</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- &quot;unwrap&quot; the inner stream transformer, @[a] -&gt; [b]@.</span><span>
</span><a name="line-156"></a><span class="hs-comment">--</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- -- unwrap your inner [a] -&gt; [b]!</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- 'streamAuto'' :: 'Auto'' a b -&gt; ([a] -&gt; [b])</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-161"></a><span class="hs-comment">--</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- All of the 'Auto's given in this library maintain some sort of semantic</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- relationship between streams --- for some, the outputs might be the</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- inputs with a function applied; for others, the outputs might be the</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- cumulative sum of the inputs.</span><span>
</span><a name="line-166"></a><span class="hs-comment">--</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- See the</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- for more information!</span><span>
</span><a name="line-170"></a><span class="hs-comment">--</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- Operationally, an  @'Auto' m a b@ is implemented as a &quot;stateful</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- function&quot;.  A function from an @a@ where, every time you &quot;apply&quot; it, you</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- get a @b@ and an &quot;updated 'Auto'&quot;/function with updated state.</span><span>
</span><a name="line-174"></a><span class="hs-comment">--</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- You can get this function using 'stepAuto':</span><span>
</span><a name="line-176"></a><span class="hs-comment">--</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- 'stepAuto' :: 'Auto' m a b -&gt; (a -&gt; m (b, 'Auto' m a b))</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-180"></a><span class="hs-comment">--</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- Or, for 'Auto'', 'stepAuto'':</span><span>
</span><a name="line-182"></a><span class="hs-comment">--</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- 'stepAuto'' :: 'Auto'' a b -&gt; (a -&gt; (b, 'Auto'' a b))</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-186"></a><span class="hs-comment">--</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- &quot;Give me an @a@ and I'll give you a @b@ and your &quot;updated&quot; 'Auto'&quot;.</span><span>
</span><a name="line-188"></a><span class="hs-comment">--</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- 'Auto's really are mostly useful because they can be composed, chained,</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- and modified using their various typeclass instances, like 'Category',</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- 'Applicative', 'Functor', 'Arrow', etc., and also with the combinators</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- in this library.  You can build complex programs as a complex 'Auto' by</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- building up smaller and smaller components.  See the tutorial for more</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- information on this.</span><span>
</span><a name="line-195"></a><span class="hs-comment">--</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- This type also contains information on its own serialization, so you can</span><span>
</span><a name="line-197"></a><span class="hs-comment">-- serialize and re-load the internal state to binary or disk.  See the</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- &quot;serialization&quot; section in the documentation for &quot;Control.Auto.Core&quot;, or</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- the documentation for 'mkAutoM' for more details.</span><span>
</span><a name="line-200"></a><span class="hs-comment">--</span><span>
</span><a name="line-201"></a><span class="hs-keyword">data</span><span> </span><a name="Auto"><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier">Auto</span></a></a><span> </span><a name="local-1627446294"><a href="#local-1627446294"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627446295"><a href="#local-1627446295"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627446296"><a href="#local-1627446296"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span>           </span><a name="AutoFunc"><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier">AutoFunc</span></a></a><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>                </span><span class="hs-glyph">|</span><span>           </span><a name="AutoFuncM"><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier">AutoFuncM</span></a></a><span>   </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446294"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627446297"><a href="#local-1627446297"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><a name="AutoState"><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier">AutoState</span></a></a><span>   </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Get</span><span> </span><a href="#local-1627446297"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446297"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446297"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446297"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">!</span><a href="#local-1627446297"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-204"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627446298"><a href="#local-1627446298"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><a name="AutoStateM"><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier">AutoStateM</span></a></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Get</span><span> </span><a href="#local-1627446298"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446298"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446298"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446294"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446298"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><a href="#local-1627446298"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-205"></a><span>                </span><span class="hs-glyph">|</span><span>           </span><a name="AutoArb"><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier">AutoArb</span></a></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446294"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">Put</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446294"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>                </span><span class="hs-glyph">|</span><span>           </span><a name="AutoArbM"><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier">AutoArbM</span></a></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446294"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">Put</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446294"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446294"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446295"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446296"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span class="hs-cpp">#if MIN_VERSION_base(4,7,0)</span><span>
</span><a name="line-208"></a><span>                </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- | Special case of 'Auto' where the underlying 'Monad' is 'Identity'.</span><span>
</span><a name="line-213"></a><span class="hs-comment">--</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- Instead of &quot;wrapping&quot; an @[a] -&gt; m [b]@, it &quot;wraps&quot; an @[a] -&gt; [b]@.</span><span>
</span><a name="line-215"></a><span class="hs-keyword">type</span><span> </span><a name="Auto%27"><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier">Auto'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><span class="hs-identifier hs-type">Identity</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- | Re-structure 'Auto' internals to use the 'Arb' (&quot;arbitrary&quot;)</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- constructors, as recursion-based mealy machines.</span><span>
</span><a name="line-220"></a><span class="hs-comment">--</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- Mostly here for performance comparisons and benchmarking purposes.</span><span>
</span><a name="line-222"></a><span class="hs-comment">--</span><span>
</span><a name="line-223"></a><span class="hs-identifier">toArb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446435"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446435"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446436"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446437"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446435"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446436"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446437"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-224"></a><a name="toArb"><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier">toArb</span></a></a><span> </span><a name="local-1627446438"><a href="#local-1627446438"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446439"><span class="hs-identifier hs-var">a_</span></a><span>
</span><a name="line-225"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-226"></a><span>    </span><a name="local-1627446439"><a href="#local-1627446439"><span class="hs-identifier">a_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446438"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-227"></a><span>           </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446440"><a href="#local-1627446440"><span class="hs-identifier">f</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-1627446439"><span class="hs-identifier hs-var">a_</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>                                 </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446441"><a href="#local-1627446441"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446440"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446441"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446439"><span class="hs-identifier hs-var">a_</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>           </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446442"><a href="#local-1627446442"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-1627446439"><span class="hs-identifier hs-var">a_</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>                                 </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446443"><a href="#local-1627446443"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><a href="#local-1627446439"><span class="hs-identifier hs-var">a_</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446442"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446443"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>           </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446444"><a href="#local-1627446444"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627446445"><a href="#local-1627446445"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><a name="local-1627446446"><a href="#local-1627446446"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627446447"><a href="#local-1627446447"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446448"><a href="#local-1627446448"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-234"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-1627446449"><a href="#local-1627446449"><span class="hs-identifier">a'</span></a></a><span> </span><a name="local-1627446450"><a href="#local-1627446450"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier hs-var">toArb</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446444"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446447"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446445"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>                                   </span><span class="hs-special">(</span><a href="#local-1627446446"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627446450"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>                                 </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446460"><a href="#local-1627446460"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446461"><a href="#local-1627446461"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446462"><a href="#local-1627446462"><span class="hs-identifier">s''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446447"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446460"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446450"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-237"></a><span>                                         </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446461"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446449"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627446462"><span class="hs-identifier hs-var">s''</span></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>               </span><span class="hs-keyword">in</span><span>  </span><a href="#local-1627446449"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627446448"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-239"></a><span>           </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446463"><a href="#local-1627446463"><span class="hs-identifier">gp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627446464"><a href="#local-1627446464"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><a name="local-1627446465"><a href="#local-1627446465"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627446466"><a href="#local-1627446466"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446467"><a href="#local-1627446467"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-240"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-1627446468"><a href="#local-1627446468"><span class="hs-identifier">a'</span></a></a><span> </span><a name="local-1627446469"><a href="#local-1627446469"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier hs-var">toArb</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446463"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446466"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446464"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>                                    </span><span class="hs-special">(</span><a href="#local-1627446465"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627446467"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>                                  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446470"><a href="#local-1627446470"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-243"></a><span>                                      </span><span class="hs-special">(</span><a name="local-1627446471"><a href="#local-1627446471"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446472"><a href="#local-1627446472"><span class="hs-identifier">s''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446466"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446470"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446469"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-244"></a><span>                                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446471"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446468"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627446472"><span class="hs-identifier hs-var">s''</span></a><span class="hs-special">)</span><span>
</span><a name="line-245"></a><span>               </span><span class="hs-keyword">in</span><span>  </span><a href="#local-1627446468"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="#local-1627446467"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-246"></a><span>           </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446473"><a href="#local-1627446473"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446474"><a href="#local-1627446474"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446475"><a href="#local-1627446475"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier hs-var">toArb</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446473"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>                                    </span><a href="#local-1627446474"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-248"></a><span>                                  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446476"><a href="#local-1627446476"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446477"><a href="#local-1627446477"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446478"><a href="#local-1627446478"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446475"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446476"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-249"></a><span>                                          </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446477"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier hs-var">toArb</span></a><span> </span><a href="#local-1627446478"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>           </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446479"><a href="#local-1627446479"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446480"><a href="#local-1627446480"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446481"><a href="#local-1627446481"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier hs-var">toArb</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446479"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>                                      </span><a href="#local-1627446480"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-252"></a><span>                                    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446482"><a href="#local-1627446482"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-253"></a><span>                                        </span><span class="hs-special">(</span><a name="local-1627446483"><a href="#local-1627446483"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446484"><a href="#local-1627446484"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446481"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446482"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-254"></a><span>                                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446483"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#toArb"><span class="hs-identifier hs-var">toArb</span></a><span> </span><a href="#local-1627446484"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-comment">-- | Returns a string representation of the internal constructor of the</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- 'Auto'.  Useful for debugging the result of compositions and functions</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- and seeing how they affect the internal structure of the 'Auto'.</span><span>
</span><a name="line-260"></a><span class="hs-comment">--</span><span>
</span><a name="line-261"></a><span class="hs-comment">-- In the order of efficiency, &quot;AutoFunc&quot;s tend to be faster than</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- &quot;AutoState&quot;s tend to be faster than &quot;AutoArb&quot;s.  However, when composing</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- one with the other (using 'Category' or 'Applicative'), the two have to</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- be &quot;reduced&quot; to the greatest common denominator; composing an &quot;AutoFunc&quot;</span><span>
</span><a name="line-265"></a><span class="hs-comment">-- with an &quot;AutoArb&quot; produces an &quot;AutoArb&quot;.</span><span>
</span><a name="line-266"></a><span class="hs-comment">--</span><span>
</span><a name="line-267"></a><span class="hs-comment">-- More benchmarking is to be done to be able to rigorously say what these</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- really mean, performance wise.</span><span>
</span><a name="line-269"></a><span class="hs-identifier">autoConstr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446432"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446433"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446434"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-270"></a><a name="autoConstr"><a href="Control.Auto.Core.html#autoConstr"><span class="hs-identifier">autoConstr</span></a></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AutoFunc&quot;</span><span>
</span><a name="line-271"></a><span class="hs-identifier">autoConstr</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AutoFuncM&quot;</span><span>
</span><a name="line-272"></a><span class="hs-identifier">autoConstr</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AutoState&quot;</span><span>
</span><a name="line-273"></a><span class="hs-identifier">autoConstr</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AutoStateM&quot;</span><span>
</span><a name="line-274"></a><span class="hs-identifier">autoConstr</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AutoArb&quot;</span><span>
</span><a name="line-275"></a><span class="hs-identifier">autoConstr</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AutoArbM&quot;</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-comment">-- | Swaps out the underlying 'Monad' of an 'Auto' using the given monad</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- morphism &quot;transforming function&quot;, a natural transformation.</span><span>
</span><a name="line-279"></a><span class="hs-comment">--</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- Basically, given a function to &quot;swap out&quot; any @m a@ with an @m' a@, it</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- swaps out the underlying monad of the 'Auto'.</span><span>
</span><a name="line-282"></a><span class="hs-comment">--</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- This forms a functor, so you rest assured in things like this:</span><span>
</span><a name="line-284"></a><span class="hs-comment">--</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- hoistA id == id</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- hoistA f a1 . hoistA f a2 == hoistA f (a1 . a2)</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-289"></a><span class="hs-identifier">hoistA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446427"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446428"><span class="hs-identifier hs-type">m'</span></a><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-1627446431"><a href="#local-1627446431"><span class="hs-identifier">c</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-1627446427"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446431"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446428"><span class="hs-identifier hs-type">m'</span></a><span> </span><a href="#local-1627446431"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ monad morphism;</span><span>
</span><a name="line-291"></a><span>                                    </span><span class="hs-comment">--     the natural transformation</span><span>
</span><a name="line-292"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446427"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446429"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446430"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-293"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446428"><span class="hs-identifier hs-type">m'</span></a><span> </span><a href="#local-1627446429"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446430"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-294"></a><a name="hoistA"><a href="Control.Auto.Core.html#hoistA"><span class="hs-identifier">hoistA</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446485"><a href="#local-1627446485"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a href="#local-1627446485"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-295"></a><span class="hs-identifier">hoistA</span><span> </span><a name="local-1627446486"><a href="#local-1627446486"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446487"><a href="#local-1627446487"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446486"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446487"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-296"></a><span class="hs-identifier">hoistA</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446488"><a href="#local-1627446488"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446489"><a href="#local-1627446489"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446490"><a href="#local-1627446490"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446488"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446489"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446490"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-297"></a><span class="hs-identifier">hoistA</span><span> </span><a name="local-1627446491"><a href="#local-1627446491"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446492"><a href="#local-1627446492"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446493"><a href="#local-1627446493"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446494"><a href="#local-1627446494"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446492"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446495"><a href="#local-1627446495"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446496"><a href="#local-1627446496"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446491"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446493"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446495"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446496"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446494"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-298"></a><span class="hs-identifier">hoistA</span><span> </span><a name="local-1627446497"><a href="#local-1627446497"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446498"><a href="#local-1627446498"><span class="hs-identifier">gt</span></a></a><span> </span><a name="local-1627446499"><a href="#local-1627446499"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627446500"><a href="#local-1627446500"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#hoistA"><span class="hs-identifier hs-var">hoistA</span></a><span> </span><a href="#local-1627446497"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446498"><span class="hs-identifier hs-var">gt</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>                                       </span><a href="#local-1627446499"><span class="hs-identifier hs-var">pt</span></a><span>
</span><a name="line-300"></a><span>                                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446501"><a href="#local-1627446501"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446502"><a href="#local-1627446502"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446503"><a href="#local-1627446503"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446500"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446501"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-301"></a><span>                                               </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446502"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#hoistA"><span class="hs-identifier hs-var">hoistA</span></a><span> </span><a href="#local-1627446497"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446503"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span class="hs-identifier">hoistA</span><span> </span><a name="local-1627446504"><a href="#local-1627446504"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446505"><a href="#local-1627446505"><span class="hs-identifier">gt</span></a></a><span> </span><a name="local-1627446506"><a href="#local-1627446506"><span class="hs-identifier">pt</span></a></a><span> </span><a name="local-1627446507"><a href="#local-1627446507"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#hoistA"><span class="hs-identifier hs-var">hoistA</span></a><span> </span><a href="#local-1627446504"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446505"><span class="hs-identifier hs-var">gt</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>                                        </span><a href="#local-1627446506"><span class="hs-identifier hs-var">pt</span></a><span>
</span><a name="line-304"></a><span>                                        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446508"><a href="#local-1627446508"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446504"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-305"></a><span>                                            </span><span class="hs-special">(</span><a name="local-1627446509"><a href="#local-1627446509"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446510"><a href="#local-1627446510"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446507"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446508"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-306"></a><span>                                            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446509"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#hoistA"><span class="hs-identifier hs-var">hoistA</span></a><span> </span><a href="#local-1627446504"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446510"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span class="hs-comment">-- | Generalizes an @'Auto'' a b@ to an @'Auto' m a b'@ for any 'Monad'</span><span>
</span><a name="line-309"></a><span class="hs-comment">-- @m@, using 'hoist'.</span><span>
</span><a name="line-310"></a><span class="hs-comment">--</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- You generally should be able to avoid using this if you never directly</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- write any 'Auto''s and always write 'Auto m' parameterized over all</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- 'Monad's, but...in case you import one from a library or something, you</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- can use this.</span><span>
</span><a name="line-315"></a><span class="hs-comment">--</span><span>
</span><a name="line-316"></a><span class="hs-identifier">generalizeA</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446424"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446425"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446426"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446424"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446425"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446426"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-317"></a><a name="generalizeA"><a href="Control.Auto.Core.html#generalizeA"><span class="hs-identifier">generalizeA</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#hoistA"><span class="hs-identifier hs-var">hoistA</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">runIdentity</span><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-comment">-- | Force the serializing components of an 'Auto'.</span><span>
</span><a name="line-320"></a><span class="hs-comment">--</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- TODO: Test if this really works</span><span>
</span><a name="line-322"></a><span class="hs-identifier">forceSerial</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446421"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446422"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446423"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446421"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446422"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446423"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-323"></a><a name="forceSerial"><a href="Control.Auto.Core.html#forceSerial"><span class="hs-identifier">forceSerial</span></a></a><span> </span><a name="local-1627446511"><a href="#local-1627446511"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446511"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-324"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446512"><a href="#local-1627446512"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446513"><a href="#local-1627446513"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446512"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-1627446513"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-1627446511"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-325"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446514"><a href="#local-1627446514"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446515"><a href="#local-1627446515"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446514"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-1627446515"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="#local-1627446511"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-326"></a><span>                  </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446511"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-comment">-- $serializing</span><span>
</span><a name="line-329"></a><span class="hs-comment">--</span><span>
</span><a name="line-330"></a><span class="hs-comment">-- The 'Auto' type offers an interface in which you can serialize</span><span>
</span><a name="line-331"></a><span class="hs-comment">-- (&quot;freeze&quot;) and &quot;resume&quot; an Auto, in 'ByteString' (binary) form.</span><span>
</span><a name="line-332"></a><span class="hs-comment">--</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- You can &quot;freeze&quot; any 'Auto' into a 'ByteString' using 'encodeAuto' (or,</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- if you want the raw 'Put' (from &quot;Data.Serialize&quot;) for some reason,</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- there's 'saveAuto'.</span><span>
</span><a name="line-336"></a><span class="hs-comment">--</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- You can &quot;resume&quot; any 'Auto' from a 'ByteString' using 'decodeAuto' (or,</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- if you want the raw 'Get' for some reason, there's 'resumeAuto').</span><span>
</span><a name="line-339"></a><span class="hs-comment">--</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- Note 'decodeAuto' and 'resumeAuto' &quot;resume&quot; a /given 'Auto'/.  That is,</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- if you call 'decodeAuto' on a &quot;fresh 'Auto'&quot;, it'll decode</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- a 'ByteString' into /that 'Auto', but &quot;resumed&quot;/.  That is, it'll &quot;fast</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- forward&quot; that 'Auto' into the state it was when it was saved.</span><span>
</span><a name="line-344"></a><span class="hs-comment">--</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- For example, let's say I have @a = 'sumFrom' 0@, the 'Auto' whose output</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- is the cumulative sum of all of its inputs so far. If I feed it 3 and</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- 10, it'll have its internal accumulator as 13, keeping track of all the</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- numbers it has seen so far.</span><span>
</span><a name="line-349"></a><span class="hs-comment">--</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- &gt;&gt;&gt; let a = sumFrom 0</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- &gt;&gt;&gt; let (_, a' ) = stepAuto' a  3</span><span>
</span><a name="line-352"></a><span class="hs-comment">-- &gt;&gt;&gt; let (_, a'') = stepAuto' a' 10</span><span>
</span><a name="line-353"></a><span class="hs-comment">--</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- I can then use 'encodeAuto' to &quot;freeze&quot;/&quot;save&quot; the 'Auto' into the</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- 'ByteString' @bs@:</span><span>
</span><a name="line-356"></a><span class="hs-comment">--</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- &gt;&gt;&gt; let bs            = encodeAuto a''</span><span>
</span><a name="line-358"></a><span class="hs-comment">--</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- To &quot;resume&quot; / &quot;load&quot; it, I can use 'decodeAuto' to &quot;resume&quot; the</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- /original/ @a@.  Remember, 'a' was our original 'Auto', the summer</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- 'Auto' with a starting accumulator of 0.  We use 'decodeAuto' to</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- &quot;resume&quot; it, with and resume it with its internal accumulator at 13.</span><span>
</span><a name="line-363"></a><span class="hs-comment">--</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- &gt;&gt;&gt; let (Right resumed) = decodeAuto a bs</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- &gt;&gt;&gt; let (y, _) = stepAuto' resumed 0</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- 13</span><span>
</span><a name="line-367"></a><span class="hs-comment">--</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- Note that all of these would have had the same result:</span><span>
</span><a name="line-369"></a><span class="hs-comment">--</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- &gt;&gt;&gt; let (Right resumed) = decodeAuto a'  bs</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- &gt;&gt;&gt; let (Right resumed) = decodeAuto a'' bs</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- &gt;&gt;&gt; let (Right resumed) = decodeAuto (sumFrom 0) bs</span><span>
</span><a name="line-373"></a><span class="hs-comment">--</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- I mean, after all, if 'decodeAuto' &quot;fast forwards&quot; an 'Auto' to the</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- state it was at when it was frozen...then all of these should really be</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- resumed to the same point, right?</span><span>
</span><a name="line-377"></a><span class="hs-comment">--</span><span>
</span><a name="line-378"></a><span class="hs-comment">-- One way you can think about it is that 'resumeAuto' / 'decodeAuto' takes</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- an 'Auto' and creates a &quot;blueprint&quot; from that 'Auto', on how to &quot;load</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- it&quot;; the blueprint contains what the form of the internal state is, and</span><span>
</span><a name="line-381"></a><span class="hs-comment">-- their offets in the 'ByteString'.  So in the above, 'a', 'a'', 'a''',</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- and @'sumFrom' 0@ all have the same &quot;blueprint&quot; --- their internal</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- states are of the same structure.</span><span>
</span><a name="line-384"></a><span class="hs-comment">--</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- Now, the /magic/ of this all is that combining and transforming 'Auto's</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- with the combinators in this library will also /compose serialization</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- strategies/ .... complex 'Auto's and combinations/chains of 'Auto's</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- create serialization strategies &quot;for free&quot;.  The</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- &lt;https://github.com/mstksg/auto-examples auto-examples&gt; repo has a lot</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- of examples that use this  to great effect, serializing entire</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- applications and entire chat bots without writing any serialization</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- code; it all does it &quot;by itself&quot;.  Be sure to read about the caveats in</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- the</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;.</span><span>
</span><a name="line-395"></a><span class="hs-comment">--</span><span>
</span><a name="line-396"></a><span class="hs-comment">-- Some specific 'Auto's (indicated by a naming convention) might choose to</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- have internal state, yet ignore it when saving/loading.  So, saving it</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- actaully saves no state, and &quot;resuming&quot; it really doesn't do anything.</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- That is, @'decodeAuto' a_ bs = Right a_@.  There isn't a real way to</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- identify from the type of the 'Auto' if it will properly save/resume or</span><span>
</span><a name="line-401"></a><span class="hs-comment">-- not, so you have to keep track of this yourself.  In all of the 'Auto'</span><span>
</span><a name="line-402"></a><span class="hs-comment">-- &quot;included&quot; in this library, any 'Auto' whose name /does not/ end in @_@</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- /will serialize and resume/.  An 'Auto' whose name ends in @_@ is taken</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- by naming convention to be a non-resuming 'Auto'.</span><span>
</span><a name="line-405"></a><span class="hs-comment">--</span><span>
</span><a name="line-406"></a><span class="hs-comment">-- In your own compositions, if you are sure to always use resuming</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- 'Auto's, your composition will also be properly resuming...so you don't</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- have to worry about this!  You shouldn't really ever be &quot;surprised&quot;,</span><span>
</span><a name="line-409"></a><span class="hs-comment">-- because you'll always explicitly chose the resuming version for 'Auto's</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- you want to resume, and the non-resuming version for those you don't.</span><span>
</span><a name="line-411"></a><span class="hs-comment">--</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- Now, /making/ or /writing/ your own generic 'Auto' combinators and</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- transformers that take advantage of serialization is a bit of</span><span>
</span><a name="line-414"></a><span class="hs-comment">-- a headache.  When you can, you might be able to make combinators out of</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- the existing functions in this library.  Sometimes, however, it's</span><span>
</span><a name="line-416"></a><span class="hs-comment">-- unavoidable.  If you are making your own 'Auto' combinators, making sure</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- serialization works as expected is tough; check out the documentation</span><span>
</span><a name="line-418"></a><span class="hs-comment">-- for 'mkAutoM' for more details.</span><span>
</span><a name="line-419"></a><span class="hs-comment">--</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-comment">-- | Encode an 'Auto' and its internal state into a 'ByteString'.</span><span>
</span><a name="line-422"></a><span class="hs-identifier">encodeAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446418"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446419"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446420"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-423"></a><a name="encodeAuto"><a href="Control.Auto.Core.html#encodeAuto"><span class="hs-identifier">encodeAuto</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">runPut</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span>
</span><a name="line-424"></a><span class="hs-pragma">{-# INLINE encodeAuto #-}</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span class="hs-comment">-- | &quot;Resume&quot; an 'Auto' from its 'ByteString' serialization, giving</span><span>
</span><a name="line-427"></a><span class="hs-comment">-- a 'Left' if the deserialization is not possible.</span><span>
</span><a name="line-428"></a><span class="hs-identifier">decodeAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446415"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446416"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446417"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446415"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446416"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446417"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><a name="decodeAuto"><a href="Control.Auto.Core.html#decodeAuto"><span class="hs-identifier">decodeAuto</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">runGet</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span>
</span><a name="line-430"></a><span class="hs-pragma">{-# INLINE decodeAuto #-}</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- | Returns a 'Get' from an 'Auto' ---  instructions (from</span><span>
</span><a name="line-433"></a><span class="hs-comment">-- &quot;Data.Serialize&quot;) on taking a ByteString and &quot;restoring&quot; the originally</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- saved 'Auto', in the originally saved state.</span><span>
</span><a name="line-435"></a><span class="hs-identifier">resumeAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446412"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446413"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446414"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446412"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446413"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446414"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-436"></a><a name="resumeAuto"><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier">resumeAuto</span></a></a><span> </span><a name="local-1627446516"><a href="#local-1627446516"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446516"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-437"></a><span>                 </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446517"><a href="#local-1627446517"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446518"><a href="#local-1627446518"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span>  </span><a href="#local-1627446517"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446518"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-1627446517"><span class="hs-identifier hs-var">gp</span></a><span>
</span><a name="line-438"></a><span>                 </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446530"><a href="#local-1627446530"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446531"><a href="#local-1627446531"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446530"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446531"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-1627446530"><span class="hs-identifier hs-var">gp</span></a><span>
</span><a name="line-439"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446532"><a href="#local-1627446532"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446532"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-440"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446533"><a href="#local-1627446533"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446533"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-441"></a><span>                 </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627446516"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-442"></a><span class="hs-pragma">{-# INLINE resumeAuto #-}</span><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-comment">-- | Returns a 'Put' --- instructions (from &quot;Data.Serialize&quot;) on how to</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- &quot;freeze&quot; the 'Auto', with its internal state, and save it to a binary</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- encoding.  It can later be reloaded and &quot;resumed&quot; by</span><span>
</span><a name="line-447"></a><span class="hs-comment">-- 'resumeAuto'/'decodeAuto'.</span><span>
</span><a name="line-448"></a><span class="hs-identifier">saveAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446409"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446410"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446411"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span>
</span><a name="line-449"></a><a name="saveAuto"><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier">saveAuto</span></a></a><span> </span><a name="local-1627446534"><a href="#local-1627446534"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446534"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-450"></a><span>               </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446535"><a href="#local-1627446535"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446536"><a href="#local-1627446536"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446535"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627446536"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-451"></a><span>               </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446537"><a href="#local-1627446537"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446538"><a href="#local-1627446538"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446537"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-1627446538"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-452"></a><span>               </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446539"><a href="#local-1627446539"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446539"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-453"></a><span>               </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446540"><a href="#local-1627446540"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446540"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-454"></a><span>               </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span class="hs-pragma">{-# INLINE saveAuto #-}</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-comment">-- | Takes an 'Auto' that is serializable/resumable and returns an 'Auto'</span><span>
</span><a name="line-458"></a><span class="hs-comment">-- that is not.  That is, when it is &quot;saved&quot;, saves no data, and when it is</span><span>
</span><a name="line-459"></a><span class="hs-comment">-- &quot;resumed&quot;, resets itself back to the initial configuration every time;</span><span>
</span><a name="line-460"></a><span class="hs-comment">-- in other words, @'decodeAuto' (unserialize a) bs = Right (unserialize</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- a)@.  Trying to &quot;resume&quot; it will just always give itself, unchanged.</span><span>
</span><a name="line-462"></a><span class="hs-identifier">unserialize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446406"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446406"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446407"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446408"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446406"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446407"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446408"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-463"></a><a name="unserialize"><a href="Control.Auto.Core.html#unserialize"><span class="hs-identifier">unserialize</span></a></a><span> </span><a name="local-1627446541"><a href="#local-1627446541"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-464"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446541"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-465"></a><span>        </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446541"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-466"></a><span>        </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446541"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-467"></a><span>        </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446542"><a href="#local-1627446542"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446543"><a href="#local-1627446543"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-1627446543"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446542"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446543"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-468"></a><span>        </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446544"><a href="#local-1627446544"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446545"><a href="#local-1627446545"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-1627446545"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446544"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446545"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-469"></a><span>        </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446546"><a href="#local-1627446546"><span class="hs-identifier">f</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-1627446541"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><a href="Control.Auto.Core.html#unserialize"><span class="hs-identifier hs-var">unserialize</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446546"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-470"></a><span>        </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446547"><a href="#local-1627446547"><span class="hs-identifier">f</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-1627446541"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><a href="Control.Auto.Core.html#unserialize"><span class="hs-identifier hs-var">unserialize</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446547"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span class="hs-comment">-- | &quot;Runs&quot; the 'Auto' through one step.</span><span>
</span><a name="line-473"></a><span class="hs-comment">--</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- That is, given an @'Auto' m a b@, returns a function that takes an @a@</span><span>
</span><a name="line-475"></a><span class="hs-comment">-- and returns a @b@ and an &quot;updated&quot;/&quot;next&quot; 'Auto'; an @a -&gt; m (b, 'Auto'</span><span>
</span><a name="line-476"></a><span class="hs-comment">-- m a b)@.</span><span>
</span><a name="line-477"></a><span class="hs-comment">--</span><span>
</span><a name="line-478"></a><span class="hs-comment">-- This is the main way of running an 'Auto' &quot;step by step&quot;, so if you have</span><span>
</span><a name="line-479"></a><span class="hs-comment">-- some sort of game loop that updates everything every &quot;tick&quot;, this is</span><span>
</span><a name="line-480"></a><span class="hs-comment">-- what you're looking for.  At every loop, gather input @a@, feed it into</span><span>
</span><a name="line-481"></a><span class="hs-comment">-- the 'Auto', &quot;render&quot; the result @b@, and get your new 'Auto' to run the</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- next time.</span><span>
</span><a name="line-483"></a><span class="hs-comment">--</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- Here is an example with @'sumFrom' 0@, the 'Auto' whose output is the</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- cumulative sum of the inputs, and an underying monad of @Identity@.</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- Here,</span><span>
</span><a name="line-487"></a><span class="hs-comment">--</span><span>
</span><a name="line-488"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- stepAuto :: Auto Identity Int Int</span><span>
</span><a name="line-490"></a><span class="hs-comment">--          -&gt; (Int -&gt; Identity (Int, Auto Identity Int Int))</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-492"></a><span class="hs-comment">--</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- Every time you &quot;step&quot;, you give it an 'Int' and get a resulting 'Int'</span><span>
</span><a name="line-494"></a><span class="hs-comment">-- (the cumulative sum) and the &quot;updated 'Auto'&quot;, with the updated</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- accumulator.</span><span>
</span><a name="line-496"></a><span class="hs-comment">--</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- &gt;&gt;&gt; let a0 :: Auto Identity Int Int</span><span>
</span><a name="line-498"></a><span class="hs-comment">--         a0 = sumFrom 0</span><span>
</span><a name="line-499"></a><span class="hs-comment">-- &gt;&gt;&gt; let Identity (res1, a1) = stepAuto a0 4      -- run with 4</span><span>
</span><a name="line-500"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-501"></a><span class="hs-comment">-- 4                -- the cumulative sum, 4</span><span>
</span><a name="line-502"></a><span class="hs-comment">-- &gt;&gt;&gt; let Identity (res2, a2) = stepAuto a1 5      -- run with 5</span><span>
</span><a name="line-503"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-504"></a><span class="hs-comment">-- 9                -- the cumulative sum, 4 + 5</span><span>
</span><a name="line-505"></a><span class="hs-comment">-- &gt;&gt;&gt; let Identity (res3, _ ) = stepAuto a2 3      -- run with 3</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-507"></a><span class="hs-comment">-- 12               -- the cumulative sum, 4 + 5 + 3</span><span>
</span><a name="line-508"></a><span class="hs-comment">--</span><span>
</span><a name="line-509"></a><span class="hs-comment">-- By the way, for the case where your 'Auto' is under 'Identity', we have</span><span>
</span><a name="line-510"></a><span class="hs-comment">-- a type synomym 'Auto''...and a convenience function to make &quot;running&quot; it</span><span>
</span><a name="line-511"></a><span class="hs-comment">-- more streamlined:</span><span>
</span><a name="line-512"></a><span class="hs-comment">--</span><span>
</span><a name="line-513"></a><span class="hs-comment">-- &gt;&gt;&gt; let a0 :: Auto' Int Int</span><span>
</span><a name="line-514"></a><span class="hs-comment">--         a0 = sumFrom 0</span><span>
</span><a name="line-515"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res1, a1) = stepAuto' a0 4          -- run with 4</span><span>
</span><a name="line-516"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-517"></a><span class="hs-comment">-- 4                -- the cumulative sum, 4</span><span>
</span><a name="line-518"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res2, a2) = stepAuto' a1 5          -- run with 5</span><span>
</span><a name="line-519"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-520"></a><span class="hs-comment">-- 9                -- the cumulative sum, 4 + 5</span><span>
</span><a name="line-521"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, _ ) = stepAuto' a2 3          -- run with 3</span><span>
</span><a name="line-522"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-523"></a><span class="hs-comment">-- 12               -- the cumulative sum, 4 + 5 + 3</span><span>
</span><a name="line-524"></a><span class="hs-comment">--</span><span>
</span><a name="line-525"></a><span class="hs-comment">-- But, if your 'Auto' actaully has effects when being stepped, 'stepAuto'</span><span>
</span><a name="line-526"></a><span class="hs-comment">-- will execute them:</span><span>
</span><a name="line-527"></a><span class="hs-comment">--</span><span>
</span><a name="line-528"></a><span class="hs-comment">-- &gt;&gt;&gt; let a0 :: Auto IO Int Int</span><span>
</span><a name="line-529"></a><span class="hs-comment">--         a0 = effect (putStrLn &quot;hey!&quot;) *&gt; sumFrom 0</span><span>
</span><a name="line-530"></a><span class="hs-comment">-- &gt;&gt;&gt; (res1, a1) &lt;- stepAuto a0 4              -- run with 4</span><span>
</span><a name="line-531"></a><span class="hs-comment">-- hey!         -- IO effect</span><span>
</span><a name="line-532"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-533"></a><span class="hs-comment">-- 4                -- the cumulative sum, 4</span><span>
</span><a name="line-534"></a><span class="hs-comment">-- &gt;&gt;&gt; (res2, a2) &lt;- stepAuto a1 5              -- run with 5</span><span>
</span><a name="line-535"></a><span class="hs-comment">-- hey!         -- IO effect</span><span>
</span><a name="line-536"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- 9                -- the cumulative sum, 4 + 5</span><span>
</span><a name="line-538"></a><span class="hs-comment">-- &gt;&gt;&gt; (res3, _ ) &lt;- stepAuto a2 3              -- run with 3</span><span>
</span><a name="line-539"></a><span class="hs-comment">-- hey!         -- IO effect</span><span>
</span><a name="line-540"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-541"></a><span class="hs-comment">-- 12               -- the cumulative sum, 4 + 5 + 3</span><span>
</span><a name="line-542"></a><span class="hs-comment">--</span><span>
</span><a name="line-543"></a><span class="hs-comment">-- (Here, @'effect' ('putStrLn' &quot;hey&quot;)@ is an @'Auto' IO Int ()@, which</span><span>
</span><a name="line-544"></a><span class="hs-comment">-- ignores its input and just executes @'putStrLn' &quot;hey&quot;@ every time it is</span><span>
</span><a name="line-545"></a><span class="hs-comment">-- run.  When we use '*&gt;' from &quot;Control.Applicative&quot;, we &quot;combine&quot; the two</span><span>
</span><a name="line-546"></a><span class="hs-comment">-- 'Auto's together and run them /both/ on each input (4, 5, 3...)...but</span><span>
</span><a name="line-547"></a><span class="hs-comment">-- for the &quot;final&quot; output at the end, we only return the output of the</span><span>
</span><a name="line-548"></a><span class="hs-comment">-- second one, @'sumFrom' 0@ (5, 9, 12...))</span><span>
</span><a name="line-549"></a><span class="hs-comment">--</span><span>
</span><a name="line-550"></a><span class="hs-comment">-- If you think of an @'Auto' m a b@ as a &quot;stateful function&quot; @a -&gt; m b@,</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- then 'stepAuto' lets you &quot;run&quot; it.</span><span>
</span><a name="line-552"></a><span class="hs-comment">--</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- In order to directly run an 'Auto' on a stream, an @[a]@, use</span><span>
</span><a name="line-554"></a><span class="hs-comment">-- 'streamAuto'.  That gives you an @[a] -&gt; m [b]@.</span><span>
</span><a name="line-555"></a><span class="hs-comment">--</span><span>
</span><a name="line-556"></a><span class="hs-identifier">stepAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446403"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-557"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446403"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446404"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446405"><span class="hs-identifier hs-type">b</span></a><span>        </span><span class="hs-comment">-- ^ the 'Auto' to step</span><span>
</span><a name="line-558"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446404"><span class="hs-identifier hs-type">a</span></a><span>                 </span><span class="hs-comment">-- ^ the input</span><span>
</span><a name="line-559"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446403"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446405"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446403"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446404"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446405"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ the output, and the updated 'Auto''.</span><span>
</span><a name="line-560"></a><a name="stepAuto"><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier">stepAuto</span></a></a><span> </span><a name="local-1627446548"><a href="#local-1627446548"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627446549"><a href="#local-1627446549"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446548"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-561"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446550"><a href="#local-1627446550"><span class="hs-identifier">f</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-562"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446550"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446549"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446548"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446551"><a href="#local-1627446551"><span class="hs-identifier">f</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-564"></a><span>                     </span><a name="local-1627446552"><a href="#local-1627446552"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446551"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446549"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-565"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446552"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446548"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-566"></a><span>                 </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446553"><a href="#local-1627446553"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446554"><a href="#local-1627446554"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446555"><a href="#local-1627446555"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-567"></a><span>                     </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446556"><a href="#local-1627446556"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446557"><a href="#local-1627446557"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446554"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446549"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446555"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-568"></a><span>                         </span><a name="local-1627446558"><a href="#local-1627446558"><span class="hs-identifier">a'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446553"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446554"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446557"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-569"></a><span>                     </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446556"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446558"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-570"></a><span>                 </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446559"><a href="#local-1627446559"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446560"><a href="#local-1627446560"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446561"><a href="#local-1627446561"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-571"></a><span>                     </span><span class="hs-special">(</span><a name="local-1627446562"><a href="#local-1627446562"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446563"><a href="#local-1627446563"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446560"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446549"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446561"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-572"></a><span>                     </span><span class="hs-keyword">let</span><span> </span><a name="local-1627446564"><a href="#local-1627446564"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446559"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446560"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446563"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-573"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446562"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446564"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446565"><a href="#local-1627446565"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446565"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446549"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-575"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446566"><a href="#local-1627446566"><span class="hs-identifier">f</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446566"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446549"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-576"></a><span class="hs-pragma">{-# INLINE stepAuto #-}</span><span>
</span><a name="line-577"></a><span>
</span><a name="line-578"></a><span class="hs-comment">-- | &quot;Runs&quot; an 'Auto'' through one step.</span><span>
</span><a name="line-579"></a><span class="hs-comment">--</span><span>
</span><a name="line-580"></a><span class="hs-comment">-- That is, given an @'Auto'' a b@, returns a function that takes an @a@</span><span>
</span><a name="line-581"></a><span class="hs-comment">-- and returns a @b@ and an &quot;updated&quot;/&quot;next&quot; 'Auto''; an @a -&gt; (b, 'Auto''</span><span>
</span><a name="line-582"></a><span class="hs-comment">-- a b)@.</span><span>
</span><a name="line-583"></a><span class="hs-comment">--</span><span>
</span><a name="line-584"></a><span class="hs-comment">-- See 'stepAuto' documentation for motivations, use cases, and more</span><span>
</span><a name="line-585"></a><span class="hs-comment">-- details.  You can use this instead of 'stepAuto' when your underyling</span><span>
</span><a name="line-586"></a><span class="hs-comment">-- monad is 'Identity', and your 'Auto' doesn't produce any effects.</span><span>
</span><a name="line-587"></a><span class="hs-comment">--</span><span>
</span><a name="line-588"></a><span class="hs-comment">-- Here is an example with @'sumFrom' 0@, the 'Auto'' whose output is the</span><span>
</span><a name="line-589"></a><span class="hs-comment">-- cumulative sum of the inputs</span><span>
</span><a name="line-590"></a><span class="hs-comment">--</span><span>
</span><a name="line-591"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-592"></a><span class="hs-comment">-- stepAuto' :: Auto' Int Int</span><span>
</span><a name="line-593"></a><span class="hs-comment">--           -&gt; (Int -&gt; (Int, Auto' Int Int))</span><span>
</span><a name="line-594"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-595"></a><span class="hs-comment">--</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- Every time you &quot;step&quot;, you give it an 'Int' and get a resulting 'Int'</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- (the cumulative sum) and the &quot;updated 'Auto''&quot;, with the updated</span><span>
</span><a name="line-598"></a><span class="hs-comment">-- accumulator.</span><span>
</span><a name="line-599"></a><span class="hs-comment">--</span><span>
</span><a name="line-600"></a><span class="hs-comment">-- &gt;&gt;&gt; let a0 :: Auto' Int Int</span><span>
</span><a name="line-601"></a><span class="hs-comment">--         a0 = sumFrom 0</span><span>
</span><a name="line-602"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res1, a1) = stepAuto' a0 4          -- run with 4</span><span>
</span><a name="line-603"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-604"></a><span class="hs-comment">-- 4                -- the cumulative sum, 4</span><span>
</span><a name="line-605"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res2, a2) = stepAuto' a1 5          -- run with 5</span><span>
</span><a name="line-606"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-607"></a><span class="hs-comment">-- 9                -- the cumulative sum, 4 + 5</span><span>
</span><a name="line-608"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, _ ) = stepAuto' a2 3          -- run with 3</span><span>
</span><a name="line-609"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-610"></a><span class="hs-comment">-- 12               -- the cumulative sum, 4 + 5 + 3</span><span>
</span><a name="line-611"></a><span class="hs-comment">--</span><span>
</span><a name="line-612"></a><span class="hs-comment">-- If you think of an @'Auto'' a b@ as a &quot;stateful function&quot; @a -&gt; b@,</span><span>
</span><a name="line-613"></a><span class="hs-comment">-- then 'stepAuto'' lets you &quot;run&quot; it.</span><span>
</span><a name="line-614"></a><span class="hs-comment">--</span><span>
</span><a name="line-615"></a><span class="hs-comment">-- In order to directly run an 'Auto'' on a stream, an @[a]@, use</span><span>
</span><a name="line-616"></a><span class="hs-comment">-- 'streamAuto''.  That gives you an @[a] -&gt; [b]@.</span><span>
</span><a name="line-617"></a><span class="hs-comment">--</span><span>
</span><a name="line-618"></a><span class="hs-identifier">stepAuto'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446401"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446402"><span class="hs-identifier hs-type">b</span></a><span>        </span><span class="hs-comment">-- ^ the 'Auto'' to step</span><span>
</span><a name="line-619"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446401"><span class="hs-identifier hs-type">a</span></a><span>                </span><span class="hs-comment">-- ^ the input</span><span>
</span><a name="line-620"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446402"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446401"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446402"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ the output, and the updated 'Auto''</span><span>
</span><a name="line-621"></a><a name="stepAuto%27"><a href="Control.Auto.Core.html#stepAuto%27"><span class="hs-identifier">stepAuto'</span></a></a><span> </span><a name="local-1627446567"><a href="#local-1627446567"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627446568"><a href="#local-1627446568"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446567"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-622"></a><span>                  </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446569"><a href="#local-1627446569"><span class="hs-identifier">f</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446569"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446568"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446567"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-623"></a><span>                  </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446570"><a href="#local-1627446570"><span class="hs-identifier">f</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-special">(</span><a href="#local-1627446570"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446568"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-1627446567"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-624"></a><span>                  </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446571"><a href="#local-1627446571"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446572"><a href="#local-1627446572"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446573"><a href="#local-1627446573"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446574"><a href="#local-1627446574"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446575"><a href="#local-1627446575"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446572"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446568"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446573"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-625"></a><span>                                           </span><a name="local-1627446576"><a href="#local-1627446576"><span class="hs-identifier">a'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446571"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446572"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446575"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-626"></a><span>                                       </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446574"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446576"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>                  </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446577"><a href="#local-1627446577"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446578"><a href="#local-1627446578"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446579"><a href="#local-1627446579"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446580"><a href="#local-1627446580"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446581"><a href="#local-1627446581"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-special">(</span><a href="#local-1627446578"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446568"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446579"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-628"></a><span>                                           </span><a name="local-1627446582"><a href="#local-1627446582"><span class="hs-identifier">a'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446577"><span class="hs-identifier hs-var">gp</span></a><span> </span><a href="#local-1627446578"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446581"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-629"></a><span>                                       </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446580"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446582"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-630"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446583"><a href="#local-1627446583"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446583"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446568"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-631"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627446584"><a href="#local-1627446584"><span class="hs-identifier">f</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-special">(</span><a href="#local-1627446584"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446568"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span class="hs-pragma">{-# INLINE stepAuto' #-}</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-comment">-- | In theory, &quot;purifying&quot; an 'Auto''&quot; should prep it for faster</span><span>
</span><a name="line-635"></a><span class="hs-comment">-- evaluation when used with 'stepAuto'' or 'streamAuto''.  But the</span><span>
</span><a name="line-636"></a><span class="hs-comment">-- benchmarks have not been run yet, so stay tuned!</span><span>
</span><a name="line-637"></a><span class="hs-comment">--</span><span>
</span><a name="line-638"></a><span class="hs-comment">-- TODO: Benchmark</span><span>
</span><a name="line-639"></a><span class="hs-identifier">purifyAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446399"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446400"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446399"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446400"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-640"></a><a name="purifyAuto"><a href="Control.Auto.Core.html#purifyAuto"><span class="hs-identifier">purifyAuto</span></a></a><span> </span><a name="local-1627446585"><a href="#local-1627446585"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446585"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-641"></a><span class="hs-identifier">purifyAuto</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446586"><a href="#local-1627446586"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446586"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span class="hs-identifier">purifyAuto</span><span> </span><a name="local-1627446587"><a href="#local-1627446587"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446587"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-643"></a><span class="hs-identifier">purifyAuto</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446588"><a href="#local-1627446588"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446589"><a href="#local-1627446589"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446590"><a href="#local-1627446590"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446588"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446591"><a href="#local-1627446591"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446592"><a href="#local-1627446592"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-special">(</span><a href="#local-1627446589"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446591"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446592"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446590"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-644"></a><span class="hs-identifier">purifyAuto</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446593"><a href="#local-1627446593"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627446594"><a href="#local-1627446594"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627446595"><a href="#local-1627446595"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#purifyAuto"><span class="hs-identifier hs-var">purifyAuto</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446593"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>                                         </span><a href="#local-1627446594"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-646"></a><span>                                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446596"><a href="#local-1627446596"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446597"><a href="#local-1627446597"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446598"><a href="#local-1627446598"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446595"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446596"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-647"></a><span>                                               </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446597"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#purifyAuto"><span class="hs-identifier hs-var">purifyAuto</span></a><span> </span><a href="#local-1627446598"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-648"></a><span class="hs-identifier">purifyAuto</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446599"><a href="#local-1627446599"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627446600"><a href="#local-1627446600"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1627446601"><a href="#local-1627446601"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#purifyAuto"><span class="hs-identifier hs-var">purifyAuto</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446599"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-649"></a><span>                                         </span><a href="#local-1627446600"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-650"></a><span>                                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446602"><a href="#local-1627446602"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446603"><a href="#local-1627446603"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446604"><a href="#local-1627446604"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><span class="hs-special">(</span><a href="#local-1627446601"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446602"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>                                               </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446603"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#purifyAuto"><span class="hs-identifier hs-var">purifyAuto</span></a><span> </span><a href="#local-1627446604"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span class="hs-comment">-- | Like 'stepAuto', but drops the &quot;next 'Auto'&quot; and just gives the</span><span>
</span><a name="line-654"></a><span class="hs-comment">-- result.</span><span>
</span><a name="line-655"></a><span class="hs-identifier">evalAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446396"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-656"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446396"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446397"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446398"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto' to run</span><span>
</span><a name="line-657"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446397"><span class="hs-identifier hs-type">a</span></a><span>               </span><span class="hs-comment">-- ^ input</span><span>
</span><a name="line-658"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446396"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446398"><span class="hs-identifier hs-type">b</span></a><span>             </span><span class="hs-comment">-- ^ output</span><span>
</span><a name="line-659"></a><a name="evalAuto"><a href="Control.Auto.Core.html#evalAuto"><span class="hs-identifier">evalAuto</span></a></a><span> </span><a name="local-1627446605"><a href="#local-1627446605"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627446605"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span class="hs-comment">-- | Like 'stepAuto'', but drops the &quot;next 'Auto''&quot; and just gives the</span><span>
</span><a name="line-662"></a><span class="hs-comment">-- result.  'evalAuto' for 'Auto''.</span><span>
</span><a name="line-663"></a><span class="hs-identifier">evalAuto'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446394"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446395"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto' to run</span><span>
</span><a name="line-664"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446394"><span class="hs-identifier hs-type">a</span></a><span>              </span><span class="hs-comment">-- ^ input</span><span>
</span><a name="line-665"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446395"><span class="hs-identifier hs-type">b</span></a><span>              </span><span class="hs-comment">-- ^ output</span><span>
</span><a name="line-666"></a><a name="evalAuto%27"><a href="Control.Auto.Core.html#evalAuto%27"><span class="hs-identifier">evalAuto'</span></a></a><span> </span><a name="local-1627446606"><a href="#local-1627446606"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#stepAuto%27"><span class="hs-identifier hs-var">stepAuto'</span></a><span> </span><a href="#local-1627446606"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-667"></a><span>
</span><a name="line-668"></a><span class="hs-comment">-- | Like 'stepAuto', but drops the result and just gives the &quot;updated</span><span>
</span><a name="line-669"></a><span class="hs-comment">-- 'Auto'&quot;.</span><span>
</span><a name="line-670"></a><span class="hs-identifier">execAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446391"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-671"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446391"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446392"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446393"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto' to run</span><span>
</span><a name="line-672"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446392"><span class="hs-identifier hs-type">a</span></a><span>               </span><span class="hs-comment">-- ^ input</span><span>
</span><a name="line-673"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446391"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446391"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446392"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446393"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ updated 'Auto'</span><span>
</span><a name="line-674"></a><a name="execAuto"><a href="Control.Auto.Core.html#execAuto"><span class="hs-identifier">execAuto</span></a></a><span> </span><a name="local-1627446607"><a href="#local-1627446607"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627446607"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span class="hs-comment">-- | Like 'stepAuto'', but drops the result and just gives the &quot;updated</span><span>
</span><a name="line-677"></a><span class="hs-comment">-- 'Auto''&quot;.  'execAuto' for 'Auto''.</span><span>
</span><a name="line-678"></a><span class="hs-identifier">execAuto'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446389"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446390"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ 'Auto'' to run</span><span>
</span><a name="line-679"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446389"><span class="hs-identifier hs-type">a</span></a><span>              </span><span class="hs-comment">-- ^ input</span><span>
</span><a name="line-680"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto%27"><span class="hs-identifier hs-type">Auto'</span></a><span> </span><a href="#local-1627446389"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446390"><span class="hs-identifier hs-type">b</span></a><span>      </span><span class="hs-comment">-- ^ updated 'Auto''</span><span>
</span><a name="line-681"></a><a name="execAuto%27"><a href="Control.Auto.Core.html#execAuto%27"><span class="hs-identifier">execAuto'</span></a></a><span> </span><a name="local-1627446608"><a href="#local-1627446608"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#stepAuto%27"><span class="hs-identifier hs-var">stepAuto'</span></a><span> </span><a href="#local-1627446608"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-comment">-- | A special 'Auto' that acts like the 'id' 'Auto', but forces results as</span><span>
</span><a name="line-684"></a><span class="hs-comment">-- they come through to be fully evaluated, when composed with other</span><span>
</span><a name="line-685"></a><span class="hs-comment">-- 'Auto's.</span><span>
</span><a name="line-686"></a><span class="hs-comment">--</span><span>
</span><a name="line-687"></a><span class="hs-comment">-- TODO: Test if this really works</span><span>
</span><a name="line-688"></a><span class="hs-identifier">forcer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="#local-1627446387"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446388"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446387"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446387"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-689"></a><a name="forcer"><a href="Control.Auto.Core.html#forcer"><span class="hs-identifier">forcer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAuto_"><span class="hs-identifier hs-var">mkAuto_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446609"><a href="#local-1627446609"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446609"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">deepseq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-1627446609"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#forcer"><span class="hs-identifier hs-var">forcer</span></a><span class="hs-special">)</span><span>
</span><a name="line-690"></a><span class="hs-pragma">{-# INLINE forcer #-}</span><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span class="hs-comment">-- | A special 'Auto' that acts like the 'id' 'Auto', but forces results as</span><span>
</span><a name="line-693"></a><span class="hs-comment">-- they come through to be evaluated to Weak Head Normal Form, with 'seq',</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- when composed with other 'Auto's.</span><span>
</span><a name="line-695"></a><span class="hs-comment">--</span><span>
</span><a name="line-696"></a><span class="hs-comment">-- TODO: Test if this really works</span><span>
</span><a name="line-697"></a><span class="hs-identifier">seqer</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446385"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446386"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446386"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-698"></a><a name="seqer"><a href="Control.Auto.Core.html#seqer"><span class="hs-identifier">seqer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAuto_"><span class="hs-identifier hs-var">mkAuto_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446610"><a href="#local-1627446610"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446610"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-1627446610"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#seqer"><span class="hs-identifier hs-var">seqer</span></a><span class="hs-special">)</span><span>
</span><a name="line-699"></a><span class="hs-pragma">{-# INLINE seqer #-}</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span class="hs-comment">-- | Abstraction over lower-level funging with serialization; lets you</span><span>
</span><a name="line-702"></a><span class="hs-comment">-- modify the result of an 'Auto' by being able to intercept the @(b,</span><span>
</span><a name="line-703"></a><span class="hs-comment">-- 'Auto' m a b)@ output and return a new output value @m c@.</span><span>
</span><a name="line-704"></a><span class="hs-comment">--</span><span>
</span><a name="line-705"></a><span class="hs-comment">-- Note that this is a lot like 'fmap':</span><span>
</span><a name="line-706"></a><span class="hs-comment">--</span><span>
</span><a name="line-707"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- fmap :: (b -&gt; c) -&gt; Auto m a b -&gt; Auto m a c</span><span>
</span><a name="line-709"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-710"></a><span class="hs-comment">--</span><span>
</span><a name="line-711"></a><span class="hs-comment">-- Except gives you access to both the @b@ and the &quot;updated 'Auto'&quot;;</span><span>
</span><a name="line-712"></a><span class="hs-comment">-- instead of an @b -&gt; c@, you get to pass a @(b, 'Auto' m a b) -&gt; m c@.</span><span>
</span><a name="line-713"></a><span class="hs-comment">--</span><span>
</span><a name="line-714"></a><span class="hs-comment">-- Basically experimenting with a bunch of abstractions over different</span><span>
</span><a name="line-715"></a><span class="hs-comment">-- lower-level modification of 'Auto's, because making sure the</span><span>
</span><a name="line-716"></a><span class="hs-comment">-- serialization works as planned can be a bit difficult.</span><span>
</span><a name="line-717"></a><span class="hs-comment">--</span><span>
</span><a name="line-718"></a><span class="hs-identifier">interceptO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446381"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-719"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627446382"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446381"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446383"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446382"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446381"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446384"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ intercepting function</span><span>
</span><a name="line-720"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446381"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446383"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446382"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-721"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446381"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446383"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446384"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-722"></a><a name="interceptO"><a href="Control.Auto.Core.html#interceptO"><span class="hs-identifier">interceptO</span></a></a><span> </span><a name="local-1627446611"><a href="#local-1627446611"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446612"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-723"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-724"></a><span>    </span><a name="local-1627446612"><a href="#local-1627446612"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627446613"><a href="#local-1627446613"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446612"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627446613"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-725"></a><span>                    </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627446613"><span class="hs-identifier hs-var">a0</span></a><span class="hs-special">)</span><span>
</span><a name="line-726"></a><span>                  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446614"><a href="#local-1627446614"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-727"></a><span>                        </span><a name="local-1627446615"><a href="#local-1627446615"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446616"><a href="#local-1627446616"><span class="hs-identifier">a1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627446613"><span class="hs-identifier hs-var">a0</span></a><span> </span><a href="#local-1627446614"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-728"></a><span>                        </span><a name="local-1627446617"><a href="#local-1627446617"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446611"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446615"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-729"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446617"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446612"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627446616"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span class="hs-comment">-- compMAuto :: (Monad m, Monad m') =&gt; Auto m b (m' c) -&gt; Auto m a (m' b) -&gt; Auto m a (m' c)</span><span>
</span><a name="line-732"></a><span class="hs-comment">-- compMAuto g f = AutoArbM undefined</span><span>
</span><a name="line-733"></a><span class="hs-comment">--                          undefined</span><span>
</span><a name="line-734"></a><span class="hs-comment">--                          $ \x -&gt; do</span><span>
</span><a name="line-735"></a><span class="hs-comment">--                              Output y f' &lt;- stepAuto f x</span><span>
</span><a name="line-736"></a><span class="hs-comment">--                              undefined</span><span>
</span><a name="line-737"></a><span>
</span><a name="line-738"></a><span>
</span><a name="line-739"></a><span class="hs-comment">-- doesn't work like you'd think lol.</span><span>
</span><a name="line-740"></a><span class="hs-comment">-- serialForcer :: Monad m =&gt; Auto m a a</span><span>
</span><a name="line-741"></a><span class="hs-comment">-- serialForcer = a</span><span>
</span><a name="line-742"></a><span class="hs-comment">--   where</span><span>
</span><a name="line-743"></a><span class="hs-comment">--     a = mkAuto_ $ \x -&gt; let outp = Output x a</span><span>
</span><a name="line-744"></a><span class="hs-comment">--                         in  forceSerial a `seq` outp</span><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span class="hs-comment">-- | Construct an 'Auto' by explicity giving its serialization,</span><span>
</span><a name="line-747"></a><span class="hs-comment">-- deserialization, and the function from @a@ to a @b@ and &quot;updated</span><span>
</span><a name="line-748"></a><span class="hs-comment">-- 'Auto'&quot;.</span><span>
</span><a name="line-749"></a><span class="hs-comment">--</span><span>
</span><a name="line-750"></a><span class="hs-comment">-- Ideally, you wouldn't have to use this unless you are making your own</span><span>
</span><a name="line-751"></a><span class="hs-comment">-- framework.  Try your best to make what you want by assembling</span><span>
</span><a name="line-752"></a><span class="hs-comment">-- primtives together.  Working with serilization directly is hard.</span><span>
</span><a name="line-753"></a><span class="hs-comment">--</span><span>
</span><a name="line-754"></a><span class="hs-comment">-- See 'mkAutoM' for more detailed instructions on doing this right.</span><span>
</span><a name="line-755"></a><span class="hs-identifier">mkAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446378"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446379"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446380"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- ^ resuming/loading 'Get'</span><span>
</span><a name="line-756"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span>                       </span><span class="hs-comment">-- ^ saving 'Put'</span><span>
</span><a name="line-757"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446379"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446380"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446378"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446379"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446380"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ step function</span><span>
</span><a name="line-758"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446378"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446379"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446380"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-759"></a><a name="mkAuto"><a href="Control.Auto.Core.html#mkAuto"><span class="hs-identifier">mkAuto</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span>
</span><a name="line-760"></a><span class="hs-pragma">{-# INLINE mkAuto #-}</span><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-comment">-- | Construct an 'Auto' by explicitly giving its serializiation,</span><span>
</span><a name="line-763"></a><span class="hs-comment">-- deserialization, and the (monadic) function from @a@ to a @b@ and the</span><span>
</span><a name="line-764"></a><span class="hs-comment">-- &quot;updated 'Auto'&quot;.</span><span>
</span><a name="line-765"></a><span class="hs-comment">--</span><span>
</span><a name="line-766"></a><span class="hs-comment">-- See the &quot;serialization&quot; section in the &quot;Control.Auto.Core&quot; module for</span><span>
</span><a name="line-767"></a><span class="hs-comment">-- more information.</span><span>
</span><a name="line-768"></a><span class="hs-comment">--</span><span>
</span><a name="line-769"></a><span class="hs-comment">-- Ideally, you wouldn't have to use this unless you are making your own</span><span>
</span><a name="line-770"></a><span class="hs-comment">-- framework.  Try your best to make what you want by assembling</span><span>
</span><a name="line-771"></a><span class="hs-comment">-- primtives together.</span><span>
</span><a name="line-772"></a><span class="hs-comment">--</span><span>
</span><a name="line-773"></a><span class="hs-comment">-- But sometimes you have to write your own combinators, and you're going</span><span>
</span><a name="line-774"></a><span class="hs-comment">-- to have to use 'mkAutoM' to make it work.</span><span>
</span><a name="line-775"></a><span class="hs-comment">--</span><span>
</span><a name="line-776"></a><span class="hs-comment">-- Sometimes, it's simple:</span><span>
</span><a name="line-777"></a><span class="hs-comment">--</span><span>
</span><a name="line-778"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-779"></a><span class="hs-comment">-- fmap :: (a -&gt; b) -&gt; Auto r a -&gt; Auto r b</span><span>
</span><a name="line-780"></a><span class="hs-comment">-- fmap f a0 = mkAutoM (do aResumed &lt;- resumeAuto a0</span><span>
</span><a name="line-781"></a><span class="hs-comment">--                         return (fmap f aResumed)  )</span><span>
</span><a name="line-782"></a><span class="hs-comment">--                     (saveAuto a0)</span><span>
</span><a name="line-783"></a><span class="hs-comment">--                     $ \x -&gt; do</span><span>
</span><a name="line-784"></a><span class="hs-comment">--                         (y, a1) &lt;- stepAuto a0 x</span><span>
</span><a name="line-785"></a><span class="hs-comment">--                         return (f y, fmap f a1)</span><span>
</span><a name="line-786"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-787"></a><span class="hs-comment">--</span><span>
</span><a name="line-788"></a><span class="hs-comment">-- Serializing @'fmap' f a0@ is just the same as serializing @a0@.  And to</span><span>
</span><a name="line-789"></a><span class="hs-comment">-- resume it, we resume @a0@ to get a resumed version of @a0@, and then we</span><span>
</span><a name="line-790"></a><span class="hs-comment">-- apply @'fmap' f@ to the 'Auto' that we resumed.</span><span>
</span><a name="line-791"></a><span class="hs-comment">--</span><span>
</span><a name="line-792"></a><span class="hs-comment">-- Also another nice &quot;simple&quot; example is:</span><span>
</span><a name="line-793"></a><span class="hs-comment">--</span><span>
</span><a name="line-794"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-795"></a><span class="hs-comment">-- catchA :: Exception e</span><span>
</span><a name="line-796"></a><span class="hs-comment">--        =&gt; Auto IO a b</span><span>
</span><a name="line-797"></a><span class="hs-comment">--        -&gt; Auto IO a (Either e b)</span><span>
</span><a name="line-798"></a><span class="hs-comment">-- catchA a = mkAutoM (do aResumed &lt;- resumeAuto a</span><span>
</span><a name="line-799"></a><span class="hs-comment">--                        return (catchA aResumed) )</span><span>
</span><a name="line-800"></a><span class="hs-comment">--                    (saveAuto a)</span><span>
</span><a name="line-801"></a><span class="hs-comment">--                  $ \x -&gt; do</span><span>
</span><a name="line-802"></a><span class="hs-comment">--                      eya' &lt;- try $ stepAuto a x</span><span>
</span><a name="line-803"></a><span class="hs-comment">--                      case eya' of</span><span>
</span><a name="line-804"></a><span class="hs-comment">--                        Right (y, a') -&gt; return (Right y, catchA a')</span><span>
</span><a name="line-805"></a><span class="hs-comment">--                        Left e        -&gt; return (Left e , catchA a )</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-807"></a><span class="hs-comment">--</span><span>
</span><a name="line-808"></a><span class="hs-comment">-- Which is basically the same principle, in terms of serializing and</span><span>
</span><a name="line-809"></a><span class="hs-comment">-- resuming strategies.</span><span>
</span><a name="line-810"></a><span class="hs-comment">--</span><span>
</span><a name="line-811"></a><span class="hs-comment">-- When you have &quot;switching&quot; --- things that behave like different 'Auto's</span><span>
</span><a name="line-812"></a><span class="hs-comment">-- at different points in time --- then things get a little complicated,</span><span>
</span><a name="line-813"></a><span class="hs-comment">-- because you have to figure out which 'Auto' to resume.</span><span>
</span><a name="line-814"></a><span class="hs-comment">--</span><span>
</span><a name="line-815"></a><span class="hs-comment">-- For example, let's look at the source of '-?&gt;':</span><span>
</span><a name="line-816"></a><span class="hs-comment">--</span><span>
</span><a name="line-817"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-818"></a><span class="hs-comment">-- (-?&gt;) :: Monad m</span><span>
</span><a name="line-819"></a><span class="hs-comment">--       =&gt; Interval m a b   -- ^ initial behavior</span><span>
</span><a name="line-820"></a><span class="hs-comment">--       -&gt; Interval m a b   -- ^ final behavior, when the initial</span><span>
</span><a name="line-821"></a><span class="hs-comment">--                           --   behavior turns off.</span><span>
</span><a name="line-822"></a><span class="hs-comment">--       -&gt; Interval m a b</span><span>
</span><a name="line-823"></a><span class="hs-comment">-- a1 -?&gt; a2 = mkAutoM l s t</span><span>
</span><a name="line-824"></a><span class="hs-comment">--   where</span><span>
</span><a name="line-825"></a><span class="hs-comment">--     l = do</span><span>
</span><a name="line-826"></a><span class="hs-comment">--       flag &lt;- get</span><span>
</span><a name="line-827"></a><span class="hs-comment">--       if flag</span><span>
</span><a name="line-828"></a><span class="hs-comment">--         then resumeAuto (switched a2)</span><span>
</span><a name="line-829"></a><span class="hs-comment">--         else (-?&gt; a2) &lt;$&gt; resumeAuto a1</span><span>
</span><a name="line-830"></a><span class="hs-comment">--     s = put False *&gt; saveAuto a1</span><span>
</span><a name="line-831"></a><span class="hs-comment">--     t x = do</span><span>
</span><a name="line-832"></a><span class="hs-comment">--       (y1, a1') &lt;- stepAuto a1 x</span><span>
</span><a name="line-833"></a><span class="hs-comment">--       case y1 of</span><span>
</span><a name="line-834"></a><span class="hs-comment">--         Just _  -&gt;</span><span>
</span><a name="line-835"></a><span class="hs-comment">--           return (y1, a1' -?&gt; a2)</span><span>
</span><a name="line-836"></a><span class="hs-comment">--         Nothing -&gt; do</span><span>
</span><a name="line-837"></a><span class="hs-comment">--           (y, a2') &lt;- stepAuto a2 x</span><span>
</span><a name="line-838"></a><span class="hs-comment">--           return (y, switched a2')</span><span>
</span><a name="line-839"></a><span class="hs-comment">--     switched a = mkAutoM l</span><span>
</span><a name="line-840"></a><span class="hs-comment">--                          (put True  *&gt; saveAuto a)</span><span>
</span><a name="line-841"></a><span class="hs-comment">--                        $ \x -&gt; do</span><span>
</span><a name="line-842"></a><span class="hs-comment">--                            (y, a') &lt;- stepAuto a x</span><span>
</span><a name="line-843"></a><span class="hs-comment">--                            return (y, switched a')</span><span>
</span><a name="line-844"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-845"></a><span class="hs-comment">--</span><span>
</span><a name="line-846"></a><span class="hs-comment">-- We have to invent a serialization and reloading scheme, taking into</span><span>
</span><a name="line-847"></a><span class="hs-comment">-- account the two states that the resulting 'Auto' can be in:</span><span>
</span><a name="line-848"></a><span class="hs-comment">--</span><span>
</span><a name="line-849"></a><span class="hs-comment">-- 1.   Initially, it is behaving like @a1@.  So, to save it, we put</span><span>
</span><a name="line-850"></a><span class="hs-comment">--      a flag saying that we are still in stage 1 ('False'), and then</span><span>
</span><a name="line-851"></a><span class="hs-comment">--      put @a1@'s current serialization data.</span><span>
</span><a name="line-852"></a><span class="hs-comment">-- 2.   After the switch, it is behaving like @a2@.  So, to save it, we put</span><span>
</span><a name="line-853"></a><span class="hs-comment">--      a flag saying that we are now in stage 2 ('True'), and then put</span><span>
</span><a name="line-854"></a><span class="hs-comment">--      @a2@'s current.</span><span>
</span><a name="line-855"></a><span class="hs-comment">--</span><span>
</span><a name="line-856"></a><span class="hs-comment">-- Now, when we /resume/ @a1 '-?&gt;' a2@, 'resumeAuto' on @a1 '-?&gt;' a2@ will</span><span>
</span><a name="line-857"></a><span class="hs-comment">-- give us @l@.  So the 'Get' we use --- the process we use to resume the</span><span>
</span><a name="line-858"></a><span class="hs-comment">-- entire @a1 '-?&gt;' a2@, will /start/ at the initial 'Get'/loading</span><span>
</span><a name="line-859"></a><span class="hs-comment">-- function, @l@ here.  We have to encode our branching and</span><span>
</span><a name="line-860"></a><span class="hs-comment">-- resuming/serialization scheme into the initial, front-facing @l@.  So</span><span>
</span><a name="line-861"></a><span class="hs-comment">-- @l@ has to check for the flag, and if the flag is true, load in the data</span><span>
</span><a name="line-862"></a><span class="hs-comment">-- for the switched state; otherwise, load in the data for the pre-switched</span><span>
</span><a name="line-863"></a><span class="hs-comment">-- state.</span><span>
</span><a name="line-864"></a><span class="hs-comment">--</span><span>
</span><a name="line-865"></a><span class="hs-comment">-- Not all of them are this tricky.  Mostly &quot;switching&quot; combinators will be</span><span>
</span><a name="line-866"></a><span class="hs-comment">-- tricky, because switching means changing what you are serializing.</span><span>
</span><a name="line-867"></a><span class="hs-comment">--</span><span>
</span><a name="line-868"></a><span class="hs-comment">-- This one might be considerably easier, because of 'mapM':</span><span>
</span><a name="line-869"></a><span class="hs-comment">--</span><span>
</span><a name="line-870"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-871"></a><span class="hs-comment">-- zipAuto :: Monad m</span><span>
</span><a name="line-872"></a><span class="hs-comment">--         =&gt; a                -- ^ default input value</span><span>
</span><a name="line-873"></a><span class="hs-comment">--         -&gt; [Auto m a b]     -- ^ 'Auto's to zip up</span><span>
</span><a name="line-874"></a><span class="hs-comment">--         -&gt; Auto m [a] [b]</span><span>
</span><a name="line-875"></a><span class="hs-comment">-- zipAuto x0 as = mkAutoM (zipAuto x0 &lt;$&gt; mapM resumeAuto as)</span><span>
</span><a name="line-876"></a><span class="hs-comment">--                         (mapM_ saveAuto as)</span><span>
</span><a name="line-877"></a><span class="hs-comment">--                         $ \xs -&gt; do</span><span>
</span><a name="line-878"></a><span class="hs-comment">--                             res &lt;- zipWithM stepAuto as (xs ++ repeat x0)</span><span>
</span><a name="line-879"></a><span class="hs-comment">--                             let (ys, as') = unzip res</span><span>
</span><a name="line-880"></a><span class="hs-comment">--                             return (ys, zipAuto x0 as')</span><span>
</span><a name="line-881"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-882"></a><span class="hs-comment">--</span><span>
</span><a name="line-883"></a><span class="hs-comment">-- To serialize, we basically sequence 'saveAuto' over all of the internal</span><span>
</span><a name="line-884"></a><span class="hs-comment">-- 'Auto's --- serialize each of their serialization data one-by-one one</span><span>
</span><a name="line-885"></a><span class="hs-comment">-- after the other in our binary.</span><span>
</span><a name="line-886"></a><span class="hs-comment">--</span><span>
</span><a name="line-887"></a><span class="hs-comment">-- To load, we do the same thing; we go over every 'Auto' in @as@ and</span><span>
</span><a name="line-888"></a><span class="hs-comment">-- 'resumeAuto' it, and then collect the results in a list --- a list of</span><span>
</span><a name="line-889"></a><span class="hs-comment">-- resumed 'Auto's.  And then we apply @'zipAuto' x0@ to that list of</span><span>
</span><a name="line-890"></a><span class="hs-comment">-- 'Auto's, to get our resumed @'zipAuto' x0 as@.</span><span>
</span><a name="line-891"></a><span class="hs-comment">--</span><span>
</span><a name="line-892"></a><span class="hs-comment">-- So, it might be complicated.  In the end, it might be all worth it, too,</span><span>
</span><a name="line-893"></a><span class="hs-comment">-- to have implicit serialization compose like this.  Think about your</span><span>
</span><a name="line-894"></a><span class="hs-comment">-- serialization strategy first.  Step back and think about what you need</span><span>
</span><a name="line-895"></a><span class="hs-comment">-- to serialize at every step, and remember that it's _the initial_</span><span>
</span><a name="line-896"></a><span class="hs-comment">-- &quot;resuming&quot; function that has to &quot;resume everything&quot;...it's not the</span><span>
</span><a name="line-897"></a><span class="hs-comment">-- resuming function that exists when you finally save your 'Auto', it's</span><span>
</span><a name="line-898"></a><span class="hs-comment">-- the resuming 'Get' that was there /at the beginning/.  For '-?&gt;', the</span><span>
</span><a name="line-899"></a><span class="hs-comment">-- intial @l@ had to know how to &quot;skip ahead&quot;.</span><span>
</span><a name="line-900"></a><span class="hs-comment">--</span><span>
</span><a name="line-901"></a><span class="hs-comment">-- And of course as always, test.</span><span>
</span><a name="line-902"></a><span class="hs-comment">--</span><span>
</span><a name="line-903"></a><span class="hs-comment">-- If you need to make your own combinator or transformer but are having</span><span>
</span><a name="line-904"></a><span class="hs-comment">-- trouble with the serializtion, feel free to contact me at</span><span>
</span><a name="line-905"></a><span class="hs-comment">-- &lt;justin@jle.im&gt;, on freenode at /#haskell/ or /#haskell-auto/, open</span><span>
</span><a name="line-906"></a><span class="hs-comment">-- a &lt;https://github.com/mstksg/auto/issues github issue&gt;, etc.  Just</span><span>
</span><a name="line-907"></a><span class="hs-comment">-- contact me somehow, I'll be happy to help!</span><span>
</span><a name="line-908"></a><span class="hs-comment">--</span><span>
</span><a name="line-909"></a><span class="hs-identifier">mkAutoM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446375"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446376"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446377"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>             </span><span class="hs-comment">-- ^ resuming/loading 'Get'</span><span>
</span><a name="line-910"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span>                          </span><span class="hs-comment">-- ^ saving 'Put'</span><span>
</span><a name="line-911"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446376"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446375"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446377"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446375"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446376"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446377"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ (monadic) step function</span><span>
</span><a name="line-912"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446375"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446376"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446377"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-913"></a><a name="mkAutoM"><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier">mkAutoM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span>
</span><a name="line-914"></a><span class="hs-pragma">{-# INLINE mkAutoM #-}</span><span>
</span><a name="line-915"></a><span>
</span><a name="line-916"></a><span class="hs-comment">-- | Like 'mkAuto', but without any way of meaningful serializing or</span><span>
</span><a name="line-917"></a><span class="hs-comment">-- deserializing.</span><span>
</span><a name="line-918"></a><span class="hs-comment">--</span><span>
</span><a name="line-919"></a><span class="hs-comment">-- Be careful!  This 'Auto' can still carry arbitrary internal state, but</span><span>
</span><a name="line-920"></a><span class="hs-comment">-- it cannot be meaningfully serialized or re-loaded/resumed.  You can</span><span>
</span><a name="line-921"></a><span class="hs-comment">-- still pretend to do so using</span><span>
</span><a name="line-922"></a><span class="hs-comment">-- 'resumeAuto'/'saveAuto'/'encodeAuto'/'decodeAuto' (and the type system</span><span>
</span><a name="line-923"></a><span class="hs-comment">-- won't stop you), but when you try to &quot;resume&quot;/decode it, its state will</span><span>
</span><a name="line-924"></a><span class="hs-comment">-- be lost.</span><span>
</span><a name="line-925"></a><span class="hs-identifier">mkAuto_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446372"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446373"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446374"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446372"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446373"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ step function</span><span>
</span><a name="line-926"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446374"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446372"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446373"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-927"></a><a name="mkAuto_"><a href="Control.Auto.Core.html#mkAuto_"><span class="hs-identifier">mkAuto_</span></a></a><span> </span><a name="local-1627446618"><a href="#local-1627446618"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAuto"><span class="hs-identifier hs-var">mkAuto</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mkAuto_"><span class="hs-identifier hs-var">mkAuto_</span></a><span> </span><a href="#local-1627446618"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446618"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-928"></a><span class="hs-pragma">{-# INLINE mkAuto_ #-}</span><span>
</span><a name="line-929"></a><span>
</span><a name="line-930"></a><span class="hs-comment">-- | Like 'mkAutoM', but without any way of meaningful serializing or</span><span>
</span><a name="line-931"></a><span class="hs-comment">-- deserializing.</span><span>
</span><a name="line-932"></a><span class="hs-comment">--</span><span>
</span><a name="line-933"></a><span class="hs-comment">-- Be careful!  This 'Auto' can still carry arbitrary internal state, but</span><span>
</span><a name="line-934"></a><span class="hs-comment">-- it cannot be meaningfully serialized or re-loaded/resumed.  You can</span><span>
</span><a name="line-935"></a><span class="hs-comment">-- still pretend to do so using</span><span>
</span><a name="line-936"></a><span class="hs-comment">-- 'resumeAuto'/'saveAuto'/'encodeAuto'/'decodeAuto' (and the type system</span><span>
</span><a name="line-937"></a><span class="hs-comment">-- won't stop you), but when you try to &quot;resume&quot;/decode it, its state will</span><span>
</span><a name="line-938"></a><span class="hs-comment">-- be reset.</span><span>
</span><a name="line-939"></a><span class="hs-identifier">mkAutoM_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446369"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446370"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446371"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446370"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446369"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446371"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ (monadic) step function</span><span>
</span><a name="line-940"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446370"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446369"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446371"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-941"></a><a name="mkAutoM_"><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier">mkAutoM_</span></a></a><span> </span><a name="local-1627446619"><a href="#local-1627446619"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><a href="#local-1627446619"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446619"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-942"></a><span class="hs-pragma">{-# INLINE mkAutoM_ #-}</span><span>
</span><a name="line-943"></a><span>
</span><a name="line-944"></a><span class="hs-comment">-- | Construct the 'Auto' whose output is always the given value, ignoring</span><span>
</span><a name="line-945"></a><span class="hs-comment">-- its input.</span><span>
</span><a name="line-946"></a><span class="hs-comment">--</span><span>
</span><a name="line-947"></a><span class="hs-comment">-- Provided for API constency, but you should really be using 'pure' from</span><span>
</span><a name="line-948"></a><span class="hs-comment">-- the 'Applicative' instance, from &quot;Control.Applicative&quot;, which does the</span><span>
</span><a name="line-949"></a><span class="hs-comment">-- same thing.</span><span>
</span><a name="line-950"></a><span class="hs-identifier">mkConst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627446366"><span class="hs-identifier hs-type">b</span></a><span>            </span><span class="hs-comment">-- ^ constant value to be outputted</span><span>
</span><a name="line-951"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446367"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446368"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446366"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-952"></a><a name="mkConst"><a href="Control.Auto.Core.html#mkConst"><span class="hs-identifier">mkConst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span>
</span><a name="line-953"></a><span class="hs-pragma">{-# INLINE mkConst #-}</span><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-comment">-- | Construct the 'Auto' that always &quot;executes&quot; the given monadic value at</span><span>
</span><a name="line-956"></a><span class="hs-comment">-- every step, yielding the result as its output and ignoring its input.</span><span>
</span><a name="line-957"></a><span class="hs-comment">--</span><span>
</span><a name="line-958"></a><span class="hs-comment">-- Provided for API consistency, but you shold really be using 'effect'</span><span>
</span><a name="line-959"></a><span class="hs-comment">-- from &quot;Control.Auto.Effects&quot;, which does the same thing.</span><span>
</span><a name="line-960"></a><span class="hs-identifier">mkConstM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627446363"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446364"><span class="hs-identifier hs-type">b</span></a><span>           </span><span class="hs-comment">-- ^ monadic action to be executed at every step</span><span>
</span><a name="line-961"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446363"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446365"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446364"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-962"></a><a name="mkConstM"><a href="Control.Auto.Core.html#mkConstM"><span class="hs-identifier">mkConstM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span>
</span><a name="line-963"></a><span class="hs-pragma">{-# INLINE mkConstM #-}</span><span>
</span><a name="line-964"></a><span>
</span><a name="line-965"></a><span class="hs-comment">-- | Construct a stateless 'Auto' that simply applies the given (pure)</span><span>
</span><a name="line-966"></a><span class="hs-comment">-- function to every input, yielding the output.  The output stream is just</span><span>
</span><a name="line-967"></a><span class="hs-comment">-- the result of applying the function to every input.</span><span>
</span><a name="line-968"></a><span class="hs-comment">--</span><span>
</span><a name="line-969"></a><span class="hs-comment">-- prop&gt; streamAuto' (mkFunc f) = map f</span><span>
</span><a name="line-970"></a><span class="hs-comment">--</span><span>
</span><a name="line-971"></a><span class="hs-comment">-- This is rarely needed; you should be using 'arr' from the 'Arrow'</span><span>
</span><a name="line-972"></a><span class="hs-comment">-- instance, from &quot;Control.Arrow&quot;.</span><span>
</span><a name="line-973"></a><span class="hs-identifier">mkFunc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446360"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446361"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ pure function</span><span>
</span><a name="line-974"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446362"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446360"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446361"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-975"></a><a name="mkFunc"><a href="Control.Auto.Core.html#mkFunc"><span class="hs-identifier">mkFunc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span>
</span><a name="line-976"></a><span class="hs-pragma">{-# INLINE mkFunc #-}</span><span>
</span><a name="line-977"></a><span>
</span><a name="line-978"></a><span class="hs-comment">-- | Construct a stateless 'Auto' that simply applies and executes the givne</span><span>
</span><a name="line-979"></a><span class="hs-comment">-- (monadic) function to every input, yielding the output.  The output</span><span>
</span><a name="line-980"></a><span class="hs-comment">-- stream is the result of applying the function to every input,</span><span>
</span><a name="line-981"></a><span class="hs-comment">-- executing/sequencing the action, and returning the returned value.</span><span>
</span><a name="line-982"></a><span class="hs-comment">--</span><span>
</span><a name="line-983"></a><span class="hs-comment">-- prop&gt; streamAuto (mkFuncM f) = mapM f</span><span>
</span><a name="line-984"></a><span class="hs-comment">--</span><span>
</span><a name="line-985"></a><span class="hs-comment">-- It's recommended that you use 'arrM' from &quot;Control.Auto.Effects&quot;.  This</span><span>
</span><a name="line-986"></a><span class="hs-comment">-- is only really provided for consistency.</span><span>
</span><a name="line-987"></a><span class="hs-identifier">mkFuncM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446357"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446358"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446359"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ &quot;monadic&quot; function</span><span>
</span><a name="line-988"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446358"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446357"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446359"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-989"></a><a name="mkFuncM"><a href="Control.Auto.Core.html#mkFuncM"><span class="hs-identifier">mkFuncM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span>
</span><a name="line-990"></a><span class="hs-pragma">{-# INLINE mkFuncM #-}</span><span>
</span><a name="line-991"></a><span>
</span><a name="line-992"></a><span class="hs-comment">-- | Construct an 'Auto' from a state transformer: an @a -&gt; s -&gt; (b, s)@</span><span>
</span><a name="line-993"></a><span class="hs-comment">-- gives you an @'Auto' m a b@, for any 'Monad' @m@.  At every step, it</span><span>
</span><a name="line-994"></a><span class="hs-comment">-- takes in the @a@ input, runs the function with the stored internal</span><span>
</span><a name="line-995"></a><span class="hs-comment">-- state, returns the @b@ result, and now contains the new resulting state.</span><span>
</span><a name="line-996"></a><span class="hs-comment">-- You have to intialize it with an initial state, of course.</span><span>
</span><a name="line-997"></a><span class="hs-comment">--</span><span>
</span><a name="line-998"></a><span class="hs-comment">-- From the &quot;stream transformer&quot; point of view, this is rougly equivalent</span><span>
</span><a name="line-999"></a><span class="hs-comment">-- to 'mapAccumL' from &quot;Data.List&quot;, with the function's arguments and</span><span>
</span><a name="line-1000"></a><span class="hs-comment">-- results in the backwards order.</span><span>
</span><a name="line-1001"></a><span class="hs-comment">--</span><span>
</span><a name="line-1002"></a><span class="hs-comment">-- prop&gt; streamAuto' (mkState f s0) = snd . mapAccumL (\s x -&gt; swap (f x s))</span><span>
</span><a name="line-1003"></a><span class="hs-comment">--</span><span>
</span><a name="line-1004"></a><span class="hs-comment">-- Try not to use this if it's ever avoidable, unless you're a framework</span><span>
</span><a name="line-1005"></a><span class="hs-comment">-- developer or something.  Try make something by combining/composing the</span><span>
</span><a name="line-1006"></a><span class="hs-comment">-- various 'Auto' combinators.</span><span>
</span><a name="line-1007"></a><span class="hs-comment">--</span><span>
</span><a name="line-1008"></a><span class="hs-comment">-- If your state @s@ does not have a 'Serialize' instance, then you should</span><span>
</span><a name="line-1009"></a><span class="hs-comment">-- either write a meaningful one, provide the serialization methods</span><span>
</span><a name="line-1010"></a><span class="hs-comment">-- manually with 'mkState'', or throw away serializability and use</span><span>
</span><a name="line-1011"></a><span class="hs-comment">-- 'mkState_'.</span><span>
</span><a name="line-1012"></a><span class="hs-identifier">mkState</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627446353"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-1013"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446354"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446353"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446355"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446353"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ state transformer</span><span>
</span><a name="line-1014"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446353"><span class="hs-identifier hs-type">s</span></a><span>                        </span><span class="hs-comment">-- ^ intial state</span><span>
</span><a name="line-1015"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446356"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446354"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446355"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1016"></a><a name="mkState"><a href="Control.Auto.Core.html#mkState"><span class="hs-identifier">mkState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">get</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">put</span><span class="hs-special">)</span><span>
</span><a name="line-1017"></a><span class="hs-pragma">{-# INLINE mkState #-}</span><span>
</span><a name="line-1018"></a><span>
</span><a name="line-1019"></a><span class="hs-comment">-- | Construct an 'Auto' from a &quot;monadic&quot; state transformer: @a -&gt; s -&gt;</span><span>
</span><a name="line-1020"></a><span class="hs-comment">-- m (b, s)@ gives you an @'Auto' m a b@.  At every step, it takes in the</span><span>
</span><a name="line-1021"></a><span class="hs-comment">-- @a@ input, runs the function with the stored internal state and</span><span>
</span><a name="line-1022"></a><span class="hs-comment">-- &quot;executes&quot; the @m (b, s)@ to get the @b@ output, and stores the @s@ as</span><span>
</span><a name="line-1023"></a><span class="hs-comment">-- the new, updated state.  Must be initialized with an initial state.</span><span>
</span><a name="line-1024"></a><span class="hs-comment">--</span><span>
</span><a name="line-1025"></a><span class="hs-comment">-- Try not to use this if it's ever avoidable, unless you're a framework</span><span>
</span><a name="line-1026"></a><span class="hs-comment">-- developer or something.  Try make something by combining/composing the</span><span>
</span><a name="line-1027"></a><span class="hs-comment">-- various 'Auto' combinators.</span><span>
</span><a name="line-1028"></a><span class="hs-comment">--</span><span>
</span><a name="line-1029"></a><span class="hs-comment">-- This version is a wrapper around 'mkAuto', that keeps track of the</span><span>
</span><a name="line-1030"></a><span class="hs-comment">-- serialization and re-loading of the internal state for you, so you don't</span><span>
</span><a name="line-1031"></a><span class="hs-comment">-- have to deal with it explicitly.</span><span>
</span><a name="line-1032"></a><span class="hs-comment">--</span><span>
</span><a name="line-1033"></a><span class="hs-comment">-- If your state @s@ does not have a 'Serialize' instance, then you should</span><span>
</span><a name="line-1034"></a><span class="hs-comment">-- either write a meaningful one, provide the serialization methods</span><span>
</span><a name="line-1035"></a><span class="hs-comment">-- manually with 'mkStateM'', or throw away serializability and use</span><span>
</span><a name="line-1036"></a><span class="hs-comment">-- 'mkStateM_'.</span><span>
</span><a name="line-1037"></a><span class="hs-identifier">mkStateM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627446349"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-1038"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446350"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446349"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446351"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446352"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446349"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ (monadic) state transformer</span><span>
</span><a name="line-1039"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446349"><span class="hs-identifier hs-type">s</span></a><span>                         </span><span class="hs-comment">-- ^ initial state</span><span>
</span><a name="line-1040"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446351"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446350"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446352"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1041"></a><a name="mkStateM"><a href="Control.Auto.Core.html#mkStateM"><span class="hs-identifier">mkStateM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">get</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">put</span><span class="hs-special">)</span><span>
</span><a name="line-1042"></a><span class="hs-pragma">{-# INLINE mkStateM #-}</span><span>
</span><a name="line-1043"></a><span>
</span><a name="line-1044"></a><span class="hs-comment">-- | A version of 'mkState', where the internal state doesn't have</span><span>
</span><a name="line-1045"></a><span class="hs-comment">-- a 'Serialize' instance, so you provide your own instructions for getting</span><span>
</span><a name="line-1046"></a><span class="hs-comment">-- and putting the state.</span><span>
</span><a name="line-1047"></a><span class="hs-comment">--</span><span>
</span><a name="line-1048"></a><span class="hs-comment">-- See 'mkState' for more details.</span><span>
</span><a name="line-1049"></a><span class="hs-identifier">mkState'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><a href="#local-1627446345"><span class="hs-identifier hs-type">s</span></a><span>                     </span><span class="hs-comment">-- ^ 'Get'; strategy for reading and deserializing the state</span><span>
</span><a name="line-1050"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446345"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span class="hs-special">)</span><span>                </span><span class="hs-comment">-- ^ 'Put'; strategy for serializing given state</span><span>
</span><a name="line-1051"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446346"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446345"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446347"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446345"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ state transformer</span><span>
</span><a name="line-1052"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446345"><span class="hs-identifier hs-type">s</span></a><span>                         </span><span class="hs-comment">-- ^ intial state</span><span>
</span><a name="line-1053"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446348"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446346"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446347"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1054"></a><a name="mkState%27"><a href="Control.Auto.Core.html#mkState%27"><span class="hs-identifier">mkState'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">curry</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span>
</span><a name="line-1055"></a><span class="hs-pragma">{-# INLINE mkState' #-}</span><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span class="hs-comment">-- | A version of 'mkStateM', where the internal state doesn't have</span><span>
</span><a name="line-1058"></a><span class="hs-comment">-- a 'Serialize' instance, so you provide your own instructions for getting</span><span>
</span><a name="line-1059"></a><span class="hs-comment">-- and putting the state.</span><span>
</span><a name="line-1060"></a><span class="hs-comment">--</span><span>
</span><a name="line-1061"></a><span class="hs-comment">-- See 'mkStateM' for more details.</span><span>
</span><a name="line-1062"></a><span class="hs-identifier">mkStateM'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><a href="#local-1627446341"><span class="hs-identifier hs-type">s</span></a><span>                      </span><span class="hs-comment">-- ^ 'Get'; strategy for reading and deserializing the state</span><span>
</span><a name="line-1063"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446341"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- ^ 'Put'; strategy for serializing given state</span><span>
</span><a name="line-1064"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446342"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446341"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446343"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446344"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446341"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ (monadic) state transformer</span><span>
</span><a name="line-1065"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446341"><span class="hs-identifier hs-type">s</span></a><span>                          </span><span class="hs-comment">-- ^ initial state</span><span>
</span><a name="line-1066"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446343"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446342"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446344"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1067"></a><a name="mkStateM%27"><a href="Control.Auto.Core.html#mkStateM%27"><span class="hs-identifier">mkStateM'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">curry</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span>
</span><a name="line-1068"></a><span class="hs-pragma">{-# INLINE mkStateM' #-}</span><span>
</span><a name="line-1069"></a><span>
</span><a name="line-1070"></a><span class="hs-comment">-- | A version of 'mkState', where the internal state isn't serialized.  It</span><span>
</span><a name="line-1071"></a><span class="hs-comment">-- can be &quot;saved&quot; and &quot;loaded&quot;, but the state is lost in the process.</span><span>
</span><a name="line-1072"></a><span class="hs-comment">--</span><span>
</span><a name="line-1073"></a><span class="hs-comment">-- See 'mkState' for more details.</span><span>
</span><a name="line-1074"></a><span class="hs-comment">--</span><span>
</span><a name="line-1075"></a><span class="hs-comment">-- Useful if your state @s@ cannot have a meaningful 'Serialize' instance.</span><span>
</span><a name="line-1076"></a><span class="hs-identifier">mkState_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446337"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446338"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446339"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446338"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ state transformer</span><span>
</span><a name="line-1077"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446338"><span class="hs-identifier hs-type">s</span></a><span>                     </span><span class="hs-comment">-- ^ initial state</span><span>
</span><a name="line-1078"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446340"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446337"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446339"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1079"></a><a name="mkState_"><a href="Control.Auto.Core.html#mkState_"><span class="hs-identifier">mkState_</span></a></a><span> </span><a name="local-1627446620"><a href="#local-1627446620"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446621"><a href="#local-1627446621"><span class="hs-identifier">s0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627446621"><span class="hs-identifier hs-var">s0</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446620"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446621"><span class="hs-identifier hs-var">s0</span></a><span>
</span><a name="line-1080"></a><span class="hs-pragma">{-# INLINE mkState_ #-}</span><span>
</span><a name="line-1081"></a><span>
</span><a name="line-1082"></a><span class="hs-comment">-- | A version of 'mkStateM', where the internal state isn't serialized.</span><span>
</span><a name="line-1083"></a><span class="hs-comment">-- It can be &quot;saved&quot; and &quot;loaded&quot;, but the state is lost in the process.</span><span>
</span><a name="line-1084"></a><span class="hs-comment">--</span><span>
</span><a name="line-1085"></a><span class="hs-comment">-- See 'mkStateM' for more details.</span><span>
</span><a name="line-1086"></a><span class="hs-comment">--</span><span>
</span><a name="line-1087"></a><span class="hs-comment">-- Useful if your state @s@ cannot have a meaningful 'Serialize' instance.</span><span>
</span><a name="line-1088"></a><span class="hs-identifier">mkStateM_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446333"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446334"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446335"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446336"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446334"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ (monadic) state transformer</span><span>
</span><a name="line-1089"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446334"><span class="hs-identifier hs-type">s</span></a><span>                      </span><span class="hs-comment">-- ^ initial state</span><span>
</span><a name="line-1090"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446335"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446333"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446336"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1091"></a><a name="mkStateM_"><a href="Control.Auto.Core.html#mkStateM_"><span class="hs-identifier">mkStateM_</span></a></a><span> </span><a name="local-1627446622"><a href="#local-1627446622"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446623"><a href="#local-1627446623"><span class="hs-identifier">s0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1627446623"><span class="hs-identifier hs-var">s0</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446622"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446623"><span class="hs-identifier hs-var">s0</span></a><span>
</span><a name="line-1092"></a><span class="hs-pragma">{-# INLINE mkStateM_ #-}</span><span>
</span><a name="line-1093"></a><span>
</span><a name="line-1094"></a><span class="hs-comment">-- | Construct an 'Auto' from a &quot;folding&quot; function: @b -&gt; a -&gt; b@ yields an</span><span>
</span><a name="line-1095"></a><span class="hs-comment">-- @'Auto' m a b@.  Basically acts like a 'foldl' or a 'scanl'.  There is</span><span>
</span><a name="line-1096"></a><span class="hs-comment">-- an internal accumulator that is &quot;updated&quot; with an @a@ at every step.</span><span>
</span><a name="line-1097"></a><span class="hs-comment">-- Must be given an initial accumulator.</span><span>
</span><a name="line-1098"></a><span class="hs-comment">--</span><span>
</span><a name="line-1099"></a><span class="hs-comment">-- Example: an 'Auto' that sums up all of its input.</span><span>
</span><a name="line-1100"></a><span class="hs-comment">--</span><span>
</span><a name="line-1101"></a><span class="hs-comment">-- &gt;&gt;&gt; let summer = accum (+) 0</span><span>
</span><a name="line-1102"></a><span class="hs-comment">-- &gt;&gt;&gt; let (sum1, summer')  = stepAuto' summer 3</span><span>
</span><a name="line-1103"></a><span class="hs-comment">-- &gt;&gt;&gt; sum1</span><span>
</span><a name="line-1104"></a><span class="hs-comment">-- 3</span><span>
</span><a name="line-1105"></a><span class="hs-comment">-- &gt;&gt;&gt; let (sum2, summer'') = stepAuto' summer' 10</span><span>
</span><a name="line-1106"></a><span class="hs-comment">-- &gt;&gt;&gt; sum2</span><span>
</span><a name="line-1107"></a><span class="hs-comment">-- 13</span><span>
</span><a name="line-1108"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto'  summer'' [1..10]</span><span>
</span><a name="line-1109"></a><span class="hs-comment">-- [14,16,19,23,28,34,41,49,58,68]</span><span>
</span><a name="line-1110"></a><span class="hs-comment">--</span><span>
</span><a name="line-1111"></a><span class="hs-comment">-- If your accumulator @b@ does not have a 'Serialize' instance, then you</span><span>
</span><a name="line-1112"></a><span class="hs-comment">-- should either write a meaningful one, or throw away serializability and</span><span>
</span><a name="line-1113"></a><span class="hs-comment">-- use 'accum_'.</span><span>
</span><a name="line-1114"></a><span class="hs-identifier">accum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627446330"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1115"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446330"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446331"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446330"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ accumulating function</span><span>
</span><a name="line-1116"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446330"><span class="hs-identifier hs-type">b</span></a><span>                  </span><span class="hs-comment">-- ^ initial accumulator</span><span>
</span><a name="line-1117"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446332"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446331"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446330"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1118"></a><a name="accum"><a href="Control.Auto.Core.html#accum"><span class="hs-identifier">accum</span></a></a><span> </span><a name="local-1627446624"><a href="#local-1627446624"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkState"><span class="hs-identifier hs-var">mkState</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446625"><a href="#local-1627446625"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446626"><a href="#local-1627446626"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627446627"><a href="#local-1627446627"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446624"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446626"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446625"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-1627446627"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446627"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1119"></a><span class="hs-pragma">{-# INLINE accum #-}</span><span>
</span><a name="line-1120"></a><span>
</span><a name="line-1121"></a><span class="hs-comment">-- | Construct an 'Auto' from a &quot;monadic&quot; &quot;folding&quot; function: @b -&gt; a -&gt;</span><span>
</span><a name="line-1122"></a><span class="hs-comment">-- m b@ yields an @'Auto' m a b@.  Basically acts like a 'foldM' or 'scanM'</span><span>
</span><a name="line-1123"></a><span class="hs-comment">-- (if it existed).  here is an internal accumulator that is &quot;updated&quot; with</span><span>
</span><a name="line-1124"></a><span class="hs-comment">-- an input @a@ with the result of the executed @m b@ at every step.  Must</span><span>
</span><a name="line-1125"></a><span class="hs-comment">-- be given an initial accumulator.</span><span>
</span><a name="line-1126"></a><span class="hs-comment">--</span><span>
</span><a name="line-1127"></a><span class="hs-comment">-- See 'accum' for more details.</span><span>
</span><a name="line-1128"></a><span class="hs-comment">--</span><span>
</span><a name="line-1129"></a><span class="hs-comment">-- If your accumulator @b@ does not have a 'Serialize' instance, then you</span><span>
</span><a name="line-1130"></a><span class="hs-comment">-- should either write a meaningful one, or throw away serializability and</span><span>
</span><a name="line-1131"></a><span class="hs-comment">-- use 'accumM_'.</span><span>
</span><a name="line-1132"></a><span class="hs-identifier">accumM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627446327"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446328"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-1133"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446327"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446329"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446328"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446327"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ (monadic) accumulating function</span><span>
</span><a name="line-1134"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446327"><span class="hs-identifier hs-type">b</span></a><span>                     </span><span class="hs-comment">-- ^ initial accumulator</span><span>
</span><a name="line-1135"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446328"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446329"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446327"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1136"></a><a name="accumM"><a href="Control.Auto.Core.html#accumM"><span class="hs-identifier">accumM</span></a></a><span> </span><a name="local-1627446628"><a href="#local-1627446628"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkStateM"><span class="hs-identifier hs-var">mkStateM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446629"><a href="#local-1627446629"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446630"><a href="#local-1627446630"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446628"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446630"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446629"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1137"></a><span class="hs-pragma">{-# INLINE accumM #-}</span><span>
</span><a name="line-1138"></a><span>
</span><a name="line-1139"></a><span class="hs-comment">-- | A version of 'accum', where the internal accumulator isn't</span><span>
</span><a name="line-1140"></a><span class="hs-comment">-- serialized. It can be &quot;saved&quot; and &quot;loaded&quot;, but the state is lost in the</span><span>
</span><a name="line-1141"></a><span class="hs-comment">-- process.</span><span>
</span><a name="line-1142"></a><span class="hs-comment">--</span><span>
</span><a name="line-1143"></a><span class="hs-comment">-- See 'accum' for more details.</span><span>
</span><a name="line-1144"></a><span class="hs-comment">--</span><span>
</span><a name="line-1145"></a><span class="hs-comment">-- Useful if your accumulator @b@ cannot have a meaningful 'Serialize'</span><span>
</span><a name="line-1146"></a><span class="hs-comment">-- instance.</span><span>
</span><a name="line-1147"></a><span class="hs-identifier">accum_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446324"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446325"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446324"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ accumulating function</span><span>
</span><a name="line-1148"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446324"><span class="hs-identifier hs-type">b</span></a><span>               </span><span class="hs-comment">-- ^ intial accumulator</span><span>
</span><a name="line-1149"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446326"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446325"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446324"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1150"></a><a name="accum_"><a href="Control.Auto.Core.html#accum_"><span class="hs-identifier">accum_</span></a></a><span> </span><a name="local-1627446631"><a href="#local-1627446631"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkState_"><span class="hs-identifier hs-var">mkState_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446632"><a href="#local-1627446632"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446633"><a href="#local-1627446633"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627446634"><a href="#local-1627446634"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446631"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446633"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446632"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-1627446634"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446634"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1151"></a><span class="hs-pragma">{-# INLINE accum_ #-}</span><span>
</span><a name="line-1152"></a><span>
</span><a name="line-1153"></a><span class="hs-comment">-- | A version of 'accumM_, where the internal accumulator isn't</span><span>
</span><a name="line-1154"></a><span class="hs-comment">-- serialized. It can be &quot;saved&quot; and &quot;loaded&quot;, but the state is lost in the</span><span>
</span><a name="line-1155"></a><span class="hs-comment">-- process.</span><span>
</span><a name="line-1156"></a><span class="hs-comment">--</span><span>
</span><a name="line-1157"></a><span class="hs-comment">-- See 'accumM' for more details.</span><span>
</span><a name="line-1158"></a><span class="hs-comment">--</span><span>
</span><a name="line-1159"></a><span class="hs-comment">-- Useful if your accumulator @b@ cannot have a meaningful 'Serialize'</span><span>
</span><a name="line-1160"></a><span class="hs-comment">-- instance.</span><span>
</span><a name="line-1161"></a><span class="hs-identifier">accumM_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446321"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-1162"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446322"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446323"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446321"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446322"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ (monadic) accumulating function</span><span>
</span><a name="line-1163"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446322"><span class="hs-identifier hs-type">b</span></a><span>                  </span><span class="hs-comment">-- ^ initial accumulator</span><span>
</span><a name="line-1164"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446321"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446323"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446322"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1165"></a><a name="accumM_"><a href="Control.Auto.Core.html#accumM_"><span class="hs-identifier">accumM_</span></a></a><span> </span><a name="local-1627446635"><a href="#local-1627446635"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkStateM_"><span class="hs-identifier hs-var">mkStateM_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446636"><a href="#local-1627446636"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446637"><a href="#local-1627446637"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446635"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446637"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446636"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1166"></a><span class="hs-pragma">{-# INLINE accumM_ #-}</span><span>
</span><a name="line-1167"></a><span>
</span><a name="line-1168"></a><span class="hs-comment">-- | A &quot;delayed&quot; version of 'accum', where the first output is the initial</span><span>
</span><a name="line-1169"></a><span class="hs-comment">-- state of the accumulator, before applying the folding function. Useful</span><span>
</span><a name="line-1170"></a><span class="hs-comment">-- in recursive bindings.</span><span>
</span><a name="line-1171"></a><span class="hs-comment">--</span><span>
</span><a name="line-1172"></a><span class="hs-comment">-- &gt;&gt;&gt; let summerD = accumD (+) 0</span><span>
</span><a name="line-1173"></a><span class="hs-comment">-- &gt;&gt;&gt; let (sum1, summerD')  = stepAuto' summerD 3</span><span>
</span><a name="line-1174"></a><span class="hs-comment">-- &gt;&gt;&gt; sum1</span><span>
</span><a name="line-1175"></a><span class="hs-comment">-- 0</span><span>
</span><a name="line-1176"></a><span class="hs-comment">-- &gt;&gt;&gt; let (sum2, summerD'') = stepAuto' summerD' 10</span><span>
</span><a name="line-1177"></a><span class="hs-comment">-- &gt;&gt;&gt; sum2</span><span>
</span><a name="line-1178"></a><span class="hs-comment">-- 3</span><span>
</span><a name="line-1179"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto'  summerD'' [1..10]</span><span>
</span><a name="line-1180"></a><span class="hs-comment">-- [13,14,16,19,23,28,34,41,49,58]</span><span>
</span><a name="line-1181"></a><span class="hs-comment">--</span><span>
</span><a name="line-1182"></a><span class="hs-comment">-- (Compare with the example in 'accum')</span><span>
</span><a name="line-1183"></a><span class="hs-comment">--</span><span>
</span><a name="line-1184"></a><span class="hs-comment">-- Note that this is more or less an encoding of 'scanl', that can be</span><span>
</span><a name="line-1185"></a><span class="hs-comment">-- &quot;decoded&quot; with 'streamAuto'':</span><span>
</span><a name="line-1186"></a><span class="hs-comment">--</span><span>
</span><a name="line-1187"></a><span class="hs-comment">-- &gt;&gt;&gt; let myScanl f z = streamAuto' (accumD f z)</span><span>
</span><a name="line-1188"></a><span class="hs-comment">-- &gt;&gt;&gt; scanl (+) 0 [1..10]</span><span>
</span><a name="line-1189"></a><span class="hs-comment">-- [0,3,6,10,15,21,28,36,45,55]</span><span>
</span><a name="line-1190"></a><span class="hs-comment">-- &gt;&gt;&gt; myScanl (+) 0 [1..10]</span><span>
</span><a name="line-1191"></a><span class="hs-comment">-- [0,3,6,10,15,21,28,36,45]</span><span>
</span><a name="line-1192"></a><span class="hs-comment">--</span><span>
</span><a name="line-1193"></a><span class="hs-comment">-- The only difference is that you don't get the last element.  (You could</span><span>
</span><a name="line-1194"></a><span class="hs-comment">-- force it out, if you wanted, by feeding any nonsense value in --- even</span><span>
</span><a name="line-1195"></a><span class="hs-comment">-- 'undefined'! --- and getting the result)</span><span>
</span><a name="line-1196"></a><span class="hs-comment">--</span><span>
</span><a name="line-1197"></a><span class="hs-identifier">accumD</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627446318"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1198"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446318"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446319"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446318"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ accumulating function</span><span>
</span><a name="line-1199"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446318"><span class="hs-identifier hs-type">b</span></a><span>                  </span><span class="hs-comment">-- ^ initial accumulator</span><span>
</span><a name="line-1200"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446320"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446319"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446318"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1201"></a><a name="accumD"><a href="Control.Auto.Core.html#accumD"><span class="hs-identifier">accumD</span></a></a><span> </span><a name="local-1627446638"><a href="#local-1627446638"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkState"><span class="hs-identifier hs-var">mkState</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446639"><a href="#local-1627446639"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446640"><a href="#local-1627446640"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446640"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446638"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446640"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446639"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1202"></a><span class="hs-pragma">{-# INLINE accumD #-}</span><span>
</span><a name="line-1203"></a><span>
</span><a name="line-1204"></a><span class="hs-comment">-- | A &quot;delayed&quot; version of 'accumM', where the first output is the initial</span><span>
</span><a name="line-1205"></a><span class="hs-comment">-- state of the accumulator, before applying the folding function. Useful</span><span>
</span><a name="line-1206"></a><span class="hs-comment">-- in recursive bindings.</span><span>
</span><a name="line-1207"></a><span class="hs-identifier">accumMD</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627446315"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446316"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-1208"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446315"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446317"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446316"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446315"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ (monadic) accumulating function</span><span>
</span><a name="line-1209"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446315"><span class="hs-identifier hs-type">b</span></a><span>                     </span><span class="hs-comment">-- ^ initial accumulator</span><span>
</span><a name="line-1210"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446316"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446317"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446315"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1211"></a><a name="accumMD"><a href="Control.Auto.Core.html#accumMD"><span class="hs-identifier">accumMD</span></a></a><span> </span><a name="local-1627446641"><a href="#local-1627446641"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkStateM"><span class="hs-identifier hs-var">mkStateM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446642"><a href="#local-1627446642"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446643"><a href="#local-1627446643"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="#local-1627446643"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446641"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446643"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446642"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span class="hs-pragma">{-# INLINE accumMD #-}</span><span>
</span><a name="line-1213"></a><span>
</span><a name="line-1214"></a><span class="hs-comment">-- | The non-resuming/non-serializing version of 'accumD'.</span><span>
</span><a name="line-1215"></a><span class="hs-identifier">accumD_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627446312"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446313"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446312"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ accumulating function</span><span>
</span><a name="line-1216"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446312"><span class="hs-identifier hs-type">b</span></a><span>               </span><span class="hs-comment">-- ^ intial accumulator</span><span>
</span><a name="line-1217"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446314"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446313"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446312"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1218"></a><a name="accumD_"><a href="Control.Auto.Core.html#accumD_"><span class="hs-identifier">accumD_</span></a></a><span> </span><a name="local-1627446644"><a href="#local-1627446644"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkState_"><span class="hs-identifier hs-var">mkState_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446645"><a href="#local-1627446645"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446646"><a href="#local-1627446646"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446646"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446644"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446646"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446645"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1219"></a><span class="hs-pragma">{-# INLINE accumD_ #-}</span><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span class="hs-comment">-- | The non-resuming/non-serializing version of 'accumMD'.</span><span>
</span><a name="line-1222"></a><span class="hs-identifier">accumMD_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446309"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-1223"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446310"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446311"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446309"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446310"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ (monadic) accumulating function</span><span>
</span><a name="line-1224"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446310"><span class="hs-identifier hs-type">b</span></a><span>                  </span><span class="hs-comment">-- ^ initial accumulator</span><span>
</span><a name="line-1225"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446309"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446311"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446310"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1226"></a><a name="accumMD_"><a href="Control.Auto.Core.html#accumMD_"><span class="hs-identifier">accumMD_</span></a></a><span> </span><a name="local-1627446647"><a href="#local-1627446647"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkStateM_"><span class="hs-identifier hs-var">mkStateM_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446648"><a href="#local-1627446648"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446649"><a href="#local-1627446649"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="#local-1627446649"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446647"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446649"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-1627446648"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1227"></a><span class="hs-pragma">{-# INLINE accumMD_ #-}</span><span>
</span><a name="line-1228"></a><span>
</span><a name="line-1229"></a><span class="hs-comment">-- | Maps over the output stream of the 'Auto'.</span><span>
</span><a name="line-1230"></a><span class="hs-comment">--</span><span>
</span><a name="line-1231"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1..10]</span><span>
</span><a name="line-1232"></a><span class="hs-comment">-- [1,3,6,10,15,21,28,36,45,55]</span><span>
</span><a name="line-1233"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (show &lt;$&gt; sumFrom 0) [1..10]</span><span>
</span><a name="line-1234"></a><span class="hs-comment">-- [&quot;1&quot;,&quot;3&quot;,&quot;6&quot;,&quot;10&quot;,&quot;15&quot;,&quot;21&quot;,&quot;28&quot;,&quot;36&quot;,&quot;45&quot;,&quot;55&quot;]</span><span>
</span><a name="line-1235"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627447381"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627447381"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627447382"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1236"></a><span>    </span><a name="local-805306541"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">rmap</span><span>
</span><a name="line-1237"></a><span>    </span><span class="hs-pragma">{-# INLINE fmap #-}</span><span>
</span><a name="line-1238"></a><span>
</span><a name="line-1239"></a><span class="hs-comment">-- | 'pure' creates the &quot;constant&quot; 'Auto':</span><span>
</span><a name="line-1240"></a><span class="hs-comment">--</span><span>
</span><a name="line-1241"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (pure &quot;foo&quot;) [1..5]</span><span>
</span><a name="line-1242"></a><span class="hs-comment">-- [&quot;foo&quot;,&quot;foo&quot;,&quot;foo&quot;,&quot;foo&quot;,&quot;foo&quot;]</span><span>
</span><a name="line-1243"></a><span class="hs-comment">--</span><span>
</span><a name="line-1244"></a><span class="hs-comment">-- '&lt;*&gt;' and 'liftA2' etc. give you the ability to fork the input stream</span><span>
</span><a name="line-1245"></a><span class="hs-comment">-- over many 'Auto's, and recombine the results:</span><span>
</span><a name="line-1246"></a><span class="hs-comment">--</span><span>
</span><a name="line-1247"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1..10]</span><span>
</span><a name="line-1248"></a><span class="hs-comment">-- [ 1, 3,  6, 10,  15]</span><span>
</span><a name="line-1249"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (productFrom 1) [1..10]</span><span>
</span><a name="line-1250"></a><span class="hs-comment">-- [ 1, 2,  6, 24, 120]</span><span>
</span><a name="line-1251"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (liftA2 (+) (sumFrom 0) (productFrom 1)) [1..5]</span><span>
</span><a name="line-1252"></a><span class="hs-comment">-- [ 2, 5, 12, 34, 135]</span><span>
</span><a name="line-1253"></a><span class="hs-comment">--</span><span>
</span><a name="line-1254"></a><span class="hs-comment">-- For effectful 'Auto', you can imagine '*&gt;' as &quot;forking&quot; the input stream</span><span>
</span><a name="line-1255"></a><span class="hs-comment">-- through both, and only keeping the result of the second:</span><span>
</span><a name="line-1256"></a><span class="hs-comment">--</span><span>
</span><a name="line-1257"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-1258"></a><span class="hs-comment">-- 'effect' 'print' *&gt; 'sumFrom' 0</span><span>
</span><a name="line-1259"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-1260"></a><span class="hs-comment">--</span><span>
</span><a name="line-1261"></a><span class="hs-comment">-- would, for example, behave just like @'sumFrom' 0@, except printing the</span><span>
</span><a name="line-1262"></a><span class="hs-comment">-- input to 'IO' at every step.</span><span>
</span><a name="line-1263"></a><span class="hs-comment">--</span><span>
</span><a name="line-1264"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627447242"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627447242"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627447243"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1265"></a><span>    </span><a name="local-805307120"><span class="hs-identifier">pure</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkConst"><span class="hs-identifier hs-var">mkConst</span></a><span>
</span><a name="line-1266"></a><span>    </span><span class="hs-pragma">{-# INLINE pure #-}</span><span>
</span><a name="line-1267"></a><span>    </span><a name="local-1627447244"><a href="#local-1627447244"><span class="hs-identifier">af</span></a></a><span> </span><a name="local-805307119"><span class="hs-operator">&lt;*&gt;</span></a><span> </span><a name="local-1627447245"><a href="#local-1627447245"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447245"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1268"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447246"><a href="#local-1627447246"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447247"><a href="#local-1627447247"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1269"></a><span>                      </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627447246"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-1627447247"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1270"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447248"><a href="#local-1627447248"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447249"><a href="#local-1627447249"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1271"></a><span>                      </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447250"><a href="#local-1627447250"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="#local-1627447248"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447250"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447249"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447250"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-1272"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447251"><a href="#local-1627447251"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447252"><a href="#local-1627447252"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447253"><a href="#local-1627447253"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447254"><a href="#local-1627447254"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1273"></a><span>                      </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447252"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447255"><a href="#local-1627447255"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447256"><a href="#local-1627447256"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><a href="#local-1627447251"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447255"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447253"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447255"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447256"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447254"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1274"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447257"><a href="#local-1627447257"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447258"><a href="#local-1627447258"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447259"><a href="#local-1627447259"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447260"><a href="#local-1627447260"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1275"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447258"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447261"><a href="#local-1627447261"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447262"><a href="#local-1627447262"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><a href="#local-1627447257"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447261"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447259"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447261"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447262"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447260"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1276"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447263"><a href="#local-1627447263"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447264"><a href="#local-1627447264"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447265"><a href="#local-1627447265"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447266"><a href="#local-1627447266"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1277"></a><span>                      </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-1627447264"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447265"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447267"><a href="#local-1627447267"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627447263"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447267"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627447266"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447267"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1278"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447268"><a href="#local-1627447268"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447269"><a href="#local-1627447269"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447270"><a href="#local-1627447270"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447271"><a href="#local-1627447271"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1279"></a><span>                      </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-1627447269"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447270"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447272"><a href="#local-1627447272"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="#local-1627447268"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447272"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447271"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447272"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447273"><a href="#local-1627447273"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447274"><a href="#local-1627447274"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1281"></a><span>                      </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447275"><a href="#local-1627447275"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627447274"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447275"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447273"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447275"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-1282"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447276"><a href="#local-1627447276"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447277"><a href="#local-1627447277"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1283"></a><span>                      </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447278"><a href="#local-1627447278"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627447276"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447278"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">ap</span><span class="hs-special">`</span><span> </span><a href="#local-1627447277"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447278"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1284"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447279"><a href="#local-1627447279"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447280"><a href="#local-1627447280"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447281"><a href="#local-1627447281"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447282"><a href="#local-1627447282"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1285"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447280"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447283"><a href="#local-1627447283"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447284"><a href="#local-1627447284"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627447281"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447283"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447284"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">first</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447279"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447283"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447282"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1286"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447285"><a href="#local-1627447285"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447286"><a href="#local-1627447286"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447287"><a href="#local-1627447287"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447288"><a href="#local-1627447288"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1287"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447286"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447289"><a href="#local-1627447289"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447290"><a href="#local-1627447290"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><a href="#local-1627447285"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447289"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447287"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447289"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447290"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447288"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1288"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447291"><a href="#local-1627447291"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447292"><a href="#local-1627447292"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447293"><a href="#local-1627447293"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447294"><a href="#local-1627447294"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1289"></a><span>                      </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-1627447292"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447293"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447295"><a href="#local-1627447295"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627447294"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447295"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447291"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447295"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-1290"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447296"><a href="#local-1627447296"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447297"><a href="#local-1627447297"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447298"><a href="#local-1627447298"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447299"><a href="#local-1627447299"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1291"></a><span>                      </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span> </span><a href="#local-1627447297"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447298"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447300"><a href="#local-1627447300"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447296"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447300"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447299"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447300"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-1292"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447301"><a href="#local-1627447301"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447302"><a href="#local-1627447302"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447303"><a href="#local-1627447303"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447304"><a href="#local-1627447304"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1293"></a><span>                      </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447301"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447305"><a href="#local-1627447305"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447306"><a href="#local-1627447306"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627447304"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447305"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447302"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447305"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447306"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447303"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1294"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447307"><a href="#local-1627447307"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447308"><a href="#local-1627447308"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447309"><a href="#local-1627447309"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447310"><a href="#local-1627447310"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1295"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447307"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447311"><a href="#local-1627447311"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447312"><a href="#local-1627447312"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447313"><a href="#local-1627447313"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627447313"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447308"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447311"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447312"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447310"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447311"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447309"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1296"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447314"><a href="#local-1627447314"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627447315"><a href="#local-1627447315"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447316"><a href="#local-1627447316"><span class="hs-identifier">sf</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447317"><a href="#local-1627447317"><span class="hs-identifier">gpx</span></a></a><span> </span><a name="local-1627447318"><a href="#local-1627447318"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447319"><a href="#local-1627447319"><span class="hs-identifier">sx</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1297"></a><span>                      </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627447314"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447317"><span class="hs-identifier hs-var">gpx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1298"></a><span>                                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447320"><a href="#local-1627447320"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627447321"><a href="#local-1627447321"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447322"><a href="#local-1627447322"><span class="hs-identifier">sx'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447323"><a href="#local-1627447323"><span class="hs-identifier">f'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447324"><a href="#local-1627447324"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447315"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447320"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447321"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1299"></a><span>                                                      </span><span class="hs-special">(</span><a name="local-1627447325"><a href="#local-1627447325"><span class="hs-identifier">x'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447326"><a href="#local-1627447326"><span class="hs-identifier">sx''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447318"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447320"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447322"><span class="hs-identifier hs-var">sx'</span></a><span>
</span><a name="line-1300"></a><span>                                                  </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627447323"><span class="hs-identifier hs-var">f'</span></a><span> </span><a href="#local-1627447325"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627447324"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447326"><span class="hs-identifier hs-var">sx''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1301"></a><span>                                </span><span class="hs-special">(</span><a href="#local-1627447316"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447319"><span class="hs-identifier hs-var">sx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1302"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447327"><a href="#local-1627447327"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627447328"><a href="#local-1627447328"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447329"><a href="#local-1627447329"><span class="hs-identifier">sf</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447330"><a href="#local-1627447330"><span class="hs-identifier">gpx</span></a></a><span> </span><a name="local-1627447331"><a href="#local-1627447331"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447332"><a href="#local-1627447332"><span class="hs-identifier">sx</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1303"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627447327"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447330"><span class="hs-identifier hs-var">gpx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1304"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447333"><a href="#local-1627447333"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627447334"><a href="#local-1627447334"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447335"><a href="#local-1627447335"><span class="hs-identifier">sx'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447336"><a href="#local-1627447336"><span class="hs-identifier">f'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447337"><a href="#local-1627447337"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447328"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447333"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447334"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1305"></a><span>                                                      </span><span class="hs-special">(</span><a name="local-1627447338"><a href="#local-1627447338"><span class="hs-identifier">x'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447339"><a href="#local-1627447339"><span class="hs-identifier">sx''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447331"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447333"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447335"><span class="hs-identifier hs-var">sx'</span></a><span>
</span><a name="line-1306"></a><span>                                                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447336"><span class="hs-identifier hs-var">f'</span></a><span> </span><a href="#local-1627447338"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627447337"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447339"><span class="hs-identifier hs-var">sx''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1307"></a><span>                                 </span><span class="hs-special">(</span><a href="#local-1627447329"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447332"><span class="hs-identifier hs-var">sx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1308"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447340"><a href="#local-1627447340"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447341"><a href="#local-1627447341"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447342"><a href="#local-1627447342"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447343"><a href="#local-1627447343"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1309"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447340"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447344"><a href="#local-1627447344"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447345"><a href="#local-1627447345"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627447343"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447344"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447341"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447344"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447345"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627447342"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1310"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447346"><a href="#local-1627447346"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627447347"><a href="#local-1627447347"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447348"><a href="#local-1627447348"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447349"><a href="#local-1627447349"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1311"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447346"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447350"><a href="#local-1627447350"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627447351"><a href="#local-1627447351"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-1627447352"><a href="#local-1627447352"><span class="hs-identifier">f'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447353"><a href="#local-1627447353"><span class="hs-identifier">s''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447347"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447350"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447351"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-1312"></a><span>                                                 </span><a name="local-1627447354"><a href="#local-1627447354"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447349"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447350"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1313"></a><span>                                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447352"><span class="hs-identifier hs-var">f'</span></a><span> </span><a href="#local-1627447354"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447353"><span class="hs-identifier hs-var">s''</span></a><span class="hs-special">)</span><span>
</span><a name="line-1314"></a><span>                                    </span><span class="hs-special">)</span><span> </span><a href="#local-1627447348"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1315"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447355"><a href="#local-1627447355"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627447356"><a href="#local-1627447356"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447357"><a href="#local-1627447357"><span class="hs-identifier">sf</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447358"><a href="#local-1627447358"><span class="hs-identifier">gpx</span></a></a><span> </span><a name="local-1627447359"><a href="#local-1627447359"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447360"><a href="#local-1627447360"><span class="hs-identifier">sx</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1316"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627447355"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447358"><span class="hs-identifier hs-var">gpx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1317"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447361"><a href="#local-1627447361"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627447362"><a href="#local-1627447362"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447363"><a href="#local-1627447363"><span class="hs-identifier">sx'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-1627447364"><a href="#local-1627447364"><span class="hs-identifier">f'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447365"><a href="#local-1627447365"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447356"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447361"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447362"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1318"></a><span>                                                      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447366"><a href="#local-1627447366"><span class="hs-identifier">x'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447367"><a href="#local-1627447367"><span class="hs-identifier">sx''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447359"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447361"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447363"><span class="hs-identifier hs-var">sx'</span></a><span>
</span><a name="line-1319"></a><span>                                                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447364"><span class="hs-identifier hs-var">f'</span></a><span> </span><a href="#local-1627447366"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627447365"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447367"><span class="hs-identifier hs-var">sx''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1320"></a><span>                                 </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447357"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447360"><span class="hs-identifier hs-var">sx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1321"></a><span>                  </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447368"><a href="#local-1627447368"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627447369"><a href="#local-1627447369"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447370"><a href="#local-1627447370"><span class="hs-identifier">sf</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447371"><a href="#local-1627447371"><span class="hs-identifier">gpx</span></a></a><span> </span><a name="local-1627447372"><a href="#local-1627447372"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447373"><a href="#local-1627447373"><span class="hs-identifier">sx</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1322"></a><span>                      </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627447368"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447371"><span class="hs-identifier hs-var">gpx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>                                 </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447374"><a href="#local-1627447374"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627447375"><a href="#local-1627447375"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447376"><a href="#local-1627447376"><span class="hs-identifier">sx'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-1627447377"><a href="#local-1627447377"><span class="hs-identifier">f'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447378"><a href="#local-1627447378"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447369"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447374"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447375"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1324"></a><span>                                                      </span><span class="hs-special">(</span><a name="local-1627447379"><a href="#local-1627447379"><span class="hs-identifier">x'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447380"><a href="#local-1627447380"><span class="hs-identifier">sx''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447372"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447374"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627447376"><span class="hs-identifier hs-var">sx'</span></a><span>
</span><a name="line-1325"></a><span>                                                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447377"><span class="hs-identifier hs-var">f'</span></a><span> </span><a href="#local-1627447379"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627447378"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447380"><span class="hs-identifier hs-var">sx''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1326"></a><span>                                 </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627447370"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447373"><span class="hs-identifier hs-var">sx</span></a><span class="hs-special">)</span><span>
</span><a name="line-1327"></a><span>                  </span><span class="hs-comment">-- i give up!</span><span>
</span><a name="line-1328"></a><span>                  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627447244"><span class="hs-identifier hs-var">af</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><a href="#local-1627447245"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>    </span><span class="hs-pragma">{-# INLINE (&lt;*&gt;) #-}</span><span>
</span><a name="line-1330"></a><span>
</span><a name="line-1331"></a><span class="hs-comment">-- | When the underlying 'Monad'/'Applicative' @m@ is an 'Alternative',</span><span>
</span><a name="line-1332"></a><span class="hs-comment">-- fork the input through each one and &quot;squish&quot; their results together</span><span>
</span><a name="line-1333"></a><span class="hs-comment">-- inside the 'Alternative' context.  See 'runTraversableA' for similar use</span><span>
</span><a name="line-1334"></a><span class="hs-comment">-- cases.</span><span>
</span><a name="line-1335"></a><span class="hs-comment">--</span><span>
</span><a name="line-1336"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto (arrM (mfilter even . Just)) [1..10]</span><span>
</span><a name="line-1337"></a><span class="hs-comment">-- Nothing</span><span>
</span><a name="line-1338"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto (arrM (Just . negate)) [1..10]</span><span>
</span><a name="line-1339"></a><span class="hs-comment">-- Just [-1,-2,-3,-4,-5,-6,-7,-8,-9,-10]</span><span>
</span><a name="line-1340"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto (arrM (mfilter even . Just)) &lt;|&gt; arrM (Just . negate)) [1..10]</span><span>
</span><a name="line-1341"></a><span class="hs-comment">-- Just [-1,2,-3,4,-5,6,-7,8,-9,10]</span><span>
</span><a name="line-1342"></a><span class="hs-comment">--</span><span>
</span><a name="line-1343"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627447235"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Alternative</span><span> </span><a href="#local-1627447235"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Alternative</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627447235"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627447236"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1344"></a><span>    </span><a name="local-1912608855"><span class="hs-identifier">empty</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkConstM"><span class="hs-identifier hs-var">mkConstM</span></a><span> </span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-1345"></a><span>    </span><a name="local-1627447237"><a href="#local-1627447237"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-1912608854"><span class="hs-operator">&lt;|&gt;</span></a><span> </span><a name="local-1627447238"><a href="#local-1627447238"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;|&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627447237"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><a href="#local-1627447238"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1346"></a><span>                        </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627447237"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><a href="#local-1627447238"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1347"></a><span>                        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447239"><a href="#local-1627447239"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-1627447240"><a href="#local-1627447240"><span class="hs-identifier">res1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="#local-1627447238"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">`</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627447237"><span class="hs-identifier hs-var">a1</span></a><span> </span><a href="#local-1627447239"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1348"></a><span>                                    </span><a name="local-1627447241"><a href="#local-1627447241"><span class="hs-identifier">res2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><a href="#local-1627447237"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">`</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627447238"><span class="hs-identifier hs-var">a2</span></a><span> </span><a href="#local-1627447239"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1349"></a><span>                                </span><span class="hs-keyword">in</span><span>  </span><a href="#local-1627447240"><span class="hs-identifier hs-var">res1</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="#local-1627447241"><span class="hs-identifier hs-var">res2</span></a><span>
</span><a name="line-1350"></a><span>
</span><a name="line-1351"></a><span class="hs-comment">-- | Gives the ability to &quot;compose&quot; two 'Auto's; feeds the input stream</span><span>
</span><a name="line-1352"></a><span class="hs-comment">-- into the first, feeds that output stream into the second, and returns as</span><span>
</span><a name="line-1353"></a><span class="hs-comment">-- a result the output stream of the second.</span><span>
</span><a name="line-1354"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446914"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Category</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446914"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1355"></a><span>    </span><a name="local-1912606272"><span class="hs-identifier">id</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkFunc"><span class="hs-identifier hs-var">mkFunc</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-1356"></a><span>    </span><a name="local-1627446915"><a href="#local-1627446915"><span class="hs-identifier">ag</span></a></a><span> </span><a name="local-1912606271"><span class="hs-operator">.</span></a><span> </span><a name="local-1627446916"><a href="#local-1627446916"><span class="hs-identifier">af</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-1627446915"><span class="hs-identifier hs-var">ag</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1357"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446917"><a href="#local-1627446917"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446918"><a href="#local-1627446918"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1358"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span>   </span><span class="hs-special">(</span><a href="#local-1627446917"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446918"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1359"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446919"><a href="#local-1627446919"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446920"><a href="#local-1627446920"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1360"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446919"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><a href="#local-1627446920"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1361"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446921"><a href="#local-1627446921"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446922"><a href="#local-1627446922"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627446923"><a href="#local-1627446923"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446924"><a href="#local-1627446924"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1362"></a><span>                    </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446922"><span class="hs-identifier hs-var">gpf</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446925"><a href="#local-1627446925"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446926"><a href="#local-1627446926"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446921"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446923"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446925"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446926"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446924"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1363"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446927"><a href="#local-1627446927"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446928"><a href="#local-1627446928"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627446929"><a href="#local-1627446929"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446930"><a href="#local-1627446930"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1364"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446928"><span class="hs-identifier hs-var">gpf</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446931"><a href="#local-1627446931"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446932"><a href="#local-1627446932"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446927"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446929"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446931"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446932"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446930"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1365"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446933"><a href="#local-1627446933"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446934"><a href="#local-1627446934"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446935"><a href="#local-1627446935"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446936"><a href="#local-1627446936"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1366"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627446915"><span class="hs-identifier hs-var">ag</span></a><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627446934"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446935"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446937"><a href="#local-1627446937"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446933"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627446933"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446936"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446937"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1367"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446938"><a href="#local-1627446938"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446939"><a href="#local-1627446939"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446940"><a href="#local-1627446940"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446941"><a href="#local-1627446941"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1368"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627446915"><span class="hs-identifier hs-var">ag</span></a><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627446939"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446940"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446942"><a href="#local-1627446942"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="#local-1627446938"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627446938"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446941"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446942"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1369"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446943"><a href="#local-1627446943"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446944"><a href="#local-1627446944"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1370"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446943"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446944"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1371"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446945"><a href="#local-1627446945"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446946"><a href="#local-1627446946"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1372"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446945"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><a href="#local-1627446946"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1373"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446947"><a href="#local-1627446947"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446948"><a href="#local-1627446948"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627446949"><a href="#local-1627446949"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446950"><a href="#local-1627446950"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1374"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446948"><span class="hs-identifier hs-var">gpf</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446951"><a href="#local-1627446951"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446952"><a href="#local-1627446952"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#firstM"><span class="hs-identifier hs-var">firstM</span></a><span> </span><a href="#local-1627446947"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446949"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446951"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446952"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446950"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1375"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446953"><a href="#local-1627446953"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446954"><a href="#local-1627446954"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627446955"><a href="#local-1627446955"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446956"><a href="#local-1627446956"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1376"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446954"><span class="hs-identifier hs-var">gpf</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446957"><a href="#local-1627446957"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446958"><a href="#local-1627446958"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#firstM"><span class="hs-identifier hs-var">firstM</span></a><span> </span><a href="#local-1627446953"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-1627446955"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446957"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446958"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446956"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1377"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446959"><a href="#local-1627446959"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446960"><a href="#local-1627446960"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446961"><a href="#local-1627446961"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446962"><a href="#local-1627446962"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1378"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627446915"><span class="hs-identifier hs-var">ag</span></a><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627446960"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>                             </span><a href="#local-1627446961"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1380"></a><span>                           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446963"><a href="#local-1627446963"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1381"></a><span>                               </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446964"><a href="#local-1627446964"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446965"><a href="#local-1627446965"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446962"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446963"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1382"></a><span>                               </span><a name="local-1627446966"><a href="#local-1627446966"><span class="hs-identifier">y'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446959"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446964"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1383"></a><span>                               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446966"><span class="hs-identifier hs-var">y'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446915"><span class="hs-identifier hs-var">ag</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446965"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1384"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446967"><a href="#local-1627446967"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446968"><a href="#local-1627446968"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446969"><a href="#local-1627446969"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446970"><a href="#local-1627446970"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1385"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627446915"><span class="hs-identifier hs-var">ag</span></a><span> </span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627446968"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1386"></a><span>                             </span><a href="#local-1627446969"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1387"></a><span>                           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446971"><a href="#local-1627446971"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1388"></a><span>                               </span><span class="hs-special">(</span><a name="local-1627446972"><a href="#local-1627446972"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446973"><a href="#local-1627446973"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446970"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446971"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1389"></a><span>                               </span><a name="local-1627446974"><a href="#local-1627446974"><span class="hs-identifier">y'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446967"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446972"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1390"></a><span>                               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446974"><span class="hs-identifier hs-var">y'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446915"><span class="hs-identifier hs-var">ag</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446973"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1391"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446975"><a href="#local-1627446975"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446976"><a href="#local-1627446976"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627446977"><a href="#local-1627446977"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446978"><a href="#local-1627446978"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1392"></a><span>                    </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446975"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446976"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446978"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446977"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1393"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446979"><a href="#local-1627446979"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446980"><a href="#local-1627446980"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627446981"><a href="#local-1627446981"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446982"><a href="#local-1627446982"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1394"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446979"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446983"><a href="#local-1627446983"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446984"><a href="#local-1627446984"><span class="hs-identifier">sg'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="#local-1627446980"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627446984"><span class="hs-identifier hs-var">sg'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446982"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446983"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446981"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1395"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446985"><a href="#local-1627446985"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446986"><a href="#local-1627446986"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627446987"><a href="#local-1627446987"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446988"><a href="#local-1627446988"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627446989"><a href="#local-1627446989"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446990"><a href="#local-1627446990"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1396"></a><span>                    </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627446985"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627446988"><span class="hs-identifier hs-var">gpf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1397"></a><span>                              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446991"><a href="#local-1627446991"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627446992"><a href="#local-1627446992"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446993"><a href="#local-1627446993"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446994"><a href="#local-1627446994"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446995"><a href="#local-1627446995"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446989"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446991"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627446993"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1398"></a><span>                                                    </span><span class="hs-special">(</span><a name="local-1627446996"><a href="#local-1627446996"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446997"><a href="#local-1627446997"><span class="hs-identifier">sg''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446986"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446994"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627446992"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1399"></a><span>                                                </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446996"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627446997"><span class="hs-identifier hs-var">sg''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446995"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1400"></a><span>                              </span><span class="hs-special">(</span><a href="#local-1627446987"><span class="hs-identifier hs-var">sg</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446990"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1401"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446998"><a href="#local-1627446998"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446999"><a href="#local-1627446999"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447000"><a href="#local-1627447000"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447001"><a href="#local-1627447001"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627447002"><a href="#local-1627447002"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447003"><a href="#local-1627447003"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1402"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627446998"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447001"><span class="hs-identifier hs-var">gpf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1403"></a><span>                               </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447004"><a href="#local-1627447004"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627447005"><a href="#local-1627447005"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447006"><a href="#local-1627447006"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1404"></a><span>                                    </span><span class="hs-special">(</span><a name="local-1627447007"><a href="#local-1627447007"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447008"><a href="#local-1627447008"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447002"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447004"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447006"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1405"></a><span>                                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447009"><a href="#local-1627447009"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447010"><a href="#local-1627447010"><span class="hs-identifier">sg''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446999"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447007"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627447005"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1406"></a><span>                                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447009"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627447010"><span class="hs-identifier hs-var">sg''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447008"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1407"></a><span>                               </span><span class="hs-special">(</span><a href="#local-1627447000"><span class="hs-identifier hs-var">sg</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447003"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1408"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447011"><a href="#local-1627447011"><span class="hs-identifier">gpg</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447012"><a href="#local-1627447012"><span class="hs-identifier">gg</span></a></a><span class="hs-special">,</span><a name="local-1627447013"><a href="#local-1627447013"><span class="hs-identifier">pg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447014"><a href="#local-1627447014"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447015"><a href="#local-1627447015"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447016"><a href="#local-1627447016"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447017"><a href="#local-1627447017"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447018"><a href="#local-1627447018"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1409"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447019"><a href="#local-1627447019"><span class="hs-identifier">sg'</span></a></a><span> </span><a name="local-1627447020"><a href="#local-1627447020"><span class="hs-identifier">af'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447011"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447014"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447019"><span class="hs-identifier hs-var">sg'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447020"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447012"><span class="hs-identifier hs-var">gg</span></a><span> </span><a href="#local-1627447016"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1410"></a><span>                            </span><span class="hs-special">(</span><a href="#local-1627447013"><span class="hs-identifier hs-var">pg</span></a><span> </span><a href="#local-1627447015"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447017"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1411"></a><span>                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447021"><a href="#local-1627447021"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447022"><a href="#local-1627447022"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447023"><a href="#local-1627447023"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447018"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447021"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1412"></a><span>                                        </span><span class="hs-special">(</span><a name="local-1627447024"><a href="#local-1627447024"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447025"><a href="#local-1627447025"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447014"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447022"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627447015"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1413"></a><span>                                        </span><a name="local-1627447026"><a href="#local-1627447026"><span class="hs-identifier">ag'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447011"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447014"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447025"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1414"></a><span>                                    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627447024"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447026"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447023"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1415"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447027"><a href="#local-1627447027"><span class="hs-identifier">gpg</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447028"><a href="#local-1627447028"><span class="hs-identifier">gg</span></a></a><span class="hs-special">,</span><a name="local-1627447029"><a href="#local-1627447029"><span class="hs-identifier">pg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447030"><a href="#local-1627447030"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447031"><a href="#local-1627447031"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447032"><a href="#local-1627447032"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447033"><a href="#local-1627447033"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447034"><a href="#local-1627447034"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1416"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447035"><a href="#local-1627447035"><span class="hs-identifier">sg'</span></a></a><span> </span><a name="local-1627447036"><a href="#local-1627447036"><span class="hs-identifier">af'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447027"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447030"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447035"><span class="hs-identifier hs-var">sg'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447036"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447028"><span class="hs-identifier hs-var">gg</span></a><span> </span><a href="#local-1627447032"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1417"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447029"><span class="hs-identifier hs-var">pg</span></a><span> </span><a href="#local-1627447031"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447033"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1418"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447037"><a href="#local-1627447037"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1419"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447038"><a href="#local-1627447038"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447039"><a href="#local-1627447039"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447034"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447037"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1420"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447040"><a href="#local-1627447040"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447041"><a href="#local-1627447041"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447030"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447038"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627447031"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1421"></a><span>                                     </span><a name="local-1627447042"><a href="#local-1627447042"><span class="hs-identifier">ag'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447027"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447030"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447041"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1422"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447040"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447042"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447039"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1423"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447043"><a href="#local-1627447043"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627447044"><a href="#local-1627447044"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447045"><a href="#local-1627447045"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447046"><a href="#local-1627447046"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1424"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447043"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627447044"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447046"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447045"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1425"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447047"><a href="#local-1627447047"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627447048"><a href="#local-1627447048"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447049"><a href="#local-1627447049"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447050"><a href="#local-1627447050"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1426"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447047"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447051"><a href="#local-1627447051"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627447052"><a href="#local-1627447052"><span class="hs-identifier">sg'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><a href="#local-1627447048"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447052"><span class="hs-identifier hs-var">sg'</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-1627447050"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447051"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447049"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1427"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447053"><a href="#local-1627447053"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627447054"><a href="#local-1627447054"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447055"><a href="#local-1627447055"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447056"><a href="#local-1627447056"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627447057"><a href="#local-1627447057"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447058"><a href="#local-1627447058"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1428"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627447053"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447056"><span class="hs-identifier hs-var">gpf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1429"></a><span>                               </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447059"><a href="#local-1627447059"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627447060"><a href="#local-1627447060"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447061"><a href="#local-1627447061"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1430"></a><span>                                  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447062"><a href="#local-1627447062"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447063"><a href="#local-1627447063"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447057"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447059"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447061"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1431"></a><span>                                  </span><span class="hs-special">(</span><a name="local-1627447064"><a href="#local-1627447064"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447065"><a href="#local-1627447065"><span class="hs-identifier">sg''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447054"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447062"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627447060"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1432"></a><span>                                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447064"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627447065"><span class="hs-identifier hs-var">sg''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447063"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1433"></a><span>                               </span><span class="hs-special">(</span><a href="#local-1627447055"><span class="hs-identifier hs-var">sg</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447058"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1434"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447066"><a href="#local-1627447066"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627447067"><a href="#local-1627447067"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447068"><a href="#local-1627447068"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447069"><a href="#local-1627447069"><span class="hs-identifier">gpf</span></a></a><span> </span><a name="local-1627447070"><a href="#local-1627447070"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447071"><a href="#local-1627447071"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1435"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier hs-var">mergeStSt</span></a><span> </span><a href="#local-1627447066"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447069"><span class="hs-identifier hs-var">gpf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1436"></a><span>                               </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447072"><a href="#local-1627447072"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627447073"><a href="#local-1627447073"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447074"><a href="#local-1627447074"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1437"></a><span>                                  </span><span class="hs-special">(</span><a name="local-1627447075"><a href="#local-1627447075"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447076"><a href="#local-1627447076"><span class="hs-identifier">sf''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447070"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447072"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447074"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1438"></a><span>                                  </span><span class="hs-special">(</span><a name="local-1627447077"><a href="#local-1627447077"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447078"><a href="#local-1627447078"><span class="hs-identifier">sg''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447067"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447075"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627447073"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1439"></a><span>                                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447077"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627447078"><span class="hs-identifier hs-var">sg''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447076"><span class="hs-identifier hs-var">sf''</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1440"></a><span>                               </span><span class="hs-special">(</span><a href="#local-1627447068"><span class="hs-identifier hs-var">sg</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447071"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1441"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447079"><a href="#local-1627447079"><span class="hs-identifier">gpg</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447080"><a href="#local-1627447080"><span class="hs-identifier">gg</span></a></a><span class="hs-special">,</span><a name="local-1627447081"><a href="#local-1627447081"><span class="hs-identifier">pg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447082"><a href="#local-1627447082"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447083"><a href="#local-1627447083"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447084"><a href="#local-1627447084"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447085"><a href="#local-1627447085"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447086"><a href="#local-1627447086"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1442"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447087"><a href="#local-1627447087"><span class="hs-identifier">sg'</span></a></a><span> </span><a name="local-1627447088"><a href="#local-1627447088"><span class="hs-identifier">af'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447079"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447082"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447087"><span class="hs-identifier hs-var">sg'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447088"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447080"><span class="hs-identifier hs-var">gg</span></a><span> </span><a href="#local-1627447084"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1443"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447081"><span class="hs-identifier hs-var">pg</span></a><span> </span><a href="#local-1627447083"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447085"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1444"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447089"><a href="#local-1627447089"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1445"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447090"><a href="#local-1627447090"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447091"><a href="#local-1627447091"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447086"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447089"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1446"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447092"><a href="#local-1627447092"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447093"><a href="#local-1627447093"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447082"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447090"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627447083"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1447"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><a name="local-1627447094"><a href="#local-1627447094"><span class="hs-identifier">ag'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447079"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447082"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447093"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1448"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447092"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447094"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447091"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1449"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447095"><a href="#local-1627447095"><span class="hs-identifier">gpg</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447096"><a href="#local-1627447096"><span class="hs-identifier">gg</span></a></a><span class="hs-special">,</span><a name="local-1627447097"><a href="#local-1627447097"><span class="hs-identifier">pg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447098"><a href="#local-1627447098"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-1627447099"><a href="#local-1627447099"><span class="hs-identifier">sg</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447100"><a href="#local-1627447100"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447101"><a href="#local-1627447101"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447102"><a href="#local-1627447102"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1450"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447103"><a href="#local-1627447103"><span class="hs-identifier">sg'</span></a></a><span> </span><a name="local-1627447104"><a href="#local-1627447104"><span class="hs-identifier">af'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447095"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447098"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447103"><span class="hs-identifier hs-var">sg'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447104"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447096"><span class="hs-identifier hs-var">gg</span></a><span> </span><a href="#local-1627447100"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1451"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447097"><span class="hs-identifier hs-var">pg</span></a><span> </span><a href="#local-1627447099"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447101"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1452"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447105"><a href="#local-1627447105"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1453"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447106"><a href="#local-1627447106"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447107"><a href="#local-1627447107"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447102"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447105"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1454"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447108"><a href="#local-1627447108"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447109"><a href="#local-1627447109"><span class="hs-identifier">sg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447098"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447106"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627447099"><span class="hs-identifier hs-var">sg</span></a><span>
</span><a name="line-1455"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><a name="local-1627447110"><a href="#local-1627447110"><span class="hs-identifier">ag'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447095"><span class="hs-identifier hs-var">gpg</span></a><span> </span><a href="#local-1627447098"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447109"><span class="hs-identifier hs-var">sg'</span></a><span>
</span><a name="line-1456"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447108"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447110"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447107"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1457"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447111"><a href="#local-1627447111"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447112"><a href="#local-1627447112"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447113"><a href="#local-1627447113"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447114"><a href="#local-1627447114"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1458"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447111"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447112"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447113"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447114"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1459"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447115"><a href="#local-1627447115"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447116"><a href="#local-1627447116"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447117"><a href="#local-1627447117"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447118"><a href="#local-1627447118"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1460"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447115"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447116"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447117"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><a href="#local-1627447118"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1461"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447119"><a href="#local-1627447119"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447120"><a href="#local-1627447120"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447121"><a href="#local-1627447121"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447122"><a href="#local-1627447122"><span class="hs-identifier">gpf</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447123"><a href="#local-1627447123"><span class="hs-identifier">gf</span></a></a><span class="hs-special">,</span><a name="local-1627447124"><a href="#local-1627447124"><span class="hs-identifier">pf</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447125"><a href="#local-1627447125"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447126"><a href="#local-1627447126"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1462"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447127"><a href="#local-1627447127"><span class="hs-identifier">ag'</span></a></a><span> </span><a name="local-1627447128"><a href="#local-1627447128"><span class="hs-identifier">sf'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627447127"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447122"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447125"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447128"><span class="hs-identifier hs-var">sf'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447119"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627447123"><span class="hs-identifier hs-var">gf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1463"></a><span>                            </span><span class="hs-special">(</span><a href="#local-1627447120"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447124"><span class="hs-identifier hs-var">pf</span></a><span> </span><a href="#local-1627447126"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1464"></a><span>                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447129"><a href="#local-1627447129"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447130"><a href="#local-1627447130"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447131"><a href="#local-1627447131"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447125"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447129"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447126"><span class="hs-identifier hs-var">sf</span></a><span>
</span><a name="line-1465"></a><span>                                        </span><a name="local-1627447132"><a href="#local-1627447132"><span class="hs-identifier">af'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447122"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447125"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447131"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1466"></a><span>                                        </span><span class="hs-special">(</span><a name="local-1627447133"><a href="#local-1627447133"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447134"><a href="#local-1627447134"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447121"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447130"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1467"></a><span>                                    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627447133"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447134"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447132"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1468"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447135"><a href="#local-1627447135"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447136"><a href="#local-1627447136"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447137"><a href="#local-1627447137"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447138"><a href="#local-1627447138"><span class="hs-identifier">gpf</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447139"><a href="#local-1627447139"><span class="hs-identifier">gf</span></a></a><span class="hs-special">,</span><a name="local-1627447140"><a href="#local-1627447140"><span class="hs-identifier">pf</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447141"><a href="#local-1627447141"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447142"><a href="#local-1627447142"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1469"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447143"><a href="#local-1627447143"><span class="hs-identifier">ag'</span></a></a><span> </span><a name="local-1627447144"><a href="#local-1627447144"><span class="hs-identifier">sf'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627447143"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447138"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447141"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447144"><span class="hs-identifier hs-var">sf'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447135"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627447139"><span class="hs-identifier hs-var">gf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1470"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447136"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447140"><span class="hs-identifier hs-var">pf</span></a><span> </span><a href="#local-1627447142"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1471"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447145"><a href="#local-1627447145"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1472"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447146"><a href="#local-1627447146"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447147"><a href="#local-1627447147"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447141"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447145"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447142"><span class="hs-identifier hs-var">sf</span></a><span>
</span><a name="line-1473"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><a name="local-1627447148"><a href="#local-1627447148"><span class="hs-identifier">af'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447138"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447141"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447147"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1474"></a><span>                                     </span><span class="hs-special">(</span><a name="local-1627447149"><a href="#local-1627447149"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447150"><a href="#local-1627447150"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447137"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447146"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1475"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447149"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447150"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447148"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1476"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447151"><a href="#local-1627447151"><span class="hs-identifier">lg</span></a></a><span> </span><a name="local-1627447152"><a href="#local-1627447152"><span class="hs-identifier">sg</span></a></a><span> </span><a name="local-1627447153"><a href="#local-1627447153"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447154"><a href="#local-1627447154"><span class="hs-identifier">lf</span></a></a><span> </span><a name="local-1627447155"><a href="#local-1627447155"><span class="hs-identifier">sf</span></a></a><span> </span><a name="local-1627447156"><a href="#local-1627447156"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1477"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627447151"><span class="hs-identifier hs-var">lg</span></a><span> </span><a href="#local-1627447154"><span class="hs-identifier hs-var">lf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1478"></a><span>                            </span><span class="hs-special">(</span><a href="#local-1627447152"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447155"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1479"></a><span>                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447157"><a href="#local-1627447157"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447158"><a href="#local-1627447158"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447159"><a href="#local-1627447159"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447156"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447157"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1480"></a><span>                                        </span><span class="hs-special">(</span><a name="local-1627447160"><a href="#local-1627447160"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447161"><a href="#local-1627447161"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447153"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447158"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1481"></a><span>                                    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627447160"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447161"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447159"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1482"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447162"><a href="#local-1627447162"><span class="hs-identifier">lg</span></a></a><span> </span><a name="local-1627447163"><a href="#local-1627447163"><span class="hs-identifier">sg</span></a></a><span> </span><a name="local-1627447164"><a href="#local-1627447164"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447165"><a href="#local-1627447165"><span class="hs-identifier">lf</span></a></a><span> </span><a name="local-1627447166"><a href="#local-1627447166"><span class="hs-identifier">sf</span></a></a><span> </span><a name="local-1627447167"><a href="#local-1627447167"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1483"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627447162"><span class="hs-identifier hs-var">lg</span></a><span> </span><a href="#local-1627447165"><span class="hs-identifier hs-var">lf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1484"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447163"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447166"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447168"><a href="#local-1627447168"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1486"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447169"><a href="#local-1627447169"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447170"><a href="#local-1627447170"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447167"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447168"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1487"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447171"><a href="#local-1627447171"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447172"><a href="#local-1627447172"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447164"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447169"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1488"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447171"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447172"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447170"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1489"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447173"><a href="#local-1627447173"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447174"><a href="#local-1627447174"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447175"><a href="#local-1627447175"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627447176"><a href="#local-1627447176"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1490"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447173"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1491"></a><span>                             </span><a href="#local-1627447174"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1492"></a><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447175"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447176"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1493"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447177"><a href="#local-1627447177"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447178"><a href="#local-1627447178"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447179"><a href="#local-1627447179"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627447180"><a href="#local-1627447180"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1494"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447177"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1495"></a><span>                             </span><a href="#local-1627447178"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1496"></a><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446916"><span class="hs-identifier hs-var">af</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447179"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><a href="#local-1627447180"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1497"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447181"><a href="#local-1627447181"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447182"><a href="#local-1627447182"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447183"><a href="#local-1627447183"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627447184"><a href="#local-1627447184"><span class="hs-identifier">gpf</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447185"><a href="#local-1627447185"><span class="hs-identifier">gf</span></a></a><span class="hs-special">,</span><a name="local-1627447186"><a href="#local-1627447186"><span class="hs-identifier">pf</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447187"><a href="#local-1627447187"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447188"><a href="#local-1627447188"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1498"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447189"><a href="#local-1627447189"><span class="hs-identifier">ag'</span></a></a><span> </span><a name="local-1627447190"><a href="#local-1627447190"><span class="hs-identifier">sf'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627447189"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447184"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447187"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447190"><span class="hs-identifier hs-var">sf'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447181"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627447185"><span class="hs-identifier hs-var">gf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1499"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447182"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447186"><span class="hs-identifier hs-var">pf</span></a><span> </span><a href="#local-1627447188"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1500"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447191"><a href="#local-1627447191"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1501"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447192"><a href="#local-1627447192"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447193"><a href="#local-1627447193"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447187"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447191"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447188"><span class="hs-identifier hs-var">sf</span></a><span>
</span><a name="line-1502"></a><span>                                     </span><a name="local-1627447194"><a href="#local-1627447194"><span class="hs-identifier">af'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627447184"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447187"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447193"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1503"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447195"><a href="#local-1627447195"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447196"><a href="#local-1627447196"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447183"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447192"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1504"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447195"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447196"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447194"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1505"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447197"><a href="#local-1627447197"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627447198"><a href="#local-1627447198"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627447199"><a href="#local-1627447199"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627447200"><a href="#local-1627447200"><span class="hs-identifier">gpf</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-1627447201"><a href="#local-1627447201"><span class="hs-identifier">gf</span></a></a><span class="hs-special">,</span><a name="local-1627447202"><a href="#local-1627447202"><span class="hs-identifier">pf</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1627447203"><a href="#local-1627447203"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627447204"><a href="#local-1627447204"><span class="hs-identifier">sf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1506"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627447205"><a href="#local-1627447205"><span class="hs-identifier">ag'</span></a></a><span> </span><a name="local-1627447206"><a href="#local-1627447206"><span class="hs-identifier">sf'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627447205"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447200"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447203"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447206"><span class="hs-identifier hs-var">sf'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627447197"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-1627447201"><span class="hs-identifier hs-var">gf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1507"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447198"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447202"><span class="hs-identifier hs-var">pf</span></a><span> </span><a href="#local-1627447204"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1508"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447207"><a href="#local-1627447207"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1509"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447208"><a href="#local-1627447208"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447209"><a href="#local-1627447209"><span class="hs-identifier">sf'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447203"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447207"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-1627447204"><span class="hs-identifier hs-var">sf</span></a><span>
</span><a name="line-1510"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><a name="local-1627447210"><a href="#local-1627447210"><span class="hs-identifier">af'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627447200"><span class="hs-identifier hs-var">gpf</span></a><span> </span><a href="#local-1627447203"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447209"><span class="hs-identifier hs-var">sf'</span></a><span>
</span><a name="line-1511"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447211"><a href="#local-1627447211"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447212"><a href="#local-1627447212"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447199"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447208"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1512"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447211"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447212"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447210"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1513"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447213"><a href="#local-1627447213"><span class="hs-identifier">lg</span></a></a><span> </span><a name="local-1627447214"><a href="#local-1627447214"><span class="hs-identifier">sg</span></a></a><span> </span><a name="local-1627447215"><a href="#local-1627447215"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627447216"><a href="#local-1627447216"><span class="hs-identifier">lf</span></a></a><span> </span><a name="local-1627447217"><a href="#local-1627447217"><span class="hs-identifier">sf</span></a></a><span> </span><a name="local-1627447218"><a href="#local-1627447218"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1514"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627447213"><span class="hs-identifier hs-var">lg</span></a><span> </span><a href="#local-1627447216"><span class="hs-identifier hs-var">lf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1515"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447214"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447217"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447219"><a href="#local-1627447219"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1517"></a><span>                                 </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627447220"><a href="#local-1627447220"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447221"><a href="#local-1627447221"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627447218"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447219"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1518"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447222"><a href="#local-1627447222"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447223"><a href="#local-1627447223"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447215"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447220"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1519"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447222"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447223"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447221"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1520"></a><span>                </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447224"><a href="#local-1627447224"><span class="hs-identifier">lg</span></a></a><span> </span><a name="local-1627447225"><a href="#local-1627447225"><span class="hs-identifier">sg</span></a></a><span> </span><a name="local-1627447226"><a href="#local-1627447226"><span class="hs-identifier">g</span></a></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627447227"><a href="#local-1627447227"><span class="hs-identifier">lf</span></a></a><span> </span><a name="local-1627447228"><a href="#local-1627447228"><span class="hs-identifier">sf</span></a></a><span> </span><a name="local-1627447229"><a href="#local-1627447229"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1521"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-1627447224"><span class="hs-identifier hs-var">lg</span></a><span> </span><a href="#local-1627447227"><span class="hs-identifier hs-var">lf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>                             </span><span class="hs-special">(</span><a href="#local-1627447225"><span class="hs-identifier hs-var">sg</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><a href="#local-1627447228"><span class="hs-identifier hs-var">sf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1523"></a><span>                             </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627447230"><a href="#local-1627447230"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1524"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447231"><a href="#local-1627447231"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447232"><a href="#local-1627447232"><span class="hs-identifier">af'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447229"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627447230"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1525"></a><span>                                 </span><span class="hs-special">(</span><a name="local-1627447233"><a href="#local-1627447233"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627447234"><a href="#local-1627447234"><span class="hs-identifier">ag'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627447226"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627447231"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1526"></a><span>                                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627447233"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627447234"><span class="hs-identifier hs-var">ag'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627447232"><span class="hs-identifier hs-var">af'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1527"></a><span>    </span><span class="hs-pragma">{-# INLINE (.) #-}</span><span>
</span><a name="line-1528"></a><span>
</span><a name="line-1529"></a><span class="hs-identifier">mergeStSt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Get</span><span> </span><a href="#local-1627446307"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446307"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span class="hs-special">)</span><span>
</span><a name="line-1530"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Get</span><span> </span><a href="#local-1627446308"><span class="hs-identifier hs-type">s'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446308"><span class="hs-identifier hs-type">s'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span class="hs-special">)</span><span>
</span><a name="line-1531"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><a href="#local-1627446307"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446308"><span class="hs-identifier hs-type">s'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627446307"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446308"><span class="hs-identifier hs-type">s'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Put</span><span class="hs-special">)</span><span>
</span><a name="line-1532"></a><a name="mergeStSt"><a href="Control.Auto.Core.html#mergeStSt"><span class="hs-identifier">mergeStSt</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627446650"><a href="#local-1627446650"><span class="hs-identifier">gg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446651"><a href="#local-1627446651"><span class="hs-identifier">pg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-1627446652"><a href="#local-1627446652"><span class="hs-identifier">gf</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446653"><a href="#local-1627446653"><span class="hs-identifier">pf</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-1627446650"><span class="hs-identifier hs-var">gg</span></a><span> </span><a href="#local-1627446652"><span class="hs-identifier hs-var">gf</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-1627446651"><span class="hs-identifier hs-var">pg</span></a><span> </span><span class="hs-operator hs-var">***</span><span> </span><a href="#local-1627446653"><span class="hs-identifier hs-var">pf</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1533"></a><span>
</span><a name="line-1534"></a><span class="hs-comment">-- | 'lmap' lets you map over the /input/ stream, and 'rmap' lets you map</span><span>
</span><a name="line-1535"></a><span class="hs-comment">-- over the /output/ stream.  Note that, as with all 'Profunctor's, 'rmap'</span><span>
</span><a name="line-1536"></a><span class="hs-comment">-- is 'fmap'.</span><span>
</span><a name="line-1537"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446839"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Profunctor</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446839"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1538"></a><span>    </span><a name="local-1912613836"><span class="hs-identifier">lmap</span></a><span> </span><a name="local-1627446840"><a href="#local-1627446840"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446841"><span class="hs-identifier hs-var">a_</span></a><span>
</span><a name="line-1539"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1540"></a><span>        </span><a name="local-1627446841"><a href="#local-1627446841"><span class="hs-identifier">a_</span></a></a><span> </span><a name="local-1627446842"><a href="#local-1627446842"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446842"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1541"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446843"><a href="#local-1627446843"><span class="hs-identifier">fa</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446843"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446840"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1542"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446844"><a href="#local-1627446844"><span class="hs-identifier">fa</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446844"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446840"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1543"></a><span>                 </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446845"><a href="#local-1627446845"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446846"><a href="#local-1627446846"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446847"><a href="#local-1627446847"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446845"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446846"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446840"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446847"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1544"></a><span>                 </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446848"><a href="#local-1627446848"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446849"><a href="#local-1627446849"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446850"><a href="#local-1627446850"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446848"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446849"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446840"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446850"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1545"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446851"><a href="#local-1627446851"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446852"><a href="#local-1627446852"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446853"><a href="#local-1627446853"><span class="hs-identifier">fa</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446841"><span class="hs-identifier hs-var">a_</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446851"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1546"></a><span>                                                </span><a href="#local-1627446852"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1547"></a><span>                                              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446854"><a href="#local-1627446854"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446855"><a href="#local-1627446855"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446856"><a href="#local-1627446856"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446853"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446840"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446854"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1548"></a><span>                                                      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446855"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446841"><span class="hs-identifier hs-var">a_</span></a><span> </span><a href="#local-1627446856"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1549"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446857"><a href="#local-1627446857"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446858"><a href="#local-1627446858"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446859"><a href="#local-1627446859"><span class="hs-identifier">fa</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446841"><span class="hs-identifier hs-var">a_</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446857"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1550"></a><span>                                                 </span><a href="#local-1627446858"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1551"></a><span>                                              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446860"><a href="#local-1627446860"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1552"></a><span>                                                  </span><span class="hs-special">(</span><a name="local-1627446861"><a href="#local-1627446861"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446862"><a href="#local-1627446862"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446859"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446840"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446860"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1553"></a><span>                                                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446861"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446841"><span class="hs-identifier hs-var">a_</span></a><span> </span><a href="#local-1627446862"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1554"></a><span>    </span><span class="hs-pragma">{-# INLINE lmap #-}</span><span>
</span><a name="line-1555"></a><span>    </span><a name="local-1912613835"><span class="hs-identifier">rmap</span></a><span> </span><a name="local-1627446863"><a href="#local-1627446863"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446864"><span class="hs-identifier hs-var">a_</span></a><span>
</span><a name="line-1556"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1557"></a><span>        </span><a name="local-1627446864"><a href="#local-1627446864"><span class="hs-identifier">a_</span></a></a><span> </span><a name="local-1627446865"><a href="#local-1627446865"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446865"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1558"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446866"><a href="#local-1627446866"><span class="hs-identifier">fa</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446863"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446866"><span class="hs-identifier hs-var">fa</span></a><span class="hs-special">)</span><span>
</span><a name="line-1559"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446867"><a href="#local-1627446867"><span class="hs-identifier">fa</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="#local-1627446863"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446867"><span class="hs-identifier hs-var">fa</span></a><span class="hs-special">)</span><span>
</span><a name="line-1560"></a><span>                 </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446868"><a href="#local-1627446868"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446869"><a href="#local-1627446869"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446870"><a href="#local-1627446870"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446868"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446871"><a href="#local-1627446871"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446863"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446869"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446871"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446870"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1561"></a><span>                 </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446872"><a href="#local-1627446872"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446873"><a href="#local-1627446873"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446874"><a href="#local-1627446874"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446872"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446875"><a href="#local-1627446875"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446863"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446873"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446875"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446874"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1562"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446876"><a href="#local-1627446876"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446877"><a href="#local-1627446877"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446878"><a href="#local-1627446878"><span class="hs-identifier">fa</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446864"><span class="hs-identifier hs-var">a_</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446876"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><span>                                                </span><a href="#local-1627446877"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1564"></a><span>                                              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446879"><a href="#local-1627446879"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446880"><a href="#local-1627446880"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446881"><a href="#local-1627446881"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446878"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446879"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1565"></a><span>                                                      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446863"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446880"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446864"><span class="hs-identifier hs-var">a_</span></a><span> </span><a href="#local-1627446881"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446882"><a href="#local-1627446882"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446883"><a href="#local-1627446883"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446884"><a href="#local-1627446884"><span class="hs-identifier">fa</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446864"><span class="hs-identifier hs-var">a_</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446882"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1567"></a><span>                                                 </span><a href="#local-1627446883"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1568"></a><span>                                               </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446885"><a href="#local-1627446885"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1569"></a><span>                                                   </span><span class="hs-special">(</span><a name="local-1627446886"><a href="#local-1627446886"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446887"><a href="#local-1627446887"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446884"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446885"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1570"></a><span>                                                   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446863"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446886"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446864"><span class="hs-identifier hs-var">a_</span></a><span> </span><a href="#local-1627446887"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1571"></a><span>    </span><span class="hs-pragma">{-# INLINE rmap #-}</span><span>
</span><a name="line-1572"></a><span>    </span><a name="local-1912613837"><span class="hs-identifier">dimap</span></a><span> </span><a name="local-1627446888"><a href="#local-1627446888"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446889"><a href="#local-1627446889"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446890"><span class="hs-identifier hs-var">a_</span></a><span>
</span><a name="line-1573"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1574"></a><span>        </span><a name="local-1627446890"><a href="#local-1627446890"><span class="hs-identifier">a_</span></a></a><span> </span><a name="local-1627446891"><a href="#local-1627446891"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446891"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1575"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446892"><a href="#local-1627446892"><span class="hs-identifier">fa</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446889"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446892"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446888"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1576"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446893"><a href="#local-1627446893"><span class="hs-identifier">fa</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="#local-1627446889"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446893"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446888"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1577"></a><span>                 </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446894"><a href="#local-1627446894"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446895"><a href="#local-1627446895"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446896"><a href="#local-1627446896"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446894"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446897"><a href="#local-1627446897"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446889"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446895"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446888"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446897"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446896"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1578"></a><span>                 </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446898"><a href="#local-1627446898"><span class="hs-identifier">gpg</span></a></a><span> </span><a name="local-1627446899"><a href="#local-1627446899"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446900"><a href="#local-1627446900"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446898"><span class="hs-identifier hs-var">gpg</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446901"><a href="#local-1627446901"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446889"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446899"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446888"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446901"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627446900"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1579"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446902"><a href="#local-1627446902"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446903"><a href="#local-1627446903"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446904"><a href="#local-1627446904"><span class="hs-identifier">fa</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446890"><span class="hs-identifier hs-var">a_</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446902"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1580"></a><span>                                                </span><a href="#local-1627446903"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1581"></a><span>                                              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446905"><a href="#local-1627446905"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446906"><a href="#local-1627446906"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446907"><a href="#local-1627446907"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446904"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446888"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446905"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1582"></a><span>                                                      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><a href="#local-1627446889"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446906"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446890"><span class="hs-identifier hs-var">a_</span></a><span> </span><a href="#local-1627446907"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1583"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446908"><a href="#local-1627446908"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446909"><a href="#local-1627446909"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446910"><a href="#local-1627446910"><span class="hs-identifier">fa</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446890"><span class="hs-identifier hs-var">a_</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446908"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1584"></a><span>                                                 </span><a href="#local-1627446909"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1585"></a><span>                                               </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446911"><a href="#local-1627446911"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1586"></a><span>                                                   </span><span class="hs-special">(</span><a name="local-1627446912"><a href="#local-1627446912"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446913"><a href="#local-1627446913"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446910"><span class="hs-identifier hs-var">fa</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446888"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446911"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1587"></a><span>                                                   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627446889"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-1627446912"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446890"><span class="hs-identifier hs-var">a_</span></a><span> </span><a href="#local-1627446913"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1588"></a><span>    </span><span class="hs-pragma">{-# INLINE dimap #-}</span><span>
</span><a name="line-1589"></a><span>
</span><a name="line-1590"></a><span class="hs-comment">-- | See 'Arrow' instance.</span><span>
</span><a name="line-1591"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446838"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Strong</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446838"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1592"></a><span>    </span><a name="local-1912613755"><span class="hs-identifier">first'</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">first</span><span>
</span><a name="line-1593"></a><span>    </span><a name="local-1912613754"><span class="hs-identifier">second'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span>
</span><a name="line-1594"></a><span>
</span><a name="line-1595"></a><span class="hs-comment">-- | See 'ArrowChoice' instance</span><span>
</span><a name="line-1596"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446837"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Choice</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446837"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1597"></a><span>    </span><a name="local-1912613688"><span class="hs-identifier">left'</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">left</span><span>
</span><a name="line-1598"></a><span>    </span><a name="local-1912613687"><span class="hs-identifier">right'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">right</span><span>
</span><a name="line-1599"></a><span>
</span><a name="line-1600"></a><span class="hs-comment">-- | See 'ArrowLoop' instance</span><span>
</span><a name="line-1601"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadFix</span><span> </span><a href="#local-1627446836"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Costrong</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446836"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1602"></a><span>    </span><a name="local-1912613763"><span class="hs-identifier">unfirst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">loop</span><span>
</span><a name="line-1603"></a><span>
</span><a name="line-1604"></a><span class="hs-comment">-- | Gives us 'arr', which is a &quot;stateless&quot; 'Auto' that behaves just like</span><span>
</span><a name="line-1605"></a><span class="hs-comment">-- a function; its outputs are the function applied the corresponding</span><span>
</span><a name="line-1606"></a><span class="hs-comment">-- inputs.</span><span>
</span><a name="line-1607"></a><span class="hs-comment">--</span><span>
</span><a name="line-1608"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (arr negate) [1..10]</span><span>
</span><a name="line-1609"></a><span class="hs-comment">-- [-1,-2,-3,-4,-5,-6,-7,-8,-9,-10]</span><span>
</span><a name="line-1610"></a><span class="hs-comment">--</span><span>
</span><a name="line-1611"></a><span class="hs-comment">-- Also allows you to have an 'Auto' run on only the &quot;first&quot; or &quot;second&quot;</span><span>
</span><a name="line-1612"></a><span class="hs-comment">-- field in an input stream that is tuples...and also allows 'Auto's to run</span><span>
</span><a name="line-1613"></a><span class="hs-comment">-- side-by-side on an input stream of tuples (run each on either tuple</span><span>
</span><a name="line-1614"></a><span class="hs-comment">-- field).</span><span>
</span><a name="line-1615"></a><span class="hs-comment">--</span><span>
</span><a name="line-1616"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [4,6,8,7]</span><span>
</span><a name="line-1617"></a><span class="hs-comment">-- [4,10,18,25]</span><span>
</span><a name="line-1618"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (first (sumFrom 0)) [(4,True),(6,False),(8,False),(7,True)]</span><span>
</span><a name="line-1619"></a><span class="hs-comment">-- [(4,True),(10,False),(18,False),(25,True)]</span><span>
</span><a name="line-1620"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (productFrom 1) [1,3,5,2]</span><span>
</span><a name="line-1621"></a><span class="hs-comment">-- [1,3,15,30]</span><span>
</span><a name="line-1622"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (sumFrom 0 *** productFrom 1) [(4,1),(6,3),(8,5),(7,2)]</span><span>
</span><a name="line-1623"></a><span class="hs-comment">-- [(4,1),(10,3),(18,15),(25,30)]</span><span>
</span><a name="line-1624"></a><span class="hs-comment">--</span><span>
</span><a name="line-1625"></a><span class="hs-comment">-- Most importantly, however, allows for &quot;proc&quot; notation; see the</span><span>
</span><a name="line-1626"></a><span class="hs-comment">-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;!</span><span>
</span><a name="line-1627"></a><span class="hs-comment">-- for more details.</span><span>
</span><a name="line-1628"></a><span class="hs-comment">--</span><span>
</span><a name="line-1629"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446781"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Arrow</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446781"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1630"></a><span>    </span><a name="local-805306548"><span class="hs-identifier">arr</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkFunc"><span class="hs-identifier hs-var">mkFunc</span></a><span>
</span><a name="line-1631"></a><span>    </span><a name="local-805306550"><span class="hs-identifier">first</span></a><span> </span><a name="local-1627446782"><a href="#local-1627446782"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446782"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1632"></a><span>                </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446783"><a href="#local-1627446783"><span class="hs-identifier">f</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1633"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446783"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1634"></a><span>                </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446784"><a href="#local-1627446784"><span class="hs-identifier">f</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1635"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#firstM"><span class="hs-identifier hs-var">firstM</span></a><span> </span><a href="#local-1627446784"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1636"></a><span>                </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446785"><a href="#local-1627446785"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446786"><a href="#local-1627446786"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446787"><a href="#local-1627446787"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1637"></a><span>                    </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446785"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446788"><a href="#local-1627446788"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446789"><a href="#local-1627446789"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><a href="#local-1627446789"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446786"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446788"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446787"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1638"></a><span>                </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446790"><a href="#local-1627446790"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446791"><a href="#local-1627446791"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446792"><a href="#local-1627446792"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1639"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446790"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446793"><a href="#local-1627446793"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446794"><a href="#local-1627446794"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><a href="#local-1627446794"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446791"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446793"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446792"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1640"></a><span>                </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446795"><a href="#local-1627446795"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446796"><a href="#local-1627446796"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446797"><a href="#local-1627446797"><span class="hs-identifier">f</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1641"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446795"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1642"></a><span>                            </span><a href="#local-1627446796"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1643"></a><span>                          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446798"><a href="#local-1627446798"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446799"><a href="#local-1627446799"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446800"><a href="#local-1627446800"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446801"><a href="#local-1627446801"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446797"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446798"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1644"></a><span>                                       </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627446800"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446799"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446801"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1645"></a><span>                </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446802"><a href="#local-1627446802"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446803"><a href="#local-1627446803"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446804"><a href="#local-1627446804"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1646"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446802"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1647"></a><span>                             </span><a href="#local-1627446803"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1648"></a><span>                           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446805"><a href="#local-1627446805"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446806"><a href="#local-1627446806"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1649"></a><span>                               </span><span class="hs-special">(</span><a name="local-1627446807"><a href="#local-1627446807"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446808"><a href="#local-1627446808"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446804"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446805"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1650"></a><span>                               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627446807"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446806"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><a href="#local-1627446808"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1651"></a><span>    </span><a name="local-1912606249"><span class="hs-identifier">second</span></a><span> </span><a name="local-1627446809"><a href="#local-1627446809"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446809"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1652"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446810"><a href="#local-1627446810"><span class="hs-identifier">f</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1653"></a><span>                     </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><a href="#local-1627446810"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1654"></a><span>                 </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446811"><a href="#local-1627446811"><span class="hs-identifier">f</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1655"></a><span>                     </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#secondM"><span class="hs-identifier hs-var">secondM</span></a><span> </span><a href="#local-1627446811"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1656"></a><span>                 </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446812"><a href="#local-1627446812"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446813"><a href="#local-1627446813"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446814"><a href="#local-1627446814"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1657"></a><span>                     </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446812"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446815"><a href="#local-1627446815"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446816"><a href="#local-1627446816"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><a href="#local-1627446815"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446813"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446816"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446814"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1658"></a><span>                 </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446817"><a href="#local-1627446817"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446818"><a href="#local-1627446818"><span class="hs-identifier">fa</span></a></a><span> </span><a name="local-1627446819"><a href="#local-1627446819"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1659"></a><span>                     </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446817"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446820"><a href="#local-1627446820"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446821"><a href="#local-1627446821"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-special">(</span><a href="#local-1627446820"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627446818"><span class="hs-identifier hs-var">fa</span></a><span> </span><a href="#local-1627446821"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446819"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1660"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446822"><a href="#local-1627446822"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446823"><a href="#local-1627446823"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446824"><a href="#local-1627446824"><span class="hs-identifier">f</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1661"></a><span>                     </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446822"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1662"></a><span>                             </span><a href="#local-1627446823"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1663"></a><span>                           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446825"><a href="#local-1627446825"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446826"><a href="#local-1627446826"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627446827"><a href="#local-1627446827"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446828"><a href="#local-1627446828"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446824"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446826"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1664"></a><span>                                        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627446825"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446827"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><a href="#local-1627446828"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1665"></a><span>                 </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446829"><a href="#local-1627446829"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446830"><a href="#local-1627446830"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446831"><a href="#local-1627446831"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1666"></a><span>                     </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446829"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1667"></a><span>                              </span><a href="#local-1627446830"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1668"></a><span>                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627446832"><a href="#local-1627446832"><span class="hs-identifier">z</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446833"><a href="#local-1627446833"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1669"></a><span>                                </span><span class="hs-special">(</span><a name="local-1627446834"><a href="#local-1627446834"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446835"><a href="#local-1627446835"><span class="hs-identifier">a'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627446831"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446833"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1670"></a><span>                                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-1627446832"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446834"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><a href="#local-1627446835"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1671"></a><span>
</span><a name="line-1672"></a><span class="hs-comment">-- | Allows you to have an 'Auto' only act on &quot;some&quot; inputs (only on</span><span>
</span><a name="line-1673"></a><span class="hs-comment">-- 'Left's, for example), and be &quot;paused&quot; otherwise.</span><span>
</span><a name="line-1674"></a><span class="hs-comment">--</span><span>
</span><a name="line-1675"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1,4,2,5]</span><span>
</span><a name="line-1676"></a><span class="hs-comment">-- [1,5,7,12]</span><span>
</span><a name="line-1677"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (left (sumFrom 0)) [Left 1, Right 'a', Left 4, Left 2, Right 'b', Left 5]</span><span>
</span><a name="line-1678"></a><span class="hs-comment">-- [Left 1, Right 'a', Left 5, Left 6, Right 'b', Left 12]</span><span>
</span><a name="line-1679"></a><span class="hs-comment">--</span><span>
</span><a name="line-1680"></a><span class="hs-comment">-- Again mostly useful for &quot;proc&quot; notation, with branching.</span><span>
</span><a name="line-1681"></a><span class="hs-comment">--</span><span>
</span><a name="line-1682"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446717"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ArrowChoice</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446717"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1683"></a><span>    </span><a name="local-1912606260"><span class="hs-identifier">left</span></a><span> </span><a name="local-1627446718"><a href="#local-1627446718"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446719"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1684"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1685"></a><span>        </span><a name="local-1627446719"><a href="#local-1627446719"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446718"><span class="hs-identifier hs-var">a0</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1686"></a><span>              </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446720"><a href="#local-1627446720"><span class="hs-identifier">f</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1687"></a><span>                  </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">left</span><span> </span><a href="#local-1627446720"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1688"></a><span>              </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446721"><a href="#local-1627446721"><span class="hs-identifier">f</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1689"></a><span>                  </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446722"><a href="#local-1627446722"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446722"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1690"></a><span>                               </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446723"><a href="#local-1627446723"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627446723"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1691"></a><span>                               </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446724"><a href="#local-1627446724"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="#local-1627446721"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446724"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1692"></a><span>              </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446725"><a href="#local-1627446725"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446726"><a href="#local-1627446726"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446727"><a href="#local-1627446727"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1693"></a><span>                  </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446725"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446728"><a href="#local-1627446728"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446729"><a href="#local-1627446729"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446728"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1694"></a><span>                                  </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446730"><a href="#local-1627446730"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627446730"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446729"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1695"></a><span>                                  </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446731"><a href="#local-1627446731"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="#local-1627446726"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446731"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627446729"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1696"></a><span>                               </span><span class="hs-special">)</span><span> </span><a href="#local-1627446727"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1697"></a><span>              </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446732"><a href="#local-1627446732"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446733"><a href="#local-1627446733"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446734"><a href="#local-1627446734"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1698"></a><span>                  </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446732"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446735"><a href="#local-1627446735"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446736"><a href="#local-1627446736"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446735"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1699"></a><span>                                   </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446737"><a href="#local-1627446737"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627446737"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446736"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1700"></a><span>                                   </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446738"><a href="#local-1627446738"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">Left</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446733"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446738"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627446736"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1701"></a><span>                                </span><span class="hs-special">)</span><span> </span><a href="#local-1627446734"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1702"></a><span>              </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446739"><a href="#local-1627446739"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446740"><a href="#local-1627446740"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446741"><a href="#local-1627446741"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1703"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">left</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446739"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1704"></a><span>                          </span><a href="#local-1627446740"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1705"></a><span>                        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446742"><a href="#local-1627446742"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446742"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1706"></a><span>                                  </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446743"><a href="#local-1627446743"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627446743"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446719"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1707"></a><span>                                  </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446744"><a href="#local-1627446744"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">left</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446741"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446744"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1708"></a><span>              </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446745"><a href="#local-1627446745"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446746"><a href="#local-1627446746"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446747"><a href="#local-1627446747"><span class="hs-identifier">f</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1709"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">left</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446745"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1710"></a><span>                           </span><a href="#local-1627446746"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1711"></a><span>                         </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446748"><a href="#local-1627446748"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446748"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1712"></a><span>                                   </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446749"><a href="#local-1627446749"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1627446749"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446719"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1713"></a><span>                                   </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446750"><a href="#local-1627446750"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">left</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446747"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446750"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1714"></a><span>    </span><span class="hs-pragma">{-# INLINE left #-}</span><span>
</span><a name="line-1715"></a><span>    </span><a name="local-1912606259"><span class="hs-identifier">right</span></a><span> </span><a name="local-1627446751"><a href="#local-1627446751"><span class="hs-identifier">a0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627446752"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1716"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1717"></a><span>        </span><a name="local-1627446752"><a href="#local-1627446752"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446751"><span class="hs-identifier hs-var">a0</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1718"></a><span>              </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446753"><a href="#local-1627446753"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1719"></a><span>                  </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627446753"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1720"></a><span>              </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446754"><a href="#local-1627446754"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1721"></a><span>                  </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-1627446754"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1722"></a><span>              </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446755"><a href="#local-1627446755"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446756"><a href="#local-1627446756"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446757"><a href="#local-1627446757"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1723"></a><span>                  </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446755"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446758"><a href="#local-1627446758"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446759"><a href="#local-1627446759"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446758"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1724"></a><span>                                  </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446760"><a href="#local-1627446760"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627446760"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446759"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1725"></a><span>                                  </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446761"><a href="#local-1627446761"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-1627446756"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446761"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627446759"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1726"></a><span>                               </span><span class="hs-special">)</span><span> </span><a href="#local-1627446757"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1727"></a><span>              </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446762"><a href="#local-1627446762"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446763"><a href="#local-1627446763"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446764"><a href="#local-1627446764"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1728"></a><span>                  </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446762"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446765"><a href="#local-1627446765"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446766"><a href="#local-1627446766"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446765"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1729"></a><span>                                   </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446767"><a href="#local-1627446767"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627446767"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446766"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1730"></a><span>                                   </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446768"><a href="#local-1627446768"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">Right</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446763"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446768"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-1627446766"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1731"></a><span>                                </span><span class="hs-special">)</span><span> </span><a href="#local-1627446764"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1732"></a><span>              </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446769"><a href="#local-1627446769"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446770"><a href="#local-1627446770"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446771"><a href="#local-1627446771"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1733"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">right</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446769"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1734"></a><span>                          </span><a href="#local-1627446770"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1735"></a><span>                        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446772"><a href="#local-1627446772"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446772"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1736"></a><span>                                  </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446773"><a href="#local-1627446773"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627446773"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446752"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1737"></a><span>                                  </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446774"><a href="#local-1627446774"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">right</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446771"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446774"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1738"></a><span>              </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446775"><a href="#local-1627446775"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446776"><a href="#local-1627446776"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446777"><a href="#local-1627446777"><span class="hs-identifier">f</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1739"></a><span>                  </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">right</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446775"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1740"></a><span>                           </span><a href="#local-1627446776"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1741"></a><span>                         </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446778"><a href="#local-1627446778"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446778"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1742"></a><span>                                   </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1627446779"><a href="#local-1627446779"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1627446779"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446752"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1743"></a><span>                                   </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627446780"><a href="#local-1627446780"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">right</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446777"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446780"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1744"></a><span>    </span><span class="hs-pragma">{-# INLINE right #-}</span><span>
</span><a name="line-1745"></a><span>
</span><a name="line-1746"></a><span class="hs-comment">-- | Finds the fixed point of self-referential 'Auto's (for example,</span><span>
</span><a name="line-1747"></a><span class="hs-comment">-- feeding the output stream of an 'Auto' to itself).  Mostly used with</span><span>
</span><a name="line-1748"></a><span class="hs-comment">-- proc notation to allow recursive bindings.</span><span>
</span><a name="line-1749"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadFix</span><span> </span><a href="#local-1627446678"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ArrowLoop</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446678"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1750"></a><span>    </span><a name="local-805306553"><span class="hs-identifier">loop</span></a><span> </span><a name="local-1627446679"><a href="#local-1627446679"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627446679"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1751"></a><span>                </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><a name="local-1627446680"><a href="#local-1627446680"><span class="hs-identifier">f</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1752"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFunc"><span class="hs-identifier hs-var">AutoFunc</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446681"><a href="#local-1627446681"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fix</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446691"><a href="#local-1627446691"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446680"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446681"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446691"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1753"></a><span>                </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><a name="local-1627446692"><a href="#local-1627446692"><span class="hs-identifier">f</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1754"></a><span>                    </span><a href="Control.Auto.Core.html#AutoFuncM"><span class="hs-identifier hs-var">AutoFuncM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446693"><a href="#local-1627446693"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mfix</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446694"><a href="#local-1627446694"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446692"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446693"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446694"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1755"></a><span>                </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a name="local-1627446695"><a href="#local-1627446695"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446696"><a href="#local-1627446696"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446697"><a href="#local-1627446697"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1756"></a><span>                    </span><a href="Control.Auto.Core.html#AutoState"><span class="hs-identifier hs-var">AutoState</span></a><span> </span><a href="#local-1627446695"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446698"><a href="#local-1627446698"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446699"><a href="#local-1627446699"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fix</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446700"><a href="#local-1627446700"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446696"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446698"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446700"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446699"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446697"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1757"></a><span>                </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a name="local-1627446701"><a href="#local-1627446701"><span class="hs-identifier">gp</span></a></a><span> </span><a name="local-1627446702"><a href="#local-1627446702"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627446703"><a href="#local-1627446703"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1758"></a><span>                    </span><a href="Control.Auto.Core.html#AutoStateM"><span class="hs-identifier hs-var">AutoStateM</span></a><span> </span><a href="#local-1627446701"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627446704"><a href="#local-1627446704"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627446705"><a href="#local-1627446705"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mfix</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446706"><a href="#local-1627446706"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446702"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446704"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446706"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446705"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627446703"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1759"></a><span>                </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><a name="local-1627446707"><a href="#local-1627446707"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446708"><a href="#local-1627446708"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446709"><a href="#local-1627446709"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1760"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArb"><span class="hs-identifier hs-var">AutoArb</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">loop</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446707"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1761"></a><span>                            </span><a href="#local-1627446708"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1762"></a><span>                          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446710"><a href="#local-1627446710"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">loop</span><span class="hs-special">)</span><span>
</span><a name="line-1763"></a><span>                                </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fix</span><span>
</span><a name="line-1764"></a><span>                                </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446711"><a href="#local-1627446711"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446709"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446710"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446711"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-1765"></a><span>                </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><a name="local-1627446712"><a href="#local-1627446712"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-1627446713"><a href="#local-1627446713"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-1627446714"><a href="#local-1627446714"><span class="hs-identifier">f</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1766"></a><span>                    </span><a href="Control.Auto.Core.html#AutoArbM"><span class="hs-identifier hs-var">AutoArbM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">loop</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627446712"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1767"></a><span>                             </span><a href="#local-1627446713"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1768"></a><span>                           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627446715"><a href="#local-1627446715"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">***</span><span> </span><span class="hs-identifier hs-var">loop</span><span class="hs-special">)</span><span>
</span><a name="line-1769"></a><span>                                 </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mfix</span><span>
</span><a name="line-1770"></a><span>                                 </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627446716"><a href="#local-1627446716"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446714"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446715"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446716"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-1771"></a><span>    </span><span class="hs-pragma">{-# INLINE loop #-}</span><span>
</span><a name="line-1772"></a><span>
</span><a name="line-1773"></a><span class="hs-comment">-- Utility instances</span><span>
</span><a name="line-1774"></a><span>
</span><a name="line-1775"></a><span class="hs-comment">-- | Fork the input stream and '&lt;&gt;' the outputs.  See the 'Monoid'</span><span>
</span><a name="line-1776"></a><span class="hs-comment">-- instance.</span><span>
</span><a name="line-1777"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446675"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><a href="#local-1627446676"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446675"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446677"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446676"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1778"></a><span>    </span><span class="hs-special">(</span><a name="local-805306881"><span class="hs-operator">&lt;&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-1779"></a><span>
</span><a name="line-1780"></a><span class="hs-comment">-- | Fork the input stream and mappend the outputs.  'mempty' is a constant</span><span>
</span><a name="line-1781"></a><span class="hs-comment">-- stream of 'mempty's, ignoring its input.</span><span>
</span><a name="line-1782"></a><span class="hs-comment">--</span><span>
</span><a name="line-1783"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (mconcat [arr (take 3), accum (++) &quot;&quot;]) [&quot;hello&quot;,&quot;world&quot;,&quot;good&quot;,&quot;bye&quot;]</span><span>
</span><a name="line-1784"></a><span class="hs-comment">-- [&quot;helhello&quot;,&quot;worhelloworld&quot;,&quot;goohelloworldgood&quot;,&quot;byehelloworldgoodbye&quot;]</span><span>
</span><a name="line-1785"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446672"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="#local-1627446673"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446672"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446674"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446673"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1786"></a><span>    </span><a name="local-805306882"><span class="hs-identifier">mempty</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-1787"></a><span>    </span><a name="local-805306883"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-identifier hs-var">mappend</span><span>
</span><a name="line-1788"></a><span>
</span><a name="line-1789"></a><span class="hs-comment">-- | String literals in code will be 'Auto's that constanty produce that</span><span>
</span><a name="line-1790"></a><span class="hs-comment">-- string.</span><span>
</span><a name="line-1791"></a><span class="hs-comment">--</span><span>
</span><a name="line-1792"></a><span class="hs-comment">-- &gt;&gt;&gt; take 6 . streamAuto' (onFor 2 . &quot;hello&quot; --&gt; &quot;world&quot;) $ repeat ()</span><span>
</span><a name="line-1793"></a><span class="hs-comment">-- [&quot;hello&quot;,&quot;hello&quot;,&quot;world&quot;,&quot;world&quot;,&quot;world&quot;,&quot;world&quot;]</span><span>
</span><a name="line-1794"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446669"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IsString</span><span> </span><a href="#local-1627446670"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">IsString</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446669"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446671"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446670"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1795"></a><span>    </span><a name="local-805306554"><span class="hs-identifier">fromString</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromString</span><span>
</span><a name="line-1796"></a><span>
</span><a name="line-1797"></a><span class="hs-comment">-- | Fork the input stream and add, multiply, etc. the outputs.  'negate'</span><span>
</span><a name="line-1798"></a><span class="hs-comment">-- will negate the ouptput stream.  'fromInteger' will be a constant stream</span><span>
</span><a name="line-1799"></a><span class="hs-comment">-- of that 'Integer', so you can write 'Auto's using numerical literals in</span><span>
</span><a name="line-1800"></a><span class="hs-comment">-- code:</span><span>
</span><a name="line-1801"></a><span class="hs-comment">--</span><span>
</span><a name="line-1802"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1..10]</span><span>
</span><a name="line-1803"></a><span class="hs-comment">-- [1,3,6,10,15,21,28,36,45,55]</span><span>
</span><a name="line-1804"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' (4 + sumFrom 0) [1..10]</span><span>
</span><a name="line-1805"></a><span class="hs-comment">-- [5,7,10,14,19,25,32,40,49,59]</span><span>
</span><a name="line-1806"></a><span class="hs-comment">--</span><span>
</span><a name="line-1807"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446666"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-1627446667"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446666"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446668"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446667"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1808"></a><span>    </span><span class="hs-special">(</span><a name="local-1912608811"><span class="hs-operator">+</span></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span>
</span><a name="line-1809"></a><span>    </span><span class="hs-special">(</span><a name="local-1912608810"><span class="hs-operator">*</span></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span>
</span><a name="line-1810"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span>
</span><a name="line-1811"></a><span>    </span><a name="local-805306537"><span class="hs-identifier">negate</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">negate</span><span>
</span><a name="line-1812"></a><span>    </span><a name="local-1912608809"><span class="hs-identifier">abs</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">abs</span><span>
</span><a name="line-1813"></a><span>    </span><a name="local-1912608808"><span class="hs-identifier">signum</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">signum</span><span>
</span><a name="line-1814"></a><span>    </span><a name="local-805306528"><span class="hs-identifier">fromInteger</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span>
</span><a name="line-1815"></a><span>
</span><a name="line-1816"></a><span class="hs-comment">-- | Fork the input stream and divide the outputs.  'recip' maps 'recip' to</span><span>
</span><a name="line-1817"></a><span class="hs-comment">-- the output stream; 'fromRational' will be a constant stream of that</span><span>
</span><a name="line-1818"></a><span class="hs-comment">-- 'Rational', so you can write 'Auto's using numerical literals in code;</span><span>
</span><a name="line-1819"></a><span class="hs-comment">-- see 'Num' instance.</span><span>
</span><a name="line-1820"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446663"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><a href="#local-1627446664"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Fractional</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446663"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446665"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446664"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1821"></a><span>    </span><span class="hs-special">(</span><a name="local-1912608718"><span class="hs-operator">/</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/</span><span class="hs-special">)</span><span>
</span><a name="line-1822"></a><span>    </span><a name="local-1912608717"><span class="hs-identifier">recip</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">recip</span><span>
</span><a name="line-1823"></a><span>    </span><a name="local-805306530"><span class="hs-identifier">fromRational</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromRational</span><span>
</span><a name="line-1824"></a><span>
</span><a name="line-1825"></a><span class="hs-comment">-- | A bunch of constant producers, mappers-of-output-streams, and</span><span>
</span><a name="line-1826"></a><span class="hs-comment">-- forks-and-recombiners.</span><span>
</span><a name="line-1827"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446660"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Floating</span><span> </span><a href="#local-1627446661"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Floating</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627446660"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446662"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627446661"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1828"></a><span>    </span><a name="local-1912608578"><span class="hs-identifier">pi</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">pi</span><span>
</span><a name="line-1829"></a><span>    </span><a name="local-1912608577"><span class="hs-identifier">exp</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">exp</span><span>
</span><a name="line-1830"></a><span>    </span><a name="local-1912608575"><span class="hs-identifier">sqrt</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">sqrt</span><span>
</span><a name="line-1831"></a><span>    </span><a name="local-1912608576"><span class="hs-identifier">log</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">log</span><span>
</span><a name="line-1832"></a><span>    </span><span class="hs-special">(</span><a name="local-1912608574"><span class="hs-operator">**</span></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">**</span><span class="hs-special">)</span><span>
</span><a name="line-1833"></a><span>    </span><a name="local-1912608573"><span class="hs-identifier">logBase</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-identifier hs-var">logBase</span><span>
</span><a name="line-1834"></a><span>    </span><a name="local-1912608572"><span class="hs-identifier">sin</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">sin</span><span>
</span><a name="line-1835"></a><span>    </span><a name="local-1912608570"><span class="hs-identifier">tan</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">tan</span><span>
</span><a name="line-1836"></a><span>    </span><a name="local-1912608571"><span class="hs-identifier">cos</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">cos</span><span>
</span><a name="line-1837"></a><span>    </span><a name="local-1912608569"><span class="hs-identifier">asin</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">asin</span><span>
</span><a name="line-1838"></a><span>    </span><a name="local-1912608567"><span class="hs-identifier">atan</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">atan</span><span>
</span><a name="line-1839"></a><span>    </span><a name="local-1912608568"><span class="hs-identifier">acos</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">acos</span><span>
</span><a name="line-1840"></a><span>    </span><a name="local-1912608566"><span class="hs-identifier">sinh</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">sinh</span><span>
</span><a name="line-1841"></a><span>    </span><a name="local-1912608564"><span class="hs-identifier">tanh</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">tanh</span><span>
</span><a name="line-1842"></a><span>    </span><a name="local-1912608565"><span class="hs-identifier">cosh</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">cosh</span><span>
</span><a name="line-1843"></a><span>    </span><a name="local-1912608563"><span class="hs-identifier">asinh</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">asinh</span><span>
</span><a name="line-1844"></a><span>    </span><a name="local-1912608561"><span class="hs-identifier">atanh</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">atanh</span><span>
</span><a name="line-1845"></a><span>    </span><a name="local-1912608562"><span class="hs-identifier">acosh</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">acosh</span><span>
</span><a name="line-1846"></a><span>
</span><a name="line-1847"></a><span class="hs-comment">-- Utility functions</span><span>
</span><a name="line-1848"></a><span>
</span><a name="line-1849"></a><span class="hs-identifier">firstM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446303"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446304"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446303"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446305"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446304"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446306"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446303"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446305"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446306"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1850"></a><a name="firstM"><a href="Control.Auto.Core.html#firstM"><span class="hs-identifier">firstM</span></a></a><span> </span><a name="local-1627446654"><a href="#local-1627446654"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-1627446655"><a href="#local-1627446655"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446656"><a href="#local-1627446656"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><a href="#local-1627446656"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446654"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446655"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1851"></a><span class="hs-pragma">{-# INLINE firstM #-}</span><span>
</span><a name="line-1852"></a><span>
</span><a name="line-1853"></a><span class="hs-identifier">secondM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627446299"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446300"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446299"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627446301"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627446302"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446300"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627446299"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627446302"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627446301"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1854"></a><a name="secondM"><a href="Control.Auto.Core.html#secondM"><span class="hs-identifier">secondM</span></a></a><span> </span><a name="local-1627446657"><a href="#local-1627446657"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-1627446658"><a href="#local-1627446658"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627446659"><a href="#local-1627446659"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="#local-1627446658"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627446657"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627446659"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1855"></a><span class="hs-pragma">{-# INLINE secondM #-}</span><span>
</span><a name="line-1856"></a></pre></body></html>