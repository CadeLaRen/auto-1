<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Control/Auto/Core.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE ExistentialQuantification #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE TupleSections #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# OPTIONS_HADDOCK not-home #-}</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-comment'>-- |</span>
<a name="line-9"></a><span class='hs-comment'>-- Module      : Control.Auto.Core</span>
<a name="line-10"></a><span class='hs-comment'>-- Description : Core types, constructors, and utilities.</span>
<a name="line-11"></a><span class='hs-comment'>-- Copyright   : (c) Justin Le 2015</span>
<a name="line-12"></a><span class='hs-comment'>-- License     : MIT</span>
<a name="line-13"></a><span class='hs-comment'>-- Maintainer  : justin@jle.im</span>
<a name="line-14"></a><span class='hs-comment'>-- Stability   : unstable</span>
<a name="line-15"></a><span class='hs-comment'>-- Portability : portable</span>
<a name="line-16"></a><span class='hs-comment'>--</span>
<a name="line-17"></a><span class='hs-comment'>-- This module defines and provides the core types, (smart) constructors,</span>
<a name="line-18"></a><span class='hs-comment'>-- and general high and low-level utilities used by the /auto/ library.</span>
<a name="line-19"></a><span class='hs-comment'>--</span>
<a name="line-20"></a><span class='hs-comment'>-- Note that importing and using functions from this module in part voids</span>
<a name="line-21"></a><span class='hs-comment'>-- some of the "semantic contracts" of the 'Auto' types you get, so use</span>
<a name="line-22"></a><span class='hs-comment'>-- with caution!</span>
<a name="line-23"></a><span class='hs-comment'>--</span>
<a name="line-24"></a><span class='hs-comment'>-- A lot of low-level functionality is provided here which is most likely</span>
<a name="line-25"></a><span class='hs-comment'>-- unnecessary for most applications; many are mostly for internal usage or</span>
<a name="line-26"></a><span class='hs-comment'>-- advanced/fine-grained usage.  It also isn't really enough to do too many</span>
<a name="line-27"></a><span class='hs-comment'>-- useful things, either.  It's recommended that you import "Control.Auto"</span>
<a name="line-28"></a><span class='hs-comment'>-- instead, which re-organizes the more useful parts of this module in</span>
<a name="line-29"></a><span class='hs-comment'>-- addition with useful parts of others to provide a nice packaged entry</span>
<a name="line-30"></a><span class='hs-comment'>-- point.  If something in here becomes useful for more than just</span>
<a name="line-31"></a><span class='hs-comment'>-- fine-tuning or low-level tweaking, it is probably supposed to be in</span>
<a name="line-32"></a><span class='hs-comment'>-- "Control.Auto" anyway.</span>
<a name="line-33"></a><span class='hs-comment'>--</span>
<a name="line-34"></a><span class='hs-comment'>-- Information on how to use these types is available in the</span>
<a name="line-35"></a><span class='hs-comment'>-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;!</span>
<a name="line-36"></a><span class='hs-comment'>--</span>
<a name="line-37"></a>
<a name="line-38"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Auto</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span> <span class='hs-layout'>(</span>
<a name="line-39"></a>  <span class='hs-comment'>-- * Auto</span>
<a name="line-40"></a>  <span class='hs-comment'>-- ** Type</span>
<a name="line-41"></a>    <span class='hs-conid'>Auto</span>
<a name="line-42"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Auto'</span>
<a name="line-43"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>autoConstr</span>
<a name="line-44"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>toArb</span>
<a name="line-45"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>purifyAuto</span>
<a name="line-46"></a>  <span class='hs-comment'>-- ** Running</span>
<a name="line-47"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>stepAuto</span>
<a name="line-48"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>stepAuto'</span>
<a name="line-49"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>evalAuto</span>
<a name="line-50"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>evalAuto'</span>
<a name="line-51"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>execAuto</span>
<a name="line-52"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>execAuto'</span>
<a name="line-53"></a>  <span class='hs-comment'>-- ** Serializing</span>
<a name="line-54"></a>  <span class='hs-comment'>-- $serializing</span>
<a name="line-55"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>encodeAuto</span>
<a name="line-56"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>decodeAuto</span>
<a name="line-57"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>saveAuto</span>
<a name="line-58"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>resumeAuto</span>
<a name="line-59"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>unserialize</span>
<a name="line-60"></a>  <span class='hs-comment'>-- ** Underlying monad</span>
<a name="line-61"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>hoistA</span>
<a name="line-62"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>generalizeA</span>
<a name="line-63"></a>  <span class='hs-comment'>-- ** Special modifiers</span>
<a name="line-64"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>interceptO</span>
<a name="line-65"></a>  <span class='hs-comment'>-- * Auto constructors</span>
<a name="line-66"></a>  <span class='hs-comment'>-- ** Lifting values and functions</span>
<a name="line-67"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkConst</span>
<a name="line-68"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkConstM</span>
<a name="line-69"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkFunc</span>
<a name="line-70"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkFuncM</span>
<a name="line-71"></a>  <span class='hs-comment'>-- ** from State transformers</span>
<a name="line-72"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkState</span>
<a name="line-73"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkState_</span>
<a name="line-74"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkStateM</span>
<a name="line-75"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkStateM_</span>
<a name="line-76"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkState'</span>
<a name="line-77"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkStateM'</span>
<a name="line-78"></a>  <span class='hs-comment'>-- ** from Accumulators</span>
<a name="line-79"></a>  <span class='hs-comment'>-- *** Result-first</span>
<a name="line-80"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accum</span>
<a name="line-81"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accum_</span>
<a name="line-82"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accumM</span>
<a name="line-83"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accumM_</span>
<a name="line-84"></a>  <span class='hs-comment'>-- *** Initial accumulator-first</span>
<a name="line-85"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accumD</span>
<a name="line-86"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accumD_</span>
<a name="line-87"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accumMD</span>
<a name="line-88"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>accumMD_</span>
<a name="line-89"></a>  <span class='hs-comment'>-- ** Arbitrary Autos</span>
<a name="line-90"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkAuto</span>
<a name="line-91"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkAuto_</span>
<a name="line-92"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkAutoM</span>
<a name="line-93"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mkAutoM_</span>
<a name="line-94"></a>  <span class='hs-comment'>-- * Strictness</span>
<a name="line-95"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>forceSerial</span>
<a name="line-96"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>forcer</span>
<a name="line-97"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>seqer</span>
<a name="line-98"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-99"></a>
<a name="line-100"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span>
<a name="line-101"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span>
<a name="line-102"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Category</span>
<a name="line-103"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>DeepSeq</span>
<a name="line-104"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>hiding</span>   <span class='hs-layout'>(</span><span class='hs-varid'>sequence</span><span class='hs-layout'>)</span>
<a name="line-105"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Fix</span>
<a name="line-106"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>empty</span><span class='hs-layout'>)</span>
<a name="line-107"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Functor</span><span class='hs-varop'>.</span><span class='hs-conid'>Identity</span>
<a name="line-108"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Orphans</span>           <span class='hs-conid'>()</span>
<a name="line-109"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Profunctor</span>
<a name="line-110"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Semigroup</span>
<a name="line-111"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Serialize</span>
<a name="line-112"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>String</span>
<a name="line-113"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Traversable</span>
<a name="line-114"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span>         <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequence</span><span class='hs-layout'>)</span>
<a name="line-115"></a>
<a name="line-116"></a><span class='hs-cpp'>#if MIN_VERSION_base(4,7,0)</span>
<a name="line-117"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span>
<a name="line-118"></a><span class='hs-cpp'>#endif</span>
<a name="line-119"></a>
<a name="line-120"></a>
<a name="line-121"></a><a name="Auto"></a><span class='hs-comment'>-- | The 'Auto' type.  For this library, an 'Auto' semantically</span>
<a name="line-122"></a><a name="Auto"></a><span class='hs-comment'>-- represents/denotes a /a relationship/ between an input and an</span>
<a name="line-123"></a><a name="Auto"></a><span class='hs-comment'>-- output that is preserved over multiple steps, where that relationship is</span>
<a name="line-124"></a><a name="Auto"></a><span class='hs-comment'>-- (optionally) maintained within the context of a monad.</span>
<a name="line-125"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-126"></a><a name="Auto"></a><span class='hs-comment'>-- A lot of fancy words, I know...but you can think of an 'Auto' as nothing</span>
<a name="line-127"></a><a name="Auto"></a><span class='hs-comment'>-- more than a "stream transformer" of value streams.  A stream of</span>
<a name="line-128"></a><a name="Auto"></a><span class='hs-comment'>-- sequential input values come in one at a time, and a stream of outputs</span>
<a name="line-129"></a><a name="Auto"></a><span class='hs-comment'>-- pop out one at a time, as well.</span>
<a name="line-130"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-131"></a><a name="Auto"></a><span class='hs-comment'>-- Using the 'streamAuto' function, you can "unwrap" the inner value stream</span>
<a name="line-132"></a><a name="Auto"></a><span class='hs-comment'>-- transformer from any 'Auto': if @a :: 'Auto' m a b@, 'streamAuto' lets</span>
<a name="line-133"></a><a name="Auto"></a><span class='hs-comment'>-- you turn it into an @[a] -&gt; m [b]@.  "Give me a stream of @a@s, one at</span>
<a name="line-134"></a><a name="Auto"></a><span class='hs-comment'>-- a time, and I'll give you a list of @b@s, matching a relationship to</span>
<a name="line-135"></a><a name="Auto"></a><span class='hs-comment'>-- your stream of @a@s."</span>
<a name="line-136"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-137"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-138"></a><a name="Auto"></a><span class='hs-comment'>-- -- unwrap your inner [a] -&gt; m [b]!</span>
<a name="line-139"></a><a name="Auto"></a><span class='hs-comment'>-- 'streamAuto' :: Monad m =&gt; 'Auto' m a b -&gt; ([a] -&gt; m [b])</span>
<a name="line-140"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-141"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-142"></a><a name="Auto"></a><span class='hs-comment'>-- You can also turn an @'Auto' m a b@ into an /effects stream/ that</span>
<a name="line-143"></a><a name="Auto"></a><span class='hs-comment'>-- executes effects sequentially with 'toEffectStream' and</span>
<a name="line-144"></a><a name="Auto"></a><span class='hs-comment'>-- 'streamAutoEffects', so you can run it with a ListT-compatible library</span>
<a name="line-145"></a><a name="Auto"></a><span class='hs-comment'>-- like /pipes/.</span>
<a name="line-146"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-147"></a><a name="Auto"></a><span class='hs-comment'>-- There's a handy type synonym 'Auto'' for relationships that don't really</span>
<a name="line-148"></a><a name="Auto"></a><span class='hs-comment'>-- need a monadic context; the @m@ is just 'Identity':</span>
<a name="line-149"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-150"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-151"></a><a name="Auto"></a><span class='hs-comment'>-- type Auto' = Auto Identity</span>
<a name="line-152"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-153"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-154"></a><a name="Auto"></a><span class='hs-comment'>-- So if you had an @a :: 'Auto'' a b@, you can use 'streamAuto'' to</span>
<a name="line-155"></a><a name="Auto"></a><span class='hs-comment'>-- "unwrap" the inner stream transformer, @[a] -&gt; [b]@.</span>
<a name="line-156"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-157"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-158"></a><a name="Auto"></a><span class='hs-comment'>-- -- unwrap your inner [a] -&gt; [b]!</span>
<a name="line-159"></a><a name="Auto"></a><span class='hs-comment'>-- 'streamAuto'' :: 'Auto'' a b -&gt; ([a] -&gt; [b])</span>
<a name="line-160"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-161"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-162"></a><a name="Auto"></a><span class='hs-comment'>-- All of the 'Auto's given in this library maintain some sort of semantic</span>
<a name="line-163"></a><a name="Auto"></a><span class='hs-comment'>-- relationship between streams --- for some, the outputs might be the</span>
<a name="line-164"></a><a name="Auto"></a><span class='hs-comment'>-- inputs with a function applied; for others, the outputs might be the</span>
<a name="line-165"></a><a name="Auto"></a><span class='hs-comment'>-- cumulative sum of the inputs.</span>
<a name="line-166"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-167"></a><a name="Auto"></a><span class='hs-comment'>-- See the</span>
<a name="line-168"></a><a name="Auto"></a><span class='hs-comment'>-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;</span>
<a name="line-169"></a><a name="Auto"></a><span class='hs-comment'>-- for more information!</span>
<a name="line-170"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-171"></a><a name="Auto"></a><span class='hs-comment'>-- Operationally, an  @'Auto' m a b@ is implemented as a "stateful</span>
<a name="line-172"></a><a name="Auto"></a><span class='hs-comment'>-- function".  A function from an @a@ where, every time you "apply" it, you</span>
<a name="line-173"></a><a name="Auto"></a><span class='hs-comment'>-- get a @b@ and an "updated 'Auto'"/function with updated state.</span>
<a name="line-174"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-175"></a><a name="Auto"></a><span class='hs-comment'>-- You can get this function using 'stepAuto':</span>
<a name="line-176"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-177"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-178"></a><a name="Auto"></a><span class='hs-comment'>-- 'stepAuto' :: 'Auto' m a b -&gt; (a -&gt; m (b, 'Auto' m a b))</span>
<a name="line-179"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-180"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-181"></a><a name="Auto"></a><span class='hs-comment'>-- Or, for 'Auto'', 'stepAuto'':</span>
<a name="line-182"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-183"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-184"></a><a name="Auto"></a><span class='hs-comment'>-- 'stepAuto'' :: 'Auto'' a b -&gt; (a -&gt; (b, 'Auto'' a b))</span>
<a name="line-185"></a><a name="Auto"></a><span class='hs-comment'>-- @</span>
<a name="line-186"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-187"></a><a name="Auto"></a><span class='hs-comment'>-- "Give me an @a@ and I'll give you a @b@ and your "updated" 'Auto'".</span>
<a name="line-188"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-189"></a><a name="Auto"></a><span class='hs-comment'>-- 'Auto's really are mostly useful because they can be composed, chained,</span>
<a name="line-190"></a><a name="Auto"></a><span class='hs-comment'>-- and modified using their various typeclass instances, like 'Category',</span>
<a name="line-191"></a><a name="Auto"></a><span class='hs-comment'>-- 'Applicative', 'Functor', 'Arrow', etc., and also with the combinators</span>
<a name="line-192"></a><a name="Auto"></a><span class='hs-comment'>-- in this library.  You can build complex programs as a complex 'Auto' by</span>
<a name="line-193"></a><a name="Auto"></a><span class='hs-comment'>-- building up smaller and smaller components.  See the tutorial for more</span>
<a name="line-194"></a><a name="Auto"></a><span class='hs-comment'>-- information on this.</span>
<a name="line-195"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-196"></a><a name="Auto"></a><span class='hs-comment'>-- This type also contains information on its own serialization, so you can</span>
<a name="line-197"></a><a name="Auto"></a><span class='hs-comment'>-- serialize and re-load the internal state to binary or disk.  See the</span>
<a name="line-198"></a><a name="Auto"></a><span class='hs-comment'>-- "serialization" section in the documentation for "Control.Auto.Core", or</span>
<a name="line-199"></a><a name="Auto"></a><span class='hs-comment'>-- the documentation for 'mkAutoM' for more details.</span>
<a name="line-200"></a><a name="Auto"></a><span class='hs-comment'>--</span>
<a name="line-201"></a><a name="Auto"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span>           <span class='hs-conid'>AutoFunc</span>    <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-202"></a>                <span class='hs-keyglyph'>|</span>           <span class='hs-conid'>AutoFuncM</span>   <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-203"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>AutoState</span>   <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span><span class='hs-layout'>)</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-varop'>!</span><span class='hs-varid'>s</span>
<a name="line-204"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>s</span><span class='hs-varop'>.</span> <span class='hs-conid'>AutoStateM</span>  <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span><span class='hs-layout'>)</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>!</span><span class='hs-varid'>s</span>
<a name="line-205"></a>                <span class='hs-keyglyph'>|</span>           <span class='hs-conid'>AutoArb</span>     <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>Put</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-206"></a>                <span class='hs-keyglyph'>|</span>           <span class='hs-conid'>AutoArbM</span>    <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>Put</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-207"></a><span class='hs-cpp'>#if MIN_VERSION_base(4,7,0)</span>
<a name="line-208"></a>                <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Typeable</span> <span class='hs-layout'>)</span>
<a name="line-209"></a><span class='hs-cpp'>#endif</span>
<a name="line-210"></a>
<a name="line-211"></a>
<a name="line-212"></a><a name="Auto'"></a><span class='hs-comment'>-- | Special case of 'Auto' where the underlying 'Monad' is 'Identity'.</span>
<a name="line-213"></a><a name="Auto'"></a><span class='hs-comment'>--</span>
<a name="line-214"></a><a name="Auto'"></a><span class='hs-comment'>-- Instead of "wrapping" an @[a] -&gt; m [b]@, it "wraps" an @[a] -&gt; [b]@.</span>
<a name="line-215"></a><a name="Auto'"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Auto'</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Auto</span> <span class='hs-conid'>Identity</span>
<a name="line-216"></a>
<a name="line-217"></a>
<a name="line-218"></a><a name="toArb"></a><span class='hs-comment'>-- | Re-structure 'Auto' internals to use the 'Arb' ("arbitrary")</span>
<a name="line-219"></a><span class='hs-comment'>-- constructors, as recursion-based mealy machines.</span>
<a name="line-220"></a><span class='hs-comment'>--</span>
<a name="line-221"></a><span class='hs-comment'>-- Mostly here for performance comparisons and benchmarking purposes.</span>
<a name="line-222"></a><span class='hs-comment'>--</span>
<a name="line-223"></a><span class='hs-definition'>toArb</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-224"></a><span class='hs-definition'>toArb</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a_</span>
<a name="line-225"></a>  <span class='hs-keyword'>where</span>
<a name="line-226"></a>    <span class='hs-varid'>a_</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-227"></a>           <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArb</span>  <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varid'>a_</span><span class='hs-layout'>)</span>
<a name="line-228"></a>                                   <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-229"></a>                                 <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span><span class='hs-layout'>)</span>
<a name="line-230"></a>           <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varid'>a_</span><span class='hs-layout'>)</span>
<a name="line-231"></a>                                   <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-232"></a>                                 <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-233"></a>           <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span><span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-234"></a>               <span class='hs-keyword'>let</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>toArb</span> <span class='hs-varop'>.</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-235"></a>                                   <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-236"></a>                                 <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span>
<a name="line-237"></a>                                         <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>s''</span><span class='hs-layout'>)</span>
<a name="line-238"></a>               <span class='hs-keyword'>in</span>  <span class='hs-varid'>a'</span> <span class='hs-varid'>s</span>
<a name="line-239"></a>           <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span><span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-240"></a>               <span class='hs-keyword'>let</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>toArb</span> <span class='hs-varop'>.</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-241"></a>                                    <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-242"></a>                                  <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-243"></a>                                      <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span>
<a name="line-244"></a>                                      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span> <span class='hs-varid'>s''</span><span class='hs-layout'>)</span>
<a name="line-245"></a>               <span class='hs-keyword'>in</span>  <span class='hs-varid'>a'</span> <span class='hs-varid'>s</span>
<a name="line-246"></a>           <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>toArb</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-247"></a>                                    <span class='hs-varid'>s</span>
<a name="line-248"></a>                                  <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-249"></a>                                          <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>toArb</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-250"></a>           <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>toArb</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-251"></a>                                      <span class='hs-varid'>s</span>
<a name="line-252"></a>                                    <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-253"></a>                                        <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-254"></a>                                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>toArb</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-255"></a>
<a name="line-256"></a>
<a name="line-257"></a><a name="autoConstr"></a><span class='hs-comment'>-- | Returns a string representation of the internal constructor of the</span>
<a name="line-258"></a><span class='hs-comment'>-- 'Auto'.  Useful for debugging the result of compositions and functions</span>
<a name="line-259"></a><span class='hs-comment'>-- and seeing how they affect the internal structure of the 'Auto'.</span>
<a name="line-260"></a><span class='hs-comment'>--</span>
<a name="line-261"></a><span class='hs-comment'>-- In the order of efficiency, "AutoFunc"s tend to be faster than</span>
<a name="line-262"></a><span class='hs-comment'>-- "AutoState"s tend to be faster than "AutoArb"s.  However, when composing</span>
<a name="line-263"></a><span class='hs-comment'>-- one with the other (using 'Category' or 'Applicative'), the two have to</span>
<a name="line-264"></a><span class='hs-comment'>-- be "reduced" to the greatest common denominator; composing an "AutoFunc"</span>
<a name="line-265"></a><span class='hs-comment'>-- with an "AutoArb" produces an "AutoArb".</span>
<a name="line-266"></a><span class='hs-comment'>--</span>
<a name="line-267"></a><span class='hs-comment'>-- More benchmarking is to be done to be able to rigorously say what these</span>
<a name="line-268"></a><span class='hs-comment'>-- really mean, performance wise.</span>
<a name="line-269"></a><span class='hs-definition'>autoConstr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-270"></a><span class='hs-definition'>autoConstr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-str'>"AutoFunc"</span>
<a name="line-271"></a><span class='hs-definition'>autoConstr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"AutoFuncM"</span>
<a name="line-272"></a><span class='hs-definition'>autoConstr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"AutoState"</span>
<a name="line-273"></a><span class='hs-definition'>autoConstr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"AutoStateM"</span>
<a name="line-274"></a><span class='hs-definition'>autoConstr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-str'>"AutoArb"</span>
<a name="line-275"></a><span class='hs-definition'>autoConstr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-str'>"AutoArbM"</span>
<a name="line-276"></a>
<a name="line-277"></a><a name="hoistA"></a><span class='hs-comment'>-- | Swaps out the underlying 'Monad' of an 'Auto' using the given monad</span>
<a name="line-278"></a><span class='hs-comment'>-- morphism "transforming function", a natural transformation.</span>
<a name="line-279"></a><span class='hs-comment'>--</span>
<a name="line-280"></a><span class='hs-comment'>-- Basically, given a function to "swap out" any @m a@ with an @m' a@, it</span>
<a name="line-281"></a><span class='hs-comment'>-- swaps out the underlying monad of the 'Auto'.</span>
<a name="line-282"></a><span class='hs-comment'>--</span>
<a name="line-283"></a><span class='hs-comment'>-- This forms a functor, so you rest assured in things like this:</span>
<a name="line-284"></a><span class='hs-comment'>--</span>
<a name="line-285"></a><span class='hs-comment'>-- @</span>
<a name="line-286"></a><span class='hs-comment'>-- hoistA id == id</span>
<a name="line-287"></a><span class='hs-comment'>-- hoistA f a1 . hoistA f a2 == hoistA f (a1 . a2)</span>
<a name="line-288"></a><span class='hs-comment'>-- @</span>
<a name="line-289"></a><span class='hs-definition'>hoistA</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m'</span><span class='hs-layout'>)</span>
<a name="line-290"></a>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m'</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ monad morphism;</span>
<a name="line-291"></a>                                    <span class='hs-comment'>--     the natural transformation</span>
<a name="line-292"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-293"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-294"></a><span class='hs-definition'>hoistA</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>
<a name="line-295"></a><span class='hs-definition'>hoistA</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-296"></a><span class='hs-definition'>hoistA</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>
<a name="line-297"></a><span class='hs-definition'>hoistA</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-298"></a><span class='hs-definition'>hoistA</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>gt</span> <span class='hs-varid'>pt</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>hoistA</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-varid'>gt</span><span class='hs-layout'>)</span>
<a name="line-299"></a>                                       <span class='hs-varid'>pt</span>
<a name="line-300"></a>                                       <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-301"></a>                                               <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>hoistA</span> <span class='hs-varid'>g</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-302"></a><span class='hs-definition'>hoistA</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>gt</span> <span class='hs-varid'>pt</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>hoistA</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-varid'>gt</span><span class='hs-layout'>)</span>
<a name="line-303"></a>                                        <span class='hs-varid'>pt</span>
<a name="line-304"></a>                                        <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>g</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-305"></a>                                            <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-306"></a>                                            <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>hoistA</span> <span class='hs-varid'>g</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-307"></a>
<a name="line-308"></a><a name="generalizeA"></a><span class='hs-comment'>-- | Generalizes an @'Auto'' a b@ to an @'Auto' m a b'@ for any 'Monad'</span>
<a name="line-309"></a><span class='hs-comment'>-- @m@, using 'hoist'.</span>
<a name="line-310"></a><span class='hs-comment'>--</span>
<a name="line-311"></a><span class='hs-comment'>-- You generally should be able to avoid using this if you never directly</span>
<a name="line-312"></a><span class='hs-comment'>-- write any 'Auto''s and always write 'Auto m' parameterized over all</span>
<a name="line-313"></a><span class='hs-comment'>-- 'Monad's, but...in case you import one from a library or something, you</span>
<a name="line-314"></a><span class='hs-comment'>-- can use this.</span>
<a name="line-315"></a><span class='hs-comment'>--</span>
<a name="line-316"></a><span class='hs-definition'>generalizeA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-317"></a><span class='hs-definition'>generalizeA</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hoistA</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>runIdentity</span><span class='hs-layout'>)</span>
<a name="line-318"></a>
<a name="line-319"></a><a name="forceSerial"></a><span class='hs-comment'>-- | Force the serializing components of an 'Auto'.</span>
<a name="line-320"></a><span class='hs-comment'>--</span>
<a name="line-321"></a><span class='hs-comment'>-- TODO: Test if this really works</span>
<a name="line-322"></a><span class='hs-definition'>forceSerial</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-323"></a><span class='hs-definition'>forceSerial</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-324"></a>                  <span class='hs-conid'>AutoArb</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>a</span>
<a name="line-325"></a>                  <span class='hs-conid'>AutoArbM</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>l</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`seq`</span> <span class='hs-varid'>a</span>
<a name="line-326"></a>                  <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-327"></a>
<a name="line-328"></a><span class='hs-comment'>-- $serializing</span>
<a name="line-329"></a><span class='hs-comment'>--</span>
<a name="line-330"></a><span class='hs-comment'>-- The 'Auto' type offers an interface in which you can serialize</span>
<a name="line-331"></a><span class='hs-comment'>-- ("freeze") and "resume" an Auto, in 'ByteString' (binary) form.</span>
<a name="line-332"></a><span class='hs-comment'>--</span>
<a name="line-333"></a><span class='hs-comment'>-- You can "freeze" any 'Auto' into a 'ByteString' using 'encodeAuto' (or,</span>
<a name="line-334"></a><span class='hs-comment'>-- if you want the raw 'Put' (from "Data.Serialize") for some reason,</span>
<a name="line-335"></a><span class='hs-comment'>-- there's 'saveAuto'.</span>
<a name="line-336"></a><span class='hs-comment'>--</span>
<a name="line-337"></a><span class='hs-comment'>-- You can "resume" any 'Auto' from a 'ByteString' using 'decodeAuto' (or,</span>
<a name="line-338"></a><span class='hs-comment'>-- if you want the raw 'Get' for some reason, there's 'resumeAuto').</span>
<a name="line-339"></a><span class='hs-comment'>--</span>
<a name="line-340"></a><span class='hs-comment'>-- Note 'decodeAuto' and 'resumeAuto' "resume" a /given 'Auto'/.  That is,</span>
<a name="line-341"></a><span class='hs-comment'>-- if you call 'decodeAuto' on a "fresh 'Auto'", it'll decode</span>
<a name="line-342"></a><span class='hs-comment'>-- a 'ByteString' into /that 'Auto', but "resumed"/.  That is, it'll "fast</span>
<a name="line-343"></a><span class='hs-comment'>-- forward" that 'Auto' into the state it was when it was saved.</span>
<a name="line-344"></a><span class='hs-comment'>--</span>
<a name="line-345"></a><span class='hs-comment'>-- For example, let's say I have @a = 'sumFrom' 0@, the 'Auto' whose output</span>
<a name="line-346"></a><span class='hs-comment'>-- is the cumulative sum of all of its inputs so far. If I feed it 3 and</span>
<a name="line-347"></a><span class='hs-comment'>-- 10, it'll have its internal accumulator as 13, keeping track of all the</span>
<a name="line-348"></a><span class='hs-comment'>-- numbers it has seen so far.</span>
<a name="line-349"></a><span class='hs-comment'>--</span>
<a name="line-350"></a><span class='hs-comment'>-- &gt;&gt;&gt; let a = sumFrom 0</span>
<a name="line-351"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (_, a' ) = stepAuto' a  3</span>
<a name="line-352"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (_, a'') = stepAuto' a' 10</span>
<a name="line-353"></a><span class='hs-comment'>--</span>
<a name="line-354"></a><span class='hs-comment'>-- I can then use 'encodeAuto' to "freeze"/"save" the 'Auto' into the</span>
<a name="line-355"></a><span class='hs-comment'>-- 'ByteString' @bs@:</span>
<a name="line-356"></a><span class='hs-comment'>--</span>
<a name="line-357"></a><span class='hs-comment'>-- &gt;&gt;&gt; let bs            = encodeAuto a''</span>
<a name="line-358"></a><span class='hs-comment'>--</span>
<a name="line-359"></a><span class='hs-comment'>-- To "resume" / "load" it, I can use 'decodeAuto' to "resume" the</span>
<a name="line-360"></a><span class='hs-comment'>-- /original/ @a@.  Remember, 'a' was our original 'Auto', the summer</span>
<a name="line-361"></a><span class='hs-comment'>-- 'Auto' with a starting accumulator of 0.  We use 'decodeAuto' to</span>
<a name="line-362"></a><span class='hs-comment'>-- "resume" it, with and resume it with its internal accumulator at 13.</span>
<a name="line-363"></a><span class='hs-comment'>--</span>
<a name="line-364"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (Right resumed) = decodeAuto a bs</span>
<a name="line-365"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (y, _) = stepAuto' resumed 0</span>
<a name="line-366"></a><span class='hs-comment'>-- 13</span>
<a name="line-367"></a><span class='hs-comment'>--</span>
<a name="line-368"></a><span class='hs-comment'>-- Note that all of these would have had the same result:</span>
<a name="line-369"></a><span class='hs-comment'>--</span>
<a name="line-370"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (Right resumed) = decodeAuto a'  bs</span>
<a name="line-371"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (Right resumed) = decodeAuto a'' bs</span>
<a name="line-372"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (Right resumed) = decodeAuto (sumFrom 0) bs</span>
<a name="line-373"></a><span class='hs-comment'>--</span>
<a name="line-374"></a><span class='hs-comment'>-- I mean, after all, if 'decodeAuto' "fast forwards" an 'Auto' to the</span>
<a name="line-375"></a><span class='hs-comment'>-- state it was at when it was frozen...then all of these should really be</span>
<a name="line-376"></a><span class='hs-comment'>-- resumed to the same point, right?</span>
<a name="line-377"></a><span class='hs-comment'>--</span>
<a name="line-378"></a><span class='hs-comment'>-- One way you can think about it is that 'resumeAuto' / 'decodeAuto' takes</span>
<a name="line-379"></a><span class='hs-comment'>-- an 'Auto' and creates a "blueprint" from that 'Auto', on how to "load</span>
<a name="line-380"></a><span class='hs-comment'>-- it"; the blueprint contains what the form of the internal state is, and</span>
<a name="line-381"></a><span class='hs-comment'>-- their offets in the 'ByteString'.  So in the above, 'a', 'a'', 'a''',</span>
<a name="line-382"></a><span class='hs-comment'>-- and @'sumFrom' 0@ all have the same "blueprint" --- their internal</span>
<a name="line-383"></a><span class='hs-comment'>-- states are of the same structure.</span>
<a name="line-384"></a><span class='hs-comment'>--</span>
<a name="line-385"></a><span class='hs-comment'>-- Now, the /magic/ of this all is that combining and transforming 'Auto's</span>
<a name="line-386"></a><span class='hs-comment'>-- with the combinators in this library will also /compose serialization</span>
<a name="line-387"></a><span class='hs-comment'>-- strategies/ .... complex 'Auto's and combinations/chains of 'Auto's</span>
<a name="line-388"></a><span class='hs-comment'>-- create serialization strategies "for free".  The</span>
<a name="line-389"></a><span class='hs-comment'>-- &lt;https://github.com/mstksg/auto-examples auto-examples&gt; repo has a lot</span>
<a name="line-390"></a><span class='hs-comment'>-- of examples that use this  to great effect, serializing entire</span>
<a name="line-391"></a><span class='hs-comment'>-- applications and entire chat bots without writing any serialization</span>
<a name="line-392"></a><span class='hs-comment'>-- code; it all does it "by itself".  Be sure to read about the caveats in</span>
<a name="line-393"></a><span class='hs-comment'>-- the</span>
<a name="line-394"></a><span class='hs-comment'>-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;.</span>
<a name="line-395"></a><span class='hs-comment'>--</span>
<a name="line-396"></a><span class='hs-comment'>-- Some specific 'Auto's (indicated by a naming convention) might choose to</span>
<a name="line-397"></a><span class='hs-comment'>-- have internal state, yet ignore it when saving/loading.  So, saving it</span>
<a name="line-398"></a><span class='hs-comment'>-- actaully saves no state, and "resuming" it really doesn't do anything.</span>
<a name="line-399"></a><span class='hs-comment'>-- That is, @'decodeAuto' a_ bs = Right a_@.  There isn't a real way to</span>
<a name="line-400"></a><span class='hs-comment'>-- identify from the type of the 'Auto' if it will properly save/resume or</span>
<a name="line-401"></a><span class='hs-comment'>-- not, so you have to keep track of this yourself.  In all of the 'Auto'</span>
<a name="line-402"></a><span class='hs-comment'>-- "included" in this library, any 'Auto' whose name /does not/ end in @_@</span>
<a name="line-403"></a><span class='hs-comment'>-- /will serialize and resume/.  An 'Auto' whose name ends in @_@ is taken</span>
<a name="line-404"></a><span class='hs-comment'>-- by naming convention to be a non-resuming 'Auto'.</span>
<a name="line-405"></a><span class='hs-comment'>--</span>
<a name="line-406"></a><span class='hs-comment'>-- In your own compositions, if you are sure to always use resuming</span>
<a name="line-407"></a><span class='hs-comment'>-- 'Auto's, your composition will also be properly resuming...so you don't</span>
<a name="line-408"></a><span class='hs-comment'>-- have to worry about this!  You shouldn't really ever be "surprised",</span>
<a name="line-409"></a><span class='hs-comment'>-- because you'll always explicitly chose the resuming version for 'Auto's</span>
<a name="line-410"></a><span class='hs-comment'>-- you want to resume, and the non-resuming version for those you don't.</span>
<a name="line-411"></a><span class='hs-comment'>--</span>
<a name="line-412"></a><span class='hs-comment'>-- Now, /making/ or /writing/ your own generic 'Auto' combinators and</span>
<a name="line-413"></a><span class='hs-comment'>-- transformers that take advantage of serialization is a bit of</span>
<a name="line-414"></a><span class='hs-comment'>-- a headache.  When you can, you might be able to make combinators out of</span>
<a name="line-415"></a><span class='hs-comment'>-- the existing functions in this library.  Sometimes, however, it's</span>
<a name="line-416"></a><span class='hs-comment'>-- unavoidable.  If you are making your own 'Auto' combinators, making sure</span>
<a name="line-417"></a><span class='hs-comment'>-- serialization works as expected is tough; check out the documentation</span>
<a name="line-418"></a><span class='hs-comment'>-- for 'mkAutoM' for more details.</span>
<a name="line-419"></a><span class='hs-comment'>--</span>
<a name="line-420"></a>
<a name="line-421"></a><a name="encodeAuto"></a><span class='hs-comment'>-- | Encode an 'Auto' and its internal state into a 'ByteString'.</span>
<a name="line-422"></a><span class='hs-definition'>encodeAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
<a name="line-423"></a><span class='hs-definition'>encodeAuto</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runPut</span> <span class='hs-varop'>.</span> <span class='hs-varid'>saveAuto</span>
<a name="line-424"></a><span class='hs-comment'>{-# INLINE encodeAuto #-}</span>
<a name="line-425"></a>
<a name="line-426"></a><a name="decodeAuto"></a><span class='hs-comment'>-- | "Resume" an 'Auto' from its 'ByteString' serialization, giving</span>
<a name="line-427"></a><span class='hs-comment'>-- a 'Left' if the deserialization is not possible.</span>
<a name="line-428"></a><span class='hs-definition'>decodeAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-429"></a><span class='hs-definition'>decodeAuto</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runGet</span> <span class='hs-varop'>.</span> <span class='hs-varid'>resumeAuto</span>
<a name="line-430"></a><span class='hs-comment'>{-# INLINE decodeAuto #-}</span>
<a name="line-431"></a>
<a name="line-432"></a><a name="resumeAuto"></a><span class='hs-comment'>-- | Returns a 'Get' from an 'Auto' ---  instructions (from</span>
<a name="line-433"></a><span class='hs-comment'>-- "Data.Serialize") on taking a ByteString and "restoring" the originally</span>
<a name="line-434"></a><span class='hs-comment'>-- saved 'Auto', in the originally saved state.</span>
<a name="line-435"></a><span class='hs-definition'>resumeAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Get</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-436"></a><span class='hs-definition'>resumeAuto</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-437"></a>                 <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoState</span>  <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>gp</span>
<a name="line-438"></a>                 <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>gp</span>
<a name="line-439"></a>                 <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>g</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>g</span>
<a name="line-440"></a>                 <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>g</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>g</span>
<a name="line-441"></a>                 <span class='hs-keyword'>_</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>a</span>
<a name="line-442"></a><span class='hs-comment'>{-# INLINE resumeAuto #-}</span>
<a name="line-443"></a>
<a name="line-444"></a><a name="saveAuto"></a><span class='hs-comment'>-- | Returns a 'Put' --- instructions (from "Data.Serialize") on how to</span>
<a name="line-445"></a><span class='hs-comment'>-- "freeze" the 'Auto', with its internal state, and save it to a binary</span>
<a name="line-446"></a><span class='hs-comment'>-- encoding.  It can later be reloaded and "resumed" by</span>
<a name="line-447"></a><span class='hs-comment'>-- 'resumeAuto'/'decodeAuto'.</span>
<a name="line-448"></a><span class='hs-definition'>saveAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span>
<a name="line-449"></a><span class='hs-definition'>saveAuto</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-450"></a>               <span class='hs-conid'>AutoState</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span>
<a name="line-451"></a>               <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span>
<a name="line-452"></a>               <span class='hs-conid'>AutoArb</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span>
<a name="line-453"></a>               <span class='hs-conid'>AutoArbM</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>_</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span>
<a name="line-454"></a>               <span class='hs-keyword'>_</span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-455"></a><span class='hs-comment'>{-# INLINE saveAuto #-}</span>
<a name="line-456"></a>
<a name="line-457"></a><a name="unserialize"></a><span class='hs-comment'>-- | Takes an 'Auto' that is serializable/resumable and returns an 'Auto'</span>
<a name="line-458"></a><span class='hs-comment'>-- that is not.  That is, when it is "saved", saves no data, and when it is</span>
<a name="line-459"></a><span class='hs-comment'>-- "resumed", resets itself back to the initial configuration every time;</span>
<a name="line-460"></a><span class='hs-comment'>-- in other words, @'decodeAuto' (unserialize a) bs = Right (unserialize</span>
<a name="line-461"></a><span class='hs-comment'>-- a)@.  Trying to "resume" it will just always give itself, unchanged.</span>
<a name="line-462"></a><span class='hs-definition'>unserialize</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-463"></a><span class='hs-definition'>unserialize</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span>
<a name="line-464"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-465"></a>        <span class='hs-conid'>AutoFunc</span> <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-466"></a>        <span class='hs-conid'>AutoFuncM</span> <span class='hs-keyword'>_</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-467"></a>        <span class='hs-conid'>AutoState</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoState</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>const</span> <span class='hs-layout'>(</span><span class='hs-varid'>put</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>
<a name="line-468"></a>        <span class='hs-conid'>AutoStateM</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>const</span> <span class='hs-layout'>(</span><span class='hs-varid'>put</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>
<a name="line-469"></a>        <span class='hs-conid'>AutoArb</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>put</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-varid'>unserialize</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-470"></a>        <span class='hs-conid'>AutoArbM</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>put</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-varid'>unserialize</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-471"></a>
<a name="line-472"></a><a name="stepAuto"></a><span class='hs-comment'>-- | "Runs" the 'Auto' through one step.</span>
<a name="line-473"></a><span class='hs-comment'>--</span>
<a name="line-474"></a><span class='hs-comment'>-- That is, given an @'Auto' m a b@, returns a function that takes an @a@</span>
<a name="line-475"></a><span class='hs-comment'>-- and returns a @b@ and an "updated"/"next" 'Auto'; an @a -&gt; m (b, 'Auto'</span>
<a name="line-476"></a><span class='hs-comment'>-- m a b)@.</span>
<a name="line-477"></a><span class='hs-comment'>--</span>
<a name="line-478"></a><span class='hs-comment'>-- This is the main way of running an 'Auto' "step by step", so if you have</span>
<a name="line-479"></a><span class='hs-comment'>-- some sort of game loop that updates everything every "tick", this is</span>
<a name="line-480"></a><span class='hs-comment'>-- what you're looking for.  At every loop, gather input @a@, feed it into</span>
<a name="line-481"></a><span class='hs-comment'>-- the 'Auto', "render" the result @b@, and get your new 'Auto' to run the</span>
<a name="line-482"></a><span class='hs-comment'>-- next time.</span>
<a name="line-483"></a><span class='hs-comment'>--</span>
<a name="line-484"></a><span class='hs-comment'>-- Here is an example with @'sumFrom' 0@, the 'Auto' whose output is the</span>
<a name="line-485"></a><span class='hs-comment'>-- cumulative sum of the inputs, and an underying monad of @Identity@.</span>
<a name="line-486"></a><span class='hs-comment'>-- Here,</span>
<a name="line-487"></a><span class='hs-comment'>--</span>
<a name="line-488"></a><span class='hs-comment'>-- @</span>
<a name="line-489"></a><span class='hs-comment'>-- stepAuto :: Auto Identity Int Int</span>
<a name="line-490"></a><span class='hs-comment'>--          -&gt; (Int -&gt; Identity (Int, Auto Identity Int Int))</span>
<a name="line-491"></a><span class='hs-comment'>-- @</span>
<a name="line-492"></a><span class='hs-comment'>--</span>
<a name="line-493"></a><span class='hs-comment'>-- Every time you "step", you give it an 'Int' and get a resulting 'Int'</span>
<a name="line-494"></a><span class='hs-comment'>-- (the cumulative sum) and the "updated 'Auto'", with the updated</span>
<a name="line-495"></a><span class='hs-comment'>-- accumulator.</span>
<a name="line-496"></a><span class='hs-comment'>--</span>
<a name="line-497"></a><span class='hs-comment'>-- &gt;&gt;&gt; let a0 :: Auto Identity Int Int</span>
<a name="line-498"></a><span class='hs-comment'>--         a0 = sumFrom 0</span>
<a name="line-499"></a><span class='hs-comment'>-- &gt;&gt;&gt; let Identity (res1, a1) = stepAuto a0 4      -- run with 4</span>
<a name="line-500"></a><span class='hs-comment'>-- &gt;&gt;&gt; res1</span>
<a name="line-501"></a><span class='hs-comment'>-- 4                -- the cumulative sum, 4</span>
<a name="line-502"></a><span class='hs-comment'>-- &gt;&gt;&gt; let Identity (res2, a2) = stepAuto a1 5      -- run with 5</span>
<a name="line-503"></a><span class='hs-comment'>-- &gt;&gt;&gt; res2</span>
<a name="line-504"></a><span class='hs-comment'>-- 9                -- the cumulative sum, 4 + 5</span>
<a name="line-505"></a><span class='hs-comment'>-- &gt;&gt;&gt; let Identity (res3, _ ) = stepAuto a2 3      -- run with 3</span>
<a name="line-506"></a><span class='hs-comment'>-- &gt;&gt;&gt; res3</span>
<a name="line-507"></a><span class='hs-comment'>-- 12               -- the cumulative sum, 4 + 5 + 3</span>
<a name="line-508"></a><span class='hs-comment'>--</span>
<a name="line-509"></a><span class='hs-comment'>-- By the way, for the case where your 'Auto' is under 'Identity', we have</span>
<a name="line-510"></a><span class='hs-comment'>-- a type synomym 'Auto''...and a convenience function to make "running" it</span>
<a name="line-511"></a><span class='hs-comment'>-- more streamlined:</span>
<a name="line-512"></a><span class='hs-comment'>--</span>
<a name="line-513"></a><span class='hs-comment'>-- &gt;&gt;&gt; let a0 :: Auto' Int Int</span>
<a name="line-514"></a><span class='hs-comment'>--         a0 = sumFrom 0</span>
<a name="line-515"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (res1, a1) = stepAuto' a0 4          -- run with 4</span>
<a name="line-516"></a><span class='hs-comment'>-- &gt;&gt;&gt; res1</span>
<a name="line-517"></a><span class='hs-comment'>-- 4                -- the cumulative sum, 4</span>
<a name="line-518"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (res2, a2) = stepAuto' a1 5          -- run with 5</span>
<a name="line-519"></a><span class='hs-comment'>-- &gt;&gt;&gt; res2</span>
<a name="line-520"></a><span class='hs-comment'>-- 9                -- the cumulative sum, 4 + 5</span>
<a name="line-521"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (res3, _ ) = stepAuto' a2 3          -- run with 3</span>
<a name="line-522"></a><span class='hs-comment'>-- &gt;&gt;&gt; res3</span>
<a name="line-523"></a><span class='hs-comment'>-- 12               -- the cumulative sum, 4 + 5 + 3</span>
<a name="line-524"></a><span class='hs-comment'>--</span>
<a name="line-525"></a><span class='hs-comment'>-- But, if your 'Auto' actaully has effects when being stepped, 'stepAuto'</span>
<a name="line-526"></a><span class='hs-comment'>-- will execute them:</span>
<a name="line-527"></a><span class='hs-comment'>--</span>
<a name="line-528"></a><span class='hs-comment'>-- &gt;&gt;&gt; let a0 :: Auto IO Int Int</span>
<a name="line-529"></a><span class='hs-comment'>--         a0 = effect (putStrLn "hey!") *&gt; sumFrom 0</span>
<a name="line-530"></a><span class='hs-comment'>-- &gt;&gt;&gt; (res1, a1) &lt;- stepAuto a0 4              -- run with 4</span>
<a name="line-531"></a><span class='hs-comment'>-- hey!         -- IO effect</span>
<a name="line-532"></a><span class='hs-comment'>-- &gt;&gt;&gt; res1</span>
<a name="line-533"></a><span class='hs-comment'>-- 4                -- the cumulative sum, 4</span>
<a name="line-534"></a><span class='hs-comment'>-- &gt;&gt;&gt; (res2, a2) &lt;- stepAuto a1 5              -- run with 5</span>
<a name="line-535"></a><span class='hs-comment'>-- hey!         -- IO effect</span>
<a name="line-536"></a><span class='hs-comment'>-- &gt;&gt;&gt; res2</span>
<a name="line-537"></a><span class='hs-comment'>-- 9                -- the cumulative sum, 4 + 5</span>
<a name="line-538"></a><span class='hs-comment'>-- &gt;&gt;&gt; (res3, _ ) &lt;- stepAuto a2 3              -- run with 3</span>
<a name="line-539"></a><span class='hs-comment'>-- hey!         -- IO effect</span>
<a name="line-540"></a><span class='hs-comment'>-- &gt;&gt;&gt; res3</span>
<a name="line-541"></a><span class='hs-comment'>-- 12               -- the cumulative sum, 4 + 5 + 3</span>
<a name="line-542"></a><span class='hs-comment'>--</span>
<a name="line-543"></a><span class='hs-comment'>-- (Here, @'effect' ('putStrLn' "hey")@ is an @'Auto' IO Int ()@, which</span>
<a name="line-544"></a><span class='hs-comment'>-- ignores its input and just executes @'putStrLn' "hey"@ every time it is</span>
<a name="line-545"></a><span class='hs-comment'>-- run.  When we use '*&gt;' from "Control.Applicative", we "combine" the two</span>
<a name="line-546"></a><span class='hs-comment'>-- 'Auto's together and run them /both/ on each input (4, 5, 3...)...but</span>
<a name="line-547"></a><span class='hs-comment'>-- for the "final" output at the end, we only return the output of the</span>
<a name="line-548"></a><span class='hs-comment'>-- second one, @'sumFrom' 0@ (5, 9, 12...))</span>
<a name="line-549"></a><span class='hs-comment'>--</span>
<a name="line-550"></a><span class='hs-comment'>-- If you think of an @'Auto' m a b@ as a "stateful function" @a -&gt; m b@,</span>
<a name="line-551"></a><span class='hs-comment'>-- then 'stepAuto' lets you "run" it.</span>
<a name="line-552"></a><span class='hs-comment'>--</span>
<a name="line-553"></a><span class='hs-comment'>-- In order to directly run an 'Auto' on a stream, an @[a]@, use</span>
<a name="line-554"></a><span class='hs-comment'>-- 'streamAuto'.  That gives you an @[a] -&gt; m [b]@.</span>
<a name="line-555"></a><span class='hs-comment'>--</span>
<a name="line-556"></a><span class='hs-definition'>stepAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-557"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>        <span class='hs-comment'>-- ^ the 'Auto' to step</span>
<a name="line-558"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>                 <span class='hs-comment'>-- ^ the input</span>
<a name="line-559"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ the output, and the updated 'Auto''.</span>
<a name="line-560"></a><span class='hs-definition'>stepAuto</span> <span class='hs-varid'>a</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-561"></a>                 <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>        <span class='hs-keyglyph'>-&gt;</span>
<a name="line-562"></a>                     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-563"></a>                 <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-564"></a>                     <span class='hs-varid'>y</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-565"></a>                     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-566"></a>                 <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-567"></a>                     <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span>
<a name="line-568"></a>                         <span class='hs-varid'>a'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s'</span>
<a name="line-569"></a>                     <span class='hs-keyword'>in</span>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-570"></a>                 <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-571"></a>                     <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span>
<a name="line-572"></a>                     <span class='hs-keyword'>let</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s'</span>
<a name="line-573"></a>                     <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-574"></a>                 <span class='hs-conid'>AutoArb</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-575"></a>                 <span class='hs-conid'>AutoArbM</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-576"></a><span class='hs-comment'>{-# INLINE stepAuto #-}</span>
<a name="line-577"></a>
<a name="line-578"></a><a name="stepAuto'"></a><span class='hs-comment'>-- | "Runs" an 'Auto'' through one step.</span>
<a name="line-579"></a><span class='hs-comment'>--</span>
<a name="line-580"></a><span class='hs-comment'>-- That is, given an @'Auto'' a b@, returns a function that takes an @a@</span>
<a name="line-581"></a><span class='hs-comment'>-- and returns a @b@ and an "updated"/"next" 'Auto''; an @a -&gt; (b, 'Auto''</span>
<a name="line-582"></a><span class='hs-comment'>-- a b)@.</span>
<a name="line-583"></a><span class='hs-comment'>--</span>
<a name="line-584"></a><span class='hs-comment'>-- See 'stepAuto' documentation for motivations, use cases, and more</span>
<a name="line-585"></a><span class='hs-comment'>-- details.  You can use this instead of 'stepAuto' when your underyling</span>
<a name="line-586"></a><span class='hs-comment'>-- monad is 'Identity', and your 'Auto' doesn't produce any effects.</span>
<a name="line-587"></a><span class='hs-comment'>--</span>
<a name="line-588"></a><span class='hs-comment'>-- Here is an example with @'sumFrom' 0@, the 'Auto'' whose output is the</span>
<a name="line-589"></a><span class='hs-comment'>-- cumulative sum of the inputs</span>
<a name="line-590"></a><span class='hs-comment'>--</span>
<a name="line-591"></a><span class='hs-comment'>-- @</span>
<a name="line-592"></a><span class='hs-comment'>-- stepAuto' :: Auto' Int Int</span>
<a name="line-593"></a><span class='hs-comment'>--           -&gt; (Int -&gt; (Int, Auto' Int Int))</span>
<a name="line-594"></a><span class='hs-comment'>-- @</span>
<a name="line-595"></a><span class='hs-comment'>--</span>
<a name="line-596"></a><span class='hs-comment'>-- Every time you "step", you give it an 'Int' and get a resulting 'Int'</span>
<a name="line-597"></a><span class='hs-comment'>-- (the cumulative sum) and the "updated 'Auto''", with the updated</span>
<a name="line-598"></a><span class='hs-comment'>-- accumulator.</span>
<a name="line-599"></a><span class='hs-comment'>--</span>
<a name="line-600"></a><span class='hs-comment'>-- &gt;&gt;&gt; let a0 :: Auto' Int Int</span>
<a name="line-601"></a><span class='hs-comment'>--         a0 = sumFrom 0</span>
<a name="line-602"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (res1, a1) = stepAuto' a0 4          -- run with 4</span>
<a name="line-603"></a><span class='hs-comment'>-- &gt;&gt;&gt; res1</span>
<a name="line-604"></a><span class='hs-comment'>-- 4                -- the cumulative sum, 4</span>
<a name="line-605"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (res2, a2) = stepAuto' a1 5          -- run with 5</span>
<a name="line-606"></a><span class='hs-comment'>-- &gt;&gt;&gt; res2</span>
<a name="line-607"></a><span class='hs-comment'>-- 9                -- the cumulative sum, 4 + 5</span>
<a name="line-608"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (res3, _ ) = stepAuto' a2 3          -- run with 3</span>
<a name="line-609"></a><span class='hs-comment'>-- &gt;&gt;&gt; res3</span>
<a name="line-610"></a><span class='hs-comment'>-- 12               -- the cumulative sum, 4 + 5 + 3</span>
<a name="line-611"></a><span class='hs-comment'>--</span>
<a name="line-612"></a><span class='hs-comment'>-- If you think of an @'Auto'' a b@ as a "stateful function" @a -&gt; b@,</span>
<a name="line-613"></a><span class='hs-comment'>-- then 'stepAuto'' lets you "run" it.</span>
<a name="line-614"></a><span class='hs-comment'>--</span>
<a name="line-615"></a><span class='hs-comment'>-- In order to directly run an 'Auto'' on a stream, an @[a]@, use</span>
<a name="line-616"></a><span class='hs-comment'>-- 'streamAuto''.  That gives you an @[a] -&gt; [b]@.</span>
<a name="line-617"></a><span class='hs-comment'>--</span>
<a name="line-618"></a><span class='hs-definition'>stepAuto'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>        <span class='hs-comment'>-- ^ the 'Auto'' to step</span>
<a name="line-619"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>                <span class='hs-comment'>-- ^ the input</span>
<a name="line-620"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ the output, and the updated 'Auto''</span>
<a name="line-621"></a><span class='hs-definition'>stepAuto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-622"></a>                  <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-623"></a>                  <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>runIdentity</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-624"></a>                  <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span>
<a name="line-625"></a>                                           <span class='hs-varid'>a'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s'</span>
<a name="line-626"></a>                                       <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-627"></a>                  <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runIdentity</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-628"></a>                                           <span class='hs-varid'>a'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s'</span>
<a name="line-629"></a>                                       <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-630"></a>                  <span class='hs-conid'>AutoArb</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-631"></a>                  <span class='hs-conid'>AutoArbM</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>runIdentity</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-632"></a><span class='hs-comment'>{-# INLINE stepAuto' #-}</span>
<a name="line-633"></a>
<a name="line-634"></a><a name="purifyAuto"></a><span class='hs-comment'>-- | In theory, "purifying" an 'Auto''" should prep it for faster</span>
<a name="line-635"></a><span class='hs-comment'>-- evaluation when used with 'stepAuto'' or 'streamAuto''.  But the</span>
<a name="line-636"></a><span class='hs-comment'>-- benchmarks have not been run yet, so stay tuned!</span>
<a name="line-637"></a><span class='hs-comment'>--</span>
<a name="line-638"></a><span class='hs-comment'>-- TODO: Benchmark</span>
<a name="line-639"></a><span class='hs-definition'>purifyAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-640"></a><span class='hs-definition'>purifyAuto</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-641"></a><span class='hs-definition'>purifyAuto</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>runIdentity</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-642"></a><span class='hs-definition'>purifyAuto</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-643"></a><span class='hs-definition'>purifyAuto</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>runIdentity</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-644"></a><span class='hs-definition'>purifyAuto</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>g</span> <span class='hs-varid'>p</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>purifyAuto</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-645"></a>                                         <span class='hs-varid'>p</span>
<a name="line-646"></a>                                       <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-647"></a>                                               <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>purifyAuto</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-648"></a><span class='hs-definition'>purifyAuto</span> <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>g</span> <span class='hs-varid'>p</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>purifyAuto</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-649"></a>                                         <span class='hs-varid'>p</span>
<a name="line-650"></a>                                       <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runIdentity</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-651"></a>                                               <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>purifyAuto</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-652"></a>
<a name="line-653"></a><a name="evalAuto"></a><span class='hs-comment'>-- | Like 'stepAuto', but drops the "next 'Auto'" and just gives the</span>
<a name="line-654"></a><span class='hs-comment'>-- result.</span>
<a name="line-655"></a><span class='hs-definition'>evalAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-656"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>      <span class='hs-comment'>-- ^ 'Auto' to run</span>
<a name="line-657"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>               <span class='hs-comment'>-- ^ input</span>
<a name="line-658"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>             <span class='hs-comment'>-- ^ output</span>
<a name="line-659"></a><span class='hs-definition'>evalAuto</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>stepAuto</span> <span class='hs-varid'>a</span>
<a name="line-660"></a>
<a name="line-661"></a><a name="evalAuto'"></a><span class='hs-comment'>-- | Like 'stepAuto'', but drops the "next 'Auto''" and just gives the</span>
<a name="line-662"></a><span class='hs-comment'>-- result.  'evalAuto' for 'Auto''.</span>
<a name="line-663"></a><span class='hs-definition'>evalAuto'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>      <span class='hs-comment'>-- ^ 'Auto' to run</span>
<a name="line-664"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>              <span class='hs-comment'>-- ^ input</span>
<a name="line-665"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>              <span class='hs-comment'>-- ^ output</span>
<a name="line-666"></a><span class='hs-definition'>evalAuto'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>stepAuto'</span> <span class='hs-varid'>a</span>
<a name="line-667"></a>
<a name="line-668"></a><a name="execAuto"></a><span class='hs-comment'>-- | Like 'stepAuto', but drops the result and just gives the "updated</span>
<a name="line-669"></a><span class='hs-comment'>-- 'Auto'".</span>
<a name="line-670"></a><span class='hs-definition'>execAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-671"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>      <span class='hs-comment'>-- ^ 'Auto' to run</span>
<a name="line-672"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>               <span class='hs-comment'>-- ^ input</span>
<a name="line-673"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ updated 'Auto'</span>
<a name="line-674"></a><span class='hs-definition'>execAuto</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>stepAuto</span> <span class='hs-varid'>a</span>
<a name="line-675"></a>
<a name="line-676"></a><a name="execAuto'"></a><span class='hs-comment'>-- | Like 'stepAuto'', but drops the result and just gives the "updated</span>
<a name="line-677"></a><span class='hs-comment'>-- 'Auto''".  'execAuto' for 'Auto''.</span>
<a name="line-678"></a><span class='hs-definition'>execAuto'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>      <span class='hs-comment'>-- ^ 'Auto'' to run</span>
<a name="line-679"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>              <span class='hs-comment'>-- ^ input</span>
<a name="line-680"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>      <span class='hs-comment'>-- ^ updated 'Auto''</span>
<a name="line-681"></a><span class='hs-definition'>execAuto'</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>stepAuto'</span> <span class='hs-varid'>a</span>
<a name="line-682"></a>
<a name="line-683"></a><a name="forcer"></a><span class='hs-comment'>-- | A special 'Auto' that acts like the 'id' 'Auto', but forces results as</span>
<a name="line-684"></a><span class='hs-comment'>-- they come through to be fully evaluated, when composed with other</span>
<a name="line-685"></a><span class='hs-comment'>-- 'Auto's.</span>
<a name="line-686"></a><span class='hs-comment'>--</span>
<a name="line-687"></a><span class='hs-comment'>-- TODO: Test if this really works</span>
<a name="line-688"></a><span class='hs-definition'>forcer</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NFData</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a</span>
<a name="line-689"></a><span class='hs-definition'>forcer</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkAuto_</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`deepseq`</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>forcer</span><span class='hs-layout'>)</span>
<a name="line-690"></a><span class='hs-comment'>{-# INLINE forcer #-}</span>
<a name="line-691"></a>
<a name="line-692"></a><a name="seqer"></a><span class='hs-comment'>-- | A special 'Auto' that acts like the 'id' 'Auto', but forces results as</span>
<a name="line-693"></a><span class='hs-comment'>-- they come through to be evaluated to Weak Head Normal Form, with 'seq',</span>
<a name="line-694"></a><span class='hs-comment'>-- when composed with other 'Auto's.</span>
<a name="line-695"></a><span class='hs-comment'>--</span>
<a name="line-696"></a><span class='hs-comment'>-- TODO: Test if this really works</span>
<a name="line-697"></a><span class='hs-definition'>seqer</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>a</span>
<a name="line-698"></a><span class='hs-definition'>seqer</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkAuto_</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`seq`</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>seqer</span><span class='hs-layout'>)</span>
<a name="line-699"></a><span class='hs-comment'>{-# INLINE seqer #-}</span>
<a name="line-700"></a>
<a name="line-701"></a><a name="interceptO"></a><span class='hs-comment'>-- | Abstraction over lower-level funging with serialization; lets you</span>
<a name="line-702"></a><span class='hs-comment'>-- modify the result of an 'Auto' by being able to intercept the @(b,</span>
<a name="line-703"></a><span class='hs-comment'>-- 'Auto' m a b)@ output and return a new output value @m c@.</span>
<a name="line-704"></a><span class='hs-comment'>--</span>
<a name="line-705"></a><span class='hs-comment'>-- Note that this is a lot like 'fmap':</span>
<a name="line-706"></a><span class='hs-comment'>--</span>
<a name="line-707"></a><span class='hs-comment'>-- @</span>
<a name="line-708"></a><span class='hs-comment'>-- fmap :: (b -&gt; c) -&gt; Auto m a b -&gt; Auto m a c</span>
<a name="line-709"></a><span class='hs-comment'>-- @</span>
<a name="line-710"></a><span class='hs-comment'>--</span>
<a name="line-711"></a><span class='hs-comment'>-- Except gives you access to both the @b@ and the "updated 'Auto'";</span>
<a name="line-712"></a><span class='hs-comment'>-- instead of an @b -&gt; c@, you get to pass a @(b, 'Auto' m a b) -&gt; m c@.</span>
<a name="line-713"></a><span class='hs-comment'>--</span>
<a name="line-714"></a><span class='hs-comment'>-- Basically experimenting with a bunch of abstractions over different</span>
<a name="line-715"></a><span class='hs-comment'>-- lower-level modification of 'Auto's, because making sure the</span>
<a name="line-716"></a><span class='hs-comment'>-- serialization works as planned can be a bit difficult.</span>
<a name="line-717"></a><span class='hs-comment'>--</span>
<a name="line-718"></a><span class='hs-definition'>interceptO</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-719"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ intercepting function</span>
<a name="line-720"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-721"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>c</span>
<a name="line-722"></a><span class='hs-definition'>interceptO</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span>
<a name="line-723"></a>  <span class='hs-keyword'>where</span>
<a name="line-724"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>a0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkAutoM</span> <span class='hs-layout'>(</span><span class='hs-varid'>go</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>resumeAuto</span> <span class='hs-varid'>a0</span><span class='hs-layout'>)</span>
<a name="line-725"></a>                    <span class='hs-layout'>(</span><span class='hs-varid'>saveAuto</span> <span class='hs-varid'>a0</span><span class='hs-layout'>)</span>
<a name="line-726"></a>                  <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-727"></a>                        <span class='hs-varid'>o</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>a1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>stepAuto</span> <span class='hs-varid'>a0</span> <span class='hs-varid'>x</span>
<a name="line-728"></a>                        <span class='hs-varid'>y</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>o</span>
<a name="line-729"></a>                        <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>go</span> <span class='hs-varid'>a1</span><span class='hs-layout'>)</span>
<a name="line-730"></a>
<a name="line-731"></a><span class='hs-comment'>-- compMAuto :: (Monad m, Monad m') =&gt; Auto m b (m' c) -&gt; Auto m a (m' b) -&gt; Auto m a (m' c)</span>
<a name="line-732"></a><span class='hs-comment'>-- compMAuto g f = AutoArbM undefined</span>
<a name="line-733"></a><span class='hs-comment'>--                          undefined</span>
<a name="line-734"></a><span class='hs-comment'>--                          $ \x -&gt; do</span>
<a name="line-735"></a><span class='hs-comment'>--                              Output y f' &lt;- stepAuto f x</span>
<a name="line-736"></a><span class='hs-comment'>--                              undefined</span>
<a name="line-737"></a>
<a name="line-738"></a>
<a name="line-739"></a><span class='hs-comment'>-- doesn't work like you'd think lol.</span>
<a name="line-740"></a><span class='hs-comment'>-- serialForcer :: Monad m =&gt; Auto m a a</span>
<a name="line-741"></a><span class='hs-comment'>-- serialForcer = a</span>
<a name="line-742"></a><span class='hs-comment'>--   where</span>
<a name="line-743"></a><span class='hs-comment'>--     a = mkAuto_ $ \x -&gt; let outp = Output x a</span>
<a name="line-744"></a><span class='hs-comment'>--                         in  forceSerial a `seq` outp</span>
<a name="line-745"></a>
<a name="line-746"></a><a name="mkAuto"></a><span class='hs-comment'>-- | Construct an 'Auto' by explicity giving its serialization,</span>
<a name="line-747"></a><span class='hs-comment'>-- deserialization, and the function from @a@ to a @b@ and "updated</span>
<a name="line-748"></a><span class='hs-comment'>-- 'Auto'".</span>
<a name="line-749"></a><span class='hs-comment'>--</span>
<a name="line-750"></a><span class='hs-comment'>-- Ideally, you wouldn't have to use this unless you are making your own</span>
<a name="line-751"></a><span class='hs-comment'>-- framework.  Try your best to make what you want by assembling</span>
<a name="line-752"></a><span class='hs-comment'>-- primtives together.  Working with serilization directly is hard.</span>
<a name="line-753"></a><span class='hs-comment'>--</span>
<a name="line-754"></a><span class='hs-comment'>-- See 'mkAutoM' for more detailed instructions on doing this right.</span>
<a name="line-755"></a><span class='hs-definition'>mkAuto</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Get</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- ^ resuming/loading 'Get'</span>
<a name="line-756"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span>                       <span class='hs-comment'>-- ^ saving 'Put'</span>
<a name="line-757"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ step function</span>
<a name="line-758"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-759"></a><span class='hs-definition'>mkAuto</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArb</span>
<a name="line-760"></a><span class='hs-comment'>{-# INLINE mkAuto #-}</span>
<a name="line-761"></a>
<a name="line-762"></a><a name="mkAutoM"></a><span class='hs-comment'>-- | Construct an 'Auto' by explicitly giving its serializiation,</span>
<a name="line-763"></a><span class='hs-comment'>-- deserialization, and the (monadic) function from @a@ to a @b@ and the</span>
<a name="line-764"></a><span class='hs-comment'>-- "updated 'Auto'".</span>
<a name="line-765"></a><span class='hs-comment'>--</span>
<a name="line-766"></a><span class='hs-comment'>-- See the "serialization" section in the "Control.Auto.Core" module for</span>
<a name="line-767"></a><span class='hs-comment'>-- more information.</span>
<a name="line-768"></a><span class='hs-comment'>--</span>
<a name="line-769"></a><span class='hs-comment'>-- Ideally, you wouldn't have to use this unless you are making your own</span>
<a name="line-770"></a><span class='hs-comment'>-- framework.  Try your best to make what you want by assembling</span>
<a name="line-771"></a><span class='hs-comment'>-- primtives together.</span>
<a name="line-772"></a><span class='hs-comment'>--</span>
<a name="line-773"></a><span class='hs-comment'>-- But sometimes you have to write your own combinators, and you're going</span>
<a name="line-774"></a><span class='hs-comment'>-- to have to use 'mkAutoM' to make it work.</span>
<a name="line-775"></a><span class='hs-comment'>--</span>
<a name="line-776"></a><span class='hs-comment'>-- Sometimes, it's simple:</span>
<a name="line-777"></a><span class='hs-comment'>--</span>
<a name="line-778"></a><span class='hs-comment'>-- @</span>
<a name="line-779"></a><span class='hs-comment'>-- fmap :: (a -&gt; b) -&gt; Auto r a -&gt; Auto r b</span>
<a name="line-780"></a><span class='hs-comment'>-- fmap f a0 = mkAutoM (do aResumed &lt;- resumeAuto a0</span>
<a name="line-781"></a><span class='hs-comment'>--                         return (fmap f aResumed)  )</span>
<a name="line-782"></a><span class='hs-comment'>--                     (saveAuto a0)</span>
<a name="line-783"></a><span class='hs-comment'>--                     $ \x -&gt; do</span>
<a name="line-784"></a><span class='hs-comment'>--                         (y, a1) &lt;- stepAuto a0 x</span>
<a name="line-785"></a><span class='hs-comment'>--                         return (f y, fmap f a1)</span>
<a name="line-786"></a><span class='hs-comment'>-- @</span>
<a name="line-787"></a><span class='hs-comment'>--</span>
<a name="line-788"></a><span class='hs-comment'>-- Serializing @'fmap' f a0@ is just the same as serializing @a0@.  And to</span>
<a name="line-789"></a><span class='hs-comment'>-- resume it, we resume @a0@ to get a resumed version of @a0@, and then we</span>
<a name="line-790"></a><span class='hs-comment'>-- apply @'fmap' f@ to the 'Auto' that we resumed.</span>
<a name="line-791"></a><span class='hs-comment'>--</span>
<a name="line-792"></a><span class='hs-comment'>-- Also another nice "simple" example is:</span>
<a name="line-793"></a><span class='hs-comment'>--</span>
<a name="line-794"></a><span class='hs-comment'>-- @</span>
<a name="line-795"></a><span class='hs-comment'>-- catchA :: Exception e</span>
<a name="line-796"></a><span class='hs-comment'>--        =&gt; Auto IO a b</span>
<a name="line-797"></a><span class='hs-comment'>--        -&gt; Auto IO a (Either e b)</span>
<a name="line-798"></a><span class='hs-comment'>-- catchA a = mkAutoM (do aResumed &lt;- resumeAuto a</span>
<a name="line-799"></a><span class='hs-comment'>--                        return (catchA aResumed) )</span>
<a name="line-800"></a><span class='hs-comment'>--                    (saveAuto a)</span>
<a name="line-801"></a><span class='hs-comment'>--                  $ \x -&gt; do</span>
<a name="line-802"></a><span class='hs-comment'>--                      eya' &lt;- try $ stepAuto a x</span>
<a name="line-803"></a><span class='hs-comment'>--                      case eya' of</span>
<a name="line-804"></a><span class='hs-comment'>--                        Right (y, a') -&gt; return (Right y, catchA a')</span>
<a name="line-805"></a><span class='hs-comment'>--                        Left e        -&gt; return (Left e , catchA a )</span>
<a name="line-806"></a><span class='hs-comment'>-- @</span>
<a name="line-807"></a><span class='hs-comment'>--</span>
<a name="line-808"></a><span class='hs-comment'>-- Which is basically the same principle, in terms of serializing and</span>
<a name="line-809"></a><span class='hs-comment'>-- resuming strategies.</span>
<a name="line-810"></a><span class='hs-comment'>--</span>
<a name="line-811"></a><span class='hs-comment'>-- When you have "switching" --- things that behave like different 'Auto's</span>
<a name="line-812"></a><span class='hs-comment'>-- at different points in time --- then things get a little complicated,</span>
<a name="line-813"></a><span class='hs-comment'>-- because you have to figure out which 'Auto' to resume.</span>
<a name="line-814"></a><span class='hs-comment'>--</span>
<a name="line-815"></a><span class='hs-comment'>-- For example, let's look at the source of '-?&gt;':</span>
<a name="line-816"></a><span class='hs-comment'>--</span>
<a name="line-817"></a><span class='hs-comment'>-- @</span>
<a name="line-818"></a><span class='hs-comment'>-- (-?&gt;) :: Monad m</span>
<a name="line-819"></a><span class='hs-comment'>--       =&gt; Interval m a b   -- ^ initial behavior</span>
<a name="line-820"></a><span class='hs-comment'>--       -&gt; Interval m a b   -- ^ final behavior, when the initial</span>
<a name="line-821"></a><span class='hs-comment'>--                           --   behavior turns off.</span>
<a name="line-822"></a><span class='hs-comment'>--       -&gt; Interval m a b</span>
<a name="line-823"></a><span class='hs-comment'>-- a1 -?&gt; a2 = mkAutoM l s t</span>
<a name="line-824"></a><span class='hs-comment'>--   where</span>
<a name="line-825"></a><span class='hs-comment'>--     l = do</span>
<a name="line-826"></a><span class='hs-comment'>--       flag &lt;- get</span>
<a name="line-827"></a><span class='hs-comment'>--       if flag</span>
<a name="line-828"></a><span class='hs-comment'>--         then resumeAuto (switched a2)</span>
<a name="line-829"></a><span class='hs-comment'>--         else (-?&gt; a2) &lt;$&gt; resumeAuto a1</span>
<a name="line-830"></a><span class='hs-comment'>--     s = put False *&gt; saveAuto a1</span>
<a name="line-831"></a><span class='hs-comment'>--     t x = do</span>
<a name="line-832"></a><span class='hs-comment'>--       (y1, a1') &lt;- stepAuto a1 x</span>
<a name="line-833"></a><span class='hs-comment'>--       case y1 of</span>
<a name="line-834"></a><span class='hs-comment'>--         Just _  -&gt;</span>
<a name="line-835"></a><span class='hs-comment'>--           return (y1, a1' -?&gt; a2)</span>
<a name="line-836"></a><span class='hs-comment'>--         Nothing -&gt; do</span>
<a name="line-837"></a><span class='hs-comment'>--           (y, a2') &lt;- stepAuto a2 x</span>
<a name="line-838"></a><span class='hs-comment'>--           return (y, switched a2')</span>
<a name="line-839"></a><span class='hs-comment'>--     switched a = mkAutoM l</span>
<a name="line-840"></a><span class='hs-comment'>--                          (put True  *&gt; saveAuto a)</span>
<a name="line-841"></a><span class='hs-comment'>--                        $ \x -&gt; do</span>
<a name="line-842"></a><span class='hs-comment'>--                            (y, a') &lt;- stepAuto a x</span>
<a name="line-843"></a><span class='hs-comment'>--                            return (y, switched a')</span>
<a name="line-844"></a><span class='hs-comment'>-- @</span>
<a name="line-845"></a><span class='hs-comment'>--</span>
<a name="line-846"></a><span class='hs-comment'>-- We have to invent a serialization and reloading scheme, taking into</span>
<a name="line-847"></a><span class='hs-comment'>-- account the two states that the resulting 'Auto' can be in:</span>
<a name="line-848"></a><span class='hs-comment'>--</span>
<a name="line-849"></a><span class='hs-comment'>-- 1.   Initially, it is behaving like @a1@.  So, to save it, we put</span>
<a name="line-850"></a><span class='hs-comment'>--      a flag saying that we are still in stage 1 ('False'), and then</span>
<a name="line-851"></a><span class='hs-comment'>--      put @a1@'s current serialization data.</span>
<a name="line-852"></a><span class='hs-comment'>-- 2.   After the switch, it is behaving like @a2@.  So, to save it, we put</span>
<a name="line-853"></a><span class='hs-comment'>--      a flag saying that we are now in stage 2 ('True'), and then put</span>
<a name="line-854"></a><span class='hs-comment'>--      @a2@'s current.</span>
<a name="line-855"></a><span class='hs-comment'>--</span>
<a name="line-856"></a><span class='hs-comment'>-- Now, when we /resume/ @a1 '-?&gt;' a2@, 'resumeAuto' on @a1 '-?&gt;' a2@ will</span>
<a name="line-857"></a><span class='hs-comment'>-- give us @l@.  So the 'Get' we use --- the process we use to resume the</span>
<a name="line-858"></a><span class='hs-comment'>-- entire @a1 '-?&gt;' a2@, will /start/ at the initial 'Get'/loading</span>
<a name="line-859"></a><span class='hs-comment'>-- function, @l@ here.  We have to encode our branching and</span>
<a name="line-860"></a><span class='hs-comment'>-- resuming/serialization scheme into the initial, front-facing @l@.  So</span>
<a name="line-861"></a><span class='hs-comment'>-- @l@ has to check for the flag, and if the flag is true, load in the data</span>
<a name="line-862"></a><span class='hs-comment'>-- for the switched state; otherwise, load in the data for the pre-switched</span>
<a name="line-863"></a><span class='hs-comment'>-- state.</span>
<a name="line-864"></a><span class='hs-comment'>--</span>
<a name="line-865"></a><span class='hs-comment'>-- Not all of them are this tricky.  Mostly "switching" combinators will be</span>
<a name="line-866"></a><span class='hs-comment'>-- tricky, because switching means changing what you are serializing.</span>
<a name="line-867"></a><span class='hs-comment'>--</span>
<a name="line-868"></a><span class='hs-comment'>-- This one might be considerably easier, because of 'mapM':</span>
<a name="line-869"></a><span class='hs-comment'>--</span>
<a name="line-870"></a><span class='hs-comment'>-- @</span>
<a name="line-871"></a><span class='hs-comment'>-- zipAuto :: Monad m</span>
<a name="line-872"></a><span class='hs-comment'>--         =&gt; a                -- ^ default input value</span>
<a name="line-873"></a><span class='hs-comment'>--         -&gt; [Auto m a b]     -- ^ 'Auto's to zip up</span>
<a name="line-874"></a><span class='hs-comment'>--         -&gt; Auto m [a] [b]</span>
<a name="line-875"></a><span class='hs-comment'>-- zipAuto x0 as = mkAutoM (zipAuto x0 &lt;$&gt; mapM resumeAuto as)</span>
<a name="line-876"></a><span class='hs-comment'>--                         (mapM_ saveAuto as)</span>
<a name="line-877"></a><span class='hs-comment'>--                         $ \xs -&gt; do</span>
<a name="line-878"></a><span class='hs-comment'>--                             res &lt;- zipWithM stepAuto as (xs ++ repeat x0)</span>
<a name="line-879"></a><span class='hs-comment'>--                             let (ys, as') = unzip res</span>
<a name="line-880"></a><span class='hs-comment'>--                             return (ys, zipAuto x0 as')</span>
<a name="line-881"></a><span class='hs-comment'>-- @</span>
<a name="line-882"></a><span class='hs-comment'>--</span>
<a name="line-883"></a><span class='hs-comment'>-- To serialize, we basically sequence 'saveAuto' over all of the internal</span>
<a name="line-884"></a><span class='hs-comment'>-- 'Auto's --- serialize each of their serialization data one-by-one one</span>
<a name="line-885"></a><span class='hs-comment'>-- after the other in our binary.</span>
<a name="line-886"></a><span class='hs-comment'>--</span>
<a name="line-887"></a><span class='hs-comment'>-- To load, we do the same thing; we go over every 'Auto' in @as@ and</span>
<a name="line-888"></a><span class='hs-comment'>-- 'resumeAuto' it, and then collect the results in a list --- a list of</span>
<a name="line-889"></a><span class='hs-comment'>-- resumed 'Auto's.  And then we apply @'zipAuto' x0@ to that list of</span>
<a name="line-890"></a><span class='hs-comment'>-- 'Auto's, to get our resumed @'zipAuto' x0 as@.</span>
<a name="line-891"></a><span class='hs-comment'>--</span>
<a name="line-892"></a><span class='hs-comment'>-- So, it might be complicated.  In the end, it might be all worth it, too,</span>
<a name="line-893"></a><span class='hs-comment'>-- to have implicit serialization compose like this.  Think about your</span>
<a name="line-894"></a><span class='hs-comment'>-- serialization strategy first.  Step back and think about what you need</span>
<a name="line-895"></a><span class='hs-comment'>-- to serialize at every step, and remember that it's _the initial_</span>
<a name="line-896"></a><span class='hs-comment'>-- "resuming" function that has to "resume everything"...it's not the</span>
<a name="line-897"></a><span class='hs-comment'>-- resuming function that exists when you finally save your 'Auto', it's</span>
<a name="line-898"></a><span class='hs-comment'>-- the resuming 'Get' that was there /at the beginning/.  For '-?&gt;', the</span>
<a name="line-899"></a><span class='hs-comment'>-- intial @l@ had to know how to "skip ahead".</span>
<a name="line-900"></a><span class='hs-comment'>--</span>
<a name="line-901"></a><span class='hs-comment'>-- And of course as always, test.</span>
<a name="line-902"></a><span class='hs-comment'>--</span>
<a name="line-903"></a><span class='hs-comment'>-- If you need to make your own combinator or transformer but are having</span>
<a name="line-904"></a><span class='hs-comment'>-- trouble with the serializtion, feel free to contact me at</span>
<a name="line-905"></a><span class='hs-comment'>-- &lt;justin@jle.im&gt;, on freenode at /#haskell/ or /#haskell-auto/, open</span>
<a name="line-906"></a><span class='hs-comment'>-- a &lt;https://github.com/mstksg/auto/issues github issue&gt;, etc.  Just</span>
<a name="line-907"></a><span class='hs-comment'>-- contact me somehow, I'll be happy to help!</span>
<a name="line-908"></a><span class='hs-comment'>--</span>
<a name="line-909"></a><span class='hs-definition'>mkAutoM</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Get</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>             <span class='hs-comment'>-- ^ resuming/loading 'Get'</span>
<a name="line-910"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span>                          <span class='hs-comment'>-- ^ saving 'Put'</span>
<a name="line-911"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ (monadic) step function</span>
<a name="line-912"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-913"></a><span class='hs-definition'>mkAutoM</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoArbM</span>
<a name="line-914"></a><span class='hs-comment'>{-# INLINE mkAutoM #-}</span>
<a name="line-915"></a>
<a name="line-916"></a><a name="mkAuto_"></a><span class='hs-comment'>-- | Like 'mkAuto', but without any way of meaningful serializing or</span>
<a name="line-917"></a><span class='hs-comment'>-- deserializing.</span>
<a name="line-918"></a><span class='hs-comment'>--</span>
<a name="line-919"></a><span class='hs-comment'>-- Be careful!  This 'Auto' can still carry arbitrary internal state, but</span>
<a name="line-920"></a><span class='hs-comment'>-- it cannot be meaningfully serialized or re-loaded/resumed.  You can</span>
<a name="line-921"></a><span class='hs-comment'>-- still pretend to do so using</span>
<a name="line-922"></a><span class='hs-comment'>-- 'resumeAuto'/'saveAuto'/'encodeAuto'/'decodeAuto' (and the type system</span>
<a name="line-923"></a><span class='hs-comment'>-- won't stop you), but when you try to "resume"/decode it, its state will</span>
<a name="line-924"></a><span class='hs-comment'>-- be lost.</span>
<a name="line-925"></a><span class='hs-definition'>mkAuto_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ step function</span>
<a name="line-926"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-927"></a><span class='hs-definition'>mkAuto_</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkAuto</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkAuto_</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span>
<a name="line-928"></a><span class='hs-comment'>{-# INLINE mkAuto_ #-}</span>
<a name="line-929"></a>
<a name="line-930"></a><a name="mkAutoM_"></a><span class='hs-comment'>-- | Like 'mkAutoM', but without any way of meaningful serializing or</span>
<a name="line-931"></a><span class='hs-comment'>-- deserializing.</span>
<a name="line-932"></a><span class='hs-comment'>--</span>
<a name="line-933"></a><span class='hs-comment'>-- Be careful!  This 'Auto' can still carry arbitrary internal state, but</span>
<a name="line-934"></a><span class='hs-comment'>-- it cannot be meaningfully serialized or re-loaded/resumed.  You can</span>
<a name="line-935"></a><span class='hs-comment'>-- still pretend to do so using</span>
<a name="line-936"></a><span class='hs-comment'>-- 'resumeAuto'/'saveAuto'/'encodeAuto'/'decodeAuto' (and the type system</span>
<a name="line-937"></a><span class='hs-comment'>-- won't stop you), but when you try to "resume"/decode it, its state will</span>
<a name="line-938"></a><span class='hs-comment'>-- be reset.</span>
<a name="line-939"></a><span class='hs-definition'>mkAutoM_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ (monadic) step function</span>
<a name="line-940"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-941"></a><span class='hs-definition'>mkAutoM_</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkAutoM</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkAutoM_</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span>
<a name="line-942"></a><span class='hs-comment'>{-# INLINE mkAutoM_ #-}</span>
<a name="line-943"></a>
<a name="line-944"></a><a name="mkConst"></a><span class='hs-comment'>-- | Construct the 'Auto' whose output is always the given value, ignoring</span>
<a name="line-945"></a><span class='hs-comment'>-- its input.</span>
<a name="line-946"></a><span class='hs-comment'>--</span>
<a name="line-947"></a><span class='hs-comment'>-- Provided for API constency, but you should really be using 'pure' from</span>
<a name="line-948"></a><span class='hs-comment'>-- the 'Applicative' instance, from "Control.Applicative", which does the</span>
<a name="line-949"></a><span class='hs-comment'>-- same thing.</span>
<a name="line-950"></a><span class='hs-definition'>mkConst</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span>            <span class='hs-comment'>-- ^ constant value to be outputted</span>
<a name="line-951"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-952"></a><span class='hs-definition'>mkConst</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varop'>.</span> <span class='hs-varid'>const</span>
<a name="line-953"></a><span class='hs-comment'>{-# INLINE mkConst #-}</span>
<a name="line-954"></a>
<a name="line-955"></a><a name="mkConstM"></a><span class='hs-comment'>-- | Construct the 'Auto' that always "executes" the given monadic value at</span>
<a name="line-956"></a><span class='hs-comment'>-- every step, yielding the result as its output and ignoring its input.</span>
<a name="line-957"></a><span class='hs-comment'>--</span>
<a name="line-958"></a><span class='hs-comment'>-- Provided for API consistency, but you shold really be using 'effect'</span>
<a name="line-959"></a><span class='hs-comment'>-- from "Control.Auto.Effects", which does the same thing.</span>
<a name="line-960"></a><span class='hs-definition'>mkConstM</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>           <span class='hs-comment'>-- ^ monadic action to be executed at every step</span>
<a name="line-961"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-962"></a><span class='hs-definition'>mkConstM</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varop'>.</span> <span class='hs-varid'>const</span>
<a name="line-963"></a><span class='hs-comment'>{-# INLINE mkConstM #-}</span>
<a name="line-964"></a>
<a name="line-965"></a><a name="mkFunc"></a><span class='hs-comment'>-- | Construct a stateless 'Auto' that simply applies the given (pure)</span>
<a name="line-966"></a><span class='hs-comment'>-- function to every input, yielding the output.  The output stream is just</span>
<a name="line-967"></a><span class='hs-comment'>-- the result of applying the function to every input.</span>
<a name="line-968"></a><span class='hs-comment'>--</span>
<a name="line-969"></a><span class='hs-comment'>-- prop&gt; streamAuto' (mkFunc f) = map f</span>
<a name="line-970"></a><span class='hs-comment'>--</span>
<a name="line-971"></a><span class='hs-comment'>-- This is rarely needed; you should be using 'arr' from the 'Arrow'</span>
<a name="line-972"></a><span class='hs-comment'>-- instance, from "Control.Arrow".</span>
<a name="line-973"></a><span class='hs-definition'>mkFunc</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ pure function</span>
<a name="line-974"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-975"></a><span class='hs-definition'>mkFunc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoFunc</span>
<a name="line-976"></a><span class='hs-comment'>{-# INLINE mkFunc #-}</span>
<a name="line-977"></a>
<a name="line-978"></a><a name="mkFuncM"></a><span class='hs-comment'>-- | Construct a stateless 'Auto' that simply applies and executes the givne</span>
<a name="line-979"></a><span class='hs-comment'>-- (monadic) function to every input, yielding the output.  The output</span>
<a name="line-980"></a><span class='hs-comment'>-- stream is the result of applying the function to every input,</span>
<a name="line-981"></a><span class='hs-comment'>-- executing/sequencing the action, and returning the returned value.</span>
<a name="line-982"></a><span class='hs-comment'>--</span>
<a name="line-983"></a><span class='hs-comment'>-- prop&gt; streamAuto (mkFuncM f) = mapM f</span>
<a name="line-984"></a><span class='hs-comment'>--</span>
<a name="line-985"></a><span class='hs-comment'>-- It's recommended that you use 'arrM' from "Control.Auto.Effects".  This</span>
<a name="line-986"></a><span class='hs-comment'>-- is only really provided for consistency.</span>
<a name="line-987"></a><span class='hs-definition'>mkFuncM</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ "monadic" function</span>
<a name="line-988"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-989"></a><span class='hs-definition'>mkFuncM</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoFuncM</span>
<a name="line-990"></a><span class='hs-comment'>{-# INLINE mkFuncM #-}</span>
<a name="line-991"></a>
<a name="line-992"></a><a name="mkState"></a><span class='hs-comment'>-- | Construct an 'Auto' from a state transformer: an @a -&gt; s -&gt; (b, s)@</span>
<a name="line-993"></a><span class='hs-comment'>-- gives you an @'Auto' m a b@, for any 'Monad' @m@.  At every step, it</span>
<a name="line-994"></a><span class='hs-comment'>-- takes in the @a@ input, runs the function with the stored internal</span>
<a name="line-995"></a><span class='hs-comment'>-- state, returns the @b@ result, and now contains the new resulting state.</span>
<a name="line-996"></a><span class='hs-comment'>-- You have to intialize it with an initial state, of course.</span>
<a name="line-997"></a><span class='hs-comment'>--</span>
<a name="line-998"></a><span class='hs-comment'>-- From the "stream transformer" point of view, this is rougly equivalent</span>
<a name="line-999"></a><span class='hs-comment'>-- to 'mapAccumL' from "Data.List", with the function's arguments and</span>
<a name="line-1000"></a><span class='hs-comment'>-- results in the backwards order.</span>
<a name="line-1001"></a><span class='hs-comment'>--</span>
<a name="line-1002"></a><span class='hs-comment'>-- prop&gt; streamAuto' (mkState f s0) = snd . mapAccumL (\s x -&gt; swap (f x s))</span>
<a name="line-1003"></a><span class='hs-comment'>--</span>
<a name="line-1004"></a><span class='hs-comment'>-- Try not to use this if it's ever avoidable, unless you're a framework</span>
<a name="line-1005"></a><span class='hs-comment'>-- developer or something.  Try make something by combining/composing the</span>
<a name="line-1006"></a><span class='hs-comment'>-- various 'Auto' combinators.</span>
<a name="line-1007"></a><span class='hs-comment'>--</span>
<a name="line-1008"></a><span class='hs-comment'>-- If your state @s@ does not have a 'Serialize' instance, then you should</span>
<a name="line-1009"></a><span class='hs-comment'>-- either write a meaningful one, provide the serialization methods</span>
<a name="line-1010"></a><span class='hs-comment'>-- manually with 'mkState'', or throw away serializability and use</span>
<a name="line-1011"></a><span class='hs-comment'>-- 'mkState_'.</span>
<a name="line-1012"></a><span class='hs-definition'>mkState</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Serialize</span> <span class='hs-varid'>s</span>
<a name="line-1013"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ state transformer</span>
<a name="line-1014"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span>                        <span class='hs-comment'>-- ^ intial state</span>
<a name="line-1015"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1016"></a><span class='hs-definition'>mkState</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-layout'>(</span><span class='hs-varid'>get</span><span class='hs-layout'>,</span> <span class='hs-varid'>put</span><span class='hs-layout'>)</span>
<a name="line-1017"></a><span class='hs-comment'>{-# INLINE mkState #-}</span>
<a name="line-1018"></a>
<a name="line-1019"></a><a name="mkStateM"></a><span class='hs-comment'>-- | Construct an 'Auto' from a "monadic" state transformer: @a -&gt; s -&gt;</span>
<a name="line-1020"></a><span class='hs-comment'>-- m (b, s)@ gives you an @'Auto' m a b@.  At every step, it takes in the</span>
<a name="line-1021"></a><span class='hs-comment'>-- @a@ input, runs the function with the stored internal state and</span>
<a name="line-1022"></a><span class='hs-comment'>-- "executes" the @m (b, s)@ to get the @b@ output, and stores the @s@ as</span>
<a name="line-1023"></a><span class='hs-comment'>-- the new, updated state.  Must be initialized with an initial state.</span>
<a name="line-1024"></a><span class='hs-comment'>--</span>
<a name="line-1025"></a><span class='hs-comment'>-- Try not to use this if it's ever avoidable, unless you're a framework</span>
<a name="line-1026"></a><span class='hs-comment'>-- developer or something.  Try make something by combining/composing the</span>
<a name="line-1027"></a><span class='hs-comment'>-- various 'Auto' combinators.</span>
<a name="line-1028"></a><span class='hs-comment'>--</span>
<a name="line-1029"></a><span class='hs-comment'>-- This version is a wrapper around 'mkAuto', that keeps track of the</span>
<a name="line-1030"></a><span class='hs-comment'>-- serialization and re-loading of the internal state for you, so you don't</span>
<a name="line-1031"></a><span class='hs-comment'>-- have to deal with it explicitly.</span>
<a name="line-1032"></a><span class='hs-comment'>--</span>
<a name="line-1033"></a><span class='hs-comment'>-- If your state @s@ does not have a 'Serialize' instance, then you should</span>
<a name="line-1034"></a><span class='hs-comment'>-- either write a meaningful one, provide the serialization methods</span>
<a name="line-1035"></a><span class='hs-comment'>-- manually with 'mkStateM'', or throw away serializability and use</span>
<a name="line-1036"></a><span class='hs-comment'>-- 'mkStateM_'.</span>
<a name="line-1037"></a><span class='hs-definition'>mkStateM</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Serialize</span> <span class='hs-varid'>s</span>
<a name="line-1038"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ (monadic) state transformer</span>
<a name="line-1039"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span>                         <span class='hs-comment'>-- ^ initial state</span>
<a name="line-1040"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1041"></a><span class='hs-definition'>mkStateM</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>get</span><span class='hs-layout'>,</span> <span class='hs-varid'>put</span><span class='hs-layout'>)</span>
<a name="line-1042"></a><span class='hs-comment'>{-# INLINE mkStateM #-}</span>
<a name="line-1043"></a>
<a name="line-1044"></a><a name="mkState'"></a><span class='hs-comment'>-- | A version of 'mkState', where the internal state doesn't have</span>
<a name="line-1045"></a><span class='hs-comment'>-- a 'Serialize' instance, so you provide your own instructions for getting</span>
<a name="line-1046"></a><span class='hs-comment'>-- and putting the state.</span>
<a name="line-1047"></a><span class='hs-comment'>--</span>
<a name="line-1048"></a><span class='hs-comment'>-- See 'mkState' for more details.</span>
<a name="line-1049"></a><span class='hs-definition'>mkState'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Get</span> <span class='hs-varid'>s</span>                     <span class='hs-comment'>-- ^ 'Get'; strategy for reading and deserializing the state</span>
<a name="line-1050"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span><span class='hs-layout'>)</span>                <span class='hs-comment'>-- ^ 'Put'; strategy for serializing given state</span>
<a name="line-1051"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ state transformer</span>
<a name="line-1052"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span>                         <span class='hs-comment'>-- ^ intial state</span>
<a name="line-1053"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1054"></a><span class='hs-definition'>mkState'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>curry</span> <span class='hs-conid'>AutoState</span>
<a name="line-1055"></a><span class='hs-comment'>{-# INLINE mkState' #-}</span>
<a name="line-1056"></a>
<a name="line-1057"></a><a name="mkStateM'"></a><span class='hs-comment'>-- | A version of 'mkStateM', where the internal state doesn't have</span>
<a name="line-1058"></a><span class='hs-comment'>-- a 'Serialize' instance, so you provide your own instructions for getting</span>
<a name="line-1059"></a><span class='hs-comment'>-- and putting the state.</span>
<a name="line-1060"></a><span class='hs-comment'>--</span>
<a name="line-1061"></a><span class='hs-comment'>-- See 'mkStateM' for more details.</span>
<a name="line-1062"></a><span class='hs-definition'>mkStateM'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Get</span> <span class='hs-varid'>s</span>                      <span class='hs-comment'>-- ^ 'Get'; strategy for reading and deserializing the state</span>
<a name="line-1063"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span><span class='hs-layout'>)</span>                 <span class='hs-comment'>-- ^ 'Put'; strategy for serializing given state</span>
<a name="line-1064"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ (monadic) state transformer</span>
<a name="line-1065"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span>                          <span class='hs-comment'>-- ^ initial state</span>
<a name="line-1066"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1067"></a><span class='hs-definition'>mkStateM'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>curry</span> <span class='hs-conid'>AutoStateM</span>
<a name="line-1068"></a><span class='hs-comment'>{-# INLINE mkStateM' #-}</span>
<a name="line-1069"></a>
<a name="line-1070"></a><a name="mkState_"></a><span class='hs-comment'>-- | A version of 'mkState', where the internal state isn't serialized.  It</span>
<a name="line-1071"></a><span class='hs-comment'>-- can be "saved" and "loaded", but the state is lost in the process.</span>
<a name="line-1072"></a><span class='hs-comment'>--</span>
<a name="line-1073"></a><span class='hs-comment'>-- See 'mkState' for more details.</span>
<a name="line-1074"></a><span class='hs-comment'>--</span>
<a name="line-1075"></a><span class='hs-comment'>-- Useful if your state @s@ cannot have a meaningful 'Serialize' instance.</span>
<a name="line-1076"></a><span class='hs-definition'>mkState_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ state transformer</span>
<a name="line-1077"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span>                     <span class='hs-comment'>-- ^ initial state</span>
<a name="line-1078"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1079"></a><span class='hs-definition'>mkState_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varid'>s0</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s0</span>
<a name="line-1080"></a><span class='hs-comment'>{-# INLINE mkState_ #-}</span>
<a name="line-1081"></a>
<a name="line-1082"></a><a name="mkStateM_"></a><span class='hs-comment'>-- | A version of 'mkStateM', where the internal state isn't serialized.</span>
<a name="line-1083"></a><span class='hs-comment'>-- It can be "saved" and "loaded", but the state is lost in the process.</span>
<a name="line-1084"></a><span class='hs-comment'>--</span>
<a name="line-1085"></a><span class='hs-comment'>-- See 'mkStateM' for more details.</span>
<a name="line-1086"></a><span class='hs-comment'>--</span>
<a name="line-1087"></a><span class='hs-comment'>-- Useful if your state @s@ cannot have a meaningful 'Serialize' instance.</span>
<a name="line-1088"></a><span class='hs-definition'>mkStateM_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ (monadic) state transformer</span>
<a name="line-1089"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span>                      <span class='hs-comment'>-- ^ initial state</span>
<a name="line-1090"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1091"></a><span class='hs-definition'>mkStateM_</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varid'>s0</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s0</span>
<a name="line-1092"></a><span class='hs-comment'>{-# INLINE mkStateM_ #-}</span>
<a name="line-1093"></a>
<a name="line-1094"></a><a name="accum"></a><span class='hs-comment'>-- | Construct an 'Auto' from a "folding" function: @b -&gt; a -&gt; b@ yields an</span>
<a name="line-1095"></a><span class='hs-comment'>-- @'Auto' m a b@.  Basically acts like a 'foldl' or a 'scanl'.  There is</span>
<a name="line-1096"></a><span class='hs-comment'>-- an internal accumulator that is "updated" with an @a@ at every step.</span>
<a name="line-1097"></a><span class='hs-comment'>-- Must be given an initial accumulator.</span>
<a name="line-1098"></a><span class='hs-comment'>--</span>
<a name="line-1099"></a><span class='hs-comment'>-- Example: an 'Auto' that sums up all of its input.</span>
<a name="line-1100"></a><span class='hs-comment'>--</span>
<a name="line-1101"></a><span class='hs-comment'>-- &gt;&gt;&gt; let summer = accum (+) 0</span>
<a name="line-1102"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (sum1, summer')  = stepAuto' summer 3</span>
<a name="line-1103"></a><span class='hs-comment'>-- &gt;&gt;&gt; sum1</span>
<a name="line-1104"></a><span class='hs-comment'>-- 3</span>
<a name="line-1105"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (sum2, summer'') = stepAuto' summer' 10</span>
<a name="line-1106"></a><span class='hs-comment'>-- &gt;&gt;&gt; sum2</span>
<a name="line-1107"></a><span class='hs-comment'>-- 13</span>
<a name="line-1108"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto'  summer'' [1..10]</span>
<a name="line-1109"></a><span class='hs-comment'>-- [14,16,19,23,28,34,41,49,58,68]</span>
<a name="line-1110"></a><span class='hs-comment'>--</span>
<a name="line-1111"></a><span class='hs-comment'>-- If your accumulator @b@ does not have a 'Serialize' instance, then you</span>
<a name="line-1112"></a><span class='hs-comment'>-- should either write a meaningful one, or throw away serializability and</span>
<a name="line-1113"></a><span class='hs-comment'>-- use 'accum_'.</span>
<a name="line-1114"></a><span class='hs-definition'>accum</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Serialize</span> <span class='hs-varid'>b</span>
<a name="line-1115"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ accumulating function</span>
<a name="line-1116"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>                  <span class='hs-comment'>-- ^ initial accumulator</span>
<a name="line-1117"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1118"></a><span class='hs-definition'>accum</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkState</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>in</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1119"></a><span class='hs-comment'>{-# INLINE accum #-}</span>
<a name="line-1120"></a>
<a name="line-1121"></a><a name="accumM"></a><span class='hs-comment'>-- | Construct an 'Auto' from a "monadic" "folding" function: @b -&gt; a -&gt;</span>
<a name="line-1122"></a><span class='hs-comment'>-- m b@ yields an @'Auto' m a b@.  Basically acts like a 'foldM' or 'scanM'</span>
<a name="line-1123"></a><span class='hs-comment'>-- (if it existed).  here is an internal accumulator that is "updated" with</span>
<a name="line-1124"></a><span class='hs-comment'>-- an input @a@ with the result of the executed @m b@ at every step.  Must</span>
<a name="line-1125"></a><span class='hs-comment'>-- be given an initial accumulator.</span>
<a name="line-1126"></a><span class='hs-comment'>--</span>
<a name="line-1127"></a><span class='hs-comment'>-- See 'accum' for more details.</span>
<a name="line-1128"></a><span class='hs-comment'>--</span>
<a name="line-1129"></a><span class='hs-comment'>-- If your accumulator @b@ does not have a 'Serialize' instance, then you</span>
<a name="line-1130"></a><span class='hs-comment'>-- should either write a meaningful one, or throw away serializability and</span>
<a name="line-1131"></a><span class='hs-comment'>-- use 'accumM_'.</span>
<a name="line-1132"></a><span class='hs-definition'>accumM</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Serialize</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-1133"></a>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ (monadic) accumulating function</span>
<a name="line-1134"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>                     <span class='hs-comment'>-- ^ initial accumulator</span>
<a name="line-1135"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1136"></a><span class='hs-definition'>accumM</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkStateM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>join</span> <span class='hs-conid'>(,)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1137"></a><span class='hs-comment'>{-# INLINE accumM #-}</span>
<a name="line-1138"></a>
<a name="line-1139"></a><a name="accum_"></a><span class='hs-comment'>-- | A version of 'accum', where the internal accumulator isn't</span>
<a name="line-1140"></a><span class='hs-comment'>-- serialized. It can be "saved" and "loaded", but the state is lost in the</span>
<a name="line-1141"></a><span class='hs-comment'>-- process.</span>
<a name="line-1142"></a><span class='hs-comment'>--</span>
<a name="line-1143"></a><span class='hs-comment'>-- See 'accum' for more details.</span>
<a name="line-1144"></a><span class='hs-comment'>--</span>
<a name="line-1145"></a><span class='hs-comment'>-- Useful if your accumulator @b@ cannot have a meaningful 'Serialize'</span>
<a name="line-1146"></a><span class='hs-comment'>-- instance.</span>
<a name="line-1147"></a><span class='hs-definition'>accum_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ accumulating function</span>
<a name="line-1148"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>               <span class='hs-comment'>-- ^ intial accumulator</span>
<a name="line-1149"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1150"></a><span class='hs-definition'>accum_</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkState_</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>in</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1151"></a><span class='hs-comment'>{-# INLINE accum_ #-}</span>
<a name="line-1152"></a>
<a name="line-1153"></a><a name="accumM_"></a><span class='hs-comment'>-- | A version of 'accumM_, where the internal accumulator isn't</span>
<a name="line-1154"></a><span class='hs-comment'>-- serialized. It can be "saved" and "loaded", but the state is lost in the</span>
<a name="line-1155"></a><span class='hs-comment'>-- process.</span>
<a name="line-1156"></a><span class='hs-comment'>--</span>
<a name="line-1157"></a><span class='hs-comment'>-- See 'accumM' for more details.</span>
<a name="line-1158"></a><span class='hs-comment'>--</span>
<a name="line-1159"></a><span class='hs-comment'>-- Useful if your accumulator @b@ cannot have a meaningful 'Serialize'</span>
<a name="line-1160"></a><span class='hs-comment'>-- instance.</span>
<a name="line-1161"></a><span class='hs-definition'>accumM_</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-1162"></a>          <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ (monadic) accumulating function</span>
<a name="line-1163"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>                  <span class='hs-comment'>-- ^ initial accumulator</span>
<a name="line-1164"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1165"></a><span class='hs-definition'>accumM_</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkStateM_</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>join</span> <span class='hs-conid'>(,)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1166"></a><span class='hs-comment'>{-# INLINE accumM_ #-}</span>
<a name="line-1167"></a>
<a name="line-1168"></a><a name="accumD"></a><span class='hs-comment'>-- | A "delayed" version of 'accum', where the first output is the initial</span>
<a name="line-1169"></a><span class='hs-comment'>-- state of the accumulator, before applying the folding function. Useful</span>
<a name="line-1170"></a><span class='hs-comment'>-- in recursive bindings.</span>
<a name="line-1171"></a><span class='hs-comment'>--</span>
<a name="line-1172"></a><span class='hs-comment'>-- &gt;&gt;&gt; let summerD = accumD (+) 0</span>
<a name="line-1173"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (sum1, summerD')  = stepAuto' summerD 3</span>
<a name="line-1174"></a><span class='hs-comment'>-- &gt;&gt;&gt; sum1</span>
<a name="line-1175"></a><span class='hs-comment'>-- 0</span>
<a name="line-1176"></a><span class='hs-comment'>-- &gt;&gt;&gt; let (sum2, summerD'') = stepAuto' summerD' 10</span>
<a name="line-1177"></a><span class='hs-comment'>-- &gt;&gt;&gt; sum2</span>
<a name="line-1178"></a><span class='hs-comment'>-- 3</span>
<a name="line-1179"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto'  summerD'' [1..10]</span>
<a name="line-1180"></a><span class='hs-comment'>-- [13,14,16,19,23,28,34,41,49,58]</span>
<a name="line-1181"></a><span class='hs-comment'>--</span>
<a name="line-1182"></a><span class='hs-comment'>-- (Compare with the example in 'accum')</span>
<a name="line-1183"></a><span class='hs-comment'>--</span>
<a name="line-1184"></a><span class='hs-comment'>-- Note that this is more or less an encoding of 'scanl', that can be</span>
<a name="line-1185"></a><span class='hs-comment'>-- "decoded" with 'streamAuto'':</span>
<a name="line-1186"></a><span class='hs-comment'>--</span>
<a name="line-1187"></a><span class='hs-comment'>-- &gt;&gt;&gt; let myScanl f z = streamAuto' (accumD f z)</span>
<a name="line-1188"></a><span class='hs-comment'>-- &gt;&gt;&gt; scanl (+) 0 [1..10]</span>
<a name="line-1189"></a><span class='hs-comment'>-- [0,3,6,10,15,21,28,36,45,55]</span>
<a name="line-1190"></a><span class='hs-comment'>-- &gt;&gt;&gt; myScanl (+) 0 [1..10]</span>
<a name="line-1191"></a><span class='hs-comment'>-- [0,3,6,10,15,21,28,36,45]</span>
<a name="line-1192"></a><span class='hs-comment'>--</span>
<a name="line-1193"></a><span class='hs-comment'>-- The only difference is that you don't get the last element.  (You could</span>
<a name="line-1194"></a><span class='hs-comment'>-- force it out, if you wanted, by feeding any nonsense value in --- even</span>
<a name="line-1195"></a><span class='hs-comment'>-- 'undefined'! --- and getting the result)</span>
<a name="line-1196"></a><span class='hs-comment'>--</span>
<a name="line-1197"></a><span class='hs-definition'>accumD</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Serialize</span> <span class='hs-varid'>b</span>
<a name="line-1198"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ accumulating function</span>
<a name="line-1199"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>                  <span class='hs-comment'>-- ^ initial accumulator</span>
<a name="line-1200"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1201"></a><span class='hs-definition'>accumD</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkState</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1202"></a><span class='hs-comment'>{-# INLINE accumD #-}</span>
<a name="line-1203"></a>
<a name="line-1204"></a><a name="accumMD"></a><span class='hs-comment'>-- | A "delayed" version of 'accumM', where the first output is the initial</span>
<a name="line-1205"></a><span class='hs-comment'>-- state of the accumulator, before applying the folding function. Useful</span>
<a name="line-1206"></a><span class='hs-comment'>-- in recursive bindings.</span>
<a name="line-1207"></a><span class='hs-definition'>accumMD</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Serialize</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-1208"></a>          <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- ^ (monadic) accumulating function</span>
<a name="line-1209"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>                     <span class='hs-comment'>-- ^ initial accumulator</span>
<a name="line-1210"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1211"></a><span class='hs-definition'>accumMD</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkStateM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1212"></a><span class='hs-comment'>{-# INLINE accumMD #-}</span>
<a name="line-1213"></a>
<a name="line-1214"></a><a name="accumD_"></a><span class='hs-comment'>-- | The non-resuming/non-serializing version of 'accumD'.</span>
<a name="line-1215"></a><span class='hs-definition'>accumD_</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^ accumulating function</span>
<a name="line-1216"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>               <span class='hs-comment'>-- ^ intial accumulator</span>
<a name="line-1217"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1218"></a><span class='hs-definition'>accumD_</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkState_</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1219"></a><span class='hs-comment'>{-# INLINE accumD_ #-}</span>
<a name="line-1220"></a>
<a name="line-1221"></a><a name="accumMD_"></a><span class='hs-comment'>-- | The non-resuming/non-serializing version of 'accumMD'.</span>
<a name="line-1222"></a><span class='hs-definition'>accumMD_</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span>
<a name="line-1223"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ (monadic) accumulating function</span>
<a name="line-1224"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>                  <span class='hs-comment'>-- ^ initial accumulator</span>
<a name="line-1225"></a>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-1226"></a><span class='hs-definition'>accumMD_</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkStateM_</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1227"></a><span class='hs-comment'>{-# INLINE accumMD_ #-}</span>
<a name="line-1228"></a>
<a name="line-1229"></a><a name="instance%20Functor%20(Auto%20m%20a)"></a><span class='hs-comment'>-- | Maps over the output stream of the 'Auto'.</span>
<a name="line-1230"></a><a name="instance%20Functor%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1231"></a><a name="instance%20Functor%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1..10]</span>
<a name="line-1232"></a><a name="instance%20Functor%20(Auto%20m%20a)"></a><span class='hs-comment'>-- [1,3,6,10,15,21,28,36,45,55]</span>
<a name="line-1233"></a><a name="instance%20Functor%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (show &lt;$&gt; sumFrom 0) [1..10]</span>
<a name="line-1234"></a><a name="instance%20Functor%20(Auto%20m%20a)"></a><span class='hs-comment'>-- ["1","3","6","10","15","21","28","36","45","55"]</span>
<a name="line-1235"></a><a name="instance%20Functor%20(Auto%20m%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Functor</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1236"></a>    <span class='hs-varid'>fmap</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rmap</span>
<a name="line-1237"></a>    <span class='hs-comment'>{-# INLINE fmap #-}</span>
<a name="line-1238"></a>
<a name="line-1239"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- | 'pure' creates the "constant" 'Auto':</span>
<a name="line-1240"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1241"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (pure "foo") [1..5]</span>
<a name="line-1242"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- ["foo","foo","foo","foo","foo"]</span>
<a name="line-1243"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1244"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- '&lt;*&gt;' and 'liftA2' etc. give you the ability to fork the input stream</span>
<a name="line-1245"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- over many 'Auto's, and recombine the results:</span>
<a name="line-1246"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1247"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1..10]</span>
<a name="line-1248"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- [ 1, 3,  6, 10,  15]</span>
<a name="line-1249"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (productFrom 1) [1..10]</span>
<a name="line-1250"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- [ 1, 2,  6, 24, 120]</span>
<a name="line-1251"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (liftA2 (+) (sumFrom 0) (productFrom 1)) [1..5]</span>
<a name="line-1252"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- [ 2, 5, 12, 34, 135]</span>
<a name="line-1253"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1254"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- For effectful 'Auto', you can imagine '*&gt;' as "forking" the input stream</span>
<a name="line-1255"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- through both, and only keeping the result of the second:</span>
<a name="line-1256"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1257"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- @</span>
<a name="line-1258"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- 'effect' 'print' *&gt; 'sumFrom' 0</span>
<a name="line-1259"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- @</span>
<a name="line-1260"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1261"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- would, for example, behave just like @'sumFrom' 0@, except printing the</span>
<a name="line-1262"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- input to 'IO' at every step.</span>
<a name="line-1263"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1264"></a><a name="instance%20Applicative%20(Auto%20m%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Applicative</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1265"></a>    <span class='hs-varid'>pure</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkConst</span>
<a name="line-1266"></a>    <span class='hs-comment'>{-# INLINE pure #-}</span>
<a name="line-1267"></a>    <span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>ax</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span><span class='hs-layout'>,</span> <span class='hs-varid'>ax</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-1268"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1269"></a>                      <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1270"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1271"></a>                      <span class='hs-conid'>AutoFuncM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-1272"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1273"></a>                      <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1274"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1275"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1276"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1277"></a>                      <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varop'>***</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span>
<a name="line-1278"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1279"></a>                      <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varop'>***</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-1280"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1281"></a>                      <span class='hs-conid'>AutoFuncM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-1282"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1283"></a>                      <span class='hs-conid'>AutoFuncM</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varop'>`ap`</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span>
<a name="line-1284"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1285"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>first</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1286"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1287"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM2</span> <span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1288"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1289"></a>                      <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varop'>***</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-1290"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1291"></a>                      <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM2</span> <span class='hs-layout'>(</span><span class='hs-varop'>***</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&lt;*&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-1292"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1293"></a>                      <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1294"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1295"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>x'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1296"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpx</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1297"></a>                      <span class='hs-conid'>AutoState</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>gpx</span><span class='hs-layout'>)</span>
<a name="line-1298"></a>                                <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sf'</span>
<a name="line-1299"></a>                                                      <span class='hs-layout'>(</span><span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sx'</span>
<a name="line-1300"></a>                                                  <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>f'</span> <span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1301"></a>                                <span class='hs-layout'>(</span><span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span>
<a name="line-1302"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpx</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1303"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>gpx</span><span class='hs-layout'>)</span>
<a name="line-1304"></a>                                 <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sf'</span>
<a name="line-1305"></a>                                                      <span class='hs-layout'>(</span><span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sx'</span>
<a name="line-1306"></a>                                                      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span> <span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1307"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span>
<a name="line-1308"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1309"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1310"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1311"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span><span class='hs-layout'>,</span> <span class='hs-varid'>s''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>s'</span>
<a name="line-1312"></a>                                                 <span class='hs-varid'>x'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span>
<a name="line-1313"></a>                                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span> <span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-varid'>s''</span><span class='hs-layout'>)</span>
<a name="line-1314"></a>                                    <span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1315"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpx</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1316"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>gpx</span><span class='hs-layout'>)</span>
<a name="line-1317"></a>                                 <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sf'</span>
<a name="line-1318"></a>                                                      <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sx'</span>
<a name="line-1319"></a>                                                      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span> <span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1320"></a>                                 <span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span>
<a name="line-1321"></a>                  <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpx</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1322"></a>                      <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>gpx</span><span class='hs-layout'>)</span>
<a name="line-1323"></a>                                 <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>i</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sf'</span>
<a name="line-1324"></a>                                                      <span class='hs-layout'>(</span><span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>sx'</span>
<a name="line-1325"></a>                                                      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>f'</span> <span class='hs-varid'>x'</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1326"></a>                                 <span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>sf</span><span class='hs-layout'>,</span> <span class='hs-varid'>sx</span><span class='hs-layout'>)</span>
<a name="line-1327"></a>                  <span class='hs-comment'>-- i give up!</span>
<a name="line-1328"></a>                  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>uncurry</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>af</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>ax</span><span class='hs-layout'>)</span>
<a name="line-1329"></a>    <span class='hs-comment'>{-# INLINE (&lt;*&gt;) #-}</span>
<a name="line-1330"></a>
<a name="line-1331"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- | When the underlying 'Monad'/'Applicative' @m@ is an 'Alternative',</span>
<a name="line-1332"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- fork the input through each one and "squish" their results together</span>
<a name="line-1333"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- inside the 'Alternative' context.  See 'runTraversableA' for similar use</span>
<a name="line-1334"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- cases.</span>
<a name="line-1335"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1336"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto (arrM (mfilter even . Just)) [1..10]</span>
<a name="line-1337"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- Nothing</span>
<a name="line-1338"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto (arrM (Just . negate)) [1..10]</span>
<a name="line-1339"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- Just [-1,-2,-3,-4,-5,-6,-7,-8,-9,-10]</span>
<a name="line-1340"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto (arrM (mfilter even . Just)) &lt;|&gt; arrM (Just . negate)) [1..10]</span>
<a name="line-1341"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>-- Just [-1,2,-3,4,-5,6,-7,8,-9,10]</span>
<a name="line-1342"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-comment'>--</span>
<a name="line-1343"></a><a name="instance%20Alternative%20(Auto%20m%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Alternative</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Alternative</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1344"></a>    <span class='hs-varid'>empty</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkConstM</span> <span class='hs-varid'>empty</span>
<a name="line-1345"></a>    <span class='hs-varid'>a1</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkAutoM</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&lt;|&gt;</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>resumeAuto</span> <span class='hs-varid'>a1</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>resumeAuto</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span>
<a name="line-1346"></a>                        <span class='hs-layout'>(</span><span class='hs-varid'>saveAuto</span> <span class='hs-varid'>a1</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>saveAuto</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span>
<a name="line-1347"></a>                        <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>res1</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>second</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span> <span class='hs-varop'>`liftM`</span> <span class='hs-varid'>stepAuto</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>x</span>
<a name="line-1348"></a>                                    <span class='hs-varid'>res2</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>second</span> <span class='hs-layout'>(</span><span class='hs-varid'>a1</span> <span class='hs-varop'>&lt;|&gt;</span><span class='hs-layout'>)</span> <span class='hs-varop'>`liftM`</span> <span class='hs-varid'>stepAuto</span> <span class='hs-varid'>a2</span> <span class='hs-varid'>x</span>
<a name="line-1349"></a>                                <span class='hs-keyword'>in</span>  <span class='hs-varid'>res1</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>res2</span>
<a name="line-1350"></a>
<a name="line-1351"></a><a name="instance%20Category%20(Auto%20m)"></a><span class='hs-comment'>-- | Gives the ability to "compose" two 'Auto's; feeds the input stream</span>
<a name="line-1352"></a><a name="instance%20Category%20(Auto%20m)"></a><span class='hs-comment'>-- into the first, feeds that output stream into the second, and returns as</span>
<a name="line-1353"></a><a name="instance%20Category%20(Auto%20m)"></a><span class='hs-comment'>-- a result the output stream of the second.</span>
<a name="line-1354"></a><a name="instance%20Category%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Category</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1355"></a>    <span class='hs-varid'>id</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFunc</span> <span class='hs-varid'>id</span>
<a name="line-1356"></a>    <span class='hs-varid'>ag</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>ag</span><span class='hs-layout'>,</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-1357"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1358"></a>                    <span class='hs-conid'>AutoFunc</span>   <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1359"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1360"></a>                    <span class='hs-conid'>AutoFuncM</span>  <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>g</span> <span class='hs-varop'>&lt;=&lt;</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1361"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1362"></a>                    <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1363"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1364"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1365"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1366"></a>                    <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>ag</span> <span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>***</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1367"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1368"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>ag</span> <span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>***</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1369"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1370"></a>                    <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>&lt;=&lt;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1371"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1372"></a>                    <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>&lt;=&lt;</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1373"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1374"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>firstM</span> <span class='hs-varid'>g</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1375"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1376"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>firstM</span> <span class='hs-varid'>g</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1377"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1378"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>ag</span> <span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1379"></a>                             <span class='hs-varid'>s</span>
<a name="line-1380"></a>                           <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1381"></a>                               <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1382"></a>                               <span class='hs-varid'>y'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1383"></a>                               <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y'</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1384"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1385"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>ag</span> <span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1386"></a>                             <span class='hs-varid'>s</span>
<a name="line-1387"></a>                           <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1388"></a>                               <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1389"></a>                               <span class='hs-varid'>y'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1390"></a>                               <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y'</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1391"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1392"></a>                    <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>sg</span>
<a name="line-1393"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1394"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>sg'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varop'>`g`</span> <span class='hs-varid'>sg'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>sg</span>
<a name="line-1395"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1396"></a>                    <span class='hs-conid'>AutoState</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>gpf</span><span class='hs-layout'>)</span>
<a name="line-1397"></a>                              <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf'</span>
<a name="line-1398"></a>                                                    <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg'</span>
<a name="line-1399"></a>                                                <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-1400"></a>                              <span class='hs-layout'>(</span><span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1401"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1402"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>gpf</span><span class='hs-layout'>)</span>
<a name="line-1403"></a>                               <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1404"></a>                                    <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf'</span>
<a name="line-1405"></a>                                    <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg'</span>
<a name="line-1406"></a>                                    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-1407"></a>                               <span class='hs-layout'>(</span><span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1408"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gg</span><span class='hs-layout'>,</span><span class='hs-varid'>pg</span><span class='hs-layout'>)</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1409"></a>                    <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>sg'</span> <span class='hs-varid'>af'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-varid'>gg</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1410"></a>                            <span class='hs-layout'>(</span><span class='hs-varid'>pg</span> <span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-1411"></a>                            <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1412"></a>                                        <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg</span>
<a name="line-1413"></a>                                        <span class='hs-varid'>ag'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span>
<a name="line-1414"></a>                                    <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1415"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gg</span><span class='hs-layout'>,</span><span class='hs-varid'>pg</span><span class='hs-layout'>)</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1416"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>sg'</span> <span class='hs-varid'>af'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-varid'>gg</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1417"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>pg</span> <span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-1418"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1419"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1420"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg</span>
<a name="line-1421"></a>                                     <span class='hs-varid'>ag'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span>
<a name="line-1422"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1423"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1424"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>&lt;=&lt;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>sg</span>
<a name="line-1425"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1426"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>sg'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>sg</span>
<a name="line-1427"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1428"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>gpf</span><span class='hs-layout'>)</span>
<a name="line-1429"></a>                               <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1430"></a>                                  <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf'</span>
<a name="line-1431"></a>                                  <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg'</span>
<a name="line-1432"></a>                                  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-1433"></a>                               <span class='hs-layout'>(</span><span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1434"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1435"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-layout'>(</span><span class='hs-varid'>mergeStSt</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>gpf</span><span class='hs-layout'>)</span>
<a name="line-1436"></a>                               <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1437"></a>                                  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf'</span>
<a name="line-1438"></a>                                  <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg''</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg'</span>
<a name="line-1439"></a>                                  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>sg''</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf''</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-1440"></a>                               <span class='hs-layout'>(</span><span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1441"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gg</span><span class='hs-layout'>,</span><span class='hs-varid'>pg</span><span class='hs-layout'>)</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1442"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>sg'</span> <span class='hs-varid'>af'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-varid'>gg</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1443"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>pg</span> <span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-1444"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1445"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1446"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg</span>
<a name="line-1447"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-varid'>ag'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span>
<a name="line-1448"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1449"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gg</span><span class='hs-layout'>,</span><span class='hs-varid'>pg</span><span class='hs-layout'>)</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1450"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>sg'</span> <span class='hs-varid'>af'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-varid'>gg</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1451"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>pg</span> <span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-1452"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1453"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1454"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>sg'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span> <span class='hs-varid'>sg</span>
<a name="line-1455"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-varid'>ag'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>g</span> <span class='hs-varid'>sg'</span>
<a name="line-1456"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1457"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1458"></a>                    <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1459"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1460"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>second</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>g</span> <span class='hs-varop'>&lt;=&lt;</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1461"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gf</span><span class='hs-layout'>,</span><span class='hs-varid'>pf</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1462"></a>                    <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ag'</span> <span class='hs-varid'>sf'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-varid'>gf</span><span class='hs-layout'>)</span>
<a name="line-1463"></a>                            <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pf</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1464"></a>                            <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf</span>
<a name="line-1465"></a>                                        <span class='hs-varid'>af'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span>
<a name="line-1466"></a>                                        <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1467"></a>                                    <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1468"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gf</span><span class='hs-layout'>,</span><span class='hs-varid'>pf</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1469"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ag'</span> <span class='hs-varid'>sf'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-varid'>gf</span><span class='hs-layout'>)</span>
<a name="line-1470"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pf</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1471"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1472"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf</span>
<a name="line-1473"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-varid'>af'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span>
<a name="line-1474"></a>                                     <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1475"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1476"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>sg</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>lf</span> <span class='hs-varid'>sf</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1477"></a>                    <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>lf</span><span class='hs-layout'>)</span>
<a name="line-1478"></a>                            <span class='hs-layout'>(</span><span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1479"></a>                            <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1480"></a>                                        <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1481"></a>                                    <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1482"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArb</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>sg</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>lf</span> <span class='hs-varid'>sf</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1483"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>lf</span><span class='hs-layout'>)</span>
<a name="line-1484"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1485"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1486"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1487"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1488"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1489"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1490"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1491"></a>                             <span class='hs-varid'>s</span>
<a name="line-1492"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1493"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1494"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1495"></a>                             <span class='hs-varid'>s</span>
<a name="line-1496"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span> <span class='hs-varid'>af</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>g</span> <span class='hs-varop'>&lt;=&lt;</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1497"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gf</span><span class='hs-layout'>,</span><span class='hs-varid'>pf</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1498"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ag'</span> <span class='hs-varid'>sf'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-varid'>gf</span><span class='hs-layout'>)</span>
<a name="line-1499"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pf</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1500"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1501"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf</span>
<a name="line-1502"></a>                                     <span class='hs-varid'>af'</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span>
<a name="line-1503"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1504"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1505"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>gf</span><span class='hs-layout'>,</span><span class='hs-varid'>pf</span><span class='hs-layout'>)</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1506"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>ag'</span> <span class='hs-varid'>sf'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span> <span class='hs-varid'>gf</span><span class='hs-layout'>)</span>
<a name="line-1507"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pf</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1508"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1509"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>sf'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>sf</span>
<a name="line-1510"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-varid'>af'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpf</span> <span class='hs-varid'>f</span> <span class='hs-varid'>sf'</span>
<a name="line-1511"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1512"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1513"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>sg</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>lf</span> <span class='hs-varid'>sf</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1514"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>lf</span><span class='hs-layout'>)</span>
<a name="line-1515"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1516"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1517"></a>                                 <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1518"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1519"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1520"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>sg</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>lf</span> <span class='hs-varid'>sf</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1521"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varid'>lg</span> <span class='hs-varid'>lf</span><span class='hs-layout'>)</span>
<a name="line-1522"></a>                             <span class='hs-layout'>(</span><span class='hs-varid'>sg</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>sf</span><span class='hs-layout'>)</span>
<a name="line-1523"></a>                             <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1524"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1525"></a>                                 <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>g</span> <span class='hs-varid'>y</span>
<a name="line-1526"></a>                                 <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>ag'</span> <span class='hs-varop'>.</span> <span class='hs-varid'>af'</span><span class='hs-layout'>)</span>
<a name="line-1527"></a>    <span class='hs-comment'>{-# INLINE (.) #-}</span>
<a name="line-1528"></a>
<a name="line-1529"></a><a name="mergeStSt"></a><span class='hs-definition'>mergeStSt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span><span class='hs-layout'>)</span>
<a name="line-1530"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-varid'>s'</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span><span class='hs-layout'>)</span>
<a name="line-1531"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Put</span><span class='hs-layout'>)</span>
<a name="line-1532"></a><span class='hs-definition'>mergeStSt</span> <span class='hs-layout'>(</span><span class='hs-varid'>gg</span><span class='hs-layout'>,</span> <span class='hs-varid'>pg</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>gf</span><span class='hs-layout'>,</span> <span class='hs-varid'>pf</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftA2</span> <span class='hs-conid'>(,)</span> <span class='hs-varid'>gg</span> <span class='hs-varid'>gf</span><span class='hs-layout'>,</span> <span class='hs-varid'>uncurry</span> <span class='hs-layout'>(</span><span class='hs-varop'>*&gt;</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>pg</span> <span class='hs-varop'>***</span> <span class='hs-varid'>pf</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1533"></a>
<a name="line-1534"></a><a name="instance%20Profunctor%20(Auto%20m)"></a><span class='hs-comment'>-- | 'lmap' lets you map over the /input/ stream, and 'rmap' lets you map</span>
<a name="line-1535"></a><a name="instance%20Profunctor%20(Auto%20m)"></a><span class='hs-comment'>-- over the /output/ stream.  Note that, as with all 'Profunctor's, 'rmap'</span>
<a name="line-1536"></a><a name="instance%20Profunctor%20(Auto%20m)"></a><span class='hs-comment'>-- is 'fmap'.</span>
<a name="line-1537"></a><a name="instance%20Profunctor%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Profunctor</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1538"></a>    <span class='hs-varid'>lmap</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a_</span>
<a name="line-1539"></a>      <span class='hs-keyword'>where</span>
<a name="line-1540"></a>        <span class='hs-varid'>a_</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-1541"></a>                 <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>fa</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>fa</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1542"></a>                 <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>fa</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fa</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1543"></a>                 <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-varid'>fa</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1544"></a>                 <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-varid'>fa</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1545"></a>                 <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fa</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>a_</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1546"></a>                                                <span class='hs-varid'>s</span>
<a name="line-1547"></a>                                              <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fa</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1548"></a>                                                      <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1549"></a>                 <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fa</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a_</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1550"></a>                                                 <span class='hs-varid'>s</span>
<a name="line-1551"></a>                                              <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1552"></a>                                                  <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fa</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1553"></a>                                                  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1554"></a>    <span class='hs-comment'>{-# INLINE lmap #-}</span>
<a name="line-1555"></a>    <span class='hs-varid'>rmap</span> <span class='hs-varid'>g</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a_</span>
<a name="line-1556"></a>      <span class='hs-keyword'>where</span>
<a name="line-1557"></a>        <span class='hs-varid'>a_</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-1558"></a>                 <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>fa</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span><span class='hs-layout'>)</span>
<a name="line-1559"></a>                 <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>fa</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftM</span> <span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span><span class='hs-layout'>)</span>
<a name="line-1560"></a>                 <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1561"></a>                 <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1562"></a>                 <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fa</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>a_</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1563"></a>                                                <span class='hs-varid'>s</span>
<a name="line-1564"></a>                                              <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span>
<a name="line-1565"></a>                                                      <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1566"></a>                 <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fa</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a_</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1567"></a>                                                 <span class='hs-varid'>s</span>
<a name="line-1568"></a>                                               <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1569"></a>                                                   <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span>
<a name="line-1570"></a>                                                   <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1571"></a>    <span class='hs-comment'>{-# INLINE rmap #-}</span>
<a name="line-1572"></a>    <span class='hs-varid'>dimap</span> <span class='hs-varid'>f</span> <span class='hs-varid'>g</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a_</span>
<a name="line-1573"></a>      <span class='hs-keyword'>where</span>
<a name="line-1574"></a>        <span class='hs-varid'>a_</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-1575"></a>                 <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>fa</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1576"></a>                 <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>fa</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>liftM</span> <span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1577"></a>                 <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1578"></a>                 <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gpg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1579"></a>                 <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fa</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>a_</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1580"></a>                                                <span class='hs-varid'>s</span>
<a name="line-1581"></a>                                              <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fa</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1582"></a>                                                      <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1583"></a>                 <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>fa</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>a_</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1584"></a>                                                 <span class='hs-varid'>s</span>
<a name="line-1585"></a>                                               <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1586"></a>                                                   <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fa</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1587"></a>                                                   <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a_</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1588"></a>    <span class='hs-comment'>{-# INLINE dimap #-}</span>
<a name="line-1589"></a>
<a name="line-1590"></a><a name="instance%20Strong%20(Auto%20m)"></a><span class='hs-comment'>-- | See 'Arrow' instance.</span>
<a name="line-1591"></a><a name="instance%20Strong%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Strong</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1592"></a>    <span class='hs-varid'>first'</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>first</span>
<a name="line-1593"></a>    <span class='hs-varid'>second'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>second</span>
<a name="line-1594"></a>
<a name="line-1595"></a><a name="instance%20Choice%20(Auto%20m)"></a><span class='hs-comment'>-- | See 'ArrowChoice' instance</span>
<a name="line-1596"></a><a name="instance%20Choice%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Choice</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1597"></a>    <span class='hs-varid'>left'</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>left</span>
<a name="line-1598"></a>    <span class='hs-varid'>right'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>right</span>
<a name="line-1599"></a>
<a name="line-1600"></a><a name="instance%20Costrong%20(Auto%20m)"></a><span class='hs-comment'>-- | See 'ArrowLoop' instance</span>
<a name="line-1601"></a><a name="instance%20Costrong%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Costrong</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1602"></a>    <span class='hs-varid'>unfirst</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>loop</span>
<a name="line-1603"></a>
<a name="line-1604"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- | Gives us 'arr', which is a "stateless" 'Auto' that behaves just like</span>
<a name="line-1605"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- a function; its outputs are the function applied the corresponding</span>
<a name="line-1606"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- inputs.</span>
<a name="line-1607"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1608"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (arr negate) [1..10]</span>
<a name="line-1609"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- [-1,-2,-3,-4,-5,-6,-7,-8,-9,-10]</span>
<a name="line-1610"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1611"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- Also allows you to have an 'Auto' run on only the "first" or "second"</span>
<a name="line-1612"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- field in an input stream that is tuples...and also allows 'Auto's to run</span>
<a name="line-1613"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- side-by-side on an input stream of tuples (run each on either tuple</span>
<a name="line-1614"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- field).</span>
<a name="line-1615"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1616"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [4,6,8,7]</span>
<a name="line-1617"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- [4,10,18,25]</span>
<a name="line-1618"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (first (sumFrom 0)) [(4,True),(6,False),(8,False),(7,True)]</span>
<a name="line-1619"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- [(4,True),(10,False),(18,False),(25,True)]</span>
<a name="line-1620"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (productFrom 1) [1,3,5,2]</span>
<a name="line-1621"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- [1,3,15,30]</span>
<a name="line-1622"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (sumFrom 0 *** productFrom 1) [(4,1),(6,3),(8,5),(7,2)]</span>
<a name="line-1623"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- [(4,1),(10,3),(18,15),(25,30)]</span>
<a name="line-1624"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1625"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- Most importantly, however, allows for "proc" notation; see the</span>
<a name="line-1626"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- &lt;https://github.com/mstksg/auto/blob/master/tutorial/tutorial.md tutorial&gt;!</span>
<a name="line-1627"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>-- for more details.</span>
<a name="line-1628"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1629"></a><a name="instance%20Arrow%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Arrow</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1630"></a>    <span class='hs-varid'>arr</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkFunc</span>
<a name="line-1631"></a>    <span class='hs-varid'>first</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-1632"></a>                <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>         <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1633"></a>                    <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1634"></a>                <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span>        <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1635"></a>                    <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>firstM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1636"></a>                <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1637"></a>                    <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-layout'>,</span><span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1638"></a>                <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1639"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-layout'>,</span><span class='hs-varid'>z</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1640"></a>                <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>      <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1641"></a>                    <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1642"></a>                            <span class='hs-varid'>s</span>
<a name="line-1643"></a>                          <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1644"></a>                                       <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>first</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1645"></a>                <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>     <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1646"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1647"></a>                             <span class='hs-varid'>s</span>
<a name="line-1648"></a>                           <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1649"></a>                               <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1650"></a>                               <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>first</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1651"></a>    <span class='hs-varid'>second</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-1652"></a>                 <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>         <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1653"></a>                     <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1654"></a>                 <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span>        <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1655"></a>                     <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>secondM</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1656"></a>                 <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1657"></a>                     <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1658"></a>                 <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1659"></a>                     <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fa</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1660"></a>                 <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>      <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1661"></a>                     <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1662"></a>                             <span class='hs-varid'>s</span>
<a name="line-1663"></a>                           <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1664"></a>                                        <span class='hs-keyword'>in</span>  <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>second</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1665"></a>                 <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>     <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1666"></a>                     <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>second</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1667"></a>                              <span class='hs-varid'>s</span>
<a name="line-1668"></a>                            <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-1669"></a>                                <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
<a name="line-1670"></a>                                <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>z</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>second</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-1671"></a>
<a name="line-1672"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>-- | Allows you to have an 'Auto' only act on "some" inputs (only on</span>
<a name="line-1673"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>-- 'Left's, for example), and be "paused" otherwise.</span>
<a name="line-1674"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1675"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1,4,2,5]</span>
<a name="line-1676"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>-- [1,5,7,12]</span>
<a name="line-1677"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (left (sumFrom 0)) [Left 1, Right 'a', Left 4, Left 2, Right 'b', Left 5]</span>
<a name="line-1678"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>-- [Left 1, Right 'a', Left 5, Left 6, Right 'b', Left 12]</span>
<a name="line-1679"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1680"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>-- Again mostly useful for "proc" notation, with branching.</span>
<a name="line-1681"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-comment'>--</span>
<a name="line-1682"></a><a name="instance%20ArrowChoice%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ArrowChoice</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1683"></a>    <span class='hs-varid'>left</span> <span class='hs-varid'>a0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-1684"></a>      <span class='hs-keyword'>where</span>
<a name="line-1685"></a>        <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a0</span> <span class='hs-keyword'>of</span>
<a name="line-1686"></a>              <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>        <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1687"></a>                  <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>left</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1688"></a>              <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span>       <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1689"></a>                  <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1690"></a>                               <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1691"></a>                               <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1692"></a>              <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1693"></a>                  <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1694"></a>                                  <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1695"></a>                                  <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1696"></a>                               <span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1697"></a>              <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1698"></a>                  <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1699"></a>                                   <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1700"></a>                                   <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-conid'>Left</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1701"></a>                                <span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1702"></a>              <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>     <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1703"></a>                  <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>left</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1704"></a>                          <span class='hs-varid'>s</span>
<a name="line-1705"></a>                        <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1706"></a>                                  <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1707"></a>                                  <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varop'>***</span> <span class='hs-varid'>left</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1708"></a>              <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1709"></a>                  <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>left</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1710"></a>                           <span class='hs-varid'>s</span>
<a name="line-1711"></a>                         <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1712"></a>                                   <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1713"></a>                                   <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varop'>***</span> <span class='hs-varid'>left</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1714"></a>    <span class='hs-comment'>{-# INLINE left #-}</span>
<a name="line-1715"></a>    <span class='hs-varid'>right</span> <span class='hs-varid'>a0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-1716"></a>      <span class='hs-keyword'>where</span>
<a name="line-1717"></a>        <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a0</span> <span class='hs-keyword'>of</span>
<a name="line-1718"></a>              <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1719"></a>                  <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1720"></a>              <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1721"></a>                  <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-varid'>sequence</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-1722"></a>              <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1723"></a>                  <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1724"></a>                                  <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1725"></a>                                  <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1726"></a>                               <span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1727"></a>              <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1728"></a>                  <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1729"></a>                                   <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1730"></a>                                   <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-conid'>Right</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span>
<a name="line-1731"></a>                                <span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1732"></a>              <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>     <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1733"></a>                  <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>right</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1734"></a>                          <span class='hs-varid'>s</span>
<a name="line-1735"></a>                        <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1736"></a>                                  <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1737"></a>                                  <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varop'>***</span> <span class='hs-varid'>right</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1738"></a>              <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1739"></a>                  <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>right</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1740"></a>                           <span class='hs-varid'>s</span>
<a name="line-1741"></a>                         <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-1742"></a>                                   <span class='hs-conid'>Left</span> <span class='hs-varid'>y</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-1743"></a>                                   <span class='hs-conid'>Right</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varop'>***</span> <span class='hs-varid'>right</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1744"></a>    <span class='hs-comment'>{-# INLINE right #-}</span>
<a name="line-1745"></a>
<a name="line-1746"></a><a name="instance%20ArrowLoop%20(Auto%20m)"></a><span class='hs-comment'>-- | Finds the fixed point of self-referential 'Auto's (for example,</span>
<a name="line-1747"></a><a name="instance%20ArrowLoop%20(Auto%20m)"></a><span class='hs-comment'>-- feeding the output stream of an 'Auto' to itself).  Mostly used with</span>
<a name="line-1748"></a><a name="instance%20ArrowLoop%20(Auto%20m)"></a><span class='hs-comment'>-- proc notation to allow recursive bindings.</span>
<a name="line-1749"></a><a name="instance%20ArrowLoop%20(Auto%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ArrowLoop</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1750"></a>    <span class='hs-varid'>loop</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>of</span>
<a name="line-1751"></a>                <span class='hs-conid'>AutoFunc</span> <span class='hs-varid'>f</span>        <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1752"></a>                    <span class='hs-conid'>AutoFunc</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fix</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1753"></a>                <span class='hs-conid'>AutoFuncM</span> <span class='hs-varid'>f</span>       <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1754"></a>                    <span class='hs-conid'>AutoFuncM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mfix</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1755"></a>                <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span>  <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1756"></a>                    <span class='hs-conid'>AutoState</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>first</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fix</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1757"></a>                <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1758"></a>                    <span class='hs-conid'>AutoStateM</span> <span class='hs-varid'>gp</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-varid'>s'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>first</span> <span class='hs-varid'>fst</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mfix</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-varid'>s'</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1759"></a>                <span class='hs-conid'>AutoArb</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>     <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1760"></a>                    <span class='hs-conid'>AutoArb</span> <span class='hs-layout'>(</span><span class='hs-varid'>loop</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1761"></a>                            <span class='hs-varid'>s</span>
<a name="line-1762"></a>                          <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>fst</span> <span class='hs-varop'>***</span> <span class='hs-varid'>loop</span><span class='hs-layout'>)</span>
<a name="line-1763"></a>                                <span class='hs-varop'>.</span> <span class='hs-varid'>fix</span>
<a name="line-1764"></a>                                <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-1765"></a>                <span class='hs-conid'>AutoArbM</span> <span class='hs-varid'>l</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1766"></a>                    <span class='hs-conid'>AutoArbM</span> <span class='hs-layout'>(</span><span class='hs-varid'>loop</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1767"></a>                             <span class='hs-varid'>s</span>
<a name="line-1768"></a>                           <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>fst</span> <span class='hs-varop'>***</span> <span class='hs-varid'>loop</span><span class='hs-layout'>)</span>
<a name="line-1769"></a>                                 <span class='hs-varop'>.</span> <span class='hs-varid'>mfix</span>
<a name="line-1770"></a>                                 <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-1771"></a>    <span class='hs-comment'>{-# INLINE loop #-}</span>
<a name="line-1772"></a>
<a name="line-1773"></a><span class='hs-comment'>-- Utility instances</span>
<a name="line-1774"></a>
<a name="line-1775"></a><a name="instance%20Semigroup%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- | Fork the input stream and '&lt;&gt;' the outputs.  See the 'Monoid'</span>
<a name="line-1776"></a><a name="instance%20Semigroup%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- instance.</span>
<a name="line-1777"></a><a name="instance%20Semigroup%20(Auto%20m%20a%20b)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Semigroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1778"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-1779"></a>
<a name="line-1780"></a><a name="instance%20Monoid%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- | Fork the input stream and mappend the outputs.  'mempty' is a constant</span>
<a name="line-1781"></a><a name="instance%20Monoid%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- stream of 'mempty's, ignoring its input.</span>
<a name="line-1782"></a><a name="instance%20Monoid%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>--</span>
<a name="line-1783"></a><a name="instance%20Monoid%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (mconcat [arr (take 3), accum (++) ""]) ["hello","world","good","bye"]</span>
<a name="line-1784"></a><a name="instance%20Monoid%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- ["helhello","worhelloworld","goohelloworldgood","byehelloworldgoodbye"]</span>
<a name="line-1785"></a><a name="instance%20Monoid%20(Auto%20m%20a%20b)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1786"></a>    <span class='hs-varid'>mempty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varid'>mempty</span>
<a name="line-1787"></a>    <span class='hs-varid'>mappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-varid'>mappend</span>
<a name="line-1788"></a>
<a name="line-1789"></a><a name="instance%20IsString%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- | String literals in code will be 'Auto's that constanty produce that</span>
<a name="line-1790"></a><a name="instance%20IsString%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- string.</span>
<a name="line-1791"></a><a name="instance%20IsString%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>--</span>
<a name="line-1792"></a><a name="instance%20IsString%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- &gt;&gt;&gt; take 6 . streamAuto' (onFor 2 . "hello" --&gt; "world") $ repeat ()</span>
<a name="line-1793"></a><a name="instance%20IsString%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- ["hello","hello","world","world","world","world"]</span>
<a name="line-1794"></a><a name="instance%20IsString%20(Auto%20m%20a%20b)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>IsString</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>IsString</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1795"></a>    <span class='hs-varid'>fromString</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromString</span>
<a name="line-1796"></a>
<a name="line-1797"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- | Fork the input stream and add, multiply, etc. the outputs.  'negate'</span>
<a name="line-1798"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- will negate the ouptput stream.  'fromInteger' will be a constant stream</span>
<a name="line-1799"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- of that 'Integer', so you can write 'Auto's using numerical literals in</span>
<a name="line-1800"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- code:</span>
<a name="line-1801"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>--</span>
<a name="line-1802"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (sumFrom 0) [1..10]</span>
<a name="line-1803"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- [1,3,6,10,15,21,28,36,45,55]</span>
<a name="line-1804"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- &gt;&gt;&gt; streamAuto' (4 + sumFrom 0) [1..10]</span>
<a name="line-1805"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- [5,7,10,14,19,25,32,40,49,59]</span>
<a name="line-1806"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>--</span>
<a name="line-1807"></a><a name="instance%20Num%20(Auto%20m%20a%20b)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Num</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1808"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span>
<a name="line-1809"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-layout'>)</span>
<a name="line-1810"></a>    <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span>
<a name="line-1811"></a>    <span class='hs-varid'>negate</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>negate</span>
<a name="line-1812"></a>    <span class='hs-varid'>abs</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>abs</span>
<a name="line-1813"></a>    <span class='hs-varid'>signum</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>signum</span>
<a name="line-1814"></a>    <span class='hs-varid'>fromInteger</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromInteger</span>
<a name="line-1815"></a>
<a name="line-1816"></a><a name="instance%20Fractional%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- | Fork the input stream and divide the outputs.  'recip' maps 'recip' to</span>
<a name="line-1817"></a><a name="instance%20Fractional%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- the output stream; 'fromRational' will be a constant stream of that</span>
<a name="line-1818"></a><a name="instance%20Fractional%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- 'Rational', so you can write 'Auto's using numerical literals in code;</span>
<a name="line-1819"></a><a name="instance%20Fractional%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- see 'Num' instance.</span>
<a name="line-1820"></a><a name="instance%20Fractional%20(Auto%20m%20a%20b)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Fractional</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Fractional</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1821"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>/</span><span class='hs-layout'>)</span>
<a name="line-1822"></a>    <span class='hs-varid'>recip</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>recip</span>
<a name="line-1823"></a>    <span class='hs-varid'>fromRational</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromRational</span>
<a name="line-1824"></a>
<a name="line-1825"></a><a name="instance%20Floating%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- | A bunch of constant producers, mappers-of-output-streams, and</span>
<a name="line-1826"></a><a name="instance%20Floating%20(Auto%20m%20a%20b)"></a><span class='hs-comment'>-- forks-and-recombiners.</span>
<a name="line-1827"></a><a name="instance%20Floating%20(Auto%20m%20a%20b)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Floating</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Floating</span> <span class='hs-layout'>(</span><span class='hs-conid'>Auto</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1828"></a>    <span class='hs-varid'>pi</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varid'>pi</span>
<a name="line-1829"></a>    <span class='hs-varid'>exp</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>exp</span>
<a name="line-1830"></a>    <span class='hs-varid'>sqrt</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>sqrt</span>
<a name="line-1831"></a>    <span class='hs-varid'>log</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>log</span>
<a name="line-1832"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>**</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-layout'>(</span><span class='hs-varop'>**</span><span class='hs-layout'>)</span>
<a name="line-1833"></a>    <span class='hs-varid'>logBase</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftA2</span> <span class='hs-varid'>logBase</span>
<a name="line-1834"></a>    <span class='hs-varid'>sin</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>sin</span>
<a name="line-1835"></a>    <span class='hs-varid'>tan</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>tan</span>
<a name="line-1836"></a>    <span class='hs-varid'>cos</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>cos</span>
<a name="line-1837"></a>    <span class='hs-varid'>asin</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>asin</span>
<a name="line-1838"></a>    <span class='hs-varid'>atan</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>atan</span>
<a name="line-1839"></a>    <span class='hs-varid'>acos</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>acos</span>
<a name="line-1840"></a>    <span class='hs-varid'>sinh</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>sinh</span>
<a name="line-1841"></a>    <span class='hs-varid'>tanh</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>tanh</span>
<a name="line-1842"></a>    <span class='hs-varid'>cosh</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>cosh</span>
<a name="line-1843"></a>    <span class='hs-varid'>asinh</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>asinh</span>
<a name="line-1844"></a>    <span class='hs-varid'>atanh</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>atanh</span>
<a name="line-1845"></a>    <span class='hs-varid'>acosh</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>acosh</span>
<a name="line-1846"></a>
<a name="line-1847"></a><span class='hs-comment'>-- Utility functions</span>
<a name="line-1848"></a>
<a name="line-1849"></a><a name="firstM"></a><span class='hs-definition'>firstM</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-1850"></a><span class='hs-definition'>firstM</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-1851"></a><span class='hs-comment'>{-# INLINE firstM #-}</span>
<a name="line-1852"></a>
<a name="line-1853"></a><a name="secondM"></a><span class='hs-definition'>secondM</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-1854"></a><span class='hs-definition'>secondM</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>~</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>liftM</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-1855"></a><span class='hs-comment'>{-# INLINE secondM #-}</span>
</pre></body>
</html>
