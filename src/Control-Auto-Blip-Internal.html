<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Control/Auto/Blip/Internal.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE DeriveFunctor #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE DeriveGeneric #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# OPTIONS_HADDOCK not-home #-}</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-comment'>-- |</span>
<a name="line-7"></a><span class='hs-comment'>-- Module      : Control.Auto.Blip.Internal</span>
<a name="line-8"></a><span class='hs-comment'>-- Description : Exposing internal unsafe functions for working with</span>
<a name="line-9"></a><span class='hs-comment'>--               'Blip'.</span>
<a name="line-10"></a><span class='hs-comment'>-- Copyright   : (c) Justin Le 2015</span>
<a name="line-11"></a><span class='hs-comment'>-- License     : MIT</span>
<a name="line-12"></a><span class='hs-comment'>-- Maintainer  : justin@jle.im</span>
<a name="line-13"></a><span class='hs-comment'>-- Stability   : unstable</span>
<a name="line-14"></a><span class='hs-comment'>-- Portability : portable</span>
<a name="line-15"></a><span class='hs-comment'>--</span>
<a name="line-16"></a><span class='hs-comment'>-- This module exposes an "unsafe" interface for working with the internal</span>
<a name="line-17"></a><span class='hs-comment'>-- representation of "blip streams".  If you are programming at the logic</span>
<a name="line-18"></a><span class='hs-comment'>-- level or the application level, you should thoroughly be able to avoid</span>
<a name="line-19"></a><span class='hs-comment'>-- importing this, and should be happy with importing the 'Blip' type from</span>
<a name="line-20"></a><span class='hs-comment'>-- "Control.Auto" and blip stream manipulators from "Control.Auto.Blip".</span>
<a name="line-21"></a><span class='hs-comment'>--</span>
<a name="line-22"></a><span class='hs-comment'>-- If, however, you are programming a framework, library, or backend, you</span>
<a name="line-23"></a><span class='hs-comment'>-- might find it useful to manually create your own blip streams/sources.</span>
<a name="line-24"></a><span class='hs-comment'>-- In this case, this module will be useful.</span>
<a name="line-25"></a><span class='hs-comment'>--</span>
<a name="line-26"></a><span class='hs-comment'>-- It is important, as with most of this library in general, to always keep</span>
<a name="line-27"></a><span class='hs-comment'>-- in mind when you are programming at the "logic" level, and when you are</span>
<a name="line-28"></a><span class='hs-comment'>-- programming at the "backend" level.  If you can justify that you are at</span>
<a name="line-29"></a><span class='hs-comment'>-- the backend level and not at the logic level of whatever you are</span>
<a name="line-30"></a><span class='hs-comment'>-- programming, then this is useful.</span>
<a name="line-31"></a><span class='hs-comment'>--</span>
<a name="line-32"></a><span class='hs-comment'>-- Be sure, of course, that whatever blip streams you do manually</span>
<a name="line-33"></a><span class='hs-comment'>-- construct and export preserve "Blip semantics", which is further</span>
<a name="line-34"></a><span class='hs-comment'>-- defined in "Control.Auto.Blip".</span>
<a name="line-35"></a><span class='hs-comment'>--</span>
<a name="line-36"></a><span class='hs-comment'>-- You have been warned!</span>
<a name="line-37"></a><span class='hs-comment'>--</span>
<a name="line-38"></a>
<a name="line-39"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Auto</span><span class='hs-varop'>.</span><span class='hs-conid'>Blip</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span> <span class='hs-layout'>(</span>
<a name="line-40"></a>    <span class='hs-conid'>Blip</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-41"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>merge</span>
<a name="line-42"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>merge'</span>
<a name="line-43"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mergeL</span>
<a name="line-44"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mergeR</span>
<a name="line-45"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>blip</span>
<a name="line-46"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-47"></a>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>DeepSeq</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Semigroup</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Serialize</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>Generics</span>
<a name="line-53"></a>
<a name="line-54"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>5</span> <span class='hs-varop'>`mergeL`</span>
<a name="line-55"></a><span class='hs-keyword'>infixl</span> <span class='hs-num'>5</span> <span class='hs-varop'>`mergeR`</span>
<a name="line-56"></a>
<a name="line-57"></a><a name="Blip"></a><span class='hs-comment'>-- | When used in the context of an input or output of an 'Auto', a @'Blip'</span>
<a name="line-58"></a><a name="Blip"></a><span class='hs-comment'>-- a@ represents a stream that occasionally, at "independent" or "discrete"</span>
<a name="line-59"></a><a name="Blip"></a><span class='hs-comment'>-- points, emits a value of type @a@.</span>
<a name="line-60"></a><a name="Blip"></a><span class='hs-comment'>--</span>
<a name="line-61"></a><a name="Blip"></a><span class='hs-comment'>-- Contrast this to 'Interval', where things are meant to be "on" or "off"</span>
<a name="line-62"></a><a name="Blip"></a><span class='hs-comment'>-- for contiguous chunks at a time; blip streams are "blippy", and</span>
<a name="line-63"></a><a name="Blip"></a><span class='hs-comment'>-- 'Interval's are "chunky".</span>
<a name="line-64"></a><a name="Blip"></a><span class='hs-comment'>--</span>
<a name="line-65"></a><a name="Blip"></a><span class='hs-comment'>-- It's here mainly because it's a pretty useful abstraction in the context</span>
<a name="line-66"></a><a name="Blip"></a><span class='hs-comment'>-- of the many combinators found in various modules of this library.  If</span>
<a name="line-67"></a><a name="Blip"></a><span class='hs-comment'>-- you think of an @'Auto' m a ('Blip' b)@ as producing a "blip stream",</span>
<a name="line-68"></a><a name="Blip"></a><span class='hs-comment'>-- then there are various combinators and functions that are specifically</span>
<a name="line-69"></a><a name="Blip"></a><span class='hs-comment'>-- designed to manipulate blip streams.</span>
<a name="line-70"></a><a name="Blip"></a><span class='hs-comment'>--</span>
<a name="line-71"></a><a name="Blip"></a><span class='hs-comment'>-- For the purposes of the semantics of what 'Blip' is supposed to</span>
<a name="line-72"></a><a name="Blip"></a><span class='hs-comment'>-- represent, its constructors are hidden.  (Almost) all of the various</span>
<a name="line-73"></a><a name="Blip"></a><span class='hs-comment'>-- 'Blip' combinators (and its very useful 'Functor' instance) "preserve</span>
<a name="line-74"></a><a name="Blip"></a><span class='hs-comment'>-- 'Blip'ness" --- one-at-a-time occurrences remain one-at-a-time under all</span>
<a name="line-75"></a><a name="Blip"></a><span class='hs-comment'>-- of these combinators, and you should have enough so that direct access</span>
<a name="line-76"></a><a name="Blip"></a><span class='hs-comment'>-- to the constructor is not needed.</span>
<a name="line-77"></a><a name="Blip"></a><span class='hs-comment'>--</span>
<a name="line-78"></a><a name="Blip"></a><span class='hs-comment'>-- If you are creating a framework, library, or backend, you might want to</span>
<a name="line-79"></a><a name="Blip"></a><span class='hs-comment'>-- manually create blip stream-producing 'Auto's for your users to</span>
<a name="line-80"></a><a name="Blip"></a><span class='hs-comment'>-- access.  In this case, you can import the constructors and useful</span>
<a name="line-81"></a><a name="Blip"></a><span class='hs-comment'>-- internal (and, of course, semantically unsafe) functions from</span>
<a name="line-82"></a><a name="Blip"></a><span class='hs-comment'>-- "Control.Auto.Blip.Internal".</span>
<a name="line-83"></a><a name="Blip"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span>  <span class='hs-conid'>NoBlip</span>
<a name="line-84"></a>             <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Blip</span> <span class='hs-varop'>!</span><span class='hs-varid'>a</span>
<a name="line-85"></a>             <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Functor</span>
<a name="line-86"></a>                      <span class='hs-layout'>,</span> <span class='hs-conid'>Show</span>
<a name="line-87"></a>                      <span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span>
<a name="line-88"></a>                      <span class='hs-layout'>,</span> <span class='hs-conid'>Generic</span>
<a name="line-89"></a>                      <span class='hs-layout'>)</span>
<a name="line-90"></a>
<a name="line-91"></a><a name="instance%20Semigroup%20(Blip%20a)"></a><span class='hs-comment'>-- | Merge two blip streams together; the result emits with /either/ of the</span>
<a name="line-92"></a><a name="instance%20Semigroup%20(Blip%20a)"></a><span class='hs-comment'>-- two merged streams emit.  When both emit at the same time, emit the</span>
<a name="line-93"></a><a name="instance%20Semigroup%20(Blip%20a)"></a><span class='hs-comment'>-- result of '&lt;&gt;'-ing the values together.</span>
<a name="line-94"></a><a name="instance%20Semigroup%20(Blip%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Semigroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-95"></a>    <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>merge</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-96"></a>
<a name="line-97"></a><a name="instance%20Monoid%20(Blip%20a)"></a><span class='hs-comment'>-- | Merge two blip streams together; the result emits with /either/ of the</span>
<a name="line-98"></a><a name="instance%20Monoid%20(Blip%20a)"></a><span class='hs-comment'>-- two merged streams emit.  When both emit at the same time, emit the</span>
<a name="line-99"></a><a name="instance%20Monoid%20(Blip%20a)"></a><span class='hs-comment'>-- result of '&lt;&gt;'-ing the values together.</span>
<a name="line-100"></a><a name="instance%20Monoid%20(Blip%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-101"></a>    <span class='hs-varid'>mempty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoBlip</span>
<a name="line-102"></a>    <span class='hs-varid'>mappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>merge</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-103"></a>
<a name="line-104"></a><a name="instance%20Serialize%20(Blip%20a)%20--%20TODO:%20Am%20I%20allowed%20to%20do%20this?%20instance%20NFData%20a%20=%3e%20NFData%20(Blip%20a)%20--%20%7c%20Merge%20two%20blip%20streams%20together;%20the%20result%20emits%20with%20/either/%20of%20the%20--%20two%20merged%20streams%20emit.%20When%20both%20emit%20at%20the%20same%20time,%20emit%20the%20--%20result%20of%20applying%20the%20given%20function%20on%20the%20two%20emitted%20values.%20--%20--%20Note%20that%20this%20might%20be%20too%20strict%20for%20some%20purposes;%20see%20'mergeL'%20and%20--%20'mergeR'%20for%20lazier%20alternatives.%20merge%20::%20(a%20-%3e%20a%20-%3e%20a)%20--%20%5e%20merging%20function%20-%3e%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20-%3e%20Blip%20a%20--%20%5e%20merged%20stream%20merge%20=%20merge'%20id%20id%20--%20%7c%20Slightly%20more%20powerful%20'merge',%20but%20I%20can't%20imagine%20a%20situation%20where%20--%20this%20power%20is%20necessary.%20--%20--%20If%20only%20the%20first%20stream%20emits,%20emit%20with%20the%20first%20function%20applied%20to%20the%20--%20value.%20If%20only%20the%20second%20stream%20emits,%20emit%20with%20the%20second%20function%20--%20applied%20to%20the%20value.%20If%20both%20emit,%20then%20emit%20with%20the%20third%20function%20--%20applied%20to%20both%20emitted%20values.%20merge'%20::%20(a%20-%3e%20c)%20--%20%5e%20function%20for%20first%20stream%20-%3e%20(b%20-%3e%20c)%20--%20%5e%20function%20for%20second%20stream%20-%3e%20(a%20-%3e%20b%20-%3e%20c)%20--%20%5e%20merging%20function%20-%3e%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20b%20--%20%5e%20second%20stream%20-%3e%20Blip%20c%20--%20%5e%20merged%20stream%20merge'%20f%20_%20_%20(Blip%20x)%20NoBlip%20=%20Blip%20(f%20x)%20merge'%20_%20g%20_%20NoBlip%20(Blip%20y)%20=%20Blip%20(g%20y)%20merge'%20_%20_%20h%20(Blip%20x)%20(Blip%20y)%20=%20Blip%20(h%20x%20y)%20merge'%20_%20_%20_%20NoBlip%20NoBlip%20=%20NoBlip%20--%20%7c%20Merges%20two%20blip%20streams%20together%20into%20one,%20which%20emits%20--%20/either/%20of%20the%20original%20blip%20streams%20emit.%20If%20both%20emit%20at%20the%20same%20--%20time,%20the%20left%20(first)%20one%20is%20favored.%20--%20--%20Lazy%20on%20the%20second%20stream%20if%20the%20first%20stream%20is%20emitting.%20--%20--%20If%20we%20discount%20laziness,%20this%20is%20@'merge'%20'const'@.%20mergeL%20::%20Blip%20a%20--%20%5e%20first%20stream%20(higher%20priority)%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20-%3e%20Blip%20a%20mergeL%20b1@(Blip%20_)%20_%20=%20b1%20mergeL%20_%20b2%20=%20b2%20--%20%7c%20Merges%20two%20blip%20streams%20together%20into%20one,%20which%20emits%20--%20/either/%20of%20the%20original%20blip%20streams%20emit.%20If%20both%20emit%20at%20the%20same%20--%20time,%20the%20right%20(second)%20one%20is%20favored.%20--%20--%20Lazy%20on%20the%20first%20stream%20if%20the%20second%20stream%20is%20emitting.%20--%20--%20If%20we%20discount%20laziness,%20this%20is%20@'merge'%20('flip'%20'const')@.%20--%20mergeR%20::%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20(higher%20priority)%20-%3e%20Blip%20a%20mergeR%20_%20b2@(Blip%20_)%20=%20b2%20mergeR%20b1%20_%20=%20b1%20--%20%7c%20Deconstruct%20a%20'Blip'%20by%20giving%20a%20default%20result%20if%20the%20'Blip'%20is%20--%20non-occuring%20and%20a%20function%20to%20apply%20on%20the%20contents,%20if%20the%20'Blip'%20is%20--%20occuring.%20--%20--%20Try%20not%20to%20use%20if%20possible,%20unless%20you%20are%20a%20framework%20developer.%20If%20--%20you're%20just%20making%20an%20application,%20try%20to%20use%20the%20other%20various%20--%20combinators%20in%20this%20library.%20It'll%20help%20you%20preserve%20the%20semantics%20of%20--%20what%20it%20means%20to%20be%20'Blip'py.%20--%20--%20Analogous%20to%20'maybe'%20from%20%22Prelude%22.%20blip%20::%20b%20--%20%5e%20default%20value%20-%3e%20(a%20-%3e%20b)%20--%20%5e%20function%20to%20apply%20on%20value%20-%3e%20Blip%20a%20--%20%5e%20'Blip'%20to%20deconstruct%20-%3e%20b%20blip%20d%20_%20NoBlip%20=%20d%20blip%20_%20f%20(Blip%20x)%20=%20f%20x"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Serialize</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Serialize</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-105"></a>
<a name="line-106"></a><a name="instance%20NFData%20(Blip%20a)%20--%20%7c%20Merge%20two%20blip%20streams%20together;%20the%20result%20emits%20with%20/either/%20of%20the%20--%20two%20merged%20streams%20emit.%20When%20both%20emit%20at%20the%20same%20time,%20emit%20the%20--%20result%20of%20applying%20the%20given%20function%20on%20the%20two%20emitted%20values.%20--%20--%20Note%20that%20this%20might%20be%20too%20strict%20for%20some%20purposes;%20see%20'mergeL'%20and%20--%20'mergeR'%20for%20lazier%20alternatives.%20merge%20::%20(a%20-%3e%20a%20-%3e%20a)%20--%20%5e%20merging%20function%20-%3e%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20-%3e%20Blip%20a%20--%20%5e%20merged%20stream%20merge%20=%20merge'%20id%20id%20--%20%7c%20Slightly%20more%20powerful%20'merge',%20but%20I%20can't%20imagine%20a%20situation%20where%20--%20this%20power%20is%20necessary.%20--%20--%20If%20only%20the%20first%20stream%20emits,%20emit%20with%20the%20first%20function%20applied%20to%20the%20--%20value.%20If%20only%20the%20second%20stream%20emits,%20emit%20with%20the%20second%20function%20--%20applied%20to%20the%20value.%20If%20both%20emit,%20then%20emit%20with%20the%20third%20function%20--%20applied%20to%20both%20emitted%20values.%20merge'%20::%20(a%20-%3e%20c)%20--%20%5e%20function%20for%20first%20stream%20-%3e%20(b%20-%3e%20c)%20--%20%5e%20function%20for%20second%20stream%20-%3e%20(a%20-%3e%20b%20-%3e%20c)%20--%20%5e%20merging%20function%20-%3e%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20b%20--%20%5e%20second%20stream%20-%3e%20Blip%20c%20--%20%5e%20merged%20stream%20merge'%20f%20_%20_%20(Blip%20x)%20NoBlip%20=%20Blip%20(f%20x)%20merge'%20_%20g%20_%20NoBlip%20(Blip%20y)%20=%20Blip%20(g%20y)%20merge'%20_%20_%20h%20(Blip%20x)%20(Blip%20y)%20=%20Blip%20(h%20x%20y)%20merge'%20_%20_%20_%20NoBlip%20NoBlip%20=%20NoBlip%20--%20%7c%20Merges%20two%20blip%20streams%20together%20into%20one,%20which%20emits%20--%20/either/%20of%20the%20original%20blip%20streams%20emit.%20If%20both%20emit%20at%20the%20same%20--%20time,%20the%20left%20(first)%20one%20is%20favored.%20--%20--%20Lazy%20on%20the%20second%20stream%20if%20the%20first%20stream%20is%20emitting.%20--%20--%20If%20we%20discount%20laziness,%20this%20is%20@'merge'%20'const'@.%20mergeL%20::%20Blip%20a%20--%20%5e%20first%20stream%20(higher%20priority)%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20-%3e%20Blip%20a%20mergeL%20b1@(Blip%20_)%20_%20=%20b1%20mergeL%20_%20b2%20=%20b2%20--%20%7c%20Merges%20two%20blip%20streams%20together%20into%20one,%20which%20emits%20--%20/either/%20of%20the%20original%20blip%20streams%20emit.%20If%20both%20emit%20at%20the%20same%20--%20time,%20the%20right%20(second)%20one%20is%20favored.%20--%20--%20Lazy%20on%20the%20first%20stream%20if%20the%20second%20stream%20is%20emitting.%20--%20--%20If%20we%20discount%20laziness,%20this%20is%20@'merge'%20('flip'%20'const')@.%20--%20mergeR%20::%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20(higher%20priority)%20-%3e%20Blip%20a%20mergeR%20_%20b2@(Blip%20_)%20=%20b2%20mergeR%20b1%20_%20=%20b1%20--%20%7c%20Deconstruct%20a%20'Blip'%20by%20giving%20a%20default%20result%20if%20the%20'Blip'%20is%20--%20non-occuring%20and%20a%20function%20to%20apply%20on%20the%20contents,%20if%20the%20'Blip'%20is%20--%20occuring.%20--%20--%20Try%20not%20to%20use%20if%20possible,%20unless%20you%20are%20a%20framework%20developer.%20If%20--%20you're%20just%20making%20an%20application,%20try%20to%20use%20the%20other%20various%20--%20combinators%20in%20this%20library.%20It'll%20help%20you%20preserve%20the%20semantics%20of%20--%20what%20it%20means%20to%20be%20'Blip'py.%20--%20--%20Analogous%20to%20'maybe'%20from%20%22Prelude%22.%20blip%20::%20b%20--%20%5e%20default%20value%20-%3e%20(a%20-%3e%20b)%20--%20%5e%20function%20to%20apply%20on%20value%20-%3e%20Blip%20a%20--%20%5e%20'Blip'%20to%20deconstruct%20-%3e%20b%20blip%20d%20_%20NoBlip%20=%20d%20blip%20_%20f%20(Blip%20x)%20=%20f%20x"></a><span class='hs-comment'>-- TODO: Am I allowed to do this?</span>
<a name="line-107"></a><a name="instance%20NFData%20(Blip%20a)%20--%20%7c%20Merge%20two%20blip%20streams%20together;%20the%20result%20emits%20with%20/either/%20of%20the%20--%20two%20merged%20streams%20emit.%20When%20both%20emit%20at%20the%20same%20time,%20emit%20the%20--%20result%20of%20applying%20the%20given%20function%20on%20the%20two%20emitted%20values.%20--%20--%20Note%20that%20this%20might%20be%20too%20strict%20for%20some%20purposes;%20see%20'mergeL'%20and%20--%20'mergeR'%20for%20lazier%20alternatives.%20merge%20::%20(a%20-%3e%20a%20-%3e%20a)%20--%20%5e%20merging%20function%20-%3e%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20-%3e%20Blip%20a%20--%20%5e%20merged%20stream%20merge%20=%20merge'%20id%20id%20--%20%7c%20Slightly%20more%20powerful%20'merge',%20but%20I%20can't%20imagine%20a%20situation%20where%20--%20this%20power%20is%20necessary.%20--%20--%20If%20only%20the%20first%20stream%20emits,%20emit%20with%20the%20first%20function%20applied%20to%20the%20--%20value.%20If%20only%20the%20second%20stream%20emits,%20emit%20with%20the%20second%20function%20--%20applied%20to%20the%20value.%20If%20both%20emit,%20then%20emit%20with%20the%20third%20function%20--%20applied%20to%20both%20emitted%20values.%20merge'%20::%20(a%20-%3e%20c)%20--%20%5e%20function%20for%20first%20stream%20-%3e%20(b%20-%3e%20c)%20--%20%5e%20function%20for%20second%20stream%20-%3e%20(a%20-%3e%20b%20-%3e%20c)%20--%20%5e%20merging%20function%20-%3e%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20b%20--%20%5e%20second%20stream%20-%3e%20Blip%20c%20--%20%5e%20merged%20stream%20merge'%20f%20_%20_%20(Blip%20x)%20NoBlip%20=%20Blip%20(f%20x)%20merge'%20_%20g%20_%20NoBlip%20(Blip%20y)%20=%20Blip%20(g%20y)%20merge'%20_%20_%20h%20(Blip%20x)%20(Blip%20y)%20=%20Blip%20(h%20x%20y)%20merge'%20_%20_%20_%20NoBlip%20NoBlip%20=%20NoBlip%20--%20%7c%20Merges%20two%20blip%20streams%20together%20into%20one,%20which%20emits%20--%20/either/%20of%20the%20original%20blip%20streams%20emit.%20If%20both%20emit%20at%20the%20same%20--%20time,%20the%20left%20(first)%20one%20is%20favored.%20--%20--%20Lazy%20on%20the%20second%20stream%20if%20the%20first%20stream%20is%20emitting.%20--%20--%20If%20we%20discount%20laziness,%20this%20is%20@'merge'%20'const'@.%20mergeL%20::%20Blip%20a%20--%20%5e%20first%20stream%20(higher%20priority)%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20-%3e%20Blip%20a%20mergeL%20b1@(Blip%20_)%20_%20=%20b1%20mergeL%20_%20b2%20=%20b2%20--%20%7c%20Merges%20two%20blip%20streams%20together%20into%20one,%20which%20emits%20--%20/either/%20of%20the%20original%20blip%20streams%20emit.%20If%20both%20emit%20at%20the%20same%20--%20time,%20the%20right%20(second)%20one%20is%20favored.%20--%20--%20Lazy%20on%20the%20first%20stream%20if%20the%20second%20stream%20is%20emitting.%20--%20--%20If%20we%20discount%20laziness,%20this%20is%20@'merge'%20('flip'%20'const')@.%20--%20mergeR%20::%20Blip%20a%20--%20%5e%20first%20stream%20-%3e%20Blip%20a%20--%20%5e%20second%20stream%20(higher%20priority)%20-%3e%20Blip%20a%20mergeR%20_%20b2@(Blip%20_)%20=%20b2%20mergeR%20b1%20_%20=%20b1%20--%20%7c%20Deconstruct%20a%20'Blip'%20by%20giving%20a%20default%20result%20if%20the%20'Blip'%20is%20--%20non-occuring%20and%20a%20function%20to%20apply%20on%20the%20contents,%20if%20the%20'Blip'%20is%20--%20occuring.%20--%20--%20Try%20not%20to%20use%20if%20possible,%20unless%20you%20are%20a%20framework%20developer.%20If%20--%20you're%20just%20making%20an%20application,%20try%20to%20use%20the%20other%20various%20--%20combinators%20in%20this%20library.%20It'll%20help%20you%20preserve%20the%20semantics%20of%20--%20what%20it%20means%20to%20be%20'Blip'py.%20--%20--%20Analogous%20to%20'maybe'%20from%20%22Prelude%22.%20blip%20::%20b%20--%20%5e%20default%20value%20-%3e%20(a%20-%3e%20b)%20--%20%5e%20function%20to%20apply%20on%20value%20-%3e%20Blip%20a%20--%20%5e%20'Blip'%20to%20deconstruct%20-%3e%20b%20blip%20d%20_%20NoBlip%20=%20d%20blip%20_%20f%20(Blip%20x)%20=%20f%20x"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>NFData</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NFData</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-108"></a>
<a name="line-109"></a><a name="merge"></a><span class='hs-comment'>-- | Merge two blip streams together; the result emits with /either/ of the</span>
<a name="line-110"></a><span class='hs-comment'>-- two merged streams emit.  When both emit at the same time, emit the</span>
<a name="line-111"></a><span class='hs-comment'>-- result of applying the given function on the two emitted values.</span>
<a name="line-112"></a><span class='hs-comment'>--</span>
<a name="line-113"></a><span class='hs-comment'>-- Note that this might be too strict for some purposes; see 'mergeL' and</span>
<a name="line-114"></a><span class='hs-comment'>-- 'mergeR' for lazier alternatives.</span>
<a name="line-115"></a><span class='hs-definition'>merge</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ merging function</span>
<a name="line-116"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>             <span class='hs-comment'>-- ^ first stream</span>
<a name="line-117"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>             <span class='hs-comment'>-- ^ second stream</span>
<a name="line-118"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>             <span class='hs-comment'>-- ^ merged stream</span>
<a name="line-119"></a><span class='hs-definition'>merge</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>merge'</span> <span class='hs-varid'>id</span> <span class='hs-varid'>id</span>
<a name="line-120"></a>
<a name="line-121"></a><a name="merge'"></a><span class='hs-comment'>-- | Slightly more powerful 'merge', but I can't imagine a situation where</span>
<a name="line-122"></a><span class='hs-comment'>-- this power is necessary.</span>
<a name="line-123"></a><span class='hs-comment'>--</span>
<a name="line-124"></a><span class='hs-comment'>-- If only the first stream emits, emit with the first function applied to the</span>
<a name="line-125"></a><span class='hs-comment'>-- value.  If only the second stream emits, emit with the second function</span>
<a name="line-126"></a><span class='hs-comment'>-- applied to the value.  If both emit, then emit with the third function</span>
<a name="line-127"></a><span class='hs-comment'>-- applied to both emitted values.</span>
<a name="line-128"></a><span class='hs-definition'>merge'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- ^ function for first stream</span>
<a name="line-129"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- ^ function for second stream</span>
<a name="line-130"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ merging function</span>
<a name="line-131"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>            <span class='hs-comment'>-- ^ first stream</span>
<a name="line-132"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>b</span>            <span class='hs-comment'>-- ^ second stream</span>
<a name="line-133"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>c</span>            <span class='hs-comment'>-- ^ merged stream</span>
<a name="line-134"></a><span class='hs-definition'>merge'</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-conid'>NoBlip</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Blip</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-135"></a><span class='hs-definition'>merge'</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>g</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>NoBlip</span>   <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Blip</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-136"></a><span class='hs-definition'>merge'</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>h</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Blip</span> <span class='hs-layout'>(</span><span class='hs-varid'>h</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span>
<a name="line-137"></a><span class='hs-definition'>merge'</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>NoBlip</span>   <span class='hs-conid'>NoBlip</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NoBlip</span>
<a name="line-138"></a>
<a name="line-139"></a><a name="mergeL"></a><span class='hs-comment'>-- | Merges two blip streams together into one, which emits</span>
<a name="line-140"></a><span class='hs-comment'>-- /either/ of the original blip streams emit.  If both emit at the same</span>
<a name="line-141"></a><span class='hs-comment'>-- time, the left (first) one is favored.</span>
<a name="line-142"></a><span class='hs-comment'>--</span>
<a name="line-143"></a><span class='hs-comment'>-- Lazy on the second stream if the first stream is emitting.</span>
<a name="line-144"></a><span class='hs-comment'>--</span>
<a name="line-145"></a><span class='hs-comment'>-- If we discount laziness, this is @'merge' 'const'@.</span>
<a name="line-146"></a><span class='hs-definition'>mergeL</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>    <span class='hs-comment'>-- ^ first stream (higher priority)</span>
<a name="line-147"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>    <span class='hs-comment'>-- ^ second stream</span>
<a name="line-148"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>
<a name="line-149"></a><span class='hs-definition'>mergeL</span> <span class='hs-varid'>b1</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b1</span>
<a name="line-150"></a><span class='hs-definition'>mergeL</span> <span class='hs-keyword'>_</span>           <span class='hs-varid'>b2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b2</span>
<a name="line-151"></a>
<a name="line-152"></a><a name="mergeR"></a><span class='hs-comment'>-- | Merges two blip streams together into one, which emits</span>
<a name="line-153"></a><span class='hs-comment'>-- /either/ of the original blip streams emit.  If both emit at the same</span>
<a name="line-154"></a><span class='hs-comment'>-- time, the right (second) one is favored.</span>
<a name="line-155"></a><span class='hs-comment'>--</span>
<a name="line-156"></a><span class='hs-comment'>-- Lazy on the first stream if the second stream is emitting.</span>
<a name="line-157"></a><span class='hs-comment'>--</span>
<a name="line-158"></a><span class='hs-comment'>-- If we discount laziness, this is @'merge' ('flip' 'const')@.</span>
<a name="line-159"></a><span class='hs-comment'>--</span>
<a name="line-160"></a><span class='hs-definition'>mergeR</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>        <span class='hs-comment'>-- ^ first stream</span>
<a name="line-161"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>        <span class='hs-comment'>-- ^ second stream (higher priority)</span>
<a name="line-162"></a>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>
<a name="line-163"></a><span class='hs-definition'>mergeR</span> <span class='hs-keyword'>_</span>  <span class='hs-varid'>b2</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b2</span>
<a name="line-164"></a><span class='hs-definition'>mergeR</span> <span class='hs-varid'>b1</span> <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b1</span>
<a name="line-165"></a>
<a name="line-166"></a><a name="blip"></a><span class='hs-comment'>-- | Deconstruct a 'Blip' by giving a default result if the 'Blip' is</span>
<a name="line-167"></a><span class='hs-comment'>-- non-occuring and a function to apply on the contents, if the 'Blip' is</span>
<a name="line-168"></a><span class='hs-comment'>-- occuring.</span>
<a name="line-169"></a><span class='hs-comment'>--</span>
<a name="line-170"></a><span class='hs-comment'>-- Try not to use if possible, unless you are a framework developer.  If</span>
<a name="line-171"></a><span class='hs-comment'>-- you're just making an application, try to use the other various</span>
<a name="line-172"></a><span class='hs-comment'>-- combinators in this library.  It'll help you preserve the semantics of</span>
<a name="line-173"></a><span class='hs-comment'>-- what it means to be 'Blip'py.</span>
<a name="line-174"></a><span class='hs-comment'>--</span>
<a name="line-175"></a><span class='hs-comment'>-- Analogous to 'maybe' from "Prelude".</span>
<a name="line-176"></a><span class='hs-definition'>blip</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span>           <span class='hs-comment'>-- ^ default value</span>
<a name="line-177"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ function to apply on value</span>
<a name="line-178"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Blip</span> <span class='hs-varid'>a</span>      <span class='hs-comment'>-- ^ 'Blip' to deconstruct</span>
<a name="line-179"></a>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-180"></a><span class='hs-definition'>blip</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>NoBlip</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-181"></a><span class='hs-definition'>blip</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Blip</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span>
</pre></body>
</html>
