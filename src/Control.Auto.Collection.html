<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Module      : Control.Auto.Collection</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Description : 'Auto's that represent collections of 'Auto's that can be</span><span>
</span><a name="line-9"></a><span class="hs-comment">--               run in parallel, multiplexed, gathered...</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Copyright   : (c) Justin Le 2015</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- License     : MIT</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Maintainer  : justin@jle.im</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Stability   : unstable</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Portability : portable</span><span>
</span><a name="line-15"></a><span class="hs-comment">--</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- The 'Auto's in this module are all dedicated to managing and working</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- with (possibly dynamic) &quot;collections&quot; of 'Auto's: an 'Auto' where the</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- output stream is typically /many/ output streams collected from running</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- many input streams through many internal 'Auto's.</span><span>
</span><a name="line-20"></a><span class="hs-comment">--</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- Particularly useful because a lot of these allow you to add or take away</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- these &quot;channels of inputs&quot; (or &quot;internal 'Auto's&quot;) dynamically; so,</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- useful for collections that can be added to or deleted from, like</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- monsters on a map.</span><span>
</span><a name="line-25"></a><span class="hs-comment">--</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- These multiplex, merge, or collect input streams through many 'Auto's</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- and output the multiplexed, merged, or collected output streams.</span><span>
</span><a name="line-28"></a><span class="hs-comment">--</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- A lot of these 'Auto's take advantaage /Interval/ semantics ('Maybe' for</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- continuous on/off periods) to signal when they want to be removed or</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- turned off.</span><span>
</span><a name="line-32"></a><span class="hs-comment">--</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- For these, the best way to learn them is probably by seeing examples.</span><span>
</span><a name="line-34"></a><span class="hs-comment">--</span><span>
</span><a name="line-35"></a><span class="hs-comment">-- If there is a time when you might want collections of things</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- that can be added to or removed from dynamically, this might be what you</span><span>
</span><a name="line-37"></a><span class="hs-comment">-- are looking for.</span><span>
</span><a name="line-38"></a><span class="hs-comment">--</span><span>
</span><a name="line-39"></a><span class="hs-comment">-- These collections are indispensible for coding real applications; many</span><span>
</span><a name="line-40"></a><span class="hs-comment">-- examples of them in use are available in the</span><span>
</span><a name="line-41"></a><span class="hs-comment">-- &lt;https://github.com/mstksg/auto-examples auto-examples&gt; project!  See</span><span>
</span><a name="line-42"></a><span class="hs-comment">-- those projects for &quot;real-world&quot; guides.</span><span>
</span><a name="line-43"></a><span class="hs-comment">--</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Collection</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-comment">-- * Static collections</span><span>
</span><a name="line-47"></a><span>    </span><a href="Control.Auto.Collection.html#zipAuto"><span class="hs-identifier hs-var">zipAuto</span></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dZipAuto"><span class="hs-identifier hs-var">dZipAuto</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dZipAuto_"><span class="hs-identifier hs-var">dZipAuto_</span></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#zipAutoB"><span class="hs-identifier hs-var">zipAutoB</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dZipAutoB"><span class="hs-identifier hs-var">dZipAutoB</span></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dZipAutoB_"><span class="hs-identifier hs-var">dZipAutoB_</span></a><span>
</span><a name="line-53"></a><span>  </span><span class="hs-comment">-- * Dynamic collections</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dynZip_"><span class="hs-identifier hs-var">dynZip_</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dynZipF"><span class="hs-identifier hs-var">dynZipF</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dynZipF_"><span class="hs-identifier hs-var">dynZipF_</span></a><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dynMap_"><span class="hs-identifier hs-var">dynMap_</span></a><span>
</span><a name="line-58"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dynMapF"><span class="hs-identifier hs-var">dynMapF</span></a><span>
</span><a name="line-59"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#dynMapF_"><span class="hs-identifier hs-var">dynMapF_</span></a><span>
</span><a name="line-60"></a><span>  </span><span class="hs-comment">-- * Multiplexers</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-comment">-- ** Single input, single output</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#mux"><span class="hs-identifier hs-var">mux</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#mux_"><span class="hs-identifier hs-var">mux_</span></a><span>
</span><a name="line-64"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#muxI"><span class="hs-identifier hs-var">muxI</span></a><span>
</span><a name="line-65"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#muxI_"><span class="hs-identifier hs-var">muxI_</span></a><span>
</span><a name="line-66"></a><span>  </span><span class="hs-comment">-- ** Multiple input, multiple output</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#muxMany"><span class="hs-identifier hs-var">muxMany</span></a><span>
</span><a name="line-68"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#muxMany_"><span class="hs-identifier hs-var">muxMany_</span></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#muxManyI"><span class="hs-identifier hs-var">muxManyI</span></a><span>
</span><a name="line-70"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#muxManyI_"><span class="hs-identifier hs-var">muxManyI_</span></a><span>
</span><a name="line-71"></a><span>  </span><span class="hs-comment">-- * &quot;Gathering&quot;/accumulating collections</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-comment">-- ** Single input, multiple output</span><span>
</span><a name="line-73"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#gather"><span class="hs-identifier hs-var">gather</span></a><span>
</span><a name="line-74"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#gather_"><span class="hs-identifier hs-var">gather_</span></a><span>
</span><a name="line-75"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#gather__"><span class="hs-identifier hs-var">gather__</span></a><span>
</span><a name="line-76"></a><span>  </span><span class="hs-comment">--- ** Multiple input, multiple output</span><span>
</span><a name="line-77"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#gatherMany"><span class="hs-identifier hs-var">gatherMany</span></a><span>
</span><a name="line-78"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#gatherMany_"><span class="hs-identifier hs-var">gatherMany_</span></a><span>
</span><a name="line-79"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#gatherMany__"><span class="hs-identifier hs-var">gatherMany__</span></a><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Arrow</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Blip.Internal.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Blip</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Core.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Core</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Interval.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Interval</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="Control.Auto.Time.html"><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Auto</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Category</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-keyword">hiding</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sequence</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sequence_</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Orphans</span><span>                 </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Profunctor</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Traversable</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sequence</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sequence_</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IntMap</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Map</span><span class="hs-operator">.</span><span class="hs-identifier">Strict</span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | Give a list of @'Auto' m a b@ and get back an @'Auto' m [a] [b]@  ---</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- take a list of @a@'s and feed them to each of the 'Auto's, and collects</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- their output @b@'s.</span><span>
</span><a name="line-107"></a><span class="hs-comment">--</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- If the input list doesn't have enough items to give to all of the</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- 'Auto's wrapped, then use the given default value.  Any extra items in</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- the input list are ignored.</span><span>
</span><a name="line-111"></a><span class="hs-comment">--</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- For an example, we're going to make a list of 'Auto's that output</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- a running sum of all of their inputs, but each starting at a different</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- beginning value:</span><span>
</span><a name="line-115"></a><span class="hs-comment">--</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- summerList :: [Auto' Int Int]</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- summerList = [sumFrom 0, sumFrom 10, sumFrom 20, sumFrom 30]</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-120"></a><span class="hs-comment">--</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- Then, let's throw it into 'zipAuto' with a sensible default value, 0:</span><span>
</span><a name="line-122"></a><span class="hs-comment">--</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- summings0 :: Auto' [Int] [Int]</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- summings0 = zipAuto 0 summerList</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-127"></a><span class="hs-comment">--</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- Now let's try it out!</span><span>
</span><a name="line-129"></a><span class="hs-comment">--</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- &gt;&gt;&gt; let (r1, summings1) = stepAuto' summings0 [1,2,3,4]</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- &gt;&gt;&gt; r1</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- [ 1, 12, 23, 34]</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- &gt;&gt;&gt; let (r2, summings2) = stepAuto' summings1 [5,5]</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- &gt;&gt;&gt; r2</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- [ 6, 17, 23, 34]</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- &gt;&gt;&gt; let (r3, _        ) = stepAuto' summings2 [10,1,10,1,10000]</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- &gt;&gt;&gt; r3</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- [16, 18, 33, 35]</span><span>
</span><a name="line-139"></a><span class="hs-comment">--</span><span>
</span><a name="line-140"></a><span class="hs-identifier">zipAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475544"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-141"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627475545"><span class="hs-identifier hs-type">a</span></a><span>                </span><span class="hs-comment">-- ^ default input value</span><span>
</span><a name="line-142"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475544"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475545"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475546"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ 'Auto's to zip up</span><span>
</span><a name="line-143"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475544"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475545"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627475546"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-144"></a><a name="zipAuto"><a href="Control.Auto.Collection.html#zipAuto"><span class="hs-identifier">zipAuto</span></a></a><span> </span><a name="local-1627475547"><a href="#local-1627475547"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#zipAuto"><span class="hs-identifier hs-var">zipAuto</span></a><span> </span><a href="#local-1627475547"><span class="hs-identifier hs-var">x0</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>                        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1627475549"><a href="#local-1627475549"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-147"></a><span>                            </span><a name="local-1627475550"><a href="#local-1627475550"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zipWithM</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">(</span><a href="#local-1627475549"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><a href="#local-1627475547"><span class="hs-identifier hs-var">x0</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>                            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627475551"><a href="#local-1627475551"><span class="hs-identifier">ys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475552"><a href="#local-1627475552"><span class="hs-identifier">as'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-1627475550"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-149"></a><span>                            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475551"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Collection.html#zipAuto"><span class="hs-identifier hs-var">zipAuto</span></a><span> </span><a href="#local-1627475547"><span class="hs-identifier hs-var">x0</span></a><span> </span><a href="#local-1627475552"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">-- | Like 'zipAuto', but delay the input by one step.  The first input to</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- all of them is the &quot;default&quot; value, and after that, feeds in the input</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- streams delayed by one.</span><span>
</span><a name="line-154"></a><span class="hs-comment">--</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- Let's try the example from 'zipAuto', except with 'dZipAuto' instead:</span><span>
</span><a name="line-156"></a><span class="hs-comment">--</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- summerList :: [Auto' Int Int]</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- summerList = map sumFrom [0, 10, 20, 30]</span><span>
</span><a name="line-160"></a><span class="hs-comment">--</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- summings0 :: Auto' [Int] [Int]</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- summings0 = dZipAuto 0 summerList</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-164"></a><span class="hs-comment">--</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- Trying it out:</span><span>
</span><a name="line-166"></a><span class="hs-comment">--</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- &gt;&gt;&gt; let (r1, summings1) = stepAuto' summings0 [1,2,3,4]</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- &gt;&gt;&gt; r1</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- [ 0, 10, 20, 30]</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- &gt;&gt;&gt; let (r2, summings2) = stepAuto' summings1 [5,5]</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- &gt;&gt;&gt; r2</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- [ 1, 12, 23, 34]</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- &gt;&gt;&gt; let (r3, summings3) = stepAuto' summings2 [10,1,10,1,10000]</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- &gt;&gt;&gt; r3</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- [ 6, 17, 23, 34]</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- &gt;&gt;&gt; let (r4, _        ) = stepAuto' summings3 [100,100,100,100]</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- &gt;&gt;&gt; r4</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- [16, 18, 33, 35]</span><span>
</span><a name="line-179"></a><span class="hs-comment">--</span><span>
</span><a name="line-180"></a><span class="hs-identifier">dZipAuto</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475541"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475542"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627475541"><span class="hs-identifier hs-type">a</span></a><span>                 </span><span class="hs-comment">-- ^ default input value</span><span>
</span><a name="line-182"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475542"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475541"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475543"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ 'Auto's to zip up</span><span>
</span><a name="line-183"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475542"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475541"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627475543"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-184"></a><a name="dZipAuto"><a href="Control.Auto.Collection.html#dZipAuto"><span class="hs-identifier">dZipAuto</span></a></a><span> </span><a name="local-1627475553"><a href="#local-1627475553"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#zipAuto"><span class="hs-identifier hs-var">zipAuto</span></a><span> </span><a href="#local-1627475553"><span class="hs-identifier hs-var">x0</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Time.html#delay"><span class="hs-identifier hs-var">delay</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'dZipAuto'.</span><span>
</span><a name="line-187"></a><span class="hs-identifier">dZipAuto_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475538"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-188"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627475539"><span class="hs-identifier hs-type">a</span></a><span>                  </span><span class="hs-comment">-- ^ default input value</span><span>
</span><a name="line-189"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475538"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475539"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475540"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- ^ 'Auto's to zip up</span><span>
</span><a name="line-190"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475538"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475539"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627475540"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-191"></a><a name="dZipAuto_"><a href="Control.Auto.Collection.html#dZipAuto_"><span class="hs-identifier">dZipAuto_</span></a></a><span> </span><a name="local-1627475555"><a href="#local-1627475555"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#zipAuto"><span class="hs-identifier hs-var">zipAuto</span></a><span> </span><a href="#local-1627475555"><span class="hs-identifier hs-var">x0</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Time.html#delay_"><span class="hs-identifier hs-var">delay_</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">-- | Takes a bunch of 'Auto's that take streams streams, and turns them</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- into one 'Auto' that takes a bunch of blip streams and feeds them into</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- each of the original 'Auto's, in order.</span><span>
</span><a name="line-196"></a><span class="hs-comment">--</span><span>
</span><a name="line-197"></a><span class="hs-comment">-- It's basically like 'zipAuto', except instead of taking in normal</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- streams of values, it takes in blip streams of values.</span><span>
</span><a name="line-199"></a><span class="hs-comment">--</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- If the input streams ever number less than the number of 'Auto's zipped,</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- the other 'Auto's are stepped assuming no emitted value.</span><span>
</span><a name="line-202"></a><span class="hs-identifier">zipAutoB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475535"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-203"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475535"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627475536"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475537"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ 'Auto's to zip up</span><span>
</span><a name="line-204"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475535"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627475536"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627475537"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-205"></a><a name="zipAutoB"><a href="Control.Auto.Collection.html#zipAutoB"><span class="hs-identifier">zipAutoB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#zipAuto"><span class="hs-identifier hs-var">zipAuto</span></a><span> </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-comment">-- | A delayed version of 'zipAutoB'</span><span>
</span><a name="line-208"></a><span class="hs-identifier">dZipAutoB</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475532"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475533"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475533"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627475532"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475534"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ 'Auto's to zip up</span><span>
</span><a name="line-210"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475533"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627475532"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627475534"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-211"></a><a name="dZipAutoB"><a href="Control.Auto.Collection.html#dZipAutoB"><span class="hs-identifier">dZipAutoB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#dZipAuto"><span class="hs-identifier hs-var">dZipAuto</span></a><span> </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'dZipAutoB'.</span><span>
</span><a name="line-214"></a><span class="hs-identifier">dZipAutoB_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475529"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-215"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475529"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627475530"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475531"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ 'Auto's to zip up</span><span>
</span><a name="line-216"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475529"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><a href="#local-1627475530"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-1627475531"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-217"></a><a name="dZipAutoB_"><a href="Control.Auto.Collection.html#dZipAutoB_"><span class="hs-identifier">dZipAutoB_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#dZipAuto_"><span class="hs-identifier hs-var">dZipAuto_</span></a><span> </span><a href="Control.Auto.Blip.Internal.html#NoBlip"><span class="hs-identifier hs-var">NoBlip</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">-- | A dynamic box of 'Interval's.  Takes a list of inputs to feed to each</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- one, in the order that they were added.  Also takes a blip stream, which</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- emits with new 'Interval's to add to the box.</span><span>
</span><a name="line-222"></a><span class="hs-comment">--</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- Add new 'Interval's to the box however you want with the blip stream.</span><span>
</span><a name="line-224"></a><span class="hs-comment">--</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- As soon as an 'Interval' turns &quot;off&quot;, the 'Interval' is removed from the</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- box, and its output is silenced.</span><span>
</span><a name="line-227"></a><span class="hs-comment">--</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- The adding/removing aside, the routing of the inputs (the first field of</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- the tuple) to the internal 'Auto's and the outputs behaves the same as</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- with 'zipAuto'.</span><span>
</span><a name="line-231"></a><span class="hs-comment">--</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- This will be a pretty powerful collection if you ever imagine adding and</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- destroying behaviors dynamically...like spawning new enemies, or</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- something like that.</span><span>
</span><a name="line-235"></a><span class="hs-comment">--</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- Let's see an example...here we are going to be throwing a bunch of</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- 'Auto's that count to five and then die into our 'dynZip_'...once every</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- other step.</span><span>
</span><a name="line-239"></a><span class="hs-comment">--</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- -- count upwards, then die when you reach 5</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- countThenDie :: 'Interval'' () Int</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- countThenDie = onFor 5 . iterator (+1) 1</span><span>
</span><a name="line-244"></a><span class="hs-comment">--</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- -- emit a new `countThenDie` every two steps</span><span>
</span><a name="line-246"></a><span class="hs-comment">-- throwCounters :: Auto' () ('Blip' ['Interval'' () Int])</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- throwCounters = tagBlips [countThenDie] . every 2</span><span>
</span><a name="line-248"></a><span class="hs-comment">--</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- a :: Auto' () [Int]</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- a = proc _ -&gt; do</span><span>
</span><a name="line-251"></a><span class="hs-comment">--         newCounter &lt;- throwCounters -&lt; ()</span><span>
</span><a name="line-252"></a><span class="hs-comment">--         dynZip_ ()  -&lt; (repeat (), newCounter)</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-254"></a><span class="hs-comment">--</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res, _) = stepAutoN' 15 a ()</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- &gt;&gt;&gt; res</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- [[], [1            ]</span><span>
</span><a name="line-258"></a><span class="hs-comment">--    , [2,           ]</span><span>
</span><a name="line-259"></a><span class="hs-comment">--    , [3, 1         ]</span><span>
</span><a name="line-260"></a><span class="hs-comment">--    , [4, 2         ]</span><span>
</span><a name="line-261"></a><span class="hs-comment">--    , [5, 3, 1      ]</span><span>
</span><a name="line-262"></a><span class="hs-comment">--    , [   4, 2      ]</span><span>
</span><a name="line-263"></a><span class="hs-comment">--    , [   5, 3, 1   ]</span><span>
</span><a name="line-264"></a><span class="hs-comment">--    , [      4, 2   ]</span><span>
</span><a name="line-265"></a><span class="hs-comment">--    , [      5, 3, 1]</span><span>
</span><a name="line-266"></a><span class="hs-comment">-- ]</span><span>
</span><a name="line-267"></a><span class="hs-comment">--</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- This is a little unweildy, because 'Auto's maybe disappearing out of the</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- thing while you are trying to feed inputs into it.  You might be feeding</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- an input to an 'Auto'...but one of the 'Auto's before it on the list has</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- disappeared, so it accidentally goes to the wrong one.</span><span>
</span><a name="line-272"></a><span class="hs-comment">--</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- Because of this, it is suggested that you use 'dynMap_', which allows</span><span>
</span><a name="line-274"></a><span class="hs-comment">-- you to &quot;target&quot; labeled 'Auto's with your inputs.</span><span>
</span><a name="line-275"></a><span class="hs-comment">--</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- This 'Auto' is inherently unserializable, but you can use 'dynZipF' for</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- more or less the same functionality, with serialization possible.  It's</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- only slightly less powerful...for all intents and purposes, you should</span><span>
</span><a name="line-279"></a><span class="hs-comment">-- be able to use both in the same situations.  All of the examples here</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- can be also done with 'dynZipF'.</span><span>
</span><a name="line-281"></a><span class="hs-comment">--</span><span>
</span><a name="line-282"></a><span class="hs-identifier">dynZip_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475526"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-283"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627475527"><span class="hs-identifier hs-type">a</span></a><span>    </span><span class="hs-comment">-- &quot;default&quot; input to feed in</span><span>
</span><a name="line-284"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475526"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1627475527"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475526"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475527"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475528"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1627475528"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-285"></a><a name="dynZip_"><a href="Control.Auto.Collection.html#dynZip_"><span class="hs-identifier">dynZip_</span></a></a><span> </span><a name="local-1627475557"><a href="#local-1627475557"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475558"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-286"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-287"></a><span>    </span><a name="local-1627475558"><a href="#local-1627475558"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627475560"><a href="#local-1627475560"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475561"><a href="#local-1627475561"><span class="hs-identifier">news</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-288"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475562"><a href="#local-1627475562"><span class="hs-identifier">newas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Control.Auto.Blip.Internal.html#blip"><span class="hs-identifier hs-var">blip</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-1627475561"><span class="hs-identifier hs-var">news</span></a><span>
</span><a name="line-289"></a><span>                         </span><a name="local-1627475563"><a href="#local-1627475563"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zipWithM</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627475562"><span class="hs-identifier hs-var">newas</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475560"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><a href="#local-1627475557"><span class="hs-identifier hs-var">x0</span></a><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>                         </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627475564"><a href="#local-1627475564"><span class="hs-identifier">ys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475565"><a href="#local-1627475565"><span class="hs-identifier">as'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1627475566"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475567"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627475566"><a href="#local-1627475566"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475567"><a href="#local-1627475567"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627475563"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-291"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475564"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475558"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475565"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- | Like 'dynZip_', but instead of taking in a blip stream of 'Interval's</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- directly, takes in a blip stream of 'k's to trigger adding more</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- 'Interval's to the &quot;box&quot;, using the given @k -&gt; 'Interval' m a b@</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- function to make the new 'Interval' to add.</span><span>
</span><a name="line-297"></a><span class="hs-comment">--</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- Pretty much all of the power of 'dynZip_', but with serialization.</span><span>
</span><a name="line-299"></a><span class="hs-comment">--</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- See 'dynZip_' for examples and caveats.</span><span>
</span><a name="line-301"></a><span class="hs-comment">--</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- You could theoretically recover the behavior of 'dynZip_' with</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- @'dynZipF' id@, if there wasn't a 'Serialize' constraint on the @k@.</span><span>
</span><a name="line-304"></a><span class="hs-identifier">dynZipF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475522"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475523"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475522"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475523"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475524"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475525"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ function to generate a new</span><span>
</span><a name="line-306"></a><span>                                      </span><span class="hs-comment">--     'Interval' for each coming @k@</span><span>
</span><a name="line-307"></a><span>                                      </span><span class="hs-comment">--     in the blip stream.</span><span>
</span><a name="line-308"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475524"><span class="hs-identifier hs-type">a</span></a><span>                          </span><span class="hs-comment">-- ^ &quot;default&quot; input to feed in</span><span>
</span><a name="line-309"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475523"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1627475524"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475522"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1627475525"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-310"></a><a name="dynZipF"><a href="Control.Auto.Collection.html#dynZipF"><span class="hs-identifier">dynZipF</span></a></a><span> </span><a name="local-1627475568"><a href="#local-1627475568"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475569"><a href="#local-1627475569"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475570"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-311"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-312"></a><span>    </span><a name="local-1627475570"><a href="#local-1627475570"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627475572"><a href="#local-1627475572"><span class="hs-identifier">ksas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><a name="local-1627475573"><a href="#local-1627475573"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-313"></a><span>                          </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627475568"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475573"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-314"></a><span>                          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1627475570"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-1627475573"><span class="hs-identifier hs-var">ks</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>                      </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-1627475575"><a href="#local-1627475575"><span class="hs-identifier">ks</span></a></a><span class="hs-special">,</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-1627475572"><span class="hs-identifier hs-var">ksas</span></a><span>
</span><a name="line-316"></a><span>                          </span><span class="hs-identifier hs-var">put</span><span> </span><a href="#local-1627475575"><span class="hs-identifier hs-var">ks</span></a><span>
</span><a name="line-317"></a><span>                          </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>                      </span><span class="hs-special">(</span><a href="#local-1627475571"><span class="hs-identifier hs-var">goFunc</span></a><span> </span><a href="#local-1627475572"><span class="hs-identifier hs-var">ksas</span></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>    </span><a name="local-1627475571"><a href="#local-1627475571"><span class="hs-identifier">goFunc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_dynZipF"><span class="hs-identifier hs-var">_dynZipF</span></a><span> </span><a href="#local-1627475568"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475569"><span class="hs-identifier hs-var">x0</span></a><span> </span><a href="#local-1627475570"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'dynZipF'.  Well, you</span><span>
</span><a name="line-322"></a><span class="hs-comment">-- really might as well use 'dynZip_', which is more powerful...but maybe</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- using this can inspire more disciplined usage.  Also works as a drop-in</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- replacement for 'dynZipF'.</span><span>
</span><a name="line-325"></a><span class="hs-identifier">dynZipF_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475518"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-326"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475519"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475518"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475520"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475521"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ function to generate a new</span><span>
</span><a name="line-327"></a><span>                                      </span><span class="hs-comment">--     'Interval' for each coming @k@</span><span>
</span><a name="line-328"></a><span>                                      </span><span class="hs-comment">--     in the blip stream.</span><span>
</span><a name="line-329"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475520"><span class="hs-identifier hs-type">a</span></a><span>                         </span><span class="hs-comment">-- ^ &quot;default&quot; input to feed in</span><span>
</span><a name="line-330"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475518"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1627475520"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475519"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1627475521"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-331"></a><a name="dynZipF_"><a href="Control.Auto.Collection.html#dynZipF_"><span class="hs-identifier">dynZipF_</span></a></a><span> </span><a name="local-1627475577"><a href="#local-1627475577"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475578"><a href="#local-1627475578"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475579"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-332"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-333"></a><span>    </span><a name="local-1627475579"><a href="#local-1627475579"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627475581"><a href="#local-1627475581"><span class="hs-identifier">ksas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475580"><span class="hs-identifier hs-var">goFunc</span></a><span> </span><a href="#local-1627475581"><span class="hs-identifier hs-var">ksas</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>    </span><a name="local-1627475580"><a href="#local-1627475580"><span class="hs-identifier">goFunc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_dynZipF"><span class="hs-identifier hs-var">_dynZipF</span></a><span> </span><a href="#local-1627475577"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475578"><span class="hs-identifier hs-var">x0</span></a><span> </span><a href="#local-1627475579"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-identifier">_dynZipF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475514"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-337"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475515"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475514"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475516"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475516"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-339"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1627475515"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475514"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475516"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475514"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1627475516"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475515"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1627475517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1627475515"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475514"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475516"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-341"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1627475516"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475515"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475514"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1627475517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475514"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-1627475516"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475515"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-1627475517"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-343"></a><a name="_dynZipF"><a href="Control.Auto.Collection.html#_dynZipF"><span class="hs-identifier">_dynZipF</span></a></a><span> </span><a name="local-1627475582"><a href="#local-1627475582"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475583"><a href="#local-1627475583"><span class="hs-identifier">x0</span></a></a><span> </span><a name="local-1627475584"><a href="#local-1627475584"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627475585"><a href="#local-1627475585"><span class="hs-identifier">ksas</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627475586"><a href="#local-1627475586"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475587"><a href="#local-1627475587"><span class="hs-identifier">news</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-344"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475588"><a href="#local-1627475588"><span class="hs-identifier">adds</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Blip.Internal.html#blip"><span class="hs-identifier hs-var">blip</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><a href="#local-1627475582"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627475587"><span class="hs-identifier hs-var">news</span></a><span>
</span><a name="line-345"></a><span>        </span><a name="local-1627475589"><a href="#local-1627475589"><span class="hs-identifier">newksas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475585"><span class="hs-identifier hs-var">ksas</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-1627475588"><span class="hs-identifier hs-var">adds</span></a><span>
</span><a name="line-346"></a><span>        </span><span class="hs-special">(</span><a name="local-1627475590"><a href="#local-1627475590"><span class="hs-identifier">newks</span></a></a><span class="hs-special">,</span><a name="local-1627475591"><a href="#local-1627475591"><span class="hs-identifier">newas</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-1627475589"><span class="hs-identifier hs-var">newksas</span></a><span>
</span><a name="line-347"></a><span>    </span><a name="local-1627475592"><a href="#local-1627475592"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">zipWithM</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627475591"><span class="hs-identifier hs-var">newas</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475586"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">repeat</span><span> </span><a href="#local-1627475583"><span class="hs-identifier hs-var">x0</span></a><span class="hs-special">)</span><span>
</span><a name="line-348"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475593"><a href="#local-1627475593"><span class="hs-identifier">resks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-1627475590"><span class="hs-identifier hs-var">newks</span></a><span> </span><a href="#local-1627475592"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-349"></a><span>        </span><span class="hs-special">(</span><a name="local-1627475594"><a href="#local-1627475594"><span class="hs-identifier">ys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475595"><a href="#local-1627475595"><span class="hs-identifier">ksas'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-1627475597"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627475596"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-1627475598"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-1627475596"><a href="#local-1627475596"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627475597"><a href="#local-1627475597"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475598"><a href="#local-1627475598"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1627475593"><span class="hs-identifier hs-var">resks</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-350"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475594"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475584"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475595"><span class="hs-identifier hs-var">ksas'</span></a><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">-- | A dynamic box of 'Auto's, indexed by an 'Int'.  Takes an 'IntMap' of</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- inputs to feed into their corresponding 'Auto's, and collect all of the</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- outputs into an output 'IntMap'.</span><span>
</span><a name="line-356"></a><span class="hs-comment">--</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- Whenever any of the internal 'Auto's return 'Nothing', they are removed</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- from the collection.</span><span>
</span><a name="line-359"></a><span class="hs-comment">--</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.IntMap as IM</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- &gt;&gt;&gt; let dm0 :: Auto' (IM.IntMap Int) (IM.IntMap Int)</span><span>
</span><a name="line-362"></a><span class="hs-comment">--         dm0 = proc x -&gt; do</span><span>
</span><a name="line-363"></a><span class="hs-comment">--                   initials &lt;- immediately -&lt; [ Just &lt;$&gt; sumFrom 0</span><span>
</span><a name="line-364"></a><span class="hs-comment">--                                              , Just &lt;$&gt; sumFrom 10 ]</span><span>
</span><a name="line-365"></a><span class="hs-comment">--                   newIs    &lt;- every 3     -&lt; [ Just &lt;$&gt; sumFrom 0  ]</span><span>
</span><a name="line-366"></a><span class="hs-comment">--                   dynMap_ (-1) -&lt; (x, initials `mergeL` newIs)</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res1, dm1) = stepAuto' dm0 mempty</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- fromList [(0, -1), (1, 9)]</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res2, dm2) = stepAuto' dm1 (IM.fromList [(0,100),(1,50)])</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- fromList [(0, 99), (1, 59)]</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, dm3) = stepAuto' dm2 (IM.fromList [(0,10),(1,5)])</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- fromList [(0, 109), (1, 64), (2, -1)]</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res4, _  ) = stepAuto' dm3 (IM.fromList [(1,5),(2,5)])</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- &gt;&gt;&gt; res4</span><span>
</span><a name="line-378"></a><span class="hs-comment">-- fromList [(0, 108), (1, 69), (2, 4)]</span><span>
</span><a name="line-379"></a><span class="hs-comment">--</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- One quirk is that every internal 'Auto' is &quot;stepped&quot; at every step with</span><span>
</span><a name="line-381"></a><span class="hs-comment">-- the default input; 'gatherMany' is a version of this where 'Auto's that</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- do not have a corresponding &quot;input&quot; are left unstepped, and their last</span><span>
</span><a name="line-383"></a><span class="hs-comment">-- output preserved in the aggregate output.  As such, 'gatherMany' might</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- be seen more often.</span><span>
</span><a name="line-385"></a><span class="hs-comment">--</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- This 'Auto' is inherently unserializable, but you can use 'dynMapF' for</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- more or less the same functionality, with serialization possible.  It's</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- only slightly less powerful...for all intents and purposes, you should</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- be able to use both in the same situations.  All of the examples here</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- can be also done with 'dynMapF'.</span><span>
</span><a name="line-391"></a><span class="hs-comment">--</span><span>
</span><a name="line-392"></a><span class="hs-identifier">dynMap_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475511"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-393"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-1627475512"><span class="hs-identifier hs-type">a</span></a><span>    </span><span class="hs-comment">-- ^ &quot;default&quot; input to feed in</span><span>
</span><a name="line-394"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475511"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475512"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475511"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475512"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475513"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475513"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><a name="dynMap_"><a href="Control.Auto.Collection.html#dynMap_"><span class="hs-identifier">dynMap_</span></a></a><span> </span><a name="local-1627475599"><a href="#local-1627475599"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475600"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-396"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-397"></a><span>    </span><a name="local-1627475600"><a href="#local-1627475600"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627475601"><a href="#local-1627475601"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627475603"><a href="#local-1627475603"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475604"><a href="#local-1627475604"><span class="hs-identifier">news</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-398"></a><span>                           </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475605"><a href="#local-1627475605"><span class="hs-identifier">newas</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><a href="#local-1627475601"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Blip.Internal.html#blip"><span class="hs-identifier hs-var">blip</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-1627475604"><span class="hs-identifier hs-var">news</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>                               </span><a name="local-1627475606"><a href="#local-1627475606"><span class="hs-identifier">newas'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-1627475605"><span class="hs-identifier hs-var">newas</span></a><span>
</span><a name="line-400"></a><span>                               </span><a name="local-1627475607"><a href="#local-1627475607"><span class="hs-identifier">newc</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475601"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627475605"><span class="hs-identifier hs-var">newas</span></a><span>
</span><a name="line-401"></a><span>                               </span><a name="local-1627475608"><a href="#local-1627475608"><span class="hs-identifier">resMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#zipIntMapWithDefaults"><span class="hs-identifier hs-var">zipIntMapWithDefaults</span></a><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627475599"><span class="hs-identifier hs-var">x0</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475606"><span class="hs-identifier hs-var">newas'</span></a><span> </span><a href="#local-1627475603"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-402"></a><span>                           </span><a name="local-1627475609"><a href="#local-1627475609"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><a href="#local-1627475608"><span class="hs-identifier hs-var">resMap</span></a><span>
</span><a name="line-403"></a><span>                           </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475610"><a href="#local-1627475610"><span class="hs-identifier">res'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><a href="#local-1627475609"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-404"></a><span>                               </span><a name="local-1627475611"><a href="#local-1627475611"><span class="hs-identifier">ys</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627475610"><span class="hs-identifier hs-var">res'</span></a><span>
</span><a name="line-405"></a><span>                               </span><a name="local-1627475612"><a href="#local-1627475612"><span class="hs-identifier">as'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1627475610"><span class="hs-identifier hs-var">res'</span></a><span>
</span><a name="line-406"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475611"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475600"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475607"><span class="hs-identifier hs-var">newc</span></a><span> </span><a href="#local-1627475612"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">-- | Like 'dynMap_', but instead of taking in a blip stream of 'Interval's</span><span>
</span><a name="line-409"></a><span class="hs-comment">-- directly, takes in a blip stream of 'k's to trigger adding more</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- 'Interval's to the &quot;box&quot;, using the given @k -&gt; 'Interval' m a b@</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- function to make the new 'Interval' to add.</span><span>
</span><a name="line-412"></a><span class="hs-comment">--</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- Pretty much all of the power of 'dynMap_', but with serialization.</span><span>
</span><a name="line-414"></a><span class="hs-comment">--</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- See 'dynMap_' for examples and use cases.</span><span>
</span><a name="line-416"></a><span class="hs-comment">--</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- You could theoretically recover the behavior of 'dynMap_' with</span><span>
</span><a name="line-418"></a><span class="hs-comment">-- @'dynMapF' id@, if there wasn't a 'Serialize' constraint on the @k@.</span><span>
</span><a name="line-419"></a><span class="hs-identifier">dynMapF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475507"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475508"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475507"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475508"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475509"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475510"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ function to generate a new</span><span>
</span><a name="line-421"></a><span>                                      </span><span class="hs-comment">--     'Interval' for each coming @k@</span><span>
</span><a name="line-422"></a><span>                                      </span><span class="hs-comment">--     in the blip stream.</span><span>
</span><a name="line-423"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475509"><span class="hs-identifier hs-type">a</span></a><span>                          </span><span class="hs-comment">-- ^ &quot;default&quot; input to feed in</span><span>
</span><a name="line-424"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475508"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475509"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475507"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475510"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><a name="dynMapF"><a href="Control.Auto.Collection.html#dynMapF"><span class="hs-identifier">dynMapF</span></a></a><span> </span><a name="local-1627475613"><a href="#local-1627475613"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475614"><a href="#local-1627475614"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475615"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-426"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-427"></a><span>    </span><a name="local-1627475615"><a href="#local-1627475615"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627475617"><a href="#local-1627475617"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627475618"><a href="#local-1627475618"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><a name="local-1627475620"><a href="#local-1627475620"><span class="hs-identifier">i'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-428"></a><span>                             </span><a name="local-1627475621"><a href="#local-1627475621"><span class="hs-identifier">ks'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-429"></a><span>                             </span><a name="local-1627475622"><a href="#local-1627475622"><span class="hs-identifier">as'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1627475613"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475621"><span class="hs-identifier hs-var">ks'</span></a><span>
</span><a name="line-430"></a><span>                             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475615"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475620"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="#local-1627475621"><span class="hs-identifier hs-var">ks'</span></a><span> </span><a href="#local-1627475622"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">put</span><span> </span><a href="#local-1627475617"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><a href="#local-1627475618"><span class="hs-identifier hs-var">ks</span></a><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>                         </span><span class="hs-special">(</span><a href="#local-1627475616"><span class="hs-identifier hs-var">goFunc</span></a><span> </span><a href="#local-1627475617"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627475618"><span class="hs-identifier hs-var">ks</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-433"></a><span>    </span><a name="local-1627475616"><a href="#local-1627475616"><span class="hs-identifier">goFunc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_dynMapF"><span class="hs-identifier hs-var">_dynMapF</span></a><span> </span><a href="#local-1627475613"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475614"><span class="hs-identifier hs-var">x0</span></a><span> </span><a href="#local-1627475615"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-434"></a><span>
</span><a name="line-435"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'dynMapF'.  Well, you</span><span>
</span><a name="line-436"></a><span class="hs-comment">-- really might as well use 'dynMap_', which is more powerful...but maybe</span><span>
</span><a name="line-437"></a><span class="hs-comment">-- using this can inspire more disciplined usage.  Also works as a drop-in</span><span>
</span><a name="line-438"></a><span class="hs-comment">-- replacement for 'dynMapF'.</span><span>
</span><a name="line-439"></a><span class="hs-identifier">dynMapF_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475503"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-440"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475504"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475503"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475505"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475506"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ function to generate a new</span><span>
</span><a name="line-441"></a><span>                                      </span><span class="hs-comment">--     'Interval' for each coming @k@</span><span>
</span><a name="line-442"></a><span>                                      </span><span class="hs-comment">--     in the blip stream.</span><span>
</span><a name="line-443"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475505"><span class="hs-identifier hs-type">a</span></a><span>                         </span><span class="hs-comment">-- ^ &quot;default&quot; input to feed in</span><span>
</span><a name="line-444"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475503"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475505"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475504"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475506"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-445"></a><a name="dynMapF_"><a href="Control.Auto.Collection.html#dynMapF_"><span class="hs-identifier">dynMapF_</span></a></a><span> </span><a name="local-1627475623"><a href="#local-1627475623"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475624"><a href="#local-1627475624"><span class="hs-identifier">x0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475625"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">empty</span><span>
</span><a name="line-446"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-447"></a><span>    </span><a name="local-1627475625"><a href="#local-1627475625"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627475627"><a href="#local-1627475627"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627475628"><a href="#local-1627475628"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475626"><span class="hs-identifier hs-var">goFunc</span></a><span> </span><a href="#local-1627475627"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-1627475628"><span class="hs-identifier hs-var">ks</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>    </span><a name="local-1627475626"><a href="#local-1627475626"><span class="hs-identifier">goFunc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_dynMapF"><span class="hs-identifier hs-var">_dynMapF</span></a><span> </span><a href="#local-1627475623"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475624"><span class="hs-identifier hs-var">x0</span></a><span> </span><a href="#local-1627475625"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span class="hs-comment">-- just splitting out the functionality so that I can write this logic once</span><span>
</span><a name="line-451"></a><span class="hs-comment">-- for both the serializing and non serializing versions</span><span>
</span><a name="line-452"></a><span class="hs-identifier">_dynMapF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475499"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-453"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475500"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475499"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475501"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475502"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475501"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-455"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475500"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475499"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475501"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475502"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475499"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475501"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475500"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475502"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-457"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475500"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-458"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475499"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475501"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475502"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475501"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475500"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475499"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475502"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475499"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475501"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Blip.Internal.html#Blip"><span class="hs-identifier hs-type">Blip</span></a><span> </span><span class="hs-special">[</span><a href="#local-1627475500"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475502"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-461"></a><a name="_dynMapF"><a href="Control.Auto.Collection.html#_dynMapF"><span class="hs-identifier">_dynMapF</span></a></a><span> </span><a name="local-1627475630"><a href="#local-1627475630"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475631"><a href="#local-1627475631"><span class="hs-identifier">x0</span></a></a><span> </span><a name="local-1627475632"><a href="#local-1627475632"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-1627475633"><a href="#local-1627475633"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-1627475634"><a href="#local-1627475634"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">(</span><a name="local-1627475636"><a href="#local-1627475636"><span class="hs-identifier">xs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475637"><a href="#local-1627475637"><span class="hs-identifier">news</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-462"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475638"><a href="#local-1627475638"><span class="hs-identifier">newks</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><a href="#local-1627475633"><span class="hs-identifier hs-var">i</span></a><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Blip.Internal.html#blip"><span class="hs-identifier hs-var">blip</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><a href="#local-1627475637"><span class="hs-identifier hs-var">news</span></a><span class="hs-special">)</span><span>
</span><a name="line-463"></a><span>        </span><a name="local-1627475639"><a href="#local-1627475639"><span class="hs-identifier">newas</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">second</span><span class="hs-special">)</span><span> </span><a href="#local-1627475630"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475638"><span class="hs-identifier hs-var">newks</span></a><span>
</span><a name="line-464"></a><span>        </span><a name="local-1627475640"><a href="#local-1627475640"><span class="hs-identifier">newks'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475634"><span class="hs-identifier hs-var">ks</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-1627475638"><span class="hs-identifier hs-var">newks</span></a><span>
</span><a name="line-465"></a><span>        </span><a name="local-1627475641"><a href="#local-1627475641"><span class="hs-identifier">newas'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><a href="#local-1627475639"><span class="hs-identifier hs-var">newas</span></a><span>
</span><a name="line-466"></a><span>        </span><a name="local-1627475642"><a href="#local-1627475642"><span class="hs-identifier">newc</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475633"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-1627475638"><span class="hs-identifier hs-var">newks</span></a><span>
</span><a name="line-467"></a><span>        </span><a name="local-1627475643"><a href="#local-1627475643"><span class="hs-identifier">resMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#zipIntMapWithDefaults"><span class="hs-identifier hs-var">zipIntMapWithDefaults</span></a><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627475631"><span class="hs-identifier hs-var">x0</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475641"><span class="hs-identifier hs-var">newas'</span></a><span> </span><a href="#local-1627475636"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-468"></a><span>    </span><a name="local-1627475644"><a href="#local-1627475644"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><a href="#local-1627475643"><span class="hs-identifier hs-var">resMap</span></a><span>
</span><a name="line-469"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475645"><a href="#local-1627475645"><span class="hs-identifier">ys'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-1627475644"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-470"></a><span>        </span><a name="local-1627475646"><a href="#local-1627475646"><span class="hs-identifier">as'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">intersection</span><span> </span><a href="#local-1627475644"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-1627475645"><span class="hs-identifier hs-var">ys'</span></a><span>
</span><a name="line-471"></a><span>        </span><a name="local-1627475647"><a href="#local-1627475647"><span class="hs-identifier">ks'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">intersection</span><span> </span><a href="#local-1627475640"><span class="hs-identifier hs-var">newks'</span></a><span> </span><a href="#local-1627475645"><span class="hs-identifier hs-var">ys'</span></a><span>
</span><a name="line-472"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475645"><span class="hs-identifier hs-var">ys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475632"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475642"><span class="hs-identifier hs-var">newc</span></a><span> </span><a href="#local-1627475647"><span class="hs-identifier hs-var">ks'</span></a><span> </span><a href="#local-1627475646"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span>
</span><a name="line-475"></a><span class="hs-comment">-- | 'Auto' multiplexer.  Stores a bunch of internal 'Auto's indexed by</span><span>
</span><a name="line-476"></a><span class="hs-comment">-- a key.  At every step, takes a key-input pair, feeds the input to the</span><span>
</span><a name="line-477"></a><span class="hs-comment">-- 'Auto' stored at that key and outputs the output.</span><span>
</span><a name="line-478"></a><span class="hs-comment">--</span><span>
</span><a name="line-479"></a><span class="hs-comment">-- If the key given does not yet have an 'Auto' stored at that key,</span><span>
</span><a name="line-480"></a><span class="hs-comment">-- initializes a new 'Auto' at that key by using the supplied function.</span><span>
</span><a name="line-481"></a><span class="hs-comment">--</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- Once initialized, these 'Auto's are stored there forever.</span><span>
</span><a name="line-483"></a><span class="hs-comment">--</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- You can play around with some combinators from &quot;Control.Auto.Switch&quot;;</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- for example, with 'resetOn', you can make 'Auto's that &quot;reset&quot;</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- themselves when given a certain input.  'switchOnF' could be put to use</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- here too in neat ways.</span><span>
</span><a name="line-488"></a><span class="hs-comment">--</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- &gt;&gt;&gt; let mx0 = mux (\_ -&gt; sumFrom 0)</span><span>
</span><a name="line-490"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res1, mx1) = stepAuto' mx0 (&quot;hello&quot;, 5)</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-492"></a><span class="hs-comment">-- 5</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res2, mx2) = stepAuto' mx1 (&quot;world&quot;, 3)</span><span>
</span><a name="line-494"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- 3</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, mx3) = stepAuto' mx2 (&quot;hello&quot;, 4)</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-498"></a><span class="hs-comment">-- 9</span><span>
</span><a name="line-499"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' mx3 [(&quot;world&quot;, 2), (&quot;foo&quot;, 6), (&quot;foo&quot;, 1), (&quot;hello&quot;, 2)]</span><span>
</span><a name="line-500"></a><span class="hs-comment">-- [5, 6, 7, 11]</span><span>
</span><a name="line-501"></a><span class="hs-identifier">mux</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475495"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475495"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475496"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-502"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475495"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475496"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475497"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475498"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ function to create a new 'Auto' if none at</span><span>
</span><a name="line-503"></a><span>                            </span><span class="hs-comment">--   that key already exists.</span><span>
</span><a name="line-504"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475496"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475495"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475497"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475498"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-505"></a><a name="mux"><a href="Control.Auto.Collection.html#mux"><span class="hs-identifier">mux</span></a></a><span> </span><a name="local-1627475648"><a href="#local-1627475648"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dimap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#muxMany"><span class="hs-identifier hs-var">muxMany</span></a><span> </span><a href="#local-1627475648"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'mux'.</span><span>
</span><a name="line-508"></a><span class="hs-identifier">mux_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475491"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475492"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-509"></a><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475491"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475492"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475493"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475494"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ function to create a new 'Auto' if none at</span><span>
</span><a name="line-510"></a><span>                            </span><span class="hs-comment">--   that key already exists</span><span>
</span><a name="line-511"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475492"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475491"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475493"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475494"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-512"></a><a name="mux_"><a href="Control.Auto.Collection.html#mux_"><span class="hs-identifier">mux_</span></a></a><span> </span><a name="local-1627475649"><a href="#local-1627475649"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dimap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#muxMany_"><span class="hs-identifier hs-var">muxMany_</span></a><span> </span><a href="#local-1627475649"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span class="hs-comment">-- | 'Auto' multiplexer, like 'mux', except allows update/access of many</span><span>
</span><a name="line-515"></a><span class="hs-comment">-- 'Auto's at a time.  Instead of taking in a single key-value pair and</span><span>
</span><a name="line-516"></a><span class="hs-comment">-- outputting a single result, takes in an entire 'Map' of key-value pairs</span><span>
</span><a name="line-517"></a><span class="hs-comment">-- and outputs a 'Map' of key-result pairs.</span><span>
</span><a name="line-518"></a><span class="hs-comment">--</span><span>
</span><a name="line-519"></a><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.Map as M</span><span>
</span><a name="line-520"></a><span class="hs-comment">-- &gt;&gt;&gt; let mx0 = mux (\_ -&gt; sumFrom 0)</span><span>
</span><a name="line-521"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res1, mx1) = stepAuto' mx0 (M.fromList [ (&quot;hello&quot;, 5)</span><span>
</span><a name="line-522"></a><span class="hs-comment">--                                                 , (&quot;world&quot;, 3) ])</span><span>
</span><a name="line-523"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-524"></a><span class="hs-comment">-- fromList [(&quot;hello&quot;, 5), (&quot;world&quot;, 3)]</span><span>
</span><a name="line-525"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res2, mx2) = stepAuto' mx1 (M.fromList [ (&quot;hello&quot;, 4)</span><span>
</span><a name="line-526"></a><span class="hs-comment">--                                                 , (&quot;foo&quot;  , 7) ])</span><span>
</span><a name="line-527"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-528"></a><span class="hs-comment">-- fromList [(&quot;foo&quot;, 7), (&quot;hello&quot;, 9)]</span><span>
</span><a name="line-529"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, _  ) = mx2 (M.fromList [(&quot;world&quot;, 3), (&quot;foo&quot;, 1)])</span><span>
</span><a name="line-530"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-531"></a><span class="hs-comment">-- fromList [(&quot;foo&quot;, 8), (&quot;world&quot;, 6)]</span><span>
</span><a name="line-532"></a><span class="hs-comment">--</span><span>
</span><a name="line-533"></a><span class="hs-comment">-- See 'mux' for more notes.</span><span>
</span><a name="line-534"></a><span class="hs-identifier">muxMany</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475487"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475487"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475488"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-535"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475487"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475488"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475489"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475490"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ function to create a new 'Auto' if</span><span>
</span><a name="line-536"></a><span>                              </span><span class="hs-comment">--   none at that key already exists</span><span>
</span><a name="line-537"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475488"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475487"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475489"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475487"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475490"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-538"></a><a name="muxMany"><a href="Control.Auto.Collection.html#muxMany"><span class="hs-identifier">muxMany</span></a></a><span> </span><a name="local-1627475650"><a href="#local-1627475650"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475651"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-539"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-540"></a><span>    </span><span class="hs-comment">-- go :: Map k (Auto m a b) -&gt; Auto m (Map k a) (Map k b)</span><span>
</span><a name="line-541"></a><span>    </span><a name="local-1627475651"><a href="#local-1627475651"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627475652"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475653"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627475654"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>    </span><a name="local-1627475652"><a href="#local-1627475652"><span class="hs-identifier">l</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-543"></a><span>      </span><a name="local-1627475656"><a href="#local-1627475656"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-544"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><a href="#local-1627475650"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475656"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span>      </span><a href="#local-1627475651"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-546"></a><span>    </span><a name="local-1627475653"><a href="#local-1627475653"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-keyword">as</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keys</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-547"></a><span>    </span><a name="local-1627475654"><a href="#local-1627475654"><span class="hs-identifier">t</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_muxManyF"><span class="hs-identifier hs-var">_muxManyF</span></a><span> </span><a href="#local-1627475650"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475651"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'muxMany'.</span><span>
</span><a name="line-550"></a><span class="hs-identifier">muxMany_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475483"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475484"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-551"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475483"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475484"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475485"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475486"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ function to create a new 'Auto' if</span><span>
</span><a name="line-552"></a><span>                              </span><span class="hs-comment">--   none at that key already exists</span><span>
</span><a name="line-553"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475484"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475483"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475485"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475483"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475486"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-554"></a><a name="muxMany_"><a href="Control.Auto.Collection.html#muxMany_"><span class="hs-identifier">muxMany_</span></a></a><span> </span><a name="local-1627475659"><a href="#local-1627475659"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475660"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-555"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-556"></a><span>    </span><span class="hs-comment">-- go :: Map k (Auto m a b) -&gt; Auto m (Map k a) (Map k b)</span><span>
</span><a name="line-557"></a><span>    </span><a name="local-1627475660"><a href="#local-1627475660"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Collection.html#_muxManyF"><span class="hs-identifier hs-var">_muxManyF</span></a><span> </span><a href="#local-1627475659"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475660"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-identifier">_muxManyF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475479"><a href="#local-1627475479"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475480"><a href="#local-1627475480"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475481"><a href="#local-1627475481"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475482"><a href="#local-1627475482"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                          </span><span class="hs-comment">-- ^ f : make new Autos</span><span>
</span><a name="line-561"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ go: make next step</span><span>
</span><a name="line-562"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                         </span><span class="hs-comment">-- ^ as: all current Autos</span><span>
</span><a name="line-563"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span>                                    </span><span class="hs-comment">-- ^ xs: Inputs</span><span>
</span><a name="line-564"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ Outputs, and next Auto.</span><span>
</span><a name="line-565"></a><a name="_muxManyF"><a href="Control.Auto.Collection.html#_muxManyF"><span class="hs-identifier">_muxManyF</span></a></a><span> </span><a name="local-1627475661"><a href="#local-1627475661"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475662"><a href="#local-1627475662"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1627475664"><a href="#local-1627475664"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-566"></a><span>    </span><span class="hs-comment">-- all the outputs of the autos with the present inputs; autos without</span><span>
</span><a name="line-567"></a><span>    </span><span class="hs-comment">--   inputs are ignored.</span><span>
</span><a name="line-568"></a><span>    </span><a name="local-1627475669"><a href="#local-1627475669"><span class="hs-identifier">outs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><a href="#local-1627475667"><span class="hs-identifier hs-var">steps</span></a><span>
</span><a name="line-569"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475670"><a href="#local-1627475670"><span class="hs-identifier">ys</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-1627475669"><span class="hs-identifier hs-var">outs</span></a><span>
</span><a name="line-570"></a><span>        </span><a name="local-1627475671"><a href="#local-1627475671"><span class="hs-identifier">allas'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-1627475669"><span class="hs-identifier hs-var">outs</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475666"><span class="hs-identifier hs-var">allas</span></a><span>
</span><a name="line-571"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475670"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475662"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475671"><span class="hs-identifier hs-var">allas'</span></a><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-573"></a><span>    </span><span class="hs-comment">-- new Autos, from the function.  Only on new ones not found in `as`.</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-identifier">newas</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-575"></a><span>    </span><a name="local-1627475665"><a href="#local-1627475665"><span class="hs-identifier">newas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627475668"><a href="#local-1627475668"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475661"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475668"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span><span> </span><a href="#local-1627475664"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-576"></a><span>    </span><span class="hs-comment">-- all Autos, new and old.  Prefer the old ones.</span><span>
</span><a name="line-577"></a><span>    </span><span class="hs-identifier">allas</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-578"></a><span>    </span><a name="local-1627475666"><a href="#local-1627475666"><span class="hs-identifier">allas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627475665"><span class="hs-identifier hs-var">newas</span></a><span>
</span><a name="line-579"></a><span>    </span><span class="hs-comment">-- Step all the autos with all the inputs.  Lose the Autos that have no</span><span>
</span><a name="line-580"></a><span>    </span><span class="hs-comment">--   corresponding input.</span><span>
</span><a name="line-581"></a><span>    </span><span class="hs-identifier">steps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475479"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475480"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475481"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475482"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span>    </span><a name="local-1627475667"><a href="#local-1627475667"><span class="hs-identifier">steps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">intersectionWith</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627475666"><span class="hs-identifier hs-var">allas</span></a><span> </span><a href="#local-1627475664"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-583"></a><span>
</span><a name="line-584"></a><span>
</span><a name="line-585"></a><span class="hs-comment">-- | Like 'muxI', but holds 'Interval's instead.  When any given 'Interval'</span><span>
</span><a name="line-586"></a><span class="hs-comment">-- turns &quot;off&quot;, it's removed from the collection.  If its key is fed in</span><span>
</span><a name="line-587"></a><span class="hs-comment">-- again, it'll be restarted with the initializing function.  On the actual</span><span>
</span><a name="line-588"></a><span class="hs-comment">-- step when it turns &quot;off&quot;, 'Nothing' will be returned.</span><span>
</span><a name="line-589"></a><span class="hs-identifier">muxI</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475475"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475475"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475476"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475475"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475476"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475477"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475478"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ function to create a new 'Auto' if none at</span><span>
</span><a name="line-591"></a><span>                              </span><span class="hs-comment">--   that key already exists.</span><span>
</span><a name="line-592"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475476"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475475"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475477"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475478"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><a name="muxI"><a href="Control.Auto.Collection.html#muxI"><span class="hs-identifier">muxI</span></a></a><span> </span><a name="local-1627475672"><a href="#local-1627475672"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dimap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToMaybe</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#muxManyI"><span class="hs-identifier hs-var">muxManyI</span></a><span> </span><a href="#local-1627475672"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'muxI'.</span><span>
</span><a name="line-596"></a><span class="hs-identifier">muxI_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475471"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475472"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-597"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475471"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475472"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475473"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475474"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ function to create a new 'Auto' if none at</span><span>
</span><a name="line-598"></a><span>                                 </span><span class="hs-comment">--   that key already exists</span><span>
</span><a name="line-599"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475472"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475471"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475473"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475474"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-600"></a><a name="muxI_"><a href="Control.Auto.Collection.html#muxI_"><span class="hs-identifier">muxI_</span></a></a><span> </span><a name="local-1627475673"><a href="#local-1627475673"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dimap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToMaybe</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#muxManyI_"><span class="hs-identifier hs-var">muxManyI_</span></a><span> </span><a href="#local-1627475673"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span class="hs-comment">-- | Like 'muxManyI', but holds 'Interval's instead.  When any given</span><span>
</span><a name="line-603"></a><span class="hs-comment">-- 'Interval' turns &quot;off&quot;, it's removed from the collection.  Only</span><span>
</span><a name="line-604"></a><span class="hs-comment">-- 'Interval's that are &quot;on&quot; after the step will be present in the output</span><span>
</span><a name="line-605"></a><span class="hs-comment">-- 'Map'.</span><span>
</span><a name="line-606"></a><span class="hs-identifier">muxManyI</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475467"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475467"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475468"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475467"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475468"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475469"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475470"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ function to create a new 'Auto' if</span><span>
</span><a name="line-608"></a><span>                                  </span><span class="hs-comment">--   none at that key already exists</span><span>
</span><a name="line-609"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475468"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475467"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475467"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475470"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-610"></a><a name="muxManyI"><a href="Control.Auto.Collection.html#muxManyI"><span class="hs-identifier">muxManyI</span></a></a><span> </span><a name="local-1627475674"><a href="#local-1627475674"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475675"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-611"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-612"></a><span>    </span><span class="hs-comment">-- go :: Map k (Interval m a b) -&gt; Auto m (Map k a) (Map k b)</span><span>
</span><a name="line-613"></a><span>    </span><a name="local-1627475675"><a href="#local-1627475675"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627475676"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475677"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627475678"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-614"></a><span>    </span><a name="local-1627475676"><a href="#local-1627475676"><span class="hs-identifier">l</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-615"></a><span>      </span><a name="local-1627475680"><a href="#local-1627475680"><span class="hs-identifier">ks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-616"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><a href="#local-1627475674"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475680"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-617"></a><span>      </span><a href="#local-1627475675"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-618"></a><span>    </span><a name="local-1627475677"><a href="#local-1627475677"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-keyword">as</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keys</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-619"></a><span>    </span><a name="local-1627475678"><a href="#local-1627475678"><span class="hs-identifier">t</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_muxManyIF"><span class="hs-identifier hs-var">_muxManyIF</span></a><span> </span><a href="#local-1627475674"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475675"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'muxManyI'.</span><span>
</span><a name="line-622"></a><span class="hs-identifier">muxManyI_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475463"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475464"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-623"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475463"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475464"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475465"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475466"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ function to create a new 'Auto' if</span><span>
</span><a name="line-624"></a><span>                                   </span><span class="hs-comment">--   none at that key already exists</span><span>
</span><a name="line-625"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475464"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475463"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475465"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475463"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475466"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-626"></a><a name="muxManyI_"><a href="Control.Auto.Collection.html#muxManyI_"><span class="hs-identifier">muxManyI_</span></a></a><span> </span><a name="local-1627475683"><a href="#local-1627475683"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475684"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-627"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-628"></a><span>    </span><span class="hs-comment">-- go :: Map k (Interval m a b) -&gt; Auto m (Map k a) (Map k b)</span><span>
</span><a name="line-629"></a><span>    </span><a name="local-1627475684"><a href="#local-1627475684"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Collection.html#_muxManyIF"><span class="hs-identifier hs-var">_muxManyIF</span></a><span> </span><a href="#local-1627475683"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475684"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-identifier">_muxManyIF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475459"><a href="#local-1627475459"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475460"><a href="#local-1627475460"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475461"><a href="#local-1627475461"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475462"><a href="#local-1627475462"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                       </span><span class="hs-comment">-- ^ f : make new Autos</span><span>
</span><a name="line-633"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ go: make next step</span><span>
</span><a name="line-634"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>                      </span><span class="hs-comment">-- ^ as: all current Autos</span><span>
</span><a name="line-635"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span>                                     </span><span class="hs-comment">-- ^ xs: Inputs</span><span>
</span><a name="line-636"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ Outputs, and next Auto.</span><span>
</span><a name="line-637"></a><a name="_muxManyIF"><a href="Control.Auto.Collection.html#_muxManyIF"><span class="hs-identifier">_muxManyIF</span></a></a><span> </span><a name="local-1627475685"><a href="#local-1627475685"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475686"><a href="#local-1627475686"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1627475688"><a href="#local-1627475688"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-638"></a><span>    </span><span class="hs-comment">-- all the outputs of the autos with the present inputs; autos without</span><span>
</span><a name="line-639"></a><span>    </span><span class="hs-comment">--   inputs are ignored.</span><span>
</span><a name="line-640"></a><span>    </span><a name="local-1627475697"><a href="#local-1627475697"><span class="hs-identifier">outs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><a href="#local-1627475691"><span class="hs-identifier hs-var">steps</span></a><span>
</span><a name="line-641"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1627475698"><a href="#local-1627475698"><span class="hs-identifier">outs'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="#local-1627475693"><span class="hs-identifier hs-var">filterDead</span></a><span> </span><a href="#local-1627475697"><span class="hs-identifier hs-var">outs</span></a><span>   </span><span class="hs-comment">-- Nothings removed</span><span>
</span><a name="line-642"></a><span>        </span><a name="local-1627475699"><a href="#local-1627475699"><span class="hs-identifier">ys</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-1627475698"><span class="hs-identifier hs-var">outs'</span></a><span>
</span><a name="line-643"></a><span>        </span><a name="local-1627475700"><a href="#local-1627475700"><span class="hs-identifier">allas'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-1627475698"><span class="hs-identifier hs-var">outs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475692"><span class="hs-identifier hs-var">leftOuts</span></a><span>
</span><a name="line-644"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475699"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475686"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475700"><span class="hs-identifier hs-var">allas'</span></a><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-646"></a><span>    </span><span class="hs-comment">-- new Autos, from the function.  Only on new ones not found in `as`.</span><span>
</span><a name="line-647"></a><span>    </span><span class="hs-identifier">newas</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-648"></a><span>    </span><a name="local-1627475689"><a href="#local-1627475689"><span class="hs-identifier">newas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1627475694"><a href="#local-1627475694"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475685"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475694"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span><span> </span><a href="#local-1627475688"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-649"></a><span>    </span><span class="hs-comment">-- all Autos, new and old.  Prefer the old ones.</span><span>
</span><a name="line-650"></a><span>    </span><span class="hs-identifier">allas</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>    </span><a name="local-1627475690"><a href="#local-1627475690"><span class="hs-identifier">allas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627475689"><span class="hs-identifier hs-var">newas</span></a><span>
</span><a name="line-652"></a><span>    </span><span class="hs-comment">-- Step all the autos with all the inputs.  Lose the Autos that have no</span><span>
</span><a name="line-653"></a><span>    </span><span class="hs-comment">--   corresponding input.</span><span>
</span><a name="line-654"></a><span>    </span><span class="hs-identifier">steps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-655"></a><span>    </span><a name="local-1627475691"><a href="#local-1627475691"><span class="hs-identifier">steps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">intersectionWith</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627475690"><span class="hs-identifier hs-var">allas</span></a><span> </span><a href="#local-1627475688"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-656"></a><span>    </span><span class="hs-comment">-- Autos not being stepped</span><span>
</span><a name="line-657"></a><span>    </span><span class="hs-identifier">leftOuts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475459"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span>    </span><a name="local-1627475692"><a href="#local-1627475692"><span class="hs-identifier">leftOuts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span><span> </span><a href="#local-1627475690"><span class="hs-identifier hs-var">allas</span></a><span> </span><a href="#local-1627475691"><span class="hs-identifier hs-var">steps</span></a><span>
</span><a name="line-659"></a><span>    </span><span class="hs-comment">-- Get out the result if Just, otherwise erase it all.</span><span>
</span><a name="line-660"></a><span>    </span><span class="hs-identifier">filterDead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475460"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475461"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475462"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-661"></a><span>    </span><a name="local-1627475693"><a href="#local-1627475693"><span class="hs-identifier">filterDead</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627475695"><a href="#local-1627475695"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475696"><a href="#local-1627475696"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-1627475695"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475696"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>    </span><span class="hs-identifier">filterDead</span><span> </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-identifier">e2m</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475457"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475458"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475458"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475457"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475458"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-665"></a><a name="e2m"><a href="Control.Auto.Collection.html#e2m"><span class="hs-identifier">e2m</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a name="local-1627475701"><a href="#local-1627475701"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475702"><a href="#local-1627475702"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1627475701"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-1627475702"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span class="hs-identifier">e2m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1627475703"><a href="#local-1627475703"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a href="#local-1627475703"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span>
</span><a name="line-668"></a><span class="hs-identifier">_muxgathermapF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627475452"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475453"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475454"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475455"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475456"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475452"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475453"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475455"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475453"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475454"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475455"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475456"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-669"></a><a name="_muxgathermapF"><a href="Control.Auto.Collection.html#_muxgathermapF"><span class="hs-identifier">_muxgathermapF</span></a></a><span> </span><a name="local-1627475704"><a href="#local-1627475704"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475705"><a href="#local-1627475705"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627475706"><a href="#local-1627475706"><span class="hs-identifier">mz</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627475706"><span class="hs-identifier hs-var">mz</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475704"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475705"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627475706"><span class="hs-identifier hs-var">mz</span></a><span class="hs-special">)</span><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span class="hs-comment">-- | Keeps an internal 'Map' of 'Interval's and, at every step, the output is</span><span>
</span><a name="line-672"></a><span class="hs-comment">-- the last seen output of every 'Interval', indexed under the proper key.</span><span>
</span><a name="line-673"></a><span class="hs-comment">--</span><span>
</span><a name="line-674"></a><span class="hs-comment">-- At every step, the input is a key-value pair; 'gather' will feed that</span><span>
</span><a name="line-675"></a><span class="hs-comment">-- input value to the 'Interval' under the proper key and update the output</span><span>
</span><a name="line-676"></a><span class="hs-comment">-- map with that new result.</span><span>
</span><a name="line-677"></a><span class="hs-comment">--</span><span>
</span><a name="line-678"></a><span class="hs-comment">-- If the key offered the input is not yet a part of the collection,</span><span>
</span><a name="line-679"></a><span class="hs-comment">-- initializes it with the given function.</span><span>
</span><a name="line-680"></a><span class="hs-comment">--</span><span>
</span><a name="line-681"></a><span class="hs-comment">-- Any 'Interval' that turns &quot;off&quot; (outputs 'Nothing') from this will be</span><span>
</span><a name="line-682"></a><span class="hs-comment">-- immediately removed from the collection.  If something for that key is</span><span>
</span><a name="line-683"></a><span class="hs-comment">-- received again, it will re-initialize it.</span><span>
</span><a name="line-684"></a><span class="hs-comment">--</span><span>
</span><a name="line-685"></a><span class="hs-comment">-- &gt;&gt;&gt; let sumUntil :: Interval' Int Int</span><span>
</span><a name="line-686"></a><span class="hs-comment">--         sumUntil = proc x -&gt; do</span><span>
</span><a name="line-687"></a><span class="hs-comment">--                        sums &lt;- sumFrom 0     -&lt; x</span><span>
</span><a name="line-688"></a><span class="hs-comment">--                        stop &lt;- became (&gt; 10) -&lt; sums</span><span>
</span><a name="line-689"></a><span class="hs-comment">--                        before -&lt; (sums, stop)</span><span>
</span><a name="line-690"></a><span class="hs-comment">--     -- (a running sum, &quot;on&quot; until the sum is greater than 10)</span><span>
</span><a name="line-691"></a><span class="hs-comment">-- &gt;&gt;&gt; let gt0 = gather (\_ -&gt; sumUntil)</span><span>
</span><a name="line-692"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res1, gt1) = stepAuto' gt0 (&quot;hello&quot;, 5)</span><span>
</span><a name="line-693"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- fromList [(&quot;hello&quot;, 5)]</span><span>
</span><a name="line-695"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res2, gt2) = stepAuto' gt1 (&quot;world&quot;, 7)</span><span>
</span><a name="line-696"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-697"></a><span class="hs-comment">-- fromList [(&quot;hello&quot;, 5), (&quot;world&quot;, 7)]</span><span>
</span><a name="line-698"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, gt3) = stepAuto' gt2 (&quot;foo&quot;, 4)</span><span>
</span><a name="line-699"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-700"></a><span class="hs-comment">-- fromList [(&quot;foo&quot;, 4), (&quot;hello&quot;, 5), (&quot;world&quot;, 7)]</span><span>
</span><a name="line-701"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res4, gt4) = stepAuto' gt3 (&quot;world&quot;, 8)</span><span>
</span><a name="line-702"></a><span class="hs-comment">-- &gt;&gt;&gt; res4</span><span>
</span><a name="line-703"></a><span class="hs-comment">-- fromList [(&quot;foo&quot;, 4), (&quot;hello&quot;, 5)]</span><span>
</span><a name="line-704"></a><span class="hs-comment">-- &gt;&gt;&gt; streamAuto' gt4 [(&quot;world&quot;, 2),(&quot;bar&quot;, 9),(&quot;world&quot;, 6),(&quot;hello&quot;, 11)]</span><span>
</span><a name="line-705"></a><span class="hs-comment">-- [ fromList [(&quot;foo&quot;, 4), (&quot;hello&quot;, 5), (&quot;world&quot;, 2)]</span><span>
</span><a name="line-706"></a><span class="hs-comment">-- , fromList [(&quot;bar&quot;, 9), (&quot;foo&quot;, 4), (&quot;hello&quot;, 5), (&quot;world&quot;, 2)]</span><span>
</span><a name="line-707"></a><span class="hs-comment">-- , fromList [(&quot;bar&quot;, 9), (&quot;foo&quot;, 4), (&quot;hello&quot;, 5), (&quot;world&quot;, 8)]</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- , fromList [(&quot;bar&quot;, 9), (&quot;foo&quot;, 4), (&quot;world&quot;, 8)]</span><span>
</span><a name="line-709"></a><span class="hs-comment">-- ]</span><span>
</span><a name="line-710"></a><span class="hs-comment">--</span><span>
</span><a name="line-711"></a><span class="hs-comment">-- In practice this ends up being a very common collection; see the</span><span>
</span><a name="line-712"></a><span class="hs-comment">-- &lt;https://github.com/mstksg/auto-examples auto-examples&gt; project for many</span><span>
</span><a name="line-713"></a><span class="hs-comment">-- examples!</span><span>
</span><a name="line-714"></a><span class="hs-comment">--</span><span>
</span><a name="line-715"></a><span class="hs-comment">-- Because everything needs a 'key', you don't have the fancy</span><span>
</span><a name="line-716"></a><span class="hs-comment">-- &quot;auto-generate new keys&quot; feature of 'dynMap'...however, you could always</span><span>
</span><a name="line-717"></a><span class="hs-comment">-- pull a new key from @'perBlip' 'enumFromA'@ or something.</span><span>
</span><a name="line-718"></a><span class="hs-comment">--</span><span>
</span><a name="line-719"></a><span class="hs-comment">-- Like with 'mux', combinators from &quot;Control.Auto.Switch&quot; like 'resetOn'</span><span>
</span><a name="line-720"></a><span class="hs-comment">-- and 'switchOnF' are very useful here!</span><span>
</span><a name="line-721"></a><span class="hs-comment">--</span><span>
</span><a name="line-722"></a><span class="hs-identifier">gather</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475448"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475449"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475448"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475450"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-723"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475448"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475449"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475451"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475450"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ function to create a new 'Auto'</span><span>
</span><a name="line-724"></a><span>                                    </span><span class="hs-comment">--   if none at that key already</span><span>
</span><a name="line-725"></a><span>                                    </span><span class="hs-comment">--   exists</span><span>
</span><a name="line-726"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475449"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475448"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475451"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475448"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475450"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-727"></a><a name="gather"><a href="Control.Auto.Collection.html#gather"><span class="hs-identifier">gather</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Collection.html#gatherMany"><span class="hs-identifier hs-var">gatherMany</span></a><span>
</span><a name="line-728"></a><span>
</span><a name="line-729"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'gather':</span><span>
</span><a name="line-730"></a><span class="hs-comment">--</span><span>
</span><a name="line-731"></a><span class="hs-comment">-- __Does__ serialize the actual __'Auto's__ themselves; the 'Auto's are</span><span>
</span><a name="line-732"></a><span class="hs-comment">-- all serialized and re-loaded/resumed when 'gather_ f' is resumed.</span><span>
</span><a name="line-733"></a><span class="hs-comment">--</span><span>
</span><a name="line-734"></a><span class="hs-comment">-- Does __not__ serialize the &quot;last outputs&quot;, so resumed 'Auto's that have</span><span>
</span><a name="line-735"></a><span class="hs-comment">-- not yet been re-run/accessed to get a fresh output are not represented</span><span>
</span><a name="line-736"></a><span class="hs-comment">-- in the output map at first.</span><span>
</span><a name="line-737"></a><span class="hs-comment">--</span><span>
</span><a name="line-738"></a><span class="hs-identifier">gather_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475444"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475445"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475444"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475444"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475445"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475446"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475447"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ function to create a new 'Auto'</span><span>
</span><a name="line-740"></a><span>                                      </span><span class="hs-comment">--   if none at that key already</span><span>
</span><a name="line-741"></a><span>                                      </span><span class="hs-comment">--   exists</span><span>
</span><a name="line-742"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475445"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475444"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475446"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475444"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475447"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-743"></a><a name="gather_"><a href="Control.Auto.Collection.html#gather_"><span class="hs-identifier">gather_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Collection.html#gatherMany_"><span class="hs-identifier hs-var">gatherMany_</span></a><span>
</span><a name="line-744"></a><span>
</span><a name="line-745"></a><span class="hs-comment">-- | The non-serializing/non-resuming vervsion of 'gather':</span><span>
</span><a name="line-746"></a><span class="hs-comment">--</span><span>
</span><a name="line-747"></a><span class="hs-comment">-- Serializes neither the 'Auto's themselves nor the &quot;last outputs&quot; ---</span><span>
</span><a name="line-748"></a><span class="hs-comment">-- essentially, serializes/resumes nothing.</span><span>
</span><a name="line-749"></a><span class="hs-identifier">gather__</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475440"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475441"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-750"></a><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475440"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475441"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475442"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475443"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ function to create a new</span><span>
</span><a name="line-751"></a><span>                                        </span><span class="hs-comment">--   'Auto' if none at that key</span><span>
</span><a name="line-752"></a><span>                                        </span><span class="hs-comment">--   already exists</span><span>
</span><a name="line-753"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475441"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475440"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475442"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475440"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475443"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-754"></a><a name="gather__"><a href="Control.Auto.Collection.html#gather__"><span class="hs-identifier">gather__</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">singleton</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Control.Auto.Collection.html#gatherMany__"><span class="hs-identifier hs-var">gatherMany__</span></a><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span>
</span><a name="line-757"></a><span class="hs-comment">-- | Much like 'gather', except allows you to pass in multiple key-value</span><span>
</span><a name="line-758"></a><span class="hs-comment">-- pairs every step, to update multiple internal 'Auto's.</span><span>
</span><a name="line-759"></a><span class="hs-comment">--</span><span>
</span><a name="line-760"></a><span class="hs-comment">-- &gt;&gt;&gt; import qualified Data.Map as M</span><span>
</span><a name="line-761"></a><span class="hs-comment">-- &gt;&gt;&gt; let sumUntil :: Interval' Int Int</span><span>
</span><a name="line-762"></a><span class="hs-comment">--         sumUntil = proc x -&gt; do</span><span>
</span><a name="line-763"></a><span class="hs-comment">--                        sums &lt;- sumFrom 0     -&lt; x</span><span>
</span><a name="line-764"></a><span class="hs-comment">--                        stop &lt;- became (&gt; 10) -&lt; sums</span><span>
</span><a name="line-765"></a><span class="hs-comment">--                        before -&lt; (sums, stop)</span><span>
</span><a name="line-766"></a><span class="hs-comment">--     -- (a running sum, &quot;on&quot; until the sum is greater than 10)</span><span>
</span><a name="line-767"></a><span class="hs-comment">-- &gt;&gt;&gt; let gm0 = gatherMany (\_ -&gt; sumUntil)</span><span>
</span><a name="line-768"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res1, gm1) = stepAuto' gm0 (M.fromList [ (&quot;hello&quot;, 5)</span><span>
</span><a name="line-769"></a><span class="hs-comment">--                                                 , (&quot;world&quot;, 7)</span><span>
</span><a name="line-770"></a><span class="hs-comment">--                                                 ])</span><span>
</span><a name="line-771"></a><span class="hs-comment">-- &gt;&gt;&gt; res1</span><span>
</span><a name="line-772"></a><span class="hs-comment">-- fromList [(&quot;hello&quot;, 5), (&quot;world&quot;, 7)]</span><span>
</span><a name="line-773"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res2, gm2) = stepAuto' gm1 (M.fromList [ (&quot;foo&quot;, 4)</span><span>
</span><a name="line-774"></a><span class="hs-comment">--                                                 , (&quot;hello&quot;, 3)</span><span>
</span><a name="line-775"></a><span class="hs-comment">--                                                 ])</span><span>
</span><a name="line-776"></a><span class="hs-comment">-- &gt;&gt;&gt; res2</span><span>
</span><a name="line-777"></a><span class="hs-comment">-- fromList [(&quot;foo&quot;, 4), (&quot;hello&quot;, 8), (&quot;world&quot;, 7)]</span><span>
</span><a name="line-778"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res3, gm3) = stepAuto' gm2 (M.fromList [ (&quot;world&quot;, 8)</span><span>
</span><a name="line-779"></a><span class="hs-comment">--                                                 , (&quot;bar&quot;, 9)</span><span>
</span><a name="line-780"></a><span class="hs-comment">--                                                 ])</span><span>
</span><a name="line-781"></a><span class="hs-comment">-- &gt;&gt;&gt; res3</span><span>
</span><a name="line-782"></a><span class="hs-comment">-- fromList [(&quot;bar&quot;, 9), (&quot;foo&quot;, 4), (&quot;hello&quot;, 8)]</span><span>
</span><a name="line-783"></a><span class="hs-comment">-- &gt;&gt;&gt; let (res4, _  ) = stepAuto' gm3 (M.fromList [ (&quot;world&quot;, 2)</span><span>
</span><a name="line-784"></a><span class="hs-comment">--                                                 , (&quot;bar&quot;, 10)</span><span>
</span><a name="line-785"></a><span class="hs-comment">--                                                 ])</span><span>
</span><a name="line-786"></a><span class="hs-comment">-- &gt;&gt;&gt; res4</span><span>
</span><a name="line-787"></a><span class="hs-comment">-- fromList [(&quot;foo&quot;, 4), (&quot;hello&quot;, 8), (&quot;world&quot;, 2)]</span><span>
</span><a name="line-788"></a><span class="hs-comment">--</span><span>
</span><a name="line-789"></a><span class="hs-comment">-- See 'gather' for more notes.</span><span>
</span><a name="line-790"></a><span class="hs-identifier">gatherMany</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475436"><a href="#local-1627475436"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475437"><a href="#local-1627475437"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475438"><a href="#local-1627475438"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475439"><a href="#local-1627475439"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475436"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475438"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475436"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475439"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-791"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475436"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475438"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475437"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475439"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ function to create a new</span><span>
</span><a name="line-792"></a><span>                                          </span><span class="hs-comment">--   'Auto' if none at that key</span><span>
</span><a name="line-793"></a><span>                                          </span><span class="hs-comment">--   already exists</span><span>
</span><a name="line-794"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475438"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475436"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475437"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475436"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475439"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-795"></a><a name="gatherMany"><a href="Control.Auto.Collection.html#gatherMany"><span class="hs-identifier">gatherMany</span></a></a><span> </span><a name="local-1627475707"><a href="#local-1627475707"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Right</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#gatherFMany"><span class="hs-identifier hs-var">gatherFMany</span></a><span> </span><a href="#local-1627475708"><span class="hs-identifier hs-var">f'</span></a><span class="hs-special">)</span><span>
</span><a name="line-796"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-797"></a><span>    </span><span class="hs-identifier">f'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627475436"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475438"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475437"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475439"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-798"></a><span>    </span><a name="local-1627475708"><a href="#local-1627475708"><span class="hs-identifier">f'</span></a></a><span> </span><a name="local-1627475709"><a href="#local-1627475709"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475707"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475709"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-799"></a><span>
</span><a name="line-800"></a><span class="hs-comment">-- | The non-serializing/non-resuming version of 'gatherMany':</span><span>
</span><a name="line-801"></a><span class="hs-comment">--</span><span>
</span><a name="line-802"></a><span class="hs-comment">-- __Does__ serialize the actual __'Auto's__ themselves; the 'Auto's are</span><span>
</span><a name="line-803"></a><span class="hs-comment">-- all serialized and re-loaded/resumed when 'gatherMany_ f' is resumed.</span><span>
</span><a name="line-804"></a><span class="hs-comment">--</span><span>
</span><a name="line-805"></a><span class="hs-comment">-- Does __not__ serialize the &quot;last outputs&quot;, so resumed 'Auto's that have</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- not yet been re-run/accessed to get a fresh output are not represented</span><span>
</span><a name="line-807"></a><span class="hs-comment">-- in the output map at first.</span><span>
</span><a name="line-808"></a><span class="hs-comment">--</span><span>
</span><a name="line-809"></a><span class="hs-identifier">gatherMany_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475432"><a href="#local-1627475432"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475433"><a href="#local-1627475433"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475434"><a href="#local-1627475434"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475435"><a href="#local-1627475435"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475432"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475434"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475432"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475432"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475434"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475433"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475435"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- ^ function to create a new</span><span>
</span><a name="line-811"></a><span>                                          </span><span class="hs-comment">--   'Auto' if none at that key</span><span>
</span><a name="line-812"></a><span>                                          </span><span class="hs-comment">--   already exists</span><span>
</span><a name="line-813"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475434"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475432"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475433"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475432"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475435"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-814"></a><a name="gatherMany_"><a href="Control.Auto.Collection.html#gatherMany_"><span class="hs-identifier">gatherMany_</span></a></a><span> </span><a name="local-1627475710"><a href="#local-1627475710"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Right</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#gatherFMany_"><span class="hs-identifier hs-var">gatherFMany_</span></a><span> </span><a href="#local-1627475711"><span class="hs-identifier hs-var">f'</span></a><span class="hs-special">)</span><span>
</span><a name="line-815"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-816"></a><span>    </span><span class="hs-identifier">f'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627475432"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475434"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475433"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475435"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-817"></a><span>    </span><a name="local-1627475711"><a href="#local-1627475711"><span class="hs-identifier">f'</span></a></a><span> </span><a name="local-1627475712"><a href="#local-1627475712"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475710"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475712"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-818"></a><span>
</span><a name="line-819"></a><span class="hs-comment">-- | The non-serializing/non-resuming vervsion of 'gatherMany':</span><span>
</span><a name="line-820"></a><span class="hs-comment">--</span><span>
</span><a name="line-821"></a><span class="hs-comment">-- Serializes neither the 'Auto's themselves nor the &quot;last outputs&quot; ---</span><span>
</span><a name="line-822"></a><span class="hs-comment">-- essentially, serializes/resumes nothing.</span><span>
</span><a name="line-823"></a><span class="hs-identifier">gatherMany__</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475428"><a href="#local-1627475428"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475429"><a href="#local-1627475429"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475430"><a href="#local-1627475430"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475431"><a href="#local-1627475431"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475428"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475430"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-824"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475428"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475430"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475429"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475431"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- ^ function to create a new</span><span>
</span><a name="line-825"></a><span>                                            </span><span class="hs-comment">--   'Auto' if none at that key</span><span>
</span><a name="line-826"></a><span>                                            </span><span class="hs-comment">--   already exists</span><span>
</span><a name="line-827"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475430"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475428"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475429"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475428"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475431"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><a name="gatherMany__"><a href="Control.Auto.Collection.html#gatherMany__"><span class="hs-identifier">gatherMany__</span></a></a><span> </span><a name="local-1627475713"><a href="#local-1627475713"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Right</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#gatherFMany__"><span class="hs-identifier hs-var">gatherFMany__</span></a><span> </span><a href="#local-1627475714"><span class="hs-identifier hs-var">f'</span></a><span class="hs-special">)</span><span>
</span><a name="line-829"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-830"></a><span>    </span><span class="hs-identifier">f'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627475428"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475430"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475429"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475431"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-831"></a><span>    </span><a name="local-1627475714"><a href="#local-1627475714"><span class="hs-identifier">f'</span></a></a><span> </span><a name="local-1627475715"><a href="#local-1627475715"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475713"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475715"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-832"></a><span>
</span><a name="line-833"></a><span class="hs-identifier">gatherFMany</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475423"><a href="#local-1627475423"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475424"><a href="#local-1627475424"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475425"><a href="#local-1627475425"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475426"><a href="#local-1627475426"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627475427"><a href="#local-1627475427"><span class="hs-identifier">c</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475424"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475427"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475426"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475427"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475424"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475425"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475426"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-835"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475424"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475427"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475425"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475425"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475426"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-836"></a><a name="gatherFMany"><a href="Control.Auto.Collection.html#gatherFMany"><span class="hs-identifier">gatherFMany</span></a></a><span> </span><a name="local-1627475716"><a href="#local-1627475716"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475717"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-837"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-838"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475427"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475424"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475425"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475426"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-839"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475426"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-840"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475424"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475427"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475425"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475425"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475423"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475426"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-841"></a><span>    </span><a name="local-1627475717"><a href="#local-1627475717"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1627475722"><a href="#local-1627475722"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627475718"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475719"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627475722"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627475720"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627475722"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span>    </span><a name="local-1627475718"><a href="#local-1627475718"><span class="hs-identifier">l</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475717"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Collection.html#_loadAs"><span class="hs-identifier hs-var">_loadAs</span></a><span> </span><a href="#local-1627475716"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-843"></a><span>    </span><a name="local-1627475719"><a href="#local-1627475719"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1627475724"><a href="#local-1627475724"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keys</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>           </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-845"></a><span>           </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><a href="#local-1627475724"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-846"></a><span>    </span><a name="local-1627475720"><a href="#local-1627475720"><span class="hs-identifier">t</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_gatherFManyF"><span class="hs-identifier hs-var">_gatherFManyF</span></a><span> </span><a href="#local-1627475716"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475717"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-847"></a><span>
</span><a name="line-848"></a><span class="hs-identifier">gatherFMany_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475418"><a href="#local-1627475418"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475419"><a href="#local-1627475419"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475420"><a href="#local-1627475420"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475421"><a href="#local-1627475421"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627475422"><a href="#local-1627475422"><span class="hs-identifier">c</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475419"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475422"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-849"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475422"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475419"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475420"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475421"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-850"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475419"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475422"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475420"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475420"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475421"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-851"></a><a name="gatherFMany_"><a href="Control.Auto.Collection.html#gatherFMany_"><span class="hs-identifier">gatherFMany_</span></a></a><span> </span><a name="local-1627475725"><a href="#local-1627475725"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475726"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-852"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-853"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475422"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475419"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475420"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475421"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-854"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475421"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-855"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475419"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475422"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475420"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475420"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475418"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475421"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>    </span><a name="local-1627475726"><a href="#local-1627475726"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1627475731"><a href="#local-1627475731"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM"><span class="hs-identifier hs-var">mkAutoM</span></a><span> </span><a href="#local-1627475727"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475728"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-1627475729"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627475731"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-857"></a><span>    </span><a name="local-1627475727"><a href="#local-1627475727"><span class="hs-identifier">l</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475726"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Control.Auto.Collection.html#_loadAs"><span class="hs-identifier hs-var">_loadAs</span></a><span> </span><a href="#local-1627475725"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-858"></a><span>    </span><a name="local-1627475728"><a href="#local-1627475728"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">keys</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">elems</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-859"></a><span>        </span><span class="hs-operator hs-var">*&gt;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#saveAuto"><span class="hs-identifier hs-var">saveAuto</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-860"></a><span>    </span><a name="local-1627475729"><a href="#local-1627475729"><span class="hs-identifier">t</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#_gatherFManyF"><span class="hs-identifier hs-var">_gatherFManyF</span></a><span> </span><a href="#local-1627475725"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475726"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span class="hs-identifier">_loadAs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475413"><a href="#local-1627475413"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475414"><a href="#local-1627475414"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475415"><a href="#local-1627475415"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475416"><a href="#local-1627475416"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627475417"><a href="#local-1627475417"><span class="hs-identifier">c</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475413"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-1627475417"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475413"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-863"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475413"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475417"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475415"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475414"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475416"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-864"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475413"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475417"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475415"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475414"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475416"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-865"></a><a name="_loadAs"><a href="Control.Auto.Collection.html#_loadAs"><span class="hs-identifier">_loadAs</span></a></a><span> </span><a name="local-1627475733"><a href="#local-1627475733"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-866"></a><span>    </span><a name="local-1627475734"><a href="#local-1627475734"><span class="hs-identifier">kszs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-1627475413"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475417"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-867"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1627475736"><a href="#local-1627475736"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475737"><a href="#local-1627475737"><span class="hs-identifier">mz</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475736"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-1627475737"><span class="hs-identifier hs-var">mz</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475733"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475736"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-1627475737"><span class="hs-identifier hs-var">mz</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-1627475734"><span class="hs-identifier hs-var">kszs</span></a><span class="hs-special">)</span><span>
</span><a name="line-868"></a><span>    </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Control.Auto.Core.html#resumeAuto"><span class="hs-identifier hs-var">resumeAuto</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span>
</span><a name="line-871"></a><span class="hs-identifier">gatherFMany__</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475408"><a href="#local-1627475408"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475409"><a href="#local-1627475409"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475410"><a href="#local-1627475410"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475411"><a href="#local-1627475411"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627475412"><a href="#local-1627475412"><span class="hs-identifier">c</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475410"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-872"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475412"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475410"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475409"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475411"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-873"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475410"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475412"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475409"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475409"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475411"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-874"></a><a name="gatherFMany__"><a href="Control.Auto.Collection.html#gatherFMany__"><span class="hs-identifier">gatherFMany__</span></a></a><span> </span><a name="local-1627475738"><a href="#local-1627475738"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475739"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-875"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-876"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475412"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475410"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475409"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475411"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-877"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475411"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-878"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475410"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475412"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475409"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475409"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475408"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475411"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-879"></a><span>    </span><a name="local-1627475739"><a href="#local-1627475739"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1627475741"><a href="#local-1627475741"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Core.html#mkAutoM_"><span class="hs-identifier hs-var">mkAutoM_</span></a><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#_gatherFManyF"><span class="hs-identifier hs-var">_gatherFManyF</span></a><span> </span><a href="#local-1627475738"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-1627475739"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627475741"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-880"></a><span>
</span><a name="line-881"></a><span class="hs-comment">-- you know the type signature looks awful, but this function pretty much</span><span>
</span><a name="line-882"></a><span class="hs-comment">-- wrote itself because of the type signature.  Haskell is awesome, isn't</span><span>
</span><a name="line-883"></a><span class="hs-comment">-- it?  I could have never written this without Haskell's type system.</span><span>
</span><a name="line-884"></a><span class="hs-identifier">_gatherFManyF</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-1627475400"><a href="#local-1627475400"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475401"><a href="#local-1627475401"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475402"><a href="#local-1627475402"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475403"><a href="#local-1627475403"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627475404"><a href="#local-1627475404"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-1627475405"><a href="#local-1627475405"><span class="hs-identifier">inAuto</span></a></a><span> </span><a name="local-1627475406"><a href="#local-1627475406"><span class="hs-identifier">outAuto</span></a></a><span> </span><a name="local-1627475407"><a href="#local-1627475407"><span class="hs-identifier">outOut</span></a></a><span class="hs-operator">.</span><span>
</span><a name="line-885"></a><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-886"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-887"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-1627475405"><span class="hs-identifier hs-type">inAuto</span></a><span>  </span><span class="hs-glyph">~</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Interval.html#Interval"><span class="hs-identifier hs-type">Interval</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-888"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-1627475406"><span class="hs-identifier hs-type">outAuto</span></a><span> </span><span class="hs-glyph">~</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-889"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="#local-1627475407"><span class="hs-identifier hs-type">outOut</span></a><span>  </span><span class="hs-glyph">~</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-890"></a><span>                  </span><span class="hs-special">)</span><span>
</span><a name="line-891"></a><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475405"><span class="hs-identifier hs-type">inAuto</span></a><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- f</span><span>
</span><a name="line-892"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475405"><span class="hs-identifier hs-type">inAuto</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475406"><span class="hs-identifier hs-type">outAuto</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- go</span><span>
</span><a name="line-893"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475405"><span class="hs-identifier hs-type">inAuto</span></a><span class="hs-special">)</span><span>                  </span><span class="hs-comment">-- as</span><span>
</span><a name="line-894"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span>                                  </span><span class="hs-comment">-- ys</span><span>
</span><a name="line-895"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>                  </span><span class="hs-comment">-- xs</span><span>
</span><a name="line-896"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475407"><span class="hs-identifier hs-type">outOut</span></a><span>
</span><a name="line-897"></a><a name="_gatherFManyF"><a href="Control.Auto.Collection.html#_gatherFManyF"><span class="hs-identifier">_gatherFManyF</span></a></a><span> </span><a name="local-1627475742"><a href="#local-1627475742"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475743"><a href="#local-1627475743"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><a name="local-1627475745"><a href="#local-1627475745"><span class="hs-identifier">ys</span></a></a><span> </span><a name="local-1627475746"><a href="#local-1627475746"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-898"></a><span>    </span><a name="local-1627475755"><a href="#local-1627475755"><span class="hs-identifier">outs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><a href="#local-1627475750"><span class="hs-identifier hs-var">steps</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-899"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">outs'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rems</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-900"></a><span>        </span><span class="hs-special">(</span><a name="local-1627475756"><a href="#local-1627475756"><span class="hs-identifier">outs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475757"><a href="#local-1627475757"><span class="hs-identifier">rems</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-1627475755"><span class="hs-identifier hs-var">outs</span></a><span>
</span><a name="line-901"></a><span>        </span><a name="local-1627475758"><a href="#local-1627475758"><span class="hs-identifier">as'</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span><span> </span><a href="#local-1627475749"><span class="hs-identifier hs-var">allas</span></a><span> </span><a href="#local-1627475757"><span class="hs-identifier hs-var">rems</span></a><span>
</span><a name="line-902"></a><span>        </span><a name="local-1627475759"><a href="#local-1627475759"><span class="hs-identifier">ys'</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span><span> </span><a href="#local-1627475745"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="#local-1627475757"><span class="hs-identifier hs-var">rems</span></a><span>
</span><a name="line-903"></a><span>        </span><a name="local-1627475760"><a href="#local-1627475760"><span class="hs-identifier">as''</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-1627475756"><span class="hs-identifier hs-var">outs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-1627475758"><span class="hs-identifier hs-var">as'</span></a><span>
</span><a name="line-904"></a><span>        </span><a name="local-1627475761"><a href="#local-1627475761"><span class="hs-identifier">newys</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-1627475756"><span class="hs-identifier hs-var">outs'</span></a><span>
</span><a name="line-905"></a><span>        </span><a name="local-1627475762"><a href="#local-1627475762"><span class="hs-identifier">ys''</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span> </span><a href="#local-1627475761"><span class="hs-identifier hs-var">newys</span></a><span> </span><a href="#local-1627475759"><span class="hs-identifier hs-var">ys'</span></a><span>
</span><a name="line-906"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-1627475762"><span class="hs-identifier hs-var">ys''</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475743"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-1627475760"><span class="hs-identifier hs-var">as''</span></a><span> </span><a href="#local-1627475762"><span class="hs-identifier hs-var">ys''</span></a><span class="hs-special">)</span><span>
</span><a name="line-907"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-908"></a><span>    </span><a name="local-1627475747"><a href="#local-1627475747"><span class="hs-identifier">_mzxs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Control.Auto.Collection.html#e2m"><span class="hs-identifier hs-var">e2m</span></a><span> </span><a href="#local-1627475746"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-909"></a><span>    </span><a name="local-1627475748"><a href="#local-1627475748"><span class="hs-identifier">newas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapWithKey</span><span> </span><span class="hs-special">(</span><a href="Control.Auto.Collection.html#_muxgathermapF"><span class="hs-identifier hs-var">_muxgathermapF</span></a><span> </span><a href="#local-1627475742"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">difference</span><span> </span><a href="#local-1627475747"><span class="hs-identifier hs-var">_mzxs</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-910"></a><span>    </span><a name="local-1627475749"><a href="#local-1627475749"><span class="hs-identifier">allas</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">union</span><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-1627475748"><span class="hs-identifier hs-var">newas</span></a><span>
</span><a name="line-911"></a><span>    </span><span class="hs-identifier">steps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475400"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-912"></a><span>    </span><a name="local-1627475750"><a href="#local-1627475750"><span class="hs-identifier">steps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">intersectionWith</span><span> </span><a href="#local-1627475751"><span class="hs-identifier hs-var">interf</span></a><span> </span><a href="#local-1627475749"><span class="hs-identifier hs-var">allas</span></a><span> </span><a href="#local-1627475747"><span class="hs-identifier hs-var">_mzxs</span></a><span>
</span><a name="line-913"></a><span>    </span><span class="hs-identifier">interf</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-914"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-915"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475404"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#Auto"><span class="hs-identifier hs-type">Auto</span></a><span> </span><a href="#local-1627475401"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475402"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475403"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-916"></a><span>    </span><a name="local-1627475751"><a href="#local-1627475751"><span class="hs-identifier">interf</span></a></a><span> </span><span class="hs-special">(</span><a name="local-1627475752"><a href="#local-1627475752"><span class="hs-identifier">mc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1627475753"><a href="#local-1627475753"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-1627475754"><a href="#local-1627475754"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">(</span><a href="#local-1627475752"><span class="hs-identifier hs-var">mc</span></a><span class="hs-special">,</span><span> </span><a href="Control.Auto.Core.html#stepAuto"><span class="hs-identifier hs-var">stepAuto</span></a><span> </span><a href="#local-1627475753"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1627475754"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span>
</span><a name="line-918"></a><span class="hs-keyword">type</span><span> </span><a name="MapMerge"><a href="Control.Auto.Collection.html#MapMerge"><span class="hs-identifier">MapMerge</span></a></a><span> </span><a name="local-1627475383"><a href="#local-1627475383"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-1627475384"><a href="#local-1627475384"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-1627475385"><a href="#local-1627475385"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-1627475386"><a href="#local-1627475386"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-1627475387"><a href="#local-1627475387"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-1627475384"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475385"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475386"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475387"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-919"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475385"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475387"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-920"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475386"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475387"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-921"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475385"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475386"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475383"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475387"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-922"></a><span>
</span><a name="line-923"></a><span class="hs-identifier">genericZipMapWithDefaults</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="#local-1627475395"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475396"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1627475395"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-924"></a><span>                          </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Control.Auto.Collection.html#MapMerge"><span class="hs-identifier hs-type">MapMerge</span></a><span> </span><a href="#local-1627475395"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475397"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475398"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-1627475399"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-1627475396"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-925"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475398"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475399"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475396"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475398"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475399"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-926"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475395"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475398"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475395"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475399"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475395"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-1627475396"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-927"></a><a name="genericZipMapWithDefaults"><a href="Control.Auto.Collection.html#genericZipMapWithDefaults"><span class="hs-identifier">genericZipMapWithDefaults</span></a></a><span> </span><a name="local-1627475763"><a href="#local-1627475763"><span class="hs-identifier">mm</span></a></a><span> </span><a name="local-1627475764"><a href="#local-1627475764"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-1627475765"><a href="#local-1627475765"><span class="hs-identifier">x0</span></a></a><span> </span><a name="local-1627475766"><a href="#local-1627475766"><span class="hs-identifier">y0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1627475763"><span class="hs-identifier hs-var">mm</span></a><span> </span><a href="#local-1627475767"><span class="hs-identifier hs-var">f'</span></a><span> </span><a href="#local-1627475768"><span class="hs-identifier hs-var">zx</span></a><span> </span><a href="#local-1627475769"><span class="hs-identifier hs-var">zy</span></a><span>
</span><a name="line-928"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-929"></a><span>    </span><a name="local-1627475767"><a href="#local-1627475767"><span class="hs-identifier">f'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-1627475770"><a href="#local-1627475770"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-1627475771"><a href="#local-1627475771"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-1627475770"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-1627475764"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627475771"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-930"></a><span>    </span><a name="local-1627475768"><a href="#local-1627475768"><span class="hs-identifier">zx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627475766"><span class="hs-identifier hs-var">y0</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-931"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-932"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627475772"><a href="#local-1627475772"><span class="hs-identifier">y'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="#local-1627475764"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">`</span><span> </span><a href="#local-1627475772"><span class="hs-identifier hs-var">y'</span></a><span class="hs-special">)</span><span>
</span><a name="line-933"></a><span>    </span><a name="local-1627475769"><a href="#local-1627475769"><span class="hs-identifier">zy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1627475765"><span class="hs-identifier hs-var">x0</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-934"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-935"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1627475773"><a href="#local-1627475773"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-1627475773"><span class="hs-identifier hs-var">x'</span></a><span> </span><span class="hs-special">`</span><a href="#local-1627475764"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">`</span><span class="hs-special">)</span><span>
</span><a name="line-936"></a><span>
</span><a name="line-937"></a><span class="hs-identifier">zipIntMapWithDefaults</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-1627475392"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475393"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475394"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475392"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475393"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475392"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475393"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="#local-1627475394"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-938"></a><a name="zipIntMapWithDefaults"><a href="Control.Auto.Collection.html#zipIntMapWithDefaults"><span class="hs-identifier">zipIntMapWithDefaults</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#genericZipMapWithDefaults"><span class="hs-identifier hs-var">genericZipMapWithDefaults</span></a><span> </span><span class="hs-identifier hs-var">IM</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mergeWithKey</span><span>
</span><a name="line-939"></a><span>
</span><a name="line-940"></a><span class="hs-identifier">_zipMapWithDefaults</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-1627475388"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1627475389"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475390"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1627475391"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475389"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1627475390"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475388"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475389"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475388"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475390"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-1627475388"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-1627475391"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-941"></a><a name="_zipMapWithDefaults"><a href="Control.Auto.Collection.html#_zipMapWithDefaults"><span class="hs-identifier">_zipMapWithDefaults</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Control.Auto.Collection.html#genericZipMapWithDefaults"><span class="hs-identifier hs-var">genericZipMapWithDefaults</span></a><span> </span><span class="hs-identifier hs-var">M</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mergeWithKey</span><span>
</span><a name="line-942"></a></pre></body></html>